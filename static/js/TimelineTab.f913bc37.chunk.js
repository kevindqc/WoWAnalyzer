(this.webpackJsonpwowanalyzer=this.webpackJsonpwowanalyzer||[]).push([[52],{1148:function(e,t,n){},1149:function(e,t,n){},1150:function(e,t,n){},1151:function(e,t,n){},1313:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(753),s=n(797),l=n(26),c=n(8),o=n(9),u=n(23),d=n(10),f=n(11),p=n(15),h=n(33),m=n(7),v=n(31),b=n(27),y=function(e){var t=e.children,n=e.style,r=void 0===n?{}:n,s=Object(b.a)(e,["children","style"]),l=Object(a.useState)(!1),c=Object(v.a)(l,2),o=c[0],u=c[1],d=Object(a.useRef)(null),f=Object(a.useRef)([0,0]),p=Object(a.useRef)(o),h=Object(a.useCallback)((function(){u(!1),p.current=!1}),[]),y=Object(a.useCallback)((function(e){p.current&&null!==d.current&&(d.current.scrollLeft-=-f.current[0]+e.clientX,d.current.scrollTop-=-f.current[1]+e.clientY,f.current=[e.clientX,e.clientY])}),[]);return Object(a.useEffect)((function(){return window.addEventListener("mouseup",h),window.addEventListener("mousemove",y),function(){window.removeEventListener("mouseup",h),window.removeEventListener("mousemove",y)}}),[h,y]),i.a.createElement("div",Object.assign({onMouseDown:function(e){0===e.button&&(u(!0),p.current=!0,f.current=[e.clientX,e.clientY],e.preventDefault())},ref:d,style:Object(m.a)(Object(m.a)({},r),{},{cursor:o?"grabbing":"grab"})},s),t)},g=n(833),E=(n(776),n(1148),n(6)),C=n(28),O=n(4),k=n(22),w=(n(1149),function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this))._applied={},e._levels=[],e._maxLevel=0,e.renderEvent=e.renderEvent.bind(Object(u.a)(e)),e}return Object(o.a)(n,[{key:"getOffsetLeft",value:function(e){return(e-this.props.start)/1e3*this.props.secondWidth}},{key:"isApplicableBuffEvent",value:function(e){if(!this.props.parser.toPlayer(e))return!1;var t=e.ability.guid,n=this.props.buffs.getBuff(t);return!(!n||!n.timelineHighlight)}},{key:"renderEvent",value:function(e){switch(e.type){case p.b.ApplyBuff:return this.isApplicableBuffEvent(e)?this.renderApplyBuff(e):null;case p.b.RemoveBuff:return this.isApplicableBuffEvent(e)?this.renderRemoveBuff(e):null;case p.b.FightEnd:return this.renderLeftOverBuffs(e);default:return null}}},{key:"_getLevel",value:function(){for(var e=0;void 0!==this._levels[e];)e+=1;return e}},{key:"renderApplyBuff",value:function(e){var t=e.ability.guid,n=this._getLevel();return this._applied[t]=e,this._levels[n]=t,this._maxLevel=Math.max(this._maxLevel,n),this.renderIcon(e,{className:"hoist",style:{"--level":n},children:i.a.createElement("div",{className:"time-indicator"})})}},{key:"renderRemoveBuff",value:function(e){var t=this._applied[e.ability.guid];if(!t)return null;var n=this.getOffsetLeft(t.timestamp),a=e.timestamp-t.timestamp,r=(t.timestamp-this.props.start)/1e3,s=this._levels.indexOf(e.ability.guid);return this._levels[s]=void 0,delete this._applied[e.ability.guid],i.a.createElement(k.b,{key:"buff-".concat(n,"-").concat(e.ability.guid),content:i.a.createElement(E.Trans,{id:"interface.report.results.timeline.buffs.tooltip.gainedAbilityForXSec",values:{0:Object(h.a)(r,3),1:e.ability.name,2:(a/1e3).toFixed(2)}})},i.a.createElement("div",{className:"buff hoist",style:{left:n,width:(e.timestamp-t.timestamp)/1e3*this.props.secondWidth,"--level":s},"data-effect":"float"}))}},{key:"renderLeftOverBuffs",value:function(e){var t=this,n=[];return Object.keys(this._applied).forEach((function(a){var i=t._applied[a];n.push(t.renderRemoveBuff(Object(m.a)(Object(m.a)({},i),{},{timestamp:e.timestamp})))})),n}},{key:"renderIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.className,a=void 0===n?"":n,r=t.style,s=void 0===r?{}:r,l=t.children,c=this.getOffsetLeft(e.timestamp);return i.a.createElement(O.a,{key:"cast-".concat(c,"-").concat(e.ability.guid),id:e.ability.guid,icon:!1,className:"cast ".concat(a),style:Object(m.a)({left:c},s)},i.a.createElement(C.a,{icon:e.ability.abilityIcon.replace(".jpg",""),alt:e.ability.name}),l)}},{key:"render",value:function(){var e=this.props.parser.eventHistory.map(this.renderEvent);return i.a.createElement("div",{className:"buffs",style:{"--levels":this._maxLevel+1}},e)}}]),n}(i.a.PureComponent)),j=(n(1150),function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this))._lastLowered=null,e._level=0,e._maxLevel=0,e.renderEvent=e.renderEvent.bind(Object(u.a)(e)),e}return Object(o.a)(n,[{key:"getOffsetLeft",value:function(e){return(e-this.props.start)/1e3*this.props.secondWidth}},{key:"isApplicableCastEvent",value:function(e){if(!this.props.parser.byPlayer(e))return!1;var t=e.ability.guid;return!g.a.includes(t)}},{key:"renderEvent",value:function(e){switch(e.type){case p.b.Cast:return this.isApplicableCastEvent(e)?this.renderCast(e):null;case p.b.BeginChannel:return this.isApplicableCastEvent(e)?this.renderBeginChannel(e):null;case p.b.EndChannel:return this.renderChannel(e);case p.b.GlobalCooldown:return this.renderGlobalCooldown(e);default:return null}}},{key:"renderCast",value:function(e){if(e.channel)return null;var t,n="",a=this.getOffsetLeft(e.timestamp),r=!e.globalCooldown,s=0;if(r){n+=" lower";var l=a-this._lastLowered;this._lastLowered&&l<22?(this._level+=1,s=this._level,this._maxLevel=Math.max(this._maxLevel,s)):this._level=0,this._lastLowered=a}var c=e.meta;return c&&(c.isInefficientCast?(n+=" inefficient",t=c.inefficientCastReason):c.isEnhancedCast&&(n+=" enhanced",t=c.enhancedCastReason)),this.renderIcon(e,{className:n,style:{"--level":s>0?s:void 0},children:r?i.a.createElement("div",{className:"time-indicator"}):void 0,tooltip:t})}},{key:"renderBeginChannel",value:function(e){var t,n="";e.isCancelled&&(n+=" cancelled",t=i.a.createElement(E.Trans,{id:"interface.report.results.timeline.casts.neverFinished"}));var a=e.meta||e.trigger&&e.trigger.meta||e.trigger&&e.trigger.type===p.b.BeginCast&&e.trigger.castEvent&&e.trigger.castEvent.meta;return a&&(a.isInefficientCast?(n+=" inefficient",t=a.inefficientCastReason):a.isEnhancedCast&&(n+=" enhanced",t=a.enhancedCastReason)),this.renderIcon(e,{className:n,tooltip:t})}},{key:"renderIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.className,a=void 0===n?"":n,r=t.style,s=void 0===r?{}:r,l=t.children,c=t.tooltip,o=this.getOffsetLeft(e.timestamp),u=function(t){return i.a.createElement(O.a,{id:e.ability.guid,icon:!1,className:"cast ".concat(a),style:Object(m.a)({left:o},s)},t)},d=i.a.createElement(i.a.Fragment,null,i.a.createElement(C.a,{icon:e.ability.abilityIcon.replace(".jpg",""),alt:e.ability.name}),l);return i.a.createElement(i.a.Fragment,{key:"cast-".concat(o,"-").concat(e.ability.guid)},c?i.a.createElement(k.b,{content:c},i.a.createElement("div",{className:"cast ".concat(a),style:Object(m.a)({left:o},s)},d)):u(d))}},{key:"renderChannel",value:function(e){var t=this.props.start,n=this.getOffsetLeft(e.start),a=(e.start-t)/1e3;return i.a.createElement(k.b,{key:"channel-".concat(n,"-").concat(e.ability.guid),content:i.a.createElement(E.Trans,{id:"interface.report.results.timeline.casts.tooltip.xSecChannelByAbility",values:{0:Object(h.a)(a,3),1:(e.duration/1e3).toFixed(2),2:e.ability.name}})},i.a.createElement("div",{className:"channel",style:{left:n,width:e.duration/1e3*this.props.secondWidth}}))}},{key:"renderGlobalCooldown",value:function(e){var t=this.props.start,n=this.getOffsetLeft(e.timestamp),a=(e.timestamp-t)/1e3;return i.a.createElement(k.b,{key:"gcd-".concat(n,"-").concat(e.ability.guid),content:i.a.createElement(E.Trans,{id:"interface.report.results.timeline.casts.tooltip.xSecGCDByAbility",values:{0:Object(h.a)(a,3),1:(e.duration/1e3).toFixed(2),2:e.ability.name}})},i.a.createElement("div",{className:"gcd",style:{left:n,width:e.duration/1e3*this.props.secondWidth}}))}},{key:"render",value:function(){var e=this.props.parser.eventHistory.map(this.renderEvent);return i.a.createElement("div",{className:"casts",style:{"--levels":this._maxLevel+1}},e)}}]),n}(i.a.PureComponent)),L=(n(1151),function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getOffsetLeft",value:function(e){return(e-this.props.fightStartTimestamp)/1e3*this.props.secondWidth}},{key:"renderEvent",value:function(e){switch(e.type){case p.b.FilterCooldownInfo:case p.b.Cast:return this.renderCast(e);case p.b.UpdateSpellUsable:return e.trigger===p.b.RestoreCharge?i.a.createElement(i.a.Fragment,{key:"restorecharge-".concat(e.timestamp)},this.renderCooldown(e),this.renderRecharge(e)):this.renderCooldown(e);default:return null}}},{key:"renderCast",value:function(e){var t=this.getOffsetLeft(Math.max(this.props.fightStartTimestamp-1e3,e.timestamp)),n=e.ability.guid;return i.a.createElement(O.a,{key:"cast-".concat(n,"-").concat(t),id:n,icon:!1,className:"cast",style:{left:t}},i.a.createElement(C.a,{icon:e.ability.abilityIcon.replace(".jpg",""),alt:e.ability.name}))}},{key:"renderCooldown",value:function(e){var t=this.getOffsetLeft(Math.max(this.props.fightStartTimestamp-1e3,e.start)),n=(Math.min(this.props.fightEndTimestamp,e.timestamp)-Math.max(this.props.fightStartTimestamp-1e3,e.start))/1e3*this.props.secondWidth;return i.a.createElement(k.b,{key:"cooldown-".concat(t),content:i.a.createElement(E.Trans,{id:"interface.report.results.timeline.lane.tooltip.eventOrAbilityCooldown",values:{0:e.name||e.ability.name,1:((e.timestamp-e.start)/1e3).toFixed(1)}})},i.a.createElement("div",{className:"cooldown",style:{left:t,width:n},"data-effect":"float"}))}},{key:"renderRecharge",value:function(e){if(e.timestamp>this.props.fightEndTimestamp)return null;var t=this.getOffsetLeft(e.timestamp);return i.a.createElement(k.b,{content:i.a.createElement(E.Trans,{id:"interface.report.results.timeline.lane.tooltip.chargeRestored"})},i.a.createElement("div",{key:"recharge-".concat(t),className:"recharge",style:{left:t}}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,a=t.style,r=n[0].ability;if(n[0].type===p.b.FilterCooldownInfo||n[0].type===p.b.Cast){var s=n.slice(1,n.length),l=s.findIndex((function(e){return e.type===p.b.Cast||e.type===p.b.FilterCooldownInfo}))+1,c=s.find((function(e){return e.type===p.b.UpdateSpellUsable&&"endcooldown"===e.trigger}));c&&c.end<this.props.fightStartTimestamp-1e3&&n.splice(0,l||n.length)}return n.length>0&&i.a.createElement("div",{className:"lane",style:a},i.a.createElement("div",{className:"legend"},i.a.createElement(C.a,{icon:r.abilityIcon.replace(".jpg",""),alt:r.name})),n.map((function(t){return e.renderEvent(t)})))}}]),n}(i.a.PureComponent)),_=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getSortIndex",value:function(e){var t=Object(v.a)(e,2),n=t[0],a=t[1],i=this.props.abilities.getAbility(n);return i&&void 0!==i.timelineSortIndex?i.timelineSortIndex:1e3-a.length}},{key:"renderLanes",value:function(e,t){var n=this;return Array.from(e).sort((function(e,a){return n.getSortIndex(t?a:e)-n.getSortIndex(t?e:a)})).map((function(e){return n.renderLane(e)}))}},{key:"renderLane",value:function(e){var t=Object(v.a)(e,2),n=t[0],a=t[1];return i.a.createElement(L,{key:n,spellId:n,fightStartTimestamp:this.props.start,fightEndTimestamp:this.props.end,secondWidth:this.props.secondWidth},a)}},{key:"render",value:function(){var e=this.props.eventsBySpellId;return i.a.createElement("div",{className:"cooldowns"},this.renderLanes(e,!1))}}]),n}(i.a.PureComponent),I=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={zoom:2,padding:0},a.setContainerRef=a.setContainerRef.bind(Object(u.a)(a)),a}return Object(o.a)(n,[{key:"isApplicableEvent",value:function(e){switch(e.type){case p.b.FilterCooldownInfo:case p.b.Cast:return this.isApplicableCastEvent(e);case p.b.UpdateSpellUsable:return this.isApplicableUpdateSpellUsableEvent(e);default:return!1}}},{key:"isApplicableCastEvent",value:function(e){if(!this.props.parser.byPlayer(e))return!1;var t=e.ability.guid;if(g.a.includes(t))return!1;var n=this.props.abilities.getAbility(t);return!(!n||!n.cooldown)&&!(e.timestamp>=this.end)}},{key:"isApplicableUpdateSpellUsableEvent",value:function(e){if(e.trigger!==p.b.EndCooldown&&e.trigger!==p.b.RestoreCharge)return!1;if(e.trigger===p.b.RestoreCharge&&e.timestamp<this.start)return!1;var t=e.ability.guid;return!g.a.includes(t)}},{key:"getEventsBySpellId",value:function(e){var t=this,n=new Map;return e.forEach((function(e){if(t.isApplicableEvent(e)){var a=t._getCanonicalId(e.ability.guid);n.has(a)||n.set(a,[]),n.get(a).push(e)}})),n}},{key:"_getCanonicalId",value:function(e){var t=this.props.abilities.getAbility(e);return t?t.spell instanceof Array?t.spell[0].id:t.spell.id:e}},{key:"setContainerRef",value:function(e){e&&e.getBoundingClientRect&&this.setState({padding:e.getBoundingClientRect().x+15})}},{key:"render",value:function(){var e=this,t=this.props,n=t.parser,a=t.abilities,r=t.buffs,s=Math.ceil(40/this.secondWidth),c=this.getEventsBySpellId(n.eventHistory);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"container",ref:this.setContainerRef}),i.a.createElement(y,{className:"spell-timeline-container"},i.a.createElement("div",{className:"spell-timeline",style:{width:this.totalWidth+2*this.state.padding,paddingTop:0,paddingBottom:0,paddingLeft:this.state.padding,paddingRight:this.state.padding,margin:"auto"}},i.a.createElement(w,{start:this.start,secondWidth:this.secondWidth,parser:n,buffs:r}),i.a.createElement("div",{className:"time-line"},this.seconds>0&&Object(l.a)(Array(Math.ceil(this.seconds))).map((function(t,n){return i.a.createElement("div",{key:n+e.offset/1e3,style:{width:e.secondWidth*s},"data-duration":Object(h.a)(n+e.offset/1e3)})}))),i.a.createElement(j,{start:this.start,secondWidth:this.secondWidth,parser:n}),i.a.createElement(_,{start:this.start,end:this.end,secondWidth:this.secondWidth,eventsBySpellId:c,abilities:a}))))}},{key:"fight",get:function(){return this.props.parser.fight}},{key:"start",get:function(){return this.fight.start_time}},{key:"end",get:function(){return this.fight.end_time}},{key:"offset",get:function(){return this.fight.offset_time}},{key:"duration",get:function(){return this.end-this.start}},{key:"seconds",get:function(){return this.duration/1e3}},{key:"secondWidth",get:function(){return 120/this.state.zoom}},{key:"totalWidth",get:function(){return this.seconds*this.secondWidth}}]),n}(i.a.PureComponent);I.defaultProps={showCooldowns:!0,showGlobalCooldownDuration:!1};var x=I;t.default=function(e){var t=e.parser;return i.a.createElement(x,{parser:t,abilities:t.getModule(r.a),buffs:t.getModule(s.a)})}}}]);
//# sourceMappingURL=TimelineTab.f913bc37.chunk.js.map