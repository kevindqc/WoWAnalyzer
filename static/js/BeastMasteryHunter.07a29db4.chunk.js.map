{"version":3,"sources":["parser/hunter/beastmastery/modules/core/SpellUsable.tsx","parser/hunter/beastmastery/modules/core/GlobalCooldown.tsx","parser/hunter/beastmastery/modules/Abilities.tsx","parser/hunter/beastmastery/modules/Buffs.tsx","parser/hunter/beastmastery/modules/features/CooldownThroughputTracker.tsx","parser/hunter/beastmastery/modules/features/AlwaysBeCasting.tsx","parser/hunter/beastmastery/modules/pets/basicAttacksTracker.tsx","parser/hunter/beastmastery/modules/resources/BeastMasteryFocusCapTracker.tsx","parser/hunter/beastmastery/modules/spells/BarbedShot.tsx","parser/hunter/beastmastery/modules/spells/BeastCleave.tsx","parser/hunter/beastmastery/modules/spells/BestialWrath.tsx","parser/hunter/beastmastery/modules/spells/CobraShot.tsx","parser/hunter/beastmastery/modules/talents/KillerCobra.tsx","parser/hunter/beastmastery/modules/checklist/Component.tsx","parser/hunter/beastmastery/modules/items/QaplaEredunWarOrder.tsx","parser/hunter/beastmastery/modules/checklist/Module.tsx","parser/hunter/beastmastery/modules/talents/KillerInstinct.tsx","parser/hunter/beastmastery/modules/talents/ChimaeraShot.tsx","parser/hunter/beastmastery/modules/talents/DireBeast.tsx","parser/hunter/beastmastery/modules/talents/Stampede.tsx","parser/hunter/beastmastery/modules/talents/Stomp.tsx","parser/hunter/beastmastery/modules/talents/ThrillOfTheHunt.tsx","parser/hunter/beastmastery/modules/talents/OneWithThePack.tsx","parser/hunter/beastmastery/modules/talents/AspectOfTheBeast.tsx","parser/hunter/beastmastery/modules/talents/SpittingCobra.tsx","parser/hunter/beastmastery/modules/talents/ScentOfBlood.tsx","parser/hunter/beastmastery/modules/talents/AnimalCompanion.tsx","parser/hunter/beastmastery/modules/spells/AspectOfTheWild.tsx","parser/hunter/beastmastery/modules/resources/Focus.tsx","parser/hunter/beastmastery/modules/resources/BeastMasteryFocusUsage.tsx","parser/hunter/beastmastery/modules/spells/conduits/Bloodletting.tsx","parser/hunter/beastmastery/modules/spells/conduits/EchoingCall.tsx","parser/hunter/beastmastery/modules/spells/conduits/FerociousAppetite.tsx","parser/hunter/beastmastery/modules/spells/conduits/OneWithTheBeast.tsx","parser/hunter/beastmastery/modules/items/DireCommand.tsx","parser/hunter/beastmastery/modules/items/FlamewakersCobraSting.tsx","parser/hunter/beastmastery/modules/items/RylakstalkersPiercingFangs.tsx","parser/hunter/beastmastery/modules/items/NesingwarysTrappingApparatus.tsx","parser/hunter/beastmastery/CombatLogParser.tsx","parser/core/calculateEffectiveDamage.js","interface/icons/Uptime.js","parser/core/calculateEffectiveHealing.js","interface/statistics/components/ConduitSpellText/index.tsx","parser/hunter/survival/constants.tsx","parser/hunter/beastmastery/constants.tsx","interface/statistics/components/DonutChart/index.js","interface/others/charts/OneVariableBinomialChart.js","parser/shared/modules/helpers/Probability.tsx","parser/shared/ExecuteHelper.ts","interface/others/AverageTargetsHit.js","parser/shared/modules/helpers/Stacks.tsx","parser/shared/modules/resources/resourcetracker/ResourceSuggest.tsx","parser/shared/modules/resources/resourcetracker/RegenResourceCapTracker.js","parser/hunter/shared/modules/resources/FocusTracker.tsx","parser/shared/modules/pets/helpers.tsx","parser/hunter/shared/modules/spells/covenants/venthyr/FlayedShot.tsx","parser/hunter/shared/modules/resources/FocusDetails.tsx","parser/hunter/shared/modules/resources/FocusCapTracker.tsx","parser/hunter/shared/modules/core/DeathTracker.tsx","parser/hunter/shared/modules/talents/NaturalMending.tsx","parser/hunter/shared/modules/talents/Trailblazer.tsx","parser/hunter/shared/modules/talents/AMurderOfCrows.tsx","parser/hunter/shared/modules/talents/BornToBeWild.tsx","parser/hunter/shared/modules/talents/BindingShot.tsx","parser/hunter/shared/modules/spells/KillShot.tsx","parser/hunter/shared/modules/resources/SpellFocusCost.tsx","parser/hunter/shared/modules/spells/covenants/kyrian/ResonatingArrow.tsx","parser/hunter/shared/modules/spells/covenants/necrolord/DeathChakrams.tsx","parser/hunter/shared/modules/spells/covenants/nightfae/WildSpirits.tsx","parser/hunter/shared/modules/spells/conduits/kyrian/EnfeebledMark.tsx","parser/hunter/shared/modules/spells/conduits/venthyr/EmpoweredRelease.tsx","parser/hunter/shared/modules/spells/conduits/necrolord/NecroticBarrage.tsx","parser/hunter/shared/modules/spells/conduits/nightfae/SpiritAttunement.tsx","parser/hunter/shared/modules/items/SoulforgeEmbers.tsx","parser/shared/modules/resources/ResourceUsage.tsx","parser/hunter/shared/modules/resources/FocusUsage.tsx","parser/hunter/shared/modules/talents/Barrage.tsx"],"names":["SpellUsable","lastPotentialTriggerForBarbedShotReset","event","spellId","ability","guid","SPELLS","AUTO_SHOT","id","this","BARBED_SHOT","cooldownTriggerEvent","isOnCooldown","endCooldown","undefined","timestamp","CoreSpellUsable","dependencies","GlobalCooldown","haste","gcd","AOTW_GCD_REDUCTION_AFFECTED_ABILITIES","includes","selectedCombatant","hasBuff","ASPECT_OF_THE_WILD","unhastedAspectGCD","MAX_GCD","hastepercent","current","Math","max","MIN_GCD","CoreGlobalCooldown","Haste","Abilities","combatant","spell","BESTIAL_WRATH","category","SPELL_CATEGORIES","COOLDOWNS","cooldown","base","timelineSortIndex","castEfficiency","suggestion","recommendedEfficiency","extraSuggestion","SpellLink","KILL_COMMAND_CAST_BM","ROTATIONAL","hastedCooldown","COBRA_SHOT","ARCANE_SHOT","charges","hasConduitBySpellID","BLOODLETTING_CONDUIT","MULTISHOT_BM","ROTATIONAL_AOE","static","ASPECT_OF_THE_TURTLE","DEFENSIVE","isDefensive","hasTalent","BORN_TO_BE_WILD_TALENT","EXHILARATION","SURVIVAL_OF_THE_FITTEST","ASPECT_OF_THE_CHEETAH","UTILITY","DISENGAGE","CONCUSSIVE_SHOT","COUNTER_SHOT","MISDIRECTION","FREEZING_TRAP","TAR_TRAP","FEIGN_DEATH","FLARE","HUNTERS_MARK","DIRE_BEAST_TALENT","enabled","BARRAGE_TALENT","STAMPEDE_TALENT","CHIMAERA_SHOT_BM_TALENT","BLOODSHED_TALENT","CAMOUFLAGE_TALENT","PRIMAL_RAGE_1","PRIMAL_RAGE_2","MASTERS_CALL","INTIMIDATION","CALL_PET_1","CALL_PET_2","CALL_PET_3","CALL_PET_4","CALL_PET_5","DISMISS_PET","MEND_PET","CoreAbilities","Buffs","timelineHighlight","triggeredBySpellId","DIRE_BEAST_BUFF","BARBED_SHOT_PET_BUFF","BEAST_CLEAVE_BUFF","Object","keys","BLOODLUST_BUFFS","map","item","Number","CoreBuffs","CooldownThroughputTracker","CoreCooldownThroughputTracker","cooldownSpells","summary","BUILT_IN_SUMMARY_TYPES","DAMAGE","ignoredSpells","BINDING_SHOT_TETHER","BINDING_SHOT_ROOT","AlwaysBeCasting","when","suggestionThresholds","addSuggestion","suggest","actual","recommended","icon","i18n","_","formatPercentage","activeTimePercentage","isLessThan","minor","average","major","style","ThresholdStyle","PERCENTAGE","CoreAlwaysBeCasting","BasicAttacks","options","lastCast","timeBetweenAttacks","totalCasts","chainCasts","damage","usedBasicAttack","BITE_BASIC_ATTACK","basicAttackChecked","addEventListener","Events","by","SELECTED_PLAYER_PET","BASIC_ATTACK_SPELLS","onPetBasicAttackDamage","name","abilityIcon","amount","absorbed","MAX_TIME_BETWEEN_BASIC_ATK","dreamScenario","usedTimeBetween","NO_DELAY_TIME_BETWEEN_BASIC_ATK","MACRO_TIME_BETWEEN_BASIC_ATK","floor","potentialExtraCasts","totalAttacksFromBasicAttacks","Statistic","position","STATISTIC_ORDER","OPTIONAL","size","dropdown","className","formatNumber","potentialExtraDamage","owner","fightDuration","BoringSpellValueText","ItemDamageDone","isGreaterThan","NUMBER","Analyzer","BeastMasteryFocusCapTracker","BEAST_MASTERY_FOCUS_REGEN","BEAST_MASTERY_FOCUS_MAX","FocusCapTracker","BarbedShot","barbedShotStacks","lastBarbedShotStack","lastBarbedShotUpdate","fight","start_time","additionalFocusFromNesingwary","possibleAdditionalFocusFromNesingwary","Array","from","length","MAX_FRENZY_STACKS","x","applybuff","SELECTED_PLAYER","handleStacks","applybuffstack","removebuff","to","fightend","hasLegendaryByBonusID","NESINGWARYS_TRAPPING_APPARATUS_EFFECT","bonusID","energize","BARBED_SHOT_FOCUS_REGEN_BUFFS","checkNesingwaryFocusGain","push","type","EventType","FightEnd","currentStacks","avgStacks","forEach","elem","index","reduce","a","b","waste","BARBED_SHOT_REGEN","resourceChange","NESINGWARYS_TRAPPING_APPARATUS_ENERGIZE","NESINGWARY_FOCUS_GAIN_MULTIPLIER","frenzyUptimeThreshold","frenzy3StackThreshold","tooltip","getAverageBarbedShotStacks","toFixed","percentUptimePet","percentPlayerUptime","values","barbedShotTimesByStacks","e","i","key","formatDuration","Uptime","percentUptimeMaxStacks","slice","acc","val","concat","totalUptime","stackUptime","getBuffUptime","BARBED_SHOT_BUFF","BeastCleave","cleaveUp","beastCleaveHits","casts","castsWithoutHits","BEAST_CLEAVE_PET_BUFF","onApplyBuff","onRemoveBuff","refreshbuff","onRefreshBuff","BEAST_CLEAVE_DAMAGE","onBeastCleaveDamage","MS_BUFFER","checkAmountOfHits","beastCleavesWithoutHits","uptime","BestialWrath","effectiveBWReduction","wastedBWReduction","accumulatedFocusAtBWCast","spellUsable","cast","onBestialWrathCast","onBarbedShotCast","resource","classResources","find","RESOURCE_TYPES","FOCUS","reductionMs","reduceCooldown","BARBED_SHOT_BESTIAL_WRATH_CDR_MS","focusOnBestialWrathCastThreshold","averageFocusAtBestialWrathCast","cdrEfficiencyBestialWrathThreshold","ResourceIcon","noLink","gainedBestialWraths","SpellIcon","totalPossibleCDR","percentUptime","BESTIAL_WRATH_BASE_CD","CobraShot","effectiveKCReductionMs","wastedKCReductionMs","wastedCasts","globalCooldown","onCobraShotCast","meta","isInefficientCast","inefficientCastReason","COBRA_SHOT_CDR_MS","getGlobalCooldownDuration","killCommandCooldownRemaining","cooldownRemaining","effectiveReductionMs","COBRA_SHOT_FOCUS_THRESHOLD_TO_WAIT","cdrEfficiencyCobraShotThreshold","wastedCobraShotsThreshold","wastedCDR","KillerCobra","effectiveKillCommandResets","wastedKillerCobraCobraShots","active","KILLER_COBRA_TALENT","onCobraCast","STATISTIC_CATEGORY","TALENTS","wastedKillerCobraThreshold","BeastMasteryChecklist","thresholds","AbilityRequirement","props","GenericCastEfficiencyRequirement","getCastEfficiencyForSpellId","Rule","description","href","target","rel","A_MURDER_OF_CROWS_TALENT","Requirement","frenzyUptimeSuggestionThreshold","frenzy3StackSuggestionThreshold","bestialWrathCDREfficiencyThreshold","cobraShotCDREfficiencyThreshold","bestialWrathFocusThreshold","basicAttackThresholds","beastCleaveThresholds","QAPLA_EREDUN_WAR_ORDER_EFFECT","qaplaEfficiencyThreshold","downtimeSuggestionThresholds","focusGeneratorWasteThresholds","focusNaturalRegenWasteThresholds","PreparationRule","QaplaEredunWarOrder","effectiveKCReduction","wastedKCReduction","QAPLA_KILL_COMMAND_REDUCTION_MS","cdrEfficiencyKillCommandThreshold","CORE","ITEMS","Checklist","combatants","preparationRuleAnalyzer","alwaysBeCasting","beastCleave","cobraShot","barbedShot","bestialWrath","killerCobra","qaplaEredunWarOrder","focusGeneratorDetails","focusCapTracker","basicAttacks","Component","selected","additionalAttacksFromMacroing","BaseChecklist","Combatants","CastEfficiency","PreparationRuleAnalyzer","FocusDetails","KillerInstinct","KILLER_INSTINCT_TALENT","castsWithExecute","ExecuteHelper","executeSpells","KILL_COMMAND_DAMAGE_BM","executeSources","lowerThreshold","KILLER_INSTINCT_THRESHOLD","modifiesDamage","damageModifier","KILLER_INSTINCT_MULTIPLIER","ChimaeraShot","hits","CHIMAERA_SHOT_BM_FROST_DAMAGE","CHIMAERA_SHOT_BM_NATURE_DAMAGE","onChimaeraDamage","AverageTargetsHit","DireBeast","activeDireBeasts","targetId","onPetDamage","summon","DIRE_BEAST_SUMMON","onDireSummon","sourceId","encodeTargetString","sourceID","targetID","DIRE_BEAST_HASTE_PERCENT","Stampede","averageHits","inefficientCasts","onStampedeApply","STAMPEDE_DAMAGE","onStampedeDamage","onFightEnd","currentCast","STAMPEDE_POTENTIAL_HITS","stampedeInefficientCastsThreshold","averageHit","stampedePlural","idx","formatMilliseconds","Stomp","hasAC","STOMP_TALENT","ANIMAL_COMPANION_TALENT","STOMP_DAMAGE","onPetStompDamage","AMOUNT_OF_PETS_WITH_AC","ThrillOfTheHunt","thrillStacks","lastThrillStack","lastThrillUpdate","THRILL_OF_THE_HUNT_TALENT","MAX_THRILL_STACKS","THRILL_OF_THE_HUNT_BUFF","thrillOfTheHuntTimesByStacks","CRIT_PER_THRILL_STACK","CriticalStrike","averageCritPercent","averageCrit","OneWithThePack","procChances","ONE_WITH_THE_PACK_TALENT","onAutoShotDamage","hitType","HIT_TYPES","CRIT","WILD_CALL_RESET_PERCENT","AspectOfTheBeast","healing","ASPECT_OF_THE_BEAST_TALENT","heal","onPetHeal","AOTB_ABILITIES_NOT_AFFECTED","calculateEffectiveDamage","AOTB_MULTIPLIER","calculateEffectiveHealing","ItemHealingDone","SpittingCobra","totalIncrease","SPITTING_COBRA_TALENT","bestialWrathCobraShotCasts","SPITTING_COBRA_DAMAGE","spittingCobraDamage","SPITTING_COBRA_DAMAGE_INCREASE","averageIncrease","ScentOfBlood","chargesGained","chargesWasted","SCENT_OF_BLOOD_TALENT","bestialWrathApplication","chargesAvailable","SCENT_OF_BLOOD_BARBED_SHOT_RECHARGE","AnimalCompanion","pets","mainPetName","petDamage","foundPet","pet","sourcePet","playerPets","isPermanentPet","petName","totalDamage","total","AspectOfTheWild","ASPECT_OF_THE_WILD_FOCUS","Focus","focusTracker","bmFocusExtraSuggestion","resourceSuggest","FOCUS_THRESHOLD_MINOR","avg","FOCUS_THRESHOLD_AVG","FOCUS_THRESHOLD_MAJOR","FocusTracker","BeastMasteryFocusUsage","SharedHunterFocusUsage","listOfResourceSpenders","LIST_OF_FOCUS_SPENDERS_BM","Bloodletting","conduitRank","addedDamage","conduitRankBySpellID","onBarbedShotDamage","BLOODLETTING_BARBED_DOT_INCREASE","COVENANTS","ConduitSpellText","rank","EchoingCall","ECHOING_CALL_CONDUIT","ECHOING_CALL_INCREASED_WILD_CALL_CHANCE","FerociousAppetite","effectiveCDR","FEROCIOUS_APPETITE_CONDUIT","onKillCommandDamage","FEROCIOUS_APPETITE_ASPECT_REDUCTION","OneWithTheBeast","ONE_WITH_THE_BEAST_CONDUIT","onGenericDamage","ONE_WITH_THE_BEAST_DAMAGE_INCREASE","DireCommand","direCommandProcs","killCommandHits","DIRE_COMMAND_EFFECT","direBeastSummon","killCommandDamage","padding","plotOneVariableBinomChart","DIRE_COMMAND_PROC_CHANCE","FlamewakersCobraSting","cobraCasts","procs","utilizedFlamewakerBuffs","wastedFlamewakerBuffs","FLAMEWAKERS_COBRA_STING_EFFECT","onCobra","onKillCommand","FLAMEWAKERS_COBRA_STING_BUFF","refreshFlamewaker","applyFlamewaker","FLAMEWAKERS_PROC_CHANCE","KILL_COMMAND_BM_FOCUS_COST","RylakstalkersPiercingFangs","RYLAKSTALKERS_PIERCING_FANGS_EFFECT","RYLAKSTALKERS_PIERCING_FANGS_CRIT_DMG_INCREASE","NesingwarysTrappingApparatus","focusGained","focusWasted","aspectOfTheWild","onEnergize","effectiveFocus","possibleFocus","CombatLogParser","CoreCombatLogParser","specModules","checklist","abilities","buffs","cooldownThroughputTracker","focusDetails","spellFocusCost","SpellFocusCost","beastMasteryFocusCapTracker","focus","beastMasteryFocusUsage","deathTracker","DeathTracker","killShot","KillShot","killerInstinct","chimaeraShot","direBeast","naturalMending","NaturalMending","trailblazer","Trailblazer","barrage","Barrage","stampede","stomp","aMurderOfCrows","AMurderOfCrows","thrillOfTheHunt","oneWithThePack","aspectOfTheBeast","spittingCobra","scentOfBlood","bornToBeWild","BornToBeWild","bindingShot","BindingShot","animalCompanion","resonatingArrow","ResonatingArrow","deathChakrams","DeathChakrams","wildSpirits","WildSpirits","flayedShot","FlayedShot","empoweredRelease","EmpoweredRelease","enfeebledMark","EnfeebledMark","necroticBarrage","NecroticBarrage","spiritAttunement","SpiritAttunement","bloodLetting","echoingCall","ferociousAppetite","oneWithTheBeast","nesingwarysTrappingApparatus","soulforgeEmbers","SoulforgeEmbers","direCommand","flamewakersCobraSting","rylakstalkersPiercingFangs","increase","raw","Icon","other","xmlns","viewBox","d","relativeHealIncrease","overheal","effectiveHealing","children","BUTCHERY_CARVE_MAX_TARGETS_HIT","COORDINATED_ASSAULT_DMG_MOD","COORDINATED_ASSAULT_BASELINE_DURATION","WILDFIRE_BOMB_LEEWAY_BUFFER","SV_KILL_COMMAND_FOCUS_GAIN","SV_SERPENT_STING_COST","SERPENT_STING_SV_PANDEMIC","SERPENT_STING_SV_BASE_DURATION","RAPTOR_MONGOOSE_VARIANTS","RAPTOR_STRIKE","RAPTOR_STRIKE_AOTE","MONGOOSE_BITE_TALENT","MONGOOSE_BITE_TALENT_AOTE","BASELINE_AOTE_CD","VIPERS_VENOM_COST_MULTIPLIER","VIPERS_VENOM_DAMAGE_MODIFIER","BOP_CA_EXTENSION_PER_CAST","SURVIVAL_CHAKRAM_TYPES","CHAKRAMS_TO_MAINTARGET","CHAKRAMS_BACK_FROM_MAINTARGET","CHAKRAMS_NOT_MAINTARGET","FLANKING_STRIKE_FOCUS_GAIN","MONGOOSE_BITE_MAX_TRAVEL_TIME","MONGOOSE_BITE_MAX_STACKS","GUERRILLA_TACTICS_INIT_HIT_MODIFIER","AFFECTED_BY_GUERRILLA_TACTICS","WILDFIRE_BOMB_IMPACT","VOLATILE_BOMB_WFI_IMPACT","PHEROMONE_BOMB_WFI_IMPACT","SHRAPNEL_BOMB_WFI_IMPACT","TIP_DAMAGE_INCREASE","TIP_MAX_STACKS","ALPHA_DAMAGE_KC_MODIFIER","BLOODSEEKER_ATTACK_SPEED_GAIN","HYDRAS_BITE_DOT_MODIFIER","LIST_OF_FOCUS_SPENDERS_SV","BUTCHERY_TALENT","CARVE","WING_CLIP","CHAKRAMS_TALENT","SERPENT_STING_SV","BASE_FOCUS_REGEN_SV","BASE_MAX_FOCUS_SV","DEADLY_TANDEM_CA_DURATION_INCREASE","FLAME_INFUSION_WFB_DAMAGE_INCREASE","STINGING_STRIKE_RS_MB_DMG_INCREASE","STRENGTH_OF_THE_PACK_DAMAGE_MODIFIER","WILD_SPIRITS","FLAYED_SHOT","RESONATING_ARROW","DEATH_CHAKRAM_INITIAL_AND_AOE","MELEE","CLAW_BASIC_ATTACK","SMACK_BASIC_ATTACK","BARBED_SHOT_BUFF_2","BARBED_SHOT_BUFF_3","BARBED_SHOT_BUFF_4","BARBED_SHOT_BUFF_5","BARBED_SHOT_BUFF_6","BARBED_SHOT_BUFF_7","BARBED_SHOT_BUFF_8","BARBED_SHOT_FOCUS_REGEN_BUFFS_IDS","BEAST_MASTERY_SPELLS_WITHOUT_WASTE","CHIMAERA_SHOT_FOCUS","AOTW_REGEN","CHIM_REGEN","DonutChart","items","sum","value","color","label","valueTooltip","content","background","chartSize","innerRadiusFactor","data","spec","mark","innerRadius","encoding","theta","field","legend","scale","domain","range","view","stroke","width","height","renderLegend","renderChart","React","PureComponent","defaultProps","OneVariableBinomialChart","state","hover","probabilities","actualEvent","xAxis","yAxis","yDomain","title","axis","grid","format","tickFormat","y","layer","line","strokeWidth","filled","disableHeight","BaseChart","expectedProcCount","procChance","procAttempts","binomialPMF","k","n","p","numerator","denominator","binomialDistribution","pow","binomialCDF","probability","findMax","pmf","maxP","resetProbabilityArray","actualProcs","_x","poissonBinomialPMF","setMinMaxProbabilities","threshold","procProbabilities","rangeMin","findIndex","rangeMax","Ekj","j","lookup","Error","fill","trackedName","tooltipText","actualEventY","inExecuteWindow","inHealthExecuteWindow","executeWindowStart","lastExecuteHitTimestamp","totalExecuteWindowDuration","onGeneralDamage","onExecuteCast","onExecuteDamage","executeOutsideRangeEnablers","applyExecuteEnablerBuff","removeExecuteEnablerBuff","hitPoints","maxHitPoints","upperThreshold","isTargetInExecuteRange","isTargetInReverseExecuteRange","usable","allOnCD","targetIsFriendly","areExecuteSpellsOnCD","isExecuteUsableOutsideExecuteRange","isTargetInHealthExecuteWindow","constructor","unique","approximate","RemoveBuff","RemoveDebuff","ApplyBuff","ApplyDebuff","ApplyBuffStack","RemoveBuffStack","ApplyDebuffStack","RemoveDebuffStack","stack","tracker","tracked","generated","wasted","isArray","newSuggestionSpell","buildersObj","maxGenerated","wastedShare","resourceNameLower","toLowerCase","regular","HIT_TYPES_THAT_REFUND","MISS","DODGE","PARRY","RegenResourceCapTracker","args","atCap","missedRegen","naturalRegen","regenState","prevSpender","hasReportedBelowCap","debugErrorSum","debugGreatestError","debugAccuracyCheckCount","currentMaxResourceWithFallback","regen","naturalRegenRate","onFightend","onCast","onDamage","drain","onDrain","ChangeHaste","onChangeHaste","predictValue","currentTimestamp","baseRegenRate","getBaseRegenRate","isRegenHasted","isNaN","before","gain","min","applyEnergize","r","resourceType","resourceCost","getResource","cost","buffId","buffHistory","getBuffHistory","Boolean","buff","start","end","updateState","end_time","resourceChangeType","applyCumulatively","energizersToApplyCumulatively","time","eventResource","shouldAccumulate","isLastUpdateRecent","getCost","exemptFromRefund","castsToApplyCumulatively","tick","refund","resourceRefundOnMiss","getReducedDrain","cumulativeEventWindow","buffsChangeMax","buffChangesResourceMax","buffsChangeRegen","buffChangesRegen","oldState","newState","durationCapped","timeCappedBetweenStates","onBelowCap","reachCap","predictReachValue","Infinity","onAtCap","calculated","currentMaxResource","startTime","startValue","targetValue","elapsed","predicted","fabricateEndCap","fabricateBeginCap","eventEmitter","fabricateEvent","playerId","EventEmitter","spellResourceCost","SpellResourceCost","drainsToApplyCumulatively","_applyBuilder","__fabricated","ResourceTracker","toString","damageTicks","totalProcs","resets","offCDProcs","activeKillShotSpell","SPECS","SURVIVAL_HUNTER","KILL_SHOT_SV","KILL_SHOT_MM_BM","hasCovenant","VENTHYR","add","FLAYERS_MARK","onProc","expectedProcs","FLAYED_SHOT_RESET_CHANCE","wastedPercent","url","render","showSpenders","RESOURCES_HUNTER_MINOR_THRESHOLD","RESOURCES_HUNTER_AVERAGE_THRESHOLD","RESOURCES_HUNTER_MAJOR_THRESHOLD","bySecond","onEnergizeByPlayer","HUNTER_BASE_FOCUS_MAX","secondsIntoFight","entries","wide","marginBottom","overflow","large","ultrawide","formatThousands","src","alt","disableWidth","duration","HUNTER_BASE_FOCUS_REGEN","deathTimestamp","ressTimestamp","lastResurrectionTimestamp","deathPercentageOfEncounter","lastDeathTimestamp","TIME_SPENT_DEAD_THRESHOLD","isAlive","deaths","pop","CoreDeathTracker","cdrPerFocus","MM_SV_CDR_PER_FOCUS","effectiveExhilReductionMs","wastedExhilReductionMs","lastFocusCost","NATURAL_MENDING_TALENT","BEAST_MASTERY_HUNTER","BM_CDR_PER_FOCUS","cooldownReductionMS","TRAILBLAZER_TALENT","TRAILBLAZER_BUFF","applicationTimestamp","lastDamageTick","crowsEndingTimestamp","maxCasts","any","checkForReset","A_MURDER_OF_CROWS_DEBUFF","adjustMaxCasts","AMOC_TICK_RATE","beginCooldown","AMOC_BASE_DURATION","ceil","_spells","baseCD","BASELINE_TURTLE_CHEETAH_CD","ASPECT_OF_THE_EAGLE","hasEagle","BORN_TO_BE_WILD_AFFECTED_SPELLS","effectiveTotalCDR","_roots","_applications","_casts","BINDING_SHOT_TALENT","MARKSMANSHIP_HUNTER","GENERAL","applydebuff","onRoot","onTether","DEAD_EYE_TALENT","totalExecuteDuration","KILL_SHOT_EXECUTE_RANGE","lockAndLoad","vipersVenom","LOCK_AND_LOAD_TALENT","VIPERS_VENOM_TALENT","LOCK_AND_LOAD_BUFF","AIMED_SHOT","LNL_COST_MULTIPLIER","VIPERS_VENOM_BUFF","debuffs","enemies","KYRIAN","RESONATING_ARROW_DEBUFF","onDebuff","RESONATING_ARROW_DAMAGE","RESONATING_ARROW_CRIT_INCREASE","Enemies","NECROLORD","DEATH_CHAKRAM_SINGLE_TARGET","DEATH_CHAKRAM_ENERGIZE","ampDamage","NIGHT_FAE","WILD_SPIRITS_DAMAGE","WILD_SPIRITS_DAMAGE_AOE","onWildSpiritsDamage","enemy","getEntity","WILD_MARK","WILD_MARK_DAMAGE_AMP","ENFEEBLED_MARK_CONDUIT","ENFEEBLED_MARK_DAMAGE_INCREASE","flayersMarkProcs","aggregatedContribution","EMPOWERED_RELEASE_CONDUIT","flayedShotProc","onKillShotDamage","EMPOWERED_RELEASE_INCREASED_FLAYED_PROC_CHANCE","EMPOWERED_RELEASE_BUFF","EMPOWERED_RELEASE_INCREASE_KS_DAMAGE","averageContributionAbsolute","round","averageContributionPercentage","gainedFocus","wastedFocus","NECROTIC_BARRAGE_CONDUIT","onDeathChakramDamage","NECROTIC_BARRAGE_DAMAGE_INCREASE","wildSpiritsCast","damageAfterOriginalDuration","SPIRIT_ATTUNEMENT_CONDUIT","onWildSpiritsCast","SPIRIT_ATTUNEMENT_DAMAGE_INCREASE","WILD_SPIRITS_BASELINE_DURATION","flareCasts","lastFlareCastTimestamp","tarTrapCasts","lastTarTrapCastTimestamp","lostEmberApplications","SOULFORGE_EMBERS_EFFECT","onFlare","onTarTrap","SOULFORGE_EMBERS_DAMAGE","onEmbersDamage","ResourceUsage","listOfSpellsUsed","ctor","resourceSpenders","spellID","spellsThatShouldShowAsOtherSpells","resourceTypeID","resourceUsed","resourceTypeName","comparison","resourceUsageStatisticOrder","ResourceLink","resourceUsageChart","listOfDefaultColours","statisticOrder","colourIndex","makeResourceUsageTooltip","sort","sortResourceUsage","FocusUsage","LIST_OF_FOCUS_SPENDERS_SHARED","uniqueTargets","uniqueTargetsHit","BARRAGE_DAMAGE","calculateAverageHits","damageTarget","targetInstance","BARRAGE_HITS_PER_CAST","barrageInefficientCastsThreshold"],"mappings":"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","file":"static/js/BeastMasteryHunter.07a29db4.chunk.js","sourcesContent":["import SPELLS from 'common/SPELLS';\r\nimport CoreSpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport { CastEvent, DamageEvent } from 'parser/core/Events';\r\n\r\nclass SpellUsable extends CoreSpellUsable {\r\n  static dependencies = {\r\n    ...CoreSpellUsable.dependencies,\r\n  };\r\n\r\n  lastPotentialTriggerForBarbedShotReset: CastEvent | null = null;\r\n\r\n  onCast(event: CastEvent) {\r\n    super.onCast(event);\r\n    const spellId = event.ability.guid;\r\n    if (spellId === SPELLS.AUTO_SHOT.id) {\r\n      this.lastPotentialTriggerForBarbedShotReset = event;\r\n    } else if (spellId === SPELLS.BARBED_SHOT.id) {\r\n      this.lastPotentialTriggerForBarbedShotReset = null;\r\n    }\r\n  }\r\n\r\n  beginCooldown(spellId: number, cooldownTriggerEvent: CastEvent | DamageEvent) {\r\n    if (spellId === SPELLS.BARBED_SHOT.id) {\r\n      if (this.isOnCooldown(spellId)) {\r\n        this.endCooldown(\r\n          spellId,\r\n          undefined,\r\n          this.lastPotentialTriggerForBarbedShotReset\r\n            ? this.lastPotentialTriggerForBarbedShotReset.timestamp\r\n            : undefined,\r\n        );\r\n      }\r\n    }\r\n    super.beginCooldown(spellId, cooldownTriggerEvent);\r\n  }\r\n}\r\n\r\nexport default SpellUsable;\r\n","import CoreGlobalCooldown from 'parser/shared/modules/GlobalCooldown';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Haste from 'parser/shared/modules/Haste';\r\nimport { MAX_GCD, MIN_GCD } from 'parser/hunter/shared/constants';\r\n\r\nimport { AOTW_GCD_REDUCTION_AFFECTED_ABILITIES } from '../../constants';\r\n\r\nconst ASPECT_GCD_REDUCTION = 200;\r\n\r\n/**\r\n * Aspect of the wild reduces Global Cooldown for certain spells by 0.2 seconds before haste calculations\r\n */\r\nclass GlobalCooldown extends CoreGlobalCooldown {\r\n  static dependencies = {\r\n    ...CoreGlobalCooldown.dependencies,\r\n    haste: Haste,\r\n  };\r\n\r\n  protected haste!: Haste;\r\n\r\n  getGlobalCooldownDuration(spellId: number) {\r\n    const gcd = super.getGlobalCooldownDuration(spellId);\r\n    if (!gcd) {\r\n      return 0;\r\n    }\r\n    if (AOTW_GCD_REDUCTION_AFFECTED_ABILITIES.includes(spellId) && this.selectedCombatant.hasBuff(SPELLS.ASPECT_OF_THE_WILD.id)) {\r\n      const unhastedAspectGCD = MAX_GCD - ASPECT_GCD_REDUCTION;\r\n      const hastepercent = 1 + this.haste.current;\r\n      return Math.max(MIN_GCD, unhastedAspectGCD / hastepercent);\r\n    }\r\n    return Math.max(MIN_GCD, gcd);\r\n  }\r\n\r\n}\r\n\r\nexport default GlobalCooldown;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport CoreAbilities from 'parser/core/modules/Abilities';\r\nimport { SpellbookAbility } from 'parser/core/modules/Ability';\r\nimport { hastedCooldown } from 'parser/hunter/shared/constants';\r\n\r\nclass Abilities extends CoreAbilities {\r\n  spellbook(): SpellbookAbility[] {\r\n    const combatant = this.selectedCombatant;\r\n    return [\r\n      //region Baseline Rotational\r\n      {\r\n        spell: SPELLS.BESTIAL_WRATH,\r\n        category: Abilities.SPELL_CATEGORIES.COOLDOWNS,\r\n        cooldown: 90,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        timelineSortIndex: -1,\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.9,\r\n          extraSuggestion: (\r\n            <>\r\n              <SpellLink id={SPELLS.BESTIAL_WRATH.id} /> should be cast on cooldown as its cooldown is quickly reset again through <SpellLink id={SPELLS.BARBED_SHOT.id} />. You want to start each <SpellLink id={SPELLS.BESTIAL_WRATH.id} /> window with as much focus as possible.\r\n            </>\r\n          ),\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.KILL_COMMAND_CAST_BM,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        cooldown: haste => hastedCooldown(7.5, haste),\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.85,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.COBRA_SHOT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.ARCANE_SHOT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.BARBED_SHOT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        charges: 2,\r\n        cooldown: haste => hastedCooldown(this.selectedCombatant.hasConduitBySpellID(SPELLS.BLOODLETTING_CONDUIT.id) ? 11 : 12, haste),\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.MULTISHOT_BM,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL_AOE,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.ASPECT_OF_THE_WILD,\r\n        category: Abilities.SPELL_CATEGORIES.COOLDOWNS,\r\n        cooldown: 120,\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n        timelineSortIndex: -1,\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.95,\r\n        },\r\n      },\r\n      //endregion\r\n\r\n      //region Baseline Defensives\r\n      {\r\n        spell: SPELLS.ASPECT_OF_THE_TURTLE,\r\n        category: Abilities.SPELL_CATEGORIES.DEFENSIVE,\r\n        isDefensive: true,\r\n        cooldown: 180 * (1 - (combatant.hasTalent(SPELLS.BORN_TO_BE_WILD_TALENT.id) ? 0.2 : 0)),\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.EXHILARATION,\r\n        category: Abilities.SPELL_CATEGORIES.DEFENSIVE,\r\n        isDefensive: true,\r\n        cooldown: 120,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.SURVIVAL_OF_THE_FITTEST,\r\n        category: Abilities.SPELL_CATEGORIES.DEFENSIVE,\r\n        isDefensive: true,\r\n        cooldown: 180,\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n      },\r\n      //endregion\r\n\r\n      //region Baseline Utility\r\n      {\r\n        spell: SPELLS.ASPECT_OF_THE_CHEETAH,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 180 * (1 - (combatant.hasTalent(SPELLS.BORN_TO_BE_WILD_TALENT.id) ? 0.2 : 0)),\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.DISENGAGE,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 20,\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.CONCUSSIVE_SHOT,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 5,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.COUNTER_SHOT,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 24,\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.MISDIRECTION,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 30,\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.FREEZING_TRAP,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 30, //TODO: Set to 25 at Shadowlands launch\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.TAR_TRAP,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 30, //TODO: Set to 25 at Shadowlands launch\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.FEIGN_DEATH,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 30,\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.FLARE,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 20,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.HUNTERS_MARK,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        gcd: {\r\n          base: 1000,\r\n        },\r\n      },\r\n      //endregion\r\n\r\n      //region Talents\r\n      {\r\n        spell: SPELLS.DIRE_BEAST_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        enabled: combatant.hasTalent(SPELLS.DIRE_BEAST_TALENT.id),\r\n        cooldown: 15,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.9,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.BARRAGE_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        enabled: combatant.hasTalent(SPELLS.BARRAGE_TALENT.id),\r\n        cooldown: 20,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.8,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.STAMPEDE_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        enabled: combatant.hasTalent(SPELLS.STAMPEDE_TALENT.id),\r\n        cooldown: 120,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.8,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.CHIMAERA_SHOT_BM_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        enabled: combatant.hasTalent(SPELLS.CHIMAERA_SHOT_BM_TALENT.id),\r\n        cooldown: haste => hastedCooldown(15, haste),\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.85,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.BLOODSHED_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        enabled: combatant.hasTalent(SPELLS.BLOODSHED_TALENT.id),\r\n        cooldown: 60,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.9,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.CAMOUFLAGE_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 60,\r\n        enabled: combatant.hasTalent(SPELLS.CAMOUFLAGE_TALENT.id),\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      //endregion\r\n\r\n      //region Pets\r\n      {\r\n        spell: [SPELLS.PRIMAL_RAGE_1, SPELLS.PRIMAL_RAGE_2],\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 360,\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.MASTERS_CALL,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 45,\r\n        gcd: {\r\n          static: 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.INTIMIDATION,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 60,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: [\r\n          SPELLS.CALL_PET_1,\r\n          SPELLS.CALL_PET_2,\r\n          SPELLS.CALL_PET_3,\r\n          SPELLS.CALL_PET_4,\r\n          SPELLS.CALL_PET_5,\r\n        ],\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.DISMISS_PET,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.MEND_PET,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 10,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      //endregion\r\n    ];\r\n  }\r\n}\r\n\r\nexport default Abilities;\r\n","import SPELLS from 'common/SPELLS';\r\nimport BLOODLUST_BUFFS from 'game/BLOODLUST_BUFFS';\r\nimport CoreBuffs from 'parser/core/modules/Buffs';\r\n\r\nclass Buffs extends CoreBuffs {\r\n  buffs() {\r\n    return [\r\n      {\r\n        spellId: SPELLS.BESTIAL_WRATH.id,\r\n        timelineHighlight: true,\r\n        triggeredBySpellId: SPELLS.BESTIAL_WRATH.id,\r\n      },\r\n      {\r\n        spellId: SPELLS.DIRE_BEAST_BUFF.id,\r\n        timelineHighlight: true,\r\n        triggeredBySpellId: SPELLS.DIRE_BEAST_TALENT.id,\r\n      },\r\n      {\r\n        //shows pet buff, since that is what is interesting to see and the player buff is 8 different spellIDs\r\n        spellId: SPELLS.BARBED_SHOT_PET_BUFF.id,\r\n        timelineHighlight: true,\r\n        triggeredBySpellId: SPELLS.BARBED_SHOT.id,\r\n      },\r\n      {\r\n        spellId: SPELLS.BEAST_CLEAVE_BUFF.id,\r\n        timelineHighlight: true,\r\n        triggeredBySpellId: SPELLS.MULTISHOT_BM.id,\r\n      },\r\n      {\r\n        spellId: SPELLS.ASPECT_OF_THE_WILD.id,\r\n        timelineHighlight: true,\r\n        triggeredBySpellId: SPELLS.ASPECT_OF_THE_WILD.id,\r\n      },\r\n      {\r\n        spellId: SPELLS.ASPECT_OF_THE_TURTLE.id,\r\n        timelineHighlight: true, // showing because it's relevant to know when we couldn't attack (this could explain some downtime)\r\n        triggeredBySpellId: SPELLS.ASPECT_OF_THE_TURTLE.id,\r\n      },\r\n      {\r\n        spellId: Object.keys(BLOODLUST_BUFFS).map(item => Number(item)),\r\n        timelineHighlight: true,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default Buffs;\r\n","import SPELLS from 'common/SPELLS';\r\nimport CoreCooldownThroughputTracker, { BUILT_IN_SUMMARY_TYPES } from 'parser/shared/modules/CooldownThroughputTracker';\r\n\r\nclass CooldownThroughputTracker extends CoreCooldownThroughputTracker {\r\n  static cooldownSpells = [\r\n    ...CoreCooldownThroughputTracker.cooldownSpells,\r\n    {\r\n      spell: SPELLS.BESTIAL_WRATH,\r\n      summary: [\r\n        BUILT_IN_SUMMARY_TYPES.DAMAGE,\r\n      ],\r\n    },\r\n    {\r\n      spell: SPELLS.ASPECT_OF_THE_WILD,\r\n      summary: [\r\n        BUILT_IN_SUMMARY_TYPES.DAMAGE,\r\n      ],\r\n    },\r\n  ];\r\n\r\n  static ignoredSpells = [\r\n    ...CoreCooldownThroughputTracker.ignoredSpells,\r\n    SPELLS.BINDING_SHOT_TETHER.id,\r\n    SPELLS.BINDING_SHOT_ROOT.id,\r\n  ];\r\n}\r\n\r\nexport default CooldownThroughputTracker;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\nimport SpellLink from 'common/SpellLink';\r\nimport CoreAlwaysBeCasting from 'parser/shared/modules/AlwaysBeCasting';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\nclass AlwaysBeCasting extends CoreAlwaysBeCasting {\r\n  get suggestionThresholds() {\r\n    return {\r\n      actual: this.activeTimePercentage,\r\n      isLessThan: {\r\n        minor: 0.85,\r\n        average: 0.825,\r\n        major: 0.8,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.suggestionThresholds).addSuggestion((suggest, actual, recommended) => suggest(<>Your downtime can be improved. Try to reduce the delay between casting spells. If everything is on cooldown, try and use <SpellLink id={SPELLS.COBRA_SHOT.id} /> to stay off the focus cap and do some damage.</>)\r\n      .icon('spell_mage_altertime')\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.alwaysBeCasting.downtime')`${formatPercentage(1 - actual)}% downtime`))\r\n      .recommended(`<${formatPercentage(1 - recommended)}% is recommended`));\r\n  }\r\n}\r\n\r\nexport default AlwaysBeCasting;\r\n","import Analyzer, { Options, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\n\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport { formatNumber } from 'common/format';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\nimport Spell from 'common/SPELLS/Spell';\r\n\r\nimport React from 'react';\r\n\r\nimport { BASIC_ATTACK_SPELLS, MACRO_TIME_BETWEEN_BASIC_ATK, MAX_TIME_BETWEEN_BASIC_ATK, NO_DELAY_TIME_BETWEEN_BASIC_ATK } from '../../constants';\r\n\r\n/**\r\n * Macroing pet basic attacks to the hunters general abilities is a DPS increase, because there is a natural delay before the pet decides to cast the spell by itself.\r\n */\r\nconst debug = false;\r\n\r\nclass BasicAttacks extends Analyzer {\r\n  lastCast: number = 0;\r\n  timeBetweenAttacks: number = 0;\r\n  totalCasts: number = 0;\r\n  chainCasts: number = 0;\r\n  damage: number = 0;\r\n  //Assume that the usedBasicAttack is Bite, so that there are no issues if no Basic Attack have been cast this fight\r\n  usedBasicAttack: Spell = SPELLS.BITE_BASIC_ATTACK;\r\n  basicAttackChecked: boolean = false;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET).spell(BASIC_ATTACK_SPELLS), this.onPetBasicAttackDamage);\r\n  }\r\n\r\n  get additionalAttacksFromMacroing() {\r\n    return {\r\n      actual: this.potentialExtraCasts(),\r\n      isGreaterThan: {\r\n        minor: 0,\r\n        average: 0,\r\n        major: 0,\r\n      },\r\n      style: ThresholdStyle.NUMBER,\r\n    };\r\n  }\r\n\r\n  get totalAttacksFromBasicAttacks() {\r\n    return {\r\n      actual: this.totalCasts,\r\n      isLessThan: {\r\n        minor: 1,\r\n        average: 1,\r\n        major: 1,\r\n      },\r\n      style: ThresholdStyle.NUMBER,\r\n    };\r\n  }\r\n\r\n  onPetBasicAttackDamage(event: DamageEvent) {\r\n    if (!this.basicAttackChecked) {\r\n      this.usedBasicAttack = { id: event.ability.guid, name: event.ability.name, icon: event.ability.abilityIcon };\r\n      this.basicAttackChecked = true;\r\n    }\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n    // If no lastcast is registered or if more time has passed than we generally attribute a chaincast then we assume that there has been some downtime, so we set the latest hit as lastCast and don't count it as chained casts.\r\n    if (event.timestamp > this.lastCast + MAX_TIME_BETWEEN_BASIC_ATK) {\r\n      this.lastCast = event.timestamp;\r\n    } else {\r\n      this.timeBetweenAttacks += event.timestamp - this.lastCast;\r\n      this.chainCasts += 1;\r\n    }\r\n    this.totalCasts += 1;\r\n  }\r\n\r\n  potentialExtraCasts(dreamScenario: boolean = false) {\r\n    const usedTimeBetween = dreamScenario ? NO_DELAY_TIME_BETWEEN_BASIC_ATK : MACRO_TIME_BETWEEN_BASIC_ATK;\r\n    return Math.max(Math.floor((this.timeBetweenAttacks - (usedTimeBetween * this.chainCasts)) / usedTimeBetween), 0);\r\n  }\r\n\r\n  potentialExtraDamage(dreamScenario: boolean = false) {\r\n    return this.potentialExtraCasts(dreamScenario) * (this.damage / this.totalCasts) || 0;\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.totalAttacksFromBasicAttacks).addSuggestion((suggest, actual, recommended) => suggest(<> Make sure that your pet is casting it's Basic Attacks, such as <SpellLink id={SPELLS.BITE_BASIC_ATTACK.id} />.</>)\r\n      .icon(SPELLS.BITE_BASIC_ATTACK.icon)\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.pet.basicAttacks')`Your pet didn't cast any Basic Attacks this fight`))\r\n      .recommended('Your pet should be autocast Basic Attacks'));\r\n  }\r\n\r\n  statistic() {\r\n    if (debug) {\r\n      console.log('Avg time between BAs', this.timeBetweenAttacks / this.chainCasts);\r\n      console.log('Total lost BA time', this.timeBetweenAttacks - (MACRO_TIME_BETWEEN_BASIC_ATK * this.chainCasts));\r\n      console.log('Potential extra casts (with macro):', this.potentialExtraCasts());\r\n      console.log('Potential extra damage (with macro):', this.potentialExtraDamage());\r\n      console.log('Potential extra casts (with 0 delay):', this.potentialExtraCasts(true));\r\n      console.log('Potential extra damage (with 0 delay):', this.potentialExtraDamage(true));\r\n    }\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(20)}\r\n        size=\"flexible\"\r\n        dropdown={(\r\n          <>\r\n            <table className=\"table table-condensed\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Potential</th>\r\n                  <th>150ms delay</th>\r\n                  <th>0ms delay</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                <tr>\r\n                  <td>\r\n                    Casts\r\n                  </td>\r\n                  <td>\r\n                    {this.potentialExtraCasts()}\r\n                  </td>\r\n                  <td>\r\n                    {this.potentialExtraCasts(true)}\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <td>\r\n                    Damage\r\n                  </td>\r\n                  <td>\r\n                    {formatNumber(this.potentialExtraDamage() / this.owner.fightDuration * 1000)} DPS\r\n                  </td>\r\n                  <td>\r\n                    {formatNumber(this.potentialExtraDamage(true) / this.owner.fightDuration * 1000)} DPS\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={this.usedBasicAttack}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} /> <br />\r\n            {formatNumber((this.timeBetweenAttacks / this.chainCasts) - NO_DELAY_TIME_BETWEEN_BASIC_ATK)} ms <small>average delay</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default BasicAttacks;\r\n","import FocusCapTracker from 'parser/hunter/shared/modules/resources/FocusCapTracker';\r\n\r\nimport { BEAST_MASTERY_FOCUS_MAX, BEAST_MASTERY_FOCUS_REGEN } from '../../constants';\r\n\r\nclass BeastMasteryFocusCapTracker extends FocusCapTracker {\r\n\r\n  getBaseRegenRate() {\r\n    const regenRate = BEAST_MASTERY_FOCUS_REGEN;\r\n    return regenRate;\r\n  }\r\n\r\n  currentMaxResource() {\r\n    const max = BEAST_MASTERY_FOCUS_MAX;\r\n    return max;\r\n  }\r\n}\r\n\r\nexport default BeastMasteryFocusCapTracker;\r\n","import React from 'react';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport { formatDuration, formatPercentage } from 'common/format';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport UptimeIcon from 'interface/icons/Uptime';\r\nimport Events, { ApplyBuffEvent, ApplyBuffStackEvent, EnergizeEvent, EventType, FightEndEvent, RemoveBuffEvent } from 'parser/core/Events';\r\nimport { currentStacks } from 'parser/shared/modules/helpers/Stacks';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\nimport { NESINGWARY_FOCUS_GAIN_MULTIPLIER } from 'parser/hunter/shared/constants';\r\n\r\nimport { BARBED_SHOT_FOCUS_REGEN_BUFFS, BARBED_SHOT_REGEN, MAX_FRENZY_STACKS } from '../../constants';\r\n\r\n/**\r\n * Fire a shot that tears through your enemy, causing them to bleed for X damage over 8 sec. Sends your pet into a frenzy, increasing attack speed by 30% for 8 sec, stacking up to 3 times.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/39yhq8VLFrm7J4wR#fight=17&type=casts&source=8&ability=-217200\r\n */\r\n\r\nclass BarbedShot extends Analyzer {\r\n\r\n  barbedShotStacks: number[][] = [];\r\n  lastBarbedShotStack: number = 0;\r\n  lastBarbedShotUpdate: number = this.owner.fight.start_time;\r\n  additionalFocusFromNesingwary = 0;\r\n  possibleAdditionalFocusFromNesingwary = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.barbedShotStacks = Array.from({ length: MAX_FRENZY_STACKS + 1 }, x => []);\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.BARBED_SHOT_PET_BUFF), this.handleStacks);\r\n    this.addEventListener(Events.applybuffstack.by(SELECTED_PLAYER).spell(SPELLS.BARBED_SHOT_PET_BUFF), this.handleStacks);\r\n    this.addEventListener(Events.removebuff.to(SELECTED_PLAYER_PET).spell(SPELLS.BARBED_SHOT_PET_BUFF), this.handleStacks);\r\n    this.addEventListener(Events.fightend, this.handleStacks);\r\n    this.selectedCombatant.hasLegendaryByBonusID(SPELLS.NESINGWARYS_TRAPPING_APPARATUS_EFFECT.bonusID) && this.addEventListener(Events.energize.by(SELECTED_PLAYER).spell(BARBED_SHOT_FOCUS_REGEN_BUFFS), this.checkNesingwaryFocusGain);\r\n\r\n  }\r\n\r\n  get barbedShotTimesByStacks() {\r\n    return this.barbedShotStacks;\r\n  }\r\n\r\n  get percentUptimeMaxStacks() {\r\n    return (this.barbedShotStacks[MAX_FRENZY_STACKS].reduce((a: number, b: number) => a + b, 0)) / this.owner.fightDuration;\r\n  }\r\n\r\n  get percentUptimePet() {\r\n    //This removes the time spent without the pet having the frenzy buff\r\n    const withoutNoBuff = this.barbedShotStacks.slice(1);\r\n    //Because .flat doesn't work in Microsoft Edge (non-chromium versions), we use this alternate option that is equivalent\r\n    const alternativeFlatten = withoutNoBuff.reduce((acc, val) => acc.concat(val), []);\r\n    //After flattening the array, we can reduce it normally.\r\n    return alternativeFlatten.reduce((totalUptime: number, stackUptime: number) => totalUptime + stackUptime, 0) / this.owner.fightDuration;\r\n  }\r\n\r\n  get percentPlayerUptime() {\r\n    //This calculates the uptime over the course of the encounter of Barbed Shot for the player\r\n    return this.selectedCombatant.getBuffUptime(SPELLS.BARBED_SHOT_BUFF.id) / this.owner.fightDuration;\r\n  }\r\n\r\n  get frenzyUptimeThreshold() {\r\n    return {\r\n      actual: this.percentUptimePet,\r\n      isLessThan: {\r\n        minor: 0.90,\r\n        average: 0.825,\r\n        major: 0.75,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  get frenzy3StackThreshold() {\r\n    return {\r\n      actual: this.percentUptimeMaxStacks,\r\n      isLessThan: {\r\n        minor: 0.75,\r\n        average: 0.70,\r\n        major: 0.65,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  handleStacks(event: RemoveBuffEvent | ApplyBuffEvent | ApplyBuffStackEvent | FightEndEvent) {\r\n    this.barbedShotStacks[this.lastBarbedShotStack].push(event.timestamp - this.lastBarbedShotUpdate);\r\n    if (event.type === EventType.FightEnd) {\r\n      return;\r\n    }\r\n    this.lastBarbedShotUpdate = event.timestamp;\r\n    this.lastBarbedShotStack = currentStacks(event);\r\n  }\r\n\r\n  getAverageBarbedShotStacks() {\r\n    let avgStacks = 0;\r\n    this.barbedShotStacks.forEach((elem: number[], index: number) => {\r\n      avgStacks += elem.reduce((a: number, b: number) => a + b, 0) / this.owner.fightDuration * index;\r\n    });\r\n    return avgStacks;\r\n  }\r\n\r\n  checkNesingwaryFocusGain(event: EnergizeEvent) {\r\n    const waste = BARBED_SHOT_REGEN - event.resourceChange;\r\n    if (this.selectedCombatant.hasBuff(SPELLS.NESINGWARYS_TRAPPING_APPARATUS_ENERGIZE.id)) {\r\n      this.additionalFocusFromNesingwary += event.resourceChange * (1 - 1 / NESINGWARY_FOCUS_GAIN_MULTIPLIER) - waste;\r\n      this.possibleAdditionalFocusFromNesingwary += BARBED_SHOT_REGEN;\r\n    }\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.frenzyUptimeThreshold).addSuggestion((suggest, actual, recommended) => suggest(<>Your pet has a general low uptime of the buff from <SpellLink id={SPELLS.BARBED_SHOT.id} />, you should never be sitting on 2 stacks of this spell. </>)\r\n      .icon(SPELLS.BARBED_SHOT.icon)\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.barbedShot.petBuff.uptime')`Your pet had the buff from Barbed Shot for ${formatPercentage(actual)}% of the fight`))\r\n      .recommended(`${formatPercentage(recommended)}% is recommended`));\r\n    when(this.frenzy3StackThreshold).addSuggestion((suggest, actual, recommended) => suggest(<>Your pet has a general low uptime of the 3 stacked buff from <SpellLink id={SPELLS.BARBED_SHOT.id} />. It's important to try and maintain the buff at 3 stacks for as long as possible, this is done by spacing out your casts, but at the same time never letting them cap on charges. </>)\r\n      .icon(SPELLS.BARBED_SHOT.icon)\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.barbedShot.threeStacks.uptime')`Your pet had 3 stacks of the buff from Barbed Shot for ${formatPercentage(actual)}% of the fight`))\r\n      .recommended(`${formatPercentage(recommended)}% is recommended`));\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(1)}\r\n        size=\"flexible\"\r\n        tooltip={(\r\n          <>\r\n            <ul>\r\n              <li>Your pet had an average of {this.getAverageBarbedShotStacks().toFixed(2)} stacks active throughout the fight.</li>\r\n              <li>Your pet had an overall uptime of {formatPercentage(this.percentUptimePet)}% on the increased attack speed buff</li>\r\n              <li>You had an uptime of {formatPercentage(this.percentPlayerUptime)}% on the focus regen buff.</li>\r\n            </ul>\r\n          </>\r\n        )}\r\n        dropdown={(\r\n          <>\r\n            <table className=\"table table-condensed\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Stacks</th>\r\n                  <th>Time (s)</th>\r\n                  <th>Time (%)</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {Object.values(this.barbedShotTimesByStacks).map((e, i) => (\r\n                  <tr key={i}>\r\n                    <th>{i}</th>\r\n                    <td>{formatDuration(e.reduce((a: number, b: number) => a + b, 0) / 1000)}</td>\r\n                    <td>{formatPercentage(e.reduce((a: number, b: number) => a + b, 0) / this.owner.fightDuration)}%\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.BARBED_SHOT_PET_BUFF}>\r\n          <>\r\n            <UptimeIcon /> {formatPercentage(this.percentUptimeMaxStacks)}% <small>3 stack uptime</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default BarbedShot;\r\n","import React from 'react';\r\nimport Analyzer, { Options, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { ApplyBuffEvent, DamageEvent, RefreshBuffEvent, RemoveBuffEvent } from 'parser/core/Events';\r\nimport { formatPercentage } from 'common/format';\r\nimport UptimeIcon from 'interface/icons/Uptime';\r\nimport { MS_BUFFER } from 'parser/hunter/shared/constants';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\n/**\r\n * After you Multi-Shot, your pet's melee attacks also strike all other nearby enemy targets for 100% as much for the next 4 sec.\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/MnzYCvDHdLGZJkAg#fight=7&type=damage-done&source=24&ability=118459\r\n *\r\n * This module also tracks the amount of multi-shot casts that did not trigger any beast cleave damage\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/bf3r17Yh86VvDLdF#fight=8&type=damage-done&source=1\r\n */\r\nclass BeastCleave extends Analyzer {\r\n  damage = 0;\r\n  cleaveUp = false;\r\n  beastCleaveHits = 0;\r\n  casts = 0;\r\n  castsWithoutHits = 0;\r\n  timestamp = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.addEventListener(Events.applybuff.to(SELECTED_PLAYER_PET).spell(SPELLS.BEAST_CLEAVE_PET_BUFF), this.onApplyBuff);\r\n    this.addEventListener(Events.removebuff.to(SELECTED_PLAYER_PET).spell(SPELLS.BEAST_CLEAVE_PET_BUFF), this.onRemoveBuff);\r\n    this.addEventListener(Events.refreshbuff.to(SELECTED_PLAYER_PET).spell(SPELLS.BEAST_CLEAVE_PET_BUFF), this.onRefreshBuff);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET).spell(SPELLS.BEAST_CLEAVE_DAMAGE), this.onBeastCleaveDamage);\r\n  }\r\n\r\n  get beastCleavesWithoutHits() {\r\n    return {\r\n      actual: this.castsWithoutHits,\r\n      isGreaterThan: {\r\n        minor: 0,\r\n        average: 0,\r\n        major: 3,\r\n      },\r\n      style: ThresholdStyle.NUMBER,\r\n    };\r\n  }\r\n\r\n  get uptime() {\r\n    return this.selectedCombatant.getBuffUptime(SPELLS.BEAST_CLEAVE_BUFF.id) / this.owner.fightDuration;\r\n  }\r\n\r\n  onApplyBuff(event: ApplyBuffEvent) {\r\n    if (this.timestamp + MS_BUFFER > event.timestamp) {\r\n      return;\r\n    }\r\n    this.casts += 1;\r\n    this.cleaveUp = true;\r\n    this.beastCleaveHits = 0;\r\n    this.timestamp = event.timestamp;\r\n  }\r\n\r\n  onRemoveBuff(event: RemoveBuffEvent) {\r\n    if (this.timestamp + MS_BUFFER > event.timestamp) {\r\n      return;\r\n    }\r\n    this.checkAmountOfHits();\r\n    this.cleaveUp = false;\r\n    this.timestamp = event.timestamp;\r\n  }\r\n\r\n  onRefreshBuff(event: RefreshBuffEvent) {\r\n    if (this.timestamp + MS_BUFFER > event.timestamp) {\r\n      return;\r\n    }\r\n    this.casts += 1;\r\n    this.checkAmountOfHits();\r\n    this.beastCleaveHits = 0;\r\n    this.timestamp = event.timestamp;\r\n  }\r\n\r\n  onBeastCleaveDamage(event: DamageEvent) {\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n    this.beastCleaveHits += 1;\r\n  }\r\n\r\n  checkAmountOfHits() {\r\n    if (this.beastCleaveHits === 0) {\r\n      this.castsWithoutHits += 1;\r\n    }\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    if (this.casts > 0) {\r\n      when(this.beastCleavesWithoutHits).addSuggestion((suggest, actual, recommended) => suggest(<>You cast <SpellLink id={SPELLS.MULTISHOT_BM.id} /> {actual} {actual === 1 ? 'time' : 'times'} without your pets doing any <SpellLink id={SPELLS.BEAST_CLEAVE_PET_BUFF.id} /> damage onto additional targets. On single-target situations, avoid using <SpellLink id={SPELLS.MULTISHOT_BM.id} />.</>)\r\n        .icon(SPELLS.MULTISHOT_BM.icon)\r\n        .actual(i18n._(t('hunter.beastmastery.suggestions.beastCleave.efficiency')`${actual} ${actual === 1 ? 'cast' : 'casts'} without any Beast Cleave damage`))\r\n        .recommended(`${recommended} is recommended`));\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    if (this.damage > 0) {\r\n      return (\r\n        <Statistic\r\n          position={STATISTIC_ORDER.OPTIONAL(13)}\r\n          size=\"flexible\"\r\n        >\r\n          <BoringSpellValueText spell={SPELLS.BEAST_CLEAVE_BUFF}>\r\n            <>\r\n              <ItemDamageDone amount={this.damage} /> <br />\r\n              <UptimeIcon /> {formatPercentage(this.uptime)}% <small>uptime</small>\r\n            </>\r\n          </BoringSpellValueText>\r\n        </Statistic>\r\n      );\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\nexport default BeastCleave;\r\n","import React from 'react';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport SPELLS from 'common/SPELLS';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport { formatNumber, formatPercentage } from 'common/format';\r\nimport SpellLink from 'common/SpellLink';\r\nimport ResourceIcon from 'common/ResourceIcon';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport UptimeIcon from 'interface/icons/Uptime';\r\nimport Events, { CastEvent } from 'parser/core/Events';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\nimport { BARBED_SHOT_BESTIAL_WRATH_CDR_MS, BESTIAL_WRATH_BASE_CD } from '../../constants';\r\n\r\n/**\r\n * Sends you and your pet into a rage, increasing all damage you both deal by 25% for 15 sec. Bestial Wrath's remaining cooldown is reduced by 12 sec each time you use Barbed Shot\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/bf3r17Yh86VvDLdF#fight=8&type=auras&source=1&ability=19574\r\n */\r\nclass BestialWrath extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n  };\r\n\r\n  effectiveBWReduction = 0;\r\n  wastedBWReduction = 0;\r\n  casts = 0;\r\n  accumulatedFocusAtBWCast = 0;\r\n\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.BESTIAL_WRATH), this.onBestialWrathCast);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.BARBED_SHOT), this.onBarbedShotCast);\r\n  }\r\n\r\n  get percentUptime() {\r\n    return formatPercentage(this.selectedCombatant.getBuffUptime(SPELLS.BESTIAL_WRATH.id) / this.owner.fightDuration);\r\n  }\r\n\r\n  get gainedBestialWraths() {\r\n    return this.effectiveBWReduction / BESTIAL_WRATH_BASE_CD;\r\n  }\r\n\r\n  get averageFocusAtBestialWrathCast() {\r\n    return this.accumulatedFocusAtBWCast / this.casts;\r\n  }\r\n\r\n  get totalPossibleCDR() {\r\n    return this.wastedBWReduction + this.effectiveBWReduction;\r\n  }\r\n\r\n  get effectiveBestialWrathCDRPercent() {\r\n    return this.effectiveBWReduction / this.totalPossibleCDR;\r\n  }\r\n\r\n  get focusOnBestialWrathCastThreshold() {\r\n    return {\r\n      actual: this.averageFocusAtBestialWrathCast,\r\n      isLessThan: {\r\n        minor: 40,\r\n        average: 30,\r\n        major: 20,\r\n      },\r\n      style: ThresholdStyle.NUMBER,\r\n    };\r\n  }\r\n\r\n  get cdrEfficiencyBestialWrathThreshold() {\r\n    return {\r\n      actual: this.effectiveBWReduction / this.totalPossibleCDR,\r\n      isLessThan: {\r\n        minor: 0.95,\r\n        average: 0.9,\r\n        major: 0.85,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  onBestialWrathCast(event: CastEvent) {\r\n    this.casts += 1;\r\n    const resource = event.classResources?.find(resource => resource.type === RESOURCE_TYPES.FOCUS.id);\r\n    if (resource) {\r\n      this.accumulatedFocusAtBWCast += resource.amount || 0;\r\n    }\r\n  }\r\n\r\n  onBarbedShotCast() {\r\n    const bestialWrathIsOnCooldown = this.spellUsable.isOnCooldown(SPELLS.BESTIAL_WRATH.id);\r\n    if (bestialWrathIsOnCooldown) {\r\n      const reductionMs = this.spellUsable.reduceCooldown(SPELLS.BESTIAL_WRATH.id, BARBED_SHOT_BESTIAL_WRATH_CDR_MS);\r\n      this.effectiveBWReduction += reductionMs;\r\n      this.wastedBWReduction += (BARBED_SHOT_BESTIAL_WRATH_CDR_MS - reductionMs);\r\n    } else {\r\n      this.wastedBWReduction += BARBED_SHOT_BESTIAL_WRATH_CDR_MS;\r\n    }\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.focusOnBestialWrathCastThreshold).addSuggestion((suggest, actual, recommended) => suggest(<>You started your average <SpellLink id={SPELLS.BESTIAL_WRATH.id} /> at {formatNumber(this.averageFocusAtBestialWrathCast)} focus, try and pool a bit more before casting <SpellLink id={SPELLS.BESTIAL_WRATH.id} />. This can be achieved by not casting abilities a few moments before <SpellLink id={SPELLS.BESTIAL_WRATH.id} /> comes off cooldown.</>)\r\n      .icon(SPELLS.BESTIAL_WRATH.icon)\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.bestialWrath.focusPool.efficiency')`Average of ${formatNumber(this.averageFocusAtBestialWrathCast)} focus at start of Bestial Wrath`))\r\n      .recommended(`>${recommended} focus is recommended`));\r\n    when(this.cdrEfficiencyBestialWrathThreshold).addSuggestion((suggest, actual, recommended) => suggest(<>A crucial part of <SpellLink id={SPELLS.BARBED_SHOT.id} /> is the cooldown reduction of <SpellLink id={SPELLS.BESTIAL_WRATH.id} /> it provides. Therefore it's important to be casting <SpellLink id={SPELLS.BESTIAL_WRATH.id} /> as often as possible to ensure you'll be wasting as little potential cooldown reduction as possible.</>)\r\n      .icon(SPELLS.BESTIAL_WRATH.icon)\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.bestialWrath.cooldown.efficiency')`You had ${formatPercentage(actual)}% effective cooldown reduction of Bestial Wrath`))\r\n      .recommended(`>${formatPercentage(recommended)}% is recommended`));\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(2)}\r\n        size=\"flexible\"\r\n        dropdown={(\r\n          <>\r\n            <table className=\"table table-condensed\">\r\n              <thead>\r\n                <tr>\r\n                  <td className=\"text-left\"><b>Statistic</b></td>\r\n                  <td><b>Info</b></td>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                <tr>\r\n                  <td className=\"text-left\">Average focus on cast</td>\r\n                  <td><>{formatNumber(this.averageFocusAtBestialWrathCast)}\r\n                    <ResourceIcon id={RESOURCE_TYPES.FOCUS.id} noLink /></>\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <td className=\"text-left\">Gained Bestial Wraths</td>\r\n                  <td><>{this.gainedBestialWraths.toFixed(1)}\r\n                    <SpellIcon id={SPELLS.BESTIAL_WRATH.id} /></>\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <td className=\"text-left\">CDR Efficiency</td>\r\n                  <td><>{formatNumber(this.effectiveBWReduction /\r\n                    1000)}s / {this.totalPossibleCDR / 1000}s\r\n                  </>\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <td className=\"text-left\">CDR Efficiency %</td>\r\n                  <td>{formatPercentage(this.effectiveBWReduction /\r\n                    this.totalPossibleCDR)}%\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.BESTIAL_WRATH}>\r\n          <>\r\n            <UptimeIcon /> {this.percentUptime}% <small>uptime</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default BestialWrath;\r\n","import React from 'react';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport SpellLink from 'common/SpellLink';\r\nimport { formatNumber, formatPercentage } from 'common/format';\r\nimport GlobalCooldown from 'parser/hunter/beastmastery/modules/core/GlobalCooldown';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport Events, { CastEvent } from 'parser/core/Events';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\nimport { COBRA_SHOT_CDR_MS, COBRA_SHOT_FOCUS_THRESHOLD_TO_WAIT } from '../../constants';\r\n\r\n/**\r\n * A quick shot causing Physical damage.\r\n * Reduces the cooldown of Kill Command by 1 sec.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/bf3r17Yh86VvDLdF#fight=8&type=damage-done&source=1&ability=193455\r\n */\r\n\r\nclass CobraShot extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n    globalCooldown: GlobalCooldown,\r\n  };\r\n\r\n  effectiveKCReductionMs = 0;\r\n  wastedKCReductionMs = 0;\r\n  wastedCasts = 0;\r\n  casts = 0;\r\n\r\n  protected spellUsable!: SpellUsable;\r\n  protected globalCooldown!: GlobalCooldown;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.COBRA_SHOT), this.onCobraShotCast);\r\n  }\r\n\r\n  get totalPossibleCDR() {\r\n    return Math.max(this.casts * COBRA_SHOT_CDR_MS, 1);\r\n  }\r\n\r\n  get wastedCDR() {\r\n    return this.wastedKCReductionMs / 1000;\r\n  }\r\n\r\n  get cdrEfficiencyCobraShotThreshold() {\r\n    return {\r\n      actual: this.effectiveKCReductionMs / this.totalPossibleCDR,\r\n      isLessThan: {\r\n        minor: 0.85,\r\n        average: 0.8,\r\n        major: 0.75,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  get wastedCobraShotsThreshold() {\r\n    return {\r\n      actual: this.wastedCasts,\r\n      isGreaterThan: {\r\n        minor: 0,\r\n        average: 1,\r\n        major: 2,\r\n      },\r\n      style: ThresholdStyle.NUMBER,\r\n    };\r\n  }\r\n\r\n  onCobraShotCast(event: CastEvent) {\r\n    if (event.meta === undefined) {\r\n      event.meta = {\r\n        isInefficientCast: false,\r\n        inefficientCastReason: '',\r\n      };\r\n    }\r\n    this.casts += 1;\r\n    if (!this.spellUsable.isOnCooldown(SPELLS.KILL_COMMAND_CAST_BM.id)) {\r\n      this.wastedCasts += 1;\r\n      this.wastedKCReductionMs += COBRA_SHOT_CDR_MS;\r\n      event.meta.isInefficientCast = true;\r\n      event.meta.inefficientCastReason = 'Cobra Shot cast while Kill Command is not on cooldown.';\r\n      return;\r\n    }\r\n    const globalCooldown = this.globalCooldown.getGlobalCooldownDuration(SPELLS.COBRA_SHOT.id);\r\n    const killCommandCooldownRemaining = this.spellUsable.cooldownRemaining(\r\n      SPELLS.KILL_COMMAND_CAST_BM.id);\r\n    if (killCommandCooldownRemaining < COBRA_SHOT_CDR_MS + globalCooldown) {\r\n      const effectiveReductionMs = killCommandCooldownRemaining -\r\n        globalCooldown;\r\n      this.effectiveKCReductionMs += this.spellUsable.reduceCooldown(SPELLS.KILL_COMMAND_CAST_BM.id, effectiveReductionMs);\r\n      this.wastedKCReductionMs += COBRA_SHOT_CDR_MS - effectiveReductionMs;\r\n\r\n      const resource = event.classResources?.find(resource => resource.type === RESOURCE_TYPES.FOCUS.id);\r\n      if (!resource) {\r\n        return;\r\n      }\r\n      if (resource.amount < COBRA_SHOT_FOCUS_THRESHOLD_TO_WAIT) {\r\n        event.meta.isInefficientCast = true;\r\n        event.meta.inefficientCastReason = 'Cobra Shot cast while Kill Command\\'s cooldown was under ' + (globalCooldown + COBRA_SHOT_CDR_MS / 1000).toFixed(1) + 's remaining and you were not close to capping focus as you only had ' + (resource.amount) + ' focus.';\r\n      }\r\n    } else {\r\n      this.effectiveKCReductionMs += this.spellUsable.reduceCooldown(SPELLS.KILL_COMMAND_CAST_BM.id, COBRA_SHOT_CDR_MS);\r\n    }\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.cdrEfficiencyCobraShotThreshold).addSuggestion((suggest, actual, recommended) => suggest(<>A crucial part of <SpellLink id={SPELLS.COBRA_SHOT.id} /> is the cooldown reduction of <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> it provides. When the cooldown of <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> is larger than the duration of your GCD + 1s, you'll want to be casting <SpellLink id={SPELLS.COBRA_SHOT.id} /> to maximize the amount of casts of <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} />. If the cooldown of <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> is lower than GCD + 1s, you'll only want to be casting <SpellLink id={SPELLS.COBRA_SHOT.id} />, if you'd be capping focus otherwise.</>)\r\n      .icon(SPELLS.COBRA_SHOT.icon)\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.cobraShot.efficiency')`You had ${formatPercentage(actual)}% effective cooldown reduction of Kill Command`))\r\n      .recommended(`>${formatPercentage(recommended)}% is recommended`));\r\n    when(this.wastedCobraShotsThreshold).addSuggestion((suggest, actual) => suggest(<>You should never cast <SpellLink id={SPELLS.COBRA_SHOT.id} /> when <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> is off cooldown.</>)\r\n      .icon(SPELLS.COBRA_SHOT.icon)\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.cobraShot.cooldown.wasted')`You cast ${actual} Cobra Shots when Kill Command wasn't on cooldown`))\r\n      .recommended(`0 inefficient casts  is recommended`));\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(3)}\r\n        size=\"flexible\"\r\n        tooltip={(\r\n          <>\r\n            {this.wastedCasts > 0 &&\r\n            <>You had {this.wastedCasts} {this.wastedCasts > 1 ? 'casts' : 'cast'} of Cobra Shot when Kill Command wasn't on cooldown. </>}\r\n            {this.wastedCasts > 0 && this.wastedKCReductionMs > 0 && <br />}\r\n            {this.wastedKCReductionMs > 0 &&\r\n            `You wasted ${this.wastedCDR.toFixed(2)} seconds of potential cooldown reduction by casting Cobra Shot while Kill Command had less than 1 + GCD seconds remaining on its CD.`}\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.COBRA_SHOT}>\r\n          <>\r\n            {formatNumber(this.effectiveKCReductionMs / 1000)}s / {this.totalPossibleCDR / 1000}s\r\n            <br />\r\n            {formatPercentage(this.effectiveKCReductionMs / this.totalPossibleCDR)}% <small>effectiveness</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default CobraShot;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events from 'parser/core/Events';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\n/**\r\n * While Bestial Wrath is active, Cobra Shot resets the cooldown on Kill\r\n * Command.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/M8dWYrRvmbnADCcZ#fight=11&type=damage-done&source=169\r\n *\r\n */\r\n\r\nclass KillerCobra extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n  };\r\n\r\n  effectiveKillCommandResets = 0;\r\n  wastedKillerCobraCobraShots = 0;\r\n\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.KILLER_COBRA_TALENT.id);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.COBRA_SHOT), this.onCobraCast);\r\n  }\r\n\r\n  get wastedKillerCobraThreshold() {\r\n    return {\r\n      actual: this.wastedKillerCobraCobraShots,\r\n      isGreaterThan: {\r\n        minor: 0,\r\n        average: 1,\r\n        major: 3,\r\n      },\r\n      style: ThresholdStyle.NUMBER,\r\n    };\r\n  }\r\n\r\n  onCobraCast() {\r\n    if (!this.selectedCombatant.hasBuff(SPELLS.BESTIAL_WRATH.id)) {\r\n      return;\r\n    }\r\n    const killCommandIsOnCooldown = this.spellUsable.isOnCooldown(SPELLS.KILL_COMMAND_CAST_BM.id);\r\n    if (killCommandIsOnCooldown) {\r\n      this.spellUsable.endCooldown(SPELLS.KILL_COMMAND_CAST_BM.id);\r\n      this.effectiveKillCommandResets += 1;\r\n    } else {\r\n      this.wastedKillerCobraCobraShots += 1;\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.KILLER_COBRA_TALENT}>\r\n          <>\r\n            {this.effectiveKillCommandResets}/{this.effectiveKillCommandResets + this.wastedKillerCobraCobraShots} <small>{this.effectiveKillCommandResets + this.wastedKillerCobraCobraShots === 1 ? 'reset' : 'resets'}</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.wastedKillerCobraThreshold).addSuggestion((suggest, actual, recommended) => suggest(<>Avoid casting <SpellLink id={SPELLS.COBRA_SHOT.id} /> whilst <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> isn't on cooldown, when you have <SpellLink id={SPELLS.BESTIAL_WRATH.id} /> up. Utilize the reset effect of <SpellLink id={SPELLS.KILLER_COBRA_TALENT.id} /> by only casting <SpellLink id={SPELLS.COBRA_SHOT.id} /> to reset <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> when <SpellLink id={SPELLS.BESTIAL_WRATH.id} /> is up. </>)\r\n      .icon(SPELLS.KILLER_COBRA_TALENT.icon)\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.killerCobra.efficiency')`You cast Cobra Shot while Kill Command wasn't on cooldown, whilst Bestial Wrath was up ${actual} times.`))\r\n      .recommended(`${recommended} is recommended.`));\r\n  }\r\n}\r\n\r\nexport default KillerCobra;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Checklist from 'parser/shared/modules/features/Checklist';\r\nimport Rule from 'parser/shared/modules/features/Checklist/Rule';\r\nimport Requirement from 'parser/shared/modules/features/Checklist/Requirement';\r\nimport PreparationRule from 'parser/shared/modules/features/Checklist/PreparationRule';\r\nimport GenericCastEfficiencyRequirement from 'parser/shared/modules/features/Checklist/GenericCastEfficiencyRequirement';\r\nimport ResourceIcon from 'common/ResourceIcon';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport SpellIcon from 'common/SpellIcon';\r\n\r\nconst BeastMasteryChecklist = ({ combatant, castEfficiency, thresholds }: any) => {\r\n\r\n  const AbilityRequirement = (props: any) => (\r\n    <GenericCastEfficiencyRequirement\r\n      castEfficiency={castEfficiency.getCastEfficiencyForSpellId(props.spell)}\r\n      {...props}\r\n    />\r\n  );\r\n\r\n  AbilityRequirement.propTypes = {\r\n    spell: PropTypes.number.isRequired,\r\n  };\r\n\r\n  return (\r\n    <Checklist>\r\n      <Rule\r\n        name=\"Use core abilities as often as possible\"\r\n        description={(\r\n          <>\r\n            Using your core abilities as often as possible can help raise your dps significantly. Some help more than others, but as a general rule of thumb you should be looking to use most of your damaging abilities and damage cooldowns as often as possible, unless you need to save them for a prioirty burst phase that is coming up soon.\r\n            {'  '}\r\n            <a href=\"https://www.icy-veins.com/wow/beast-mastery-hunter-pve-dps-rotation-cooldowns-abilities\" target=\"_blank\" rel=\"noopener noreferrer\">More info.</a>\r\n          </>\r\n        )}\r\n      >\r\n        <AbilityRequirement spell={SPELLS.KILL_COMMAND_CAST_BM.id} />\r\n        <AbilityRequirement spell={SPELLS.BARBED_SHOT.id} />\r\n        <AbilityRequirement spell={SPELLS.BESTIAL_WRATH.id} />\r\n        <AbilityRequirement spell={SPELLS.ASPECT_OF_THE_WILD.id} />\r\n\r\n        {combatant.hasTalent(SPELLS.DIRE_BEAST_TALENT.id) &&\r\n        <AbilityRequirement spell={SPELLS.DIRE_BEAST_TALENT.id} />}\r\n        {combatant.hasTalent(SPELLS.CHIMAERA_SHOT_BM_TALENT.id) &&\r\n        <AbilityRequirement spell={SPELLS.CHIMAERA_SHOT_BM_TALENT.id} />}\r\n        {combatant.hasTalent(SPELLS.A_MURDER_OF_CROWS_TALENT.id) &&\r\n        <AbilityRequirement spell={SPELLS.A_MURDER_OF_CROWS_TALENT.id} />}\r\n        {combatant.hasTalent(SPELLS.BARRAGE_TALENT.id) &&\r\n        <AbilityRequirement spell={SPELLS.BARRAGE_TALENT.id} />}\r\n        {combatant.hasTalent(SPELLS.STAMPEDE_TALENT.id) &&\r\n        <AbilityRequirement spell={SPELLS.STAMPEDE_TALENT.id} />}\r\n        {combatant.hasTalent(SPELLS.BLOODSHED_TALENT.id) &&\r\n        <AbilityRequirement spell={SPELLS.BLOODSHED_TALENT.id} />}\r\n      </Rule>\r\n      <Rule\r\n        name=\"Barbed Shot usage\"\r\n        description={(\r\n          <>\r\n            Using <SpellLink id={SPELLS.BARBED_SHOT.id} /> properly is a key to achieving high dps. This means maintaining the pet buff from <SpellLink id={SPELLS.BARBED_SHOT.id} /> as long as possible, and using it to reduce the cooldown of <SpellLink id={SPELLS.BESTIAL_WRATH.id} /> as much as possible, to ensure high uptime on <SpellLink id={SPELLS.BESTIAL_WRATH.id} />.\r\n          </>\r\n        )}\r\n      >\r\n        <Requirement name={<>Uptime of <SpellLink id={SPELLS.BARBED_SHOT_PET_BUFF.id} /> </>} thresholds={thresholds.frenzyUptimeSuggestionThreshold} />\r\n        <Requirement name={<>3 stack uptime of <SpellLink id={SPELLS.BARBED_SHOT_PET_BUFF.id} /> </>} thresholds={thresholds.frenzy3StackSuggestionThreshold} />\r\n        <Requirement name={<><SpellLink id={SPELLS.BESTIAL_WRATH.id} /> CDR Efficiency</>} thresholds={thresholds.bestialWrathCDREfficiencyThreshold} />\r\n      </Rule>\r\n      <Rule\r\n        name=\"Talent, cooldown and spell efficiency\"\r\n        description={(\r\n          <>\r\n            You want to be using your baseline spells as efficiently as possible, as well as choosing the right talents for the given scenario. If a talent isn't being used optimally for the encounter, you should consider swapping to a different talent.\r\n          </>\r\n        )}\r\n      >\r\n        <Requirement name={<><SpellIcon id={SPELLS.COBRA_SHOT.id} /><SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} icon={false} /> CDR efficiency</>} thresholds={thresholds.cobraShotCDREfficiencyThreshold} />\r\n        <Requirement name={<><SpellLink id={SPELLS.COBRA_SHOT.id} /> casts when <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> wasn't on cd</>} thresholds={thresholds.wastedCobraShotsThreshold} />\r\n        <Requirement name={<><ResourceIcon id={RESOURCE_TYPES.FOCUS.id} noLink={false} /> Average focus on <SpellIcon id={SPELLS.BESTIAL_WRATH.id} /> cast </>} thresholds={thresholds.bestialWrathFocusThreshold} />\r\n        <Requirement name={<> Lost pet Basic Attacks </>} thresholds={thresholds.basicAttackThresholds} />\r\n        <Requirement name={<><SpellLink id={SPELLS.BEAST_CLEAVE_BUFF.id} /> applications with 0 cleaves</>} thresholds={thresholds.beastCleaveThresholds} />\r\n        {combatant.hasTalent(SPELLS.KILLER_COBRA_TALENT.id) && <Requirement name={<> Wasted <SpellLink id={SPELLS.KILLER_COBRA_TALENT.id} /> resets </>} thresholds={thresholds.wastedKillerCobraThreshold} />}\r\n      </Rule>\r\n      <Rule\r\n        name=\"Legendaries\"\r\n        description=\"The throughput gain of some legendaries might vary greatly. Consider switching to a more reliable alternative if something is underperforming regularly, even after trying to improve your usage of said legendary.\"\r\n      >\r\n        {combatant.hasLegendaryByBonusID(SPELLS.QAPLA_EREDUN_WAR_ORDER_EFFECT.bonusID) &&\r\n        <Requirement name={<><SpellLink id={SPELLS.QAPLA_EREDUN_WAR_ORDER_EFFECT.id} /> CDR efficiency</>} thresholds={thresholds.qaplaEfficiencyThreshold} />}\r\n      </Rule>\r\n      <Rule\r\n        name=\"Downtime & resource generators\"\r\n        description={(\r\n          <>\r\n            As a DPS, you should try to reduce the delay between casting spells, and stay off resource capping as much as possible. If everything is on cooldown, try and use <SpellLink id={SPELLS.COBRA_SHOT.id} /> to stay off the focus cap and do some damage.\r\n          </>\r\n        )}\r\n      >\r\n        <Requirement name=\"Active time\" thresholds={thresholds.downtimeSuggestionThresholds} />\r\n        <Requirement name=\"Effective Focus from generators\" thresholds={thresholds.focusGeneratorWasteThresholds} />\r\n        <Requirement name=\"Effective Focus from natural regen\" thresholds={thresholds.focusNaturalRegenWasteThresholds} />\r\n      </Rule>\r\n      <PreparationRule thresholds={thresholds} />\r\n    </Checklist>\r\n  );\r\n};\r\n\r\nBeastMasteryChecklist.propTypes = {\r\n  castEfficiency: PropTypes.object.isRequired,\r\n  combatant: PropTypes.shape({\r\n    hasTalent: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n  thresholds: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default BeastMasteryChecklist;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport React from 'react';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events from 'parser/core/Events';\r\nimport { QAPLA_KILL_COMMAND_REDUCTION_MS } from 'parser/hunter/beastmastery/constants';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport { formatNumber, formatPercentage } from 'common/format';\r\nimport SpellLink from 'common/SpellLink';\r\n\r\n/**\r\n * Barbed Shot reduces the cooldown of Kill Command by 5.0 sec.\r\n *\r\n * Example log:\r\n *\r\n */\r\nclass QaplaEredunWarOrder extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n  };\r\n\r\n  effectiveKCReduction: number = 0;\r\n  wastedKCReduction: number = 0;\r\n  wastedCasts: number = 0;\r\n\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasLegendaryByBonusID(SPELLS.QAPLA_EREDUN_WAR_ORDER_EFFECT.bonusID);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.BARBED_SHOT), this.onBarbedShotCast);\r\n  }\r\n\r\n  get totalPossibleCDR() {\r\n    return Math.max(this.wastedKCReduction + this.effectiveKCReduction, 1);\r\n  }\r\n\r\n  get effectiveKillCommandCDRPercent() {\r\n    return this.effectiveKCReduction / this.totalPossibleCDR;\r\n  }\r\n\r\n  get cdrEfficiencyKillCommandThreshold() {\r\n    return {\r\n      actual: this.effectiveKCReduction / this.totalPossibleCDR,\r\n      isLessThan: {\r\n        minor: 0.75,\r\n        average: 0.65,\r\n        major: 0.55,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  onBarbedShotCast() {\r\n    const killCommandIsOnCooldown = this.spellUsable.isOnCooldown(SPELLS.KILL_COMMAND_CAST_BM.id);\r\n    if (killCommandIsOnCooldown) {\r\n      const reductionMs = this.spellUsable.reduceCooldown(SPELLS.KILL_COMMAND_CAST_BM.id, QAPLA_KILL_COMMAND_REDUCTION_MS);\r\n      this.effectiveKCReduction += reductionMs;\r\n      this.wastedKCReduction += (QAPLA_KILL_COMMAND_REDUCTION_MS - reductionMs);\r\n    } else {\r\n      this.wastedCasts += 1;\r\n      this.wastedKCReduction += QAPLA_KILL_COMMAND_REDUCTION_MS;\r\n    }\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.cdrEfficiencyKillCommandThreshold).addSuggestion((suggest, actual, recommended) => suggest(<>When using <SpellLink id={SPELLS.QAPLA_EREDUN_WAR_ORDER_EFFECT.id} /> you want to ideally only use <SpellLink id={SPELLS.BARBED_SHOT.id} /> when <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> has as much cooldown remaining as possible to gain the most out of its effect - but you still don't want to be capping on <SpellLink id={SPELLS.BARBED_SHOT.id} /> charges. </>)\r\n      .icon(SPELLS.QAPLA_EREDUN_WAR_ORDER_EFFECT.icon)\r\n      .actual(`You had ${formatPercentage(actual)}% effective cooldown reduction of Kill Command`)\r\n      .recommended(`>${formatPercentage(recommended, 0)}% is recommended`));\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.ITEMS}\r\n        tooltip={(\r\n          <>\r\n            {this.wastedCasts > 0 &&\r\n            <>You had {this.wastedCasts} {this.wastedCasts > 1 ? 'casts' : 'cast'} of Cobra Shot when Kill Command wasn't on cooldown. </>}\r\n            {this.wastedCasts > 0 && this.wastedKCReduction > 0 && <br />}\r\n            {this.wastedKCReduction > 0 &&\r\n            `You wasted ${(this.wastedKCReduction / 1000).toFixed(2)} seconds of potential cooldown reduction by casting Barbed Shot while Kill Command had less than 4 seconds remaining on its CD.`}\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.QAPLA_EREDUN_WAR_ORDER_EFFECT}>\r\n          <>\r\n            {formatNumber(this.effectiveKCReduction / 1000)}s / {this.totalPossibleCDR / 1000}s\r\n            <br />\r\n            {formatPercentage(this.effectiveKCReduction / this.totalPossibleCDR)}% <small>effectiveness</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default QaplaEredunWarOrder;\r\n","import FocusDetails from 'parser/hunter/shared/modules/resources/FocusDetails';\r\n\r\nimport CastEfficiency from 'parser/shared/modules/CastEfficiency';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\n\r\nimport BaseChecklist from 'parser/shared/modules/features/Checklist/Module';\r\nimport PreparationRuleAnalyzer from 'parser/shared/modules/features/Checklist/PreparationRuleAnalyzer';\r\nimport React from 'react';\r\n\r\nimport AlwaysBeCasting from '../features/AlwaysBeCasting';\r\nimport BasicAttacks from '../pets/basicAttacksTracker';\r\nimport BeastMasteryFocusCapTracker from '../resources/BeastMasteryFocusCapTracker';\r\nimport BarbedShot from '../spells/BarbedShot';\r\nimport BeastCleave from '../spells/BeastCleave';\r\nimport BestialWrath from '../spells/BestialWrath';\r\nimport CobraShot from '../spells/CobraShot';\r\nimport KillerCobra from '../talents/KillerCobra';\r\nimport Component from './Component';\r\nimport QaplaEredunWarOrder from '../items/QaplaEredunWarOrder';\r\n\r\nclass Checklist extends BaseChecklist {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n    castEfficiency: CastEfficiency,\r\n    preparationRuleAnalyzer: PreparationRuleAnalyzer,\r\n    alwaysBeCasting: AlwaysBeCasting,\r\n    barbedShot: BarbedShot,\r\n    bestialWrath: BestialWrath,\r\n    killerCobra: KillerCobra,\r\n    cobraShot: CobraShot,\r\n    focusGeneratorDetails: FocusDetails,\r\n    focusCapTracker: BeastMasteryFocusCapTracker,\r\n    beastCleave: BeastCleave,\r\n    basicAttacks: BasicAttacks,\r\n    qaplaEredunWarOrder: QaplaEredunWarOrder,\r\n  };\r\n\r\n  //region Core\r\n  protected combatants!: Combatants;\r\n  protected castEfficiency!: CastEfficiency;\r\n  protected preparationRuleAnalyzer!: PreparationRuleAnalyzer;\r\n  protected alwaysBeCasting!: AlwaysBeCasting;\r\n  //endregion\r\n\r\n  //region Spells\r\n  protected beastCleave!: BeastCleave;\r\n  protected cobraShot!: CobraShot;\r\n  protected barbedShot!: BarbedShot;\r\n  protected bestialWrath!: BestialWrath;\r\n  //endregion\r\n\r\n  //region Talents\r\n  protected killerCobra!: KillerCobra;\r\n  //endregion\r\n\r\n  //region Legendaries (and sets.. maybe, please blizzard)\r\n  protected qaplaEredunWarOrder!: QaplaEredunWarOrder;\r\n  //endregion\r\n\r\n  //region Resources\r\n  protected focusGeneratorDetails!: FocusDetails;\r\n  protected focusCapTracker!: BeastMasteryFocusCapTracker;\r\n  //endregion\r\n\r\n  //region Pets\r\n  protected basicAttacks!: BasicAttacks;\r\n\r\n  //endregion\r\n\r\n  render() {\r\n    return (\r\n      <Component\r\n        combatant={this.combatants.selected}\r\n        castEfficiency={this.castEfficiency}\r\n        thresholds={{\r\n          //region Core\r\n          ...this.preparationRuleAnalyzer.thresholds,\r\n          downtimeSuggestionThresholds: this.alwaysBeCasting.suggestionThresholds,\r\n          //endregion\r\n\r\n          //region Spells\r\n          frenzy3StackSuggestionThreshold: this.barbedShot.frenzy3StackThreshold,\r\n          frenzyUptimeSuggestionThreshold: this.barbedShot.frenzyUptimeThreshold,\r\n          bestialWrathCDREfficiencyThreshold: this.bestialWrath.cdrEfficiencyBestialWrathThreshold,\r\n          bestialWrathFocusThreshold: this.bestialWrath.focusOnBestialWrathCastThreshold,\r\n          cobraShotCDREfficiencyThreshold: this.cobraShot.cdrEfficiencyCobraShotThreshold,\r\n          wastedCobraShotsThreshold: this.cobraShot.wastedCobraShotsThreshold,\r\n          beastCleaveThresholds: this.beastCleave.beastCleavesWithoutHits,\r\n          //endregion\r\n\r\n          //region Talents\r\n          wastedKillerCobraThreshold: this.killerCobra.wastedKillerCobraThreshold,\r\n          //endregion\r\n\r\n          //region Legendaries\r\n          qaplaEfficiencyThreshold: this.qaplaEredunWarOrder.cdrEfficiencyKillCommandThreshold,\r\n          //endregion\r\n\r\n          //region Resources\r\n          focusGeneratorWasteThresholds: this.focusGeneratorDetails.focusGeneratorWasteThresholds,\r\n          focusNaturalRegenWasteThresholds: this.focusCapTracker.focusNaturalRegenWasteThresholds,\r\n          //endregion\r\n\r\n          //region Pets\r\n          basicAttackThresholds: this.basicAttacks.additionalAttacksFromMacroing,\r\n          //endregion\r\n        }}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default Checklist;\r\n","import React from 'react';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport { Options, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport { formatNumber } from 'common/format';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport ExecuteHelper from 'parser/shared/ExecuteHelper';\r\n\r\nimport { KILLER_INSTINCT_MULTIPLIER, KILLER_INSTINCT_THRESHOLD } from '../../constants';\r\n\r\n/**\r\n * Kill Command deals 50% increased damage against enemies below 35% health.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/DFZVfmhkj9bYa6rn#fight=1&type=damage-done\r\n */\r\nclass KillerInstinct extends ExecuteHelper {\r\n  static executeSpells = [SPELLS.KILL_COMMAND_DAMAGE_BM];\r\n  static executeSources = SELECTED_PLAYER_PET;\r\n  static lowerThreshold = KILLER_INSTINCT_THRESHOLD;\r\n  static modifiesDamage = true;\r\n  static damageModifier = KILLER_INSTINCT_MULTIPLIER;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.KILLER_INSTINCT_TALENT.id);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        tooltip={(\r\n          <>\r\n            You cast a total of {this.casts} Kill Commands, of which {this.castsWithExecute} were on enemies with less than 35% of their health remaining. <br />\r\n            These {this.castsWithExecute} casts provided you a total of {formatNumber(this.damage)} extra damage throughout the fight.\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.KILLER_INSTINCT_TALENT}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} /><br />\r\n            {formatNumber(this.castsWithExecute)} <small>casts at {'<'}35% health</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default KillerInstinct;\r\n","import React from 'react';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport AverageTargetsHit from 'interface/others/AverageTargetsHit';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\n\r\n/**\r\n * A two-headed shot that hits your primary target and another nearby target, dealing 720% Nature damage to one and 720% Frost damage to the other.\r\n * Generates 10 Focus for each target hit.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/3hpLckCDdjWXqFyT#fight=5&type=damage-done&source=2&ability=-53209\r\n */\r\nclass ChimaeraShot extends Analyzer {\r\n\r\n  damage = 0;\r\n  casts = 0;\r\n  hits = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.CHIMAERA_SHOT_BM_TALENT.id);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.CHIMAERA_SHOT_BM_TALENT), () => {\r\n      this.casts += 1;\r\n    });\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell([SPELLS.CHIMAERA_SHOT_BM_FROST_DAMAGE, SPELLS.CHIMAERA_SHOT_BM_NATURE_DAMAGE]), this.onChimaeraDamage);\r\n  }\r\n\r\n  onChimaeraDamage(event: DamageEvent) {\r\n    this.hits += 1;\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.CHIMAERA_SHOT_BM_TALENT}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} />\r\n            <br />\r\n            <AverageTargetsHit casts={this.casts} hits={this.hits} />\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ChimaeraShot;\r\n","import React from 'react';\r\nimport Analyzer, { Options, SELECTED_PLAYER, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\nimport { encodeTargetString } from 'parser/shared/modules/EnemyInstances';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Haste from 'interface/icons/Haste';\r\nimport Events, { DamageEvent, SummonEvent } from 'parser/core/Events';\r\nimport { DIRE_BEAST_HASTE_PERCENT } from 'parser/hunter/shared/constants';\r\n\r\n/**\r\n * Summons a powerful wild beast that attacks the target and roars, increasing your Haste by 5% for 8 sec.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/TY846VxkCwAfPLbG#fight=46&type=damage-done&source=411\r\n *\r\n * TODO: Ensure it doesn't conflict with Dire Command legendary.\r\n */\r\n\r\nclass DireBeast extends Analyzer {\r\n\r\n  damage = 0;\r\n  activeDireBeasts: string[] = [];\r\n  targetId = '';\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.DIRE_BEAST_TALENT.id);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET), this.onPetDamage);\r\n    this.addEventListener(Events.summon.by(SELECTED_PLAYER).spell(SPELLS.DIRE_BEAST_SUMMON), this.onDireSummon);\r\n  }\r\n\r\n  get uptime() {\r\n    return this.selectedCombatant.getBuffUptime(SPELLS.DIRE_BEAST_BUFF.id) / this.owner.fightDuration;\r\n  }\r\n\r\n  onPetDamage(event: DamageEvent) {\r\n    const sourceId: string = encodeTargetString(event.sourceID);\r\n    if (this.activeDireBeasts.includes(sourceId)) {\r\n      this.damage += event.amount + (event.absorbed || 0);\r\n    }\r\n  }\r\n\r\n  onDireSummon(event: SummonEvent) {\r\n    this.targetId = encodeTargetString(event.targetID);\r\n    this.activeDireBeasts = [];\r\n    this.activeDireBeasts.push(this.targetId);\r\n    this.targetId = '';\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        tooltip={<>You had {formatPercentage(this.uptime)}% uptime on the Dire Beast Haste buff.</>}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.DIRE_BEAST_TALENT}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} />\r\n            <br />\r\n            <Haste /> {formatPercentage(DIRE_BEAST_HASTE_PERCENT * this.uptime)}% Haste<br />\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DireBeast;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport { formatMilliseconds, formatNumber } from 'common/format';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { ApplyBuffEvent, DamageEvent } from 'parser/core/Events';\r\nimport { STAMPEDE_POTENTIAL_HITS } from 'parser/hunter/beastmastery/constants';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\n/**\r\n * Summon a herd of stampeding animals from the wilds around you that deal damage to your enemies for 12 sec.\r\n *\r\n * Example log that triggers the warning for one cast, but also has 1 good cast:\r\n * https://www.warcraftlogs.com/reports/1xBcaN8kyADHdhjG#fight=9&type=damage-done&source=176&ability=201594\r\n */\r\nclass Stampede extends Analyzer {\r\n\r\n  casts: Array<{ timestamp: number, damage: number, hits: number, averageHits: number }> = [];\r\n  damage = 0;\r\n  hits = 0;\r\n  averageHits = 0;\r\n  inefficientCasts = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.STAMPEDE_TALENT.id);\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.STAMPEDE_TALENT), this.onStampedeApply);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.STAMPEDE_DAMAGE), this.onStampedeDamage);\r\n    this.addEventListener(Events.fightend, this.onFightEnd);\r\n  }\r\n\r\n  get currentCast() {\r\n    if (this.casts.length === 0) {\r\n      return null;\r\n    }\r\n    return this.casts[this.casts.length - 1];\r\n  }\r\n\r\n  get stampedeInefficientCastsThreshold() {\r\n    return {\r\n      actual: this.inefficientCasts,\r\n      isGreaterThan: {\r\n        minor: 0,\r\n        average: 0,\r\n        major: 1,\r\n      },\r\n      style: ThresholdStyle.NUMBER,\r\n    };\r\n  }\r\n\r\n  onStampedeApply(event: ApplyBuffEvent) {\r\n    this.casts.push({\r\n      timestamp: event.timestamp,\r\n      damage: 0,\r\n      hits: 0,\r\n      averageHits: 0,\r\n    });\r\n  }\r\n\r\n  onStampedeDamage(event: DamageEvent) {\r\n    const damage = event.amount + (event.absorbed || 0);\r\n    this.hits += 1;\r\n    this.damage += damage;\r\n\r\n    if (this.currentCast !== null) {\r\n      this.currentCast.hits += 1;\r\n      this.currentCast.damage += damage;\r\n    }\r\n  }\r\n\r\n  onFightEnd() {\r\n    this.averageHits = this.hits / this.casts.length / STAMPEDE_POTENTIAL_HITS;\r\n    this.casts.forEach((cast: { averageHits: number, hits: number }) => {\r\n      cast.averageHits = cast.hits / STAMPEDE_POTENTIAL_HITS;\r\n      if (cast.averageHits < 1) {\r\n        this.inefficientCasts += 1;\r\n      }\r\n    });\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.stampedeInefficientCastsThreshold).addSuggestion((suggest, actual, recommended) => suggest(<>You cast <SpellLink id={SPELLS.STAMPEDE_TALENT.id} /> inefficiently {actual} {actual > 1 ? 'times' : 'time'} throughout the fight. This means you've placed <SpellLink id={SPELLS.STAMPEDE_TALENT.id} /> at a place where it was impossible for it to deal it's full damage, or the enemy moved out of it. Avoid using <SpellLink id={SPELLS.STAMPEDE_TALENT.id} /> on moments where it's likely the enemy will be moving out of it.</>)\r\n      .icon(SPELLS.STAMPEDE_TALENT.icon)\r\n      .actual(i18n._(t('hunter.beastmastery.suggestions.stampede.efficiency')`${actual} inefficient ${actual > 1 ? 'casts' : 'cast'}`))\r\n      .recommended(`${recommended} is recommended`));\r\n  }\r\n\r\n  statistic() {\r\n    if (this.casts.length > 0) {\r\n      const averageHit = this.damage / this.hits;\r\n      const stampedePlural = this.casts.length === 1 ? `1 Stampede` : `a total of ${this.casts.length} Stampedes`;\r\n      return (\r\n        <Statistic\r\n          position={STATISTIC_ORDER.OPTIONAL(13)}\r\n          size=\"flexible\"\r\n          category={STATISTIC_CATEGORY.TALENTS}\r\n          tooltip={(\r\n            <>\r\n              You cast {stampedePlural} in the fight, which hit enemies {this.hits} times for an average of {formatNumber(averageHit)} damage per hit.\r\n            </>\r\n          )}\r\n          dropdown={(\r\n            <>\r\n              <table className=\"table table-condensed\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Cast at</th>\r\n                    <th>Damage</th>\r\n                    <th>Hits</th>\r\n                    <th>Avg hit</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {this.casts.map((cast, idx) => (\r\n                    <tr key={idx}>\r\n                      <td>{formatMilliseconds(cast.timestamp - this.owner.fight.start_time)}</td>\r\n                      <td>{formatNumber(cast.damage)}</td>\r\n                      <td>{cast.hits}</td>\r\n                      <td>{formatNumber(cast.damage / cast.hits)}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </>\r\n          )}\r\n        >\r\n          <BoringSpellValueText spell={SPELLS.STAMPEDE_TALENT}>\r\n            <>\r\n              <ItemDamageDone amount={this.damage} /><br />\r\n              {this.casts.length} {this.casts.length > 1 ? 'casts' : 'cast'} / {this.hits} hits\r\n            </>\r\n          </BoringSpellValueText>\r\n        </Statistic>\r\n      );\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\nexport default Stampede;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport AverageTargetsHit from 'interface/others/AverageTargetsHit';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\n\r\nimport { AMOUNT_OF_PETS_WITH_AC } from '../../constants';\r\n\r\n/**\r\n * When you cast Barbed Shot, your pet stomps the ground, dealing [((50% of Attack power)) * (1 + Versatility)] Physical damage to all nearby enemies.\r\n *\r\n * Example log without Animal Companion:\r\n * https://www.warcraftlogs.com/reports/Q9LghKR7ZPnAwFaH#fight=48&type=damage-done&ability=201754&source=280\r\n *\r\n * Example log with Animal Companion (on ST, so only 1 avg target hit expected):\r\n * https://www.warcraftlogs.com/reports/aRZTcf4Gh6n7xmKq#fight=9&type=damage-done&source=10&ability=201754\r\n *\r\n */\r\n\r\nclass Stomp extends Analyzer {\r\n  damage = 0;\r\n  hits = 0;\r\n  casts = 0;\r\n  hasAC = false;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.STOMP_TALENT.id);\r\n    this.hasAC = this.selectedCombatant.hasTalent(SPELLS.ANIMAL_COMPANION_TALENT.id);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell([SPELLS.BARBED_SHOT, SPELLS.DIRE_BEAST_TALENT]), () => {\r\n      this.casts += 1;\r\n    });\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET).spell(SPELLS.STOMP_DAMAGE), this.onPetStompDamage);\r\n  }\r\n\r\n  onPetStompDamage(event: DamageEvent) {\r\n    this.hits += 1;\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.STOMP_TALENT}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} /><br />\r\n            <AverageTargetsHit casts={this.casts} hits={this.hasAC ? this.hits / AMOUNT_OF_PETS_WITH_AC : this.hits} />\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Stomp;\r\n","import React from 'react';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatDuration, formatPercentage } from 'common/format';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport CriticalStrike from 'interface/icons/CriticalStrike';\r\nimport Events, { ApplyBuffEvent, ApplyBuffStackEvent, EventType, FightEndEvent, RemoveBuffEvent } from 'parser/core/Events';\r\nimport { currentStacks } from 'parser/shared/modules/helpers/Stacks';\r\nimport { CRIT_PER_THRILL_STACK, MAX_THRILL_STACKS } from 'parser/hunter/beastmastery/constants';\r\n\r\n/**\r\n * Barbed Shot increases your critical strike chance by 3% for 8 sec, stacking up to 3 times.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/Q9LghKR7ZPnAwFaH#fight=48&type=auras&source=280&ability=257946\r\n */\r\n\r\nclass ThrillOfTheHunt extends Analyzer {\r\n\r\n  thrillStacks: number[][] = [];\r\n  lastThrillStack = 0;\r\n  lastThrillUpdate = this.owner.fight.start_time;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.THRILL_OF_THE_HUNT_TALENT.id);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    this.thrillStacks = Array.from({ length: MAX_THRILL_STACKS + 1 }, x => []);\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.THRILL_OF_THE_HUNT_BUFF), this.handleStacks);\r\n    this.addEventListener(Events.applybuffstack.by(SELECTED_PLAYER).spell(SPELLS.THRILL_OF_THE_HUNT_BUFF), this.handleStacks);\r\n    this.addEventListener(Events.removebuff.by(SELECTED_PLAYER).spell(SPELLS.THRILL_OF_THE_HUNT_BUFF), this.handleStacks);\r\n    this.addEventListener(Events.fightend, this.handleStacks);\r\n  }\r\n\r\n  get thrillOfTheHuntTimesByStacks() {\r\n    return this.thrillStacks;\r\n  }\r\n\r\n  get currentThrillCritPercentage() {\r\n    return this.lastThrillStack * CRIT_PER_THRILL_STACK;\r\n  }\r\n\r\n  get averageCritPercent() {\r\n    let averageCrit = 0;\r\n    this.thrillStacks.forEach((elem, index) => {\r\n      averageCrit += elem.reduce((a, b) => a + b, 0) / this.owner.fightDuration * index * CRIT_PER_THRILL_STACK;\r\n    });\r\n    return formatPercentage(averageCrit);\r\n  }\r\n\r\n  handleStacks(event: RemoveBuffEvent | ApplyBuffEvent | ApplyBuffStackEvent | FightEndEvent) {\r\n    this.thrillStacks[this.lastThrillStack].push(event.timestamp - this.lastThrillUpdate);\r\n    if (event.type === EventType.FightEnd) {\r\n      return;\r\n    }\r\n    this.lastThrillUpdate = event.timestamp;\r\n    this.lastThrillStack = currentStacks(event);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        dropdown={(\r\n          <>\r\n            <table className=\"table table-condensed\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Stacks</th>\r\n                  <th>Time (s)</th>\r\n                  <th>Time (%)</th>\r\n                  <th>Crit (%)</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {Object.values(this.thrillOfTheHuntTimesByStacks).map((e, i) => (\r\n                  <tr key={i}>\r\n                    <th>{i}</th>\r\n                    <td>{formatDuration(e.reduce((a, b) => a + b, 0) / 1000)}</td>\r\n                    <td>{formatPercentage(e.reduce((a, b) => a + b, 0) / this.owner.fightDuration)}%</td>\r\n                    <td>{formatPercentage(CRIT_PER_THRILL_STACK * i, 0)}%</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.THRILL_OF_THE_HUNT_TALENT}>\r\n          <>\r\n            <CriticalStrike /> {this.averageCritPercent}% <small>average Crit</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ThrillOfTheHunt;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport HIT_TYPES from 'game/HIT_TYPES';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\n\r\nimport { WILD_CALL_RESET_PERCENT } from '../../constants';\r\n\r\n/**\r\n * Wild Call has a 20% increased chance to reset the cooldown of Barbed Shot.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/y8RkxqLapwWhBAjT#fight=6&type=damage-done&source=142\r\n *\r\n * Wild Call: Your auto shot critical strikes have a 20% chance to reset the cooldown of Barbed Shot.\r\n */\r\n\r\nclass OneWithThePack extends Analyzer {\r\n\r\n  procChances = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.ONE_WITH_THE_PACK_TALENT.id);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.AUTO_SHOT), this.onAutoShotDamage);\r\n  }\r\n\r\n  onAutoShotDamage(event: DamageEvent) {\r\n    if (event.hitType !== HIT_TYPES.CRIT) {\r\n      return;\r\n    }\r\n    this.procChances += 1;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        tooltip={(\r\n          <>\r\n            Since there is no way to track Wild Call resets, this is an approximation of how many resets One With The Pack granted you.\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.ONE_WITH_THE_PACK_TALENT}>\r\n          <>\r\n            {(this.procChances * WILD_CALL_RESET_PERCENT).toFixed(1)} <small>resets</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default OneWithThePack;\r\n","import React from 'react';\r\nimport Analyzer, { Options, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { DamageEvent, HealEvent } from 'parser/core/Events';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\nimport ItemHealingDone from 'interface/ItemHealingDone';\r\nimport { AOTB_ABILITIES_NOT_AFFECTED, AOTB_MULTIPLIER } from 'parser/hunter/beastmastery/constants';\r\n\r\n/**\r\n * Increases the damage of your pet's abilities by 30%.\r\n * Increases the effectiveness of your pet's Predator's Thirst, Endurance Training, and Pathfinding passives by 50%.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/a4KVj37kTNbyxG1Y#fight=10&type=summary&source=8\r\n */\r\nclass AspectOfTheBeast extends Analyzer {\r\n  damage = 0;\r\n  healing = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.ASPECT_OF_THE_BEAST_TALENT.id);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET), this.onPetDamage);\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER_PET), this.onPetHeal);\r\n  }\r\n\r\n  onPetDamage(event: DamageEvent) {\r\n    const spellId = event.ability.guid;\r\n    if (AOTB_ABILITIES_NOT_AFFECTED.includes(spellId)) {\r\n      return;\r\n    }\r\n    this.damage += calculateEffectiveDamage(event, AOTB_MULTIPLIER);\r\n  }\r\n\r\n  onPetHeal(event: HealEvent) {\r\n    this.healing += calculateEffectiveHealing(event, AOTB_MULTIPLIER);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.ASPECT_OF_THE_BEAST_TALENT}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} />\r\n            <br />\r\n            <ItemHealingDone amount={this.healing} />\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default AspectOfTheBeast;\r\n","import React from 'react';\r\nimport Analyzer, { Options, SELECTED_PLAYER, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { CastEvent, DamageEvent } from 'parser/core/Events';\r\n\r\nimport { SPITTING_COBRA_DAMAGE_INCREASE } from '../../constants';\r\n\r\n/**\r\n *\r\n * When Bestial Wrath ends, summon a Spitting Cobra to aid you in combat for 15 sec.\r\n * Each Cobra Shot used during Bestial Wrath increases the damage this Spitting Cobra deals by 10%.\r\n *\r\n * Example log:\r\n *\r\n */\r\n\r\nclass SpittingCobra extends Analyzer {\r\n\r\n  damage = 0;\r\n  casts = 0;\r\n  totalIncrease = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.SPITTING_COBRA_TALENT.id);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell([SPELLS.BESTIAL_WRATH, SPELLS.COBRA_SHOT]), this.bestialWrathCobraShotCasts);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET).spell(SPELLS.SPITTING_COBRA_DAMAGE), this.spittingCobraDamage);\r\n  }\r\n\r\n  get averageIncrease() {\r\n    return (this.totalIncrease / this.casts).toFixed(1);\r\n  }\r\n\r\n  bestialWrathCobraShotCasts(event: CastEvent) {\r\n    const spellId = event.ability.guid;\r\n    if (spellId === SPELLS.BESTIAL_WRATH.id) {\r\n      this.casts += 1;\r\n      return;\r\n    }\r\n    if (!this.selectedCombatant.hasBuff(SPELLS.BESTIAL_WRATH.id)) {\r\n      return;\r\n    }\r\n    this.totalIncrease += SPITTING_COBRA_DAMAGE_INCREASE;\r\n  }\r\n\r\n  spittingCobraDamage(event: DamageEvent) {\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.SPITTING_COBRA_TALENT}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} /> <br />\r\n            {this.averageIncrease}% <small>average damage increase</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default SpittingCobra;\r\n","import React from 'react';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events from 'parser/core/Events';\r\nimport { SCENT_OF_BLOOD_BARBED_SHOT_RECHARGE } from 'parser/hunter/beastmastery/constants';\r\n\r\nimport SpellUsable from '../core/SpellUsable';\r\n\r\n/**\r\n * Activating Bestial Wrath grants 2 charges of Barbed Shot.\r\n *\r\n * Example log:\r\n */\r\n\r\nclass ScentOfBlood extends Analyzer {\r\n\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n  };\r\n\r\n  chargesGained = 0;\r\n  chargesWasted = 0;\r\n\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.SCENT_OF_BLOOD_TALENT.id);\r\n\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.BESTIAL_WRATH), this.bestialWrathApplication);\r\n  }\r\n\r\n  bestialWrathApplication() {\r\n    const chargesAvailable = this.spellUsable.chargesAvailable(SPELLS.BARBED_SHOT.id);\r\n    this.chargesGained += SCENT_OF_BLOOD_BARBED_SHOT_RECHARGE - chargesAvailable;\r\n    this.chargesWasted += chargesAvailable;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.SCENT_OF_BLOOD_TALENT}>\r\n          <>\r\n            {this.chargesGained}/{this.chargesGained + this.chargesWasted} <small>charges gained</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ScentOfBlood;\r\n","import React from 'react';\r\nimport Analyzer, { Options, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatNumber } from 'common/format';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport { isPermanentPet } from 'parser/shared/modules/pets/helpers';\r\n\r\n/**\r\n * Your Call Pet additionally summons the first pet from your stable.\r\n * This pet will obey your Kill Command, but cannot use pet family abilities.\r\n *\r\n * Additionally this talent baseline reduces all pet damage by 35%.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/bf3r17Yh86VvDLdF#fight=8&type=damage-done&source=1\r\n */\r\nclass AnimalCompanion extends Analyzer {\r\n  damage = 0;\r\n  pets: Array<{ petName: string, sourceID: number | undefined, damage: number }> = [];\r\n  mainPetName: string = '';\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.ANIMAL_COMPANION_TALENT.id);\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET), this.petDamage);\r\n    this.addEventListener(Events.fightend, this.onFightEnd);\r\n  }\r\n\r\n  petDamage(event: DamageEvent) {\r\n    const foundPet = this.pets.find((pet: { sourceID: number | undefined }) => pet.sourceID === event.sourceID);\r\n    const damage = event.amount +\r\n      (event.absorbed || 0);\r\n    if (!foundPet) {\r\n      const sourcePet = this.owner.playerPets.find((pet: { id: number | undefined; }) => pet.id === event.sourceID);\r\n      if (!sourcePet || !isPermanentPet(sourcePet.guid)) {\r\n        return;\r\n      }\r\n      this.pets.push({\r\n        petName: sourcePet.name,\r\n        sourceID: event.sourceID,\r\n        damage: damage,\r\n      });\r\n    } else {\r\n      foundPet.damage += damage;\r\n    }\r\n  }\r\n\r\n  onFightEnd() {\r\n    let max = 0;\r\n    this.pets.forEach((pet: { damage: number; petName: string; }) => {\r\n      if (pet.damage > max) {\r\n        max = pet.damage;\r\n        this.mainPetName = pet.petName;\r\n      }\r\n    });\r\n  }\r\n\r\n  statistic() {\r\n    const totalDamage = this.pets.map((pet: { damage: number; }) => pet.damage)\r\n      .reduce((total: number, current: number) => total + current, 0);\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        dropdown={(\r\n          <>\r\n            <table className=\"table table-condensed\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Pet</th>\r\n                  <th>Dmg</th>\r\n                  <th>DPS</th>\r\n                  <th>Dmg without AC</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {this.pets.map((pet, idx) => (\r\n                  <tr key={idx}>\r\n                    <td>{pet.petName}</td>\r\n                    <td>{formatNumber(pet.damage)}</td>\r\n                    <td>{formatNumber(pet.damage / (this.owner.fightDuration / 1000))}</td>\r\n                    <td>{pet.petName === this.mainPetName ?\r\n                      formatNumber(pet.damage / 0.65) + ' / ' + formatNumber((pet.damage / 0.65) / (this.owner.fightDuration / 1000)) + ' DPS'\r\n                      : ''}</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.ANIMAL_COMPANION_TALENT}>\r\n          <>\r\n            {formatNumber(totalDamage)} / {formatNumber(totalDamage / (this.owner.fightDuration / 1000))} DPS\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default AnimalCompanion;\r\n","import SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport SpellUsable from 'parser/hunter/beastmastery/modules/core/SpellUsable';\r\nimport Events, { EnergizeEvent } from 'parser/core/Events';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport UptimeIcon from 'interface/icons/Uptime';\r\nimport { formatPercentage } from 'common/format';\r\nimport React from 'react';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport { ASPECT_OF_THE_WILD_FOCUS } from 'parser/hunter/beastmastery/constants';\r\nimport { NESINGWARY_FOCUS_GAIN_MULTIPLIER } from 'parser/hunter/shared/constants';\r\n\r\n/**\r\n * Grants you and your pet 5 Focus per sec and 10% increased critical strike\r\n * chance for 20 sec. Reduces GCD by 200ms before haste.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/39yhq8VLFrm7J4wR#fight=17&type=auras&source=8&ability=193530\r\n */\r\n\r\nclass AspectOfTheWild extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n  };\r\n\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  additionalFocusFromNesingwary = 0;\r\n  possibleAdditionalFocusFromNesingwary = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.selectedCombatant.hasLegendaryByBonusID(SPELLS.NESINGWARYS_TRAPPING_APPARATUS_EFFECT.bonusID) && this.addEventListener(Events.energize.by(SELECTED_PLAYER).spell(SPELLS.ASPECT_OF_THE_WILD), this.checkNesingwaryFocusGain);\r\n  }\r\n\r\n  get uptime() {\r\n    return this.selectedCombatant.getBuffUptime(SPELLS.ASPECT_OF_THE_WILD.id) / this.owner.fightDuration;\r\n  }\r\n\r\n  checkNesingwaryFocusGain(event: EnergizeEvent) {\r\n    const waste = ASPECT_OF_THE_WILD_FOCUS - event.resourceChange;\r\n    if (this.selectedCombatant.hasBuff(SPELLS.NESINGWARYS_TRAPPING_APPARATUS_ENERGIZE.id)) {\r\n      this.additionalFocusFromNesingwary += event.resourceChange * (1 - 1 / NESINGWARY_FOCUS_GAIN_MULTIPLIER) - waste;\r\n      this.possibleAdditionalFocusFromNesingwary += ASPECT_OF_THE_WILD_FOCUS;\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(5)}\r\n        size=\"flexible\"\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.ASPECT_OF_THE_WILD}>\r\n          <>\r\n            <UptimeIcon /> {formatPercentage(this.uptime)}% <small>uptime</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default AspectOfTheWild;\r\n","import React from 'react';\r\n\r\nimport Analyzer from 'parser/core/Analyzer';\r\nimport { When } from 'parser/core/ParseResults';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport resourceSuggest from 'parser/shared/modules/resources/resourcetracker/ResourceSuggest';\r\nimport FocusTracker from 'parser/hunter/shared/modules/resources/FocusTracker';\r\n\r\nimport { BARBED_SHOT_FOCUS_REGEN_BUFFS, FOCUS_THRESHOLD_AVG, FOCUS_THRESHOLD_MAJOR, FOCUS_THRESHOLD_MINOR } from '../../constants';\r\n\r\nclass Focus extends Analyzer {\r\n  static dependencies = {\r\n    focusTracker: FocusTracker,\r\n  };\r\n\r\n  protected focusTracker!: FocusTracker;\r\n\r\n  suggestions(when: When) {\r\n    const bmFocusExtraSuggestion = <>Try to keep focus below max by using <SpellLink id={SPELLS.COBRA_SHOT.id} /> and <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} />.</>;\r\n    resourceSuggest(when, this.focusTracker, {\r\n      spell: SPELLS.ASPECT_OF_THE_WILD,\r\n      minor: FOCUS_THRESHOLD_MINOR,\r\n      avg: FOCUS_THRESHOLD_AVG,\r\n      major: FOCUS_THRESHOLD_MAJOR,\r\n      extraSuggestion: bmFocusExtraSuggestion,\r\n    });\r\n    resourceSuggest(when, this.focusTracker, {\r\n      spell: BARBED_SHOT_FOCUS_REGEN_BUFFS,\r\n      minor: FOCUS_THRESHOLD_MINOR,\r\n      avg: FOCUS_THRESHOLD_AVG,\r\n      major: FOCUS_THRESHOLD_MAJOR,\r\n      extraSuggestion: bmFocusExtraSuggestion,\r\n    });\r\n  }\r\n}\r\n\r\nexport default Focus;\r\n","import SharedHunterFocusUsage from 'parser/hunter/shared/modules/resources/FocusUsage';\r\nimport { LIST_OF_FOCUS_SPENDERS_BM } from 'parser/hunter/beastmastery/constants';\r\nimport Spell from 'common/SPELLS/Spell';\r\n\r\nclass BeastMasteryFocusUsage extends SharedHunterFocusUsage {\r\n\r\n  static listOfResourceSpenders: Spell[] = [\r\n    ...LIST_OF_FOCUS_SPENDERS_BM,\r\n  ];\r\n\r\n}\r\n\r\nexport default BeastMasteryFocusUsage;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport SPELLS from 'common/SPELLS';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport { BLOODLETTING_BARBED_DOT_INCREASE } from 'parser/hunter/beastmastery/constants';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport React from 'react';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\n\r\n/**\r\n * Barbed Shot's recharge time is reduced by 1 sec.\r\n * The damage of Barbed Shot is increased by x%.\r\n *\r\n * Example log\r\n *\r\n */\r\nclass Bloodletting extends Analyzer {\r\n\r\n  conduitRank: number = 0;\r\n  addedDamage: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.BLOODLETTING_CONDUIT.id);\r\n    if (!this.conduitRank) {\r\n      this.active = false;\r\n      return;\r\n    }\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.BARBED_SHOT), this.onBarbedShotDamage);\r\n  }\r\n\r\n  onBarbedShotDamage(event: DamageEvent) {\r\n    this.addedDamage += calculateEffectiveDamage(event, BLOODLETTING_BARBED_DOT_INCREASE[this.conduitRank]);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.BLOODLETTING_CONDUIT} rank={this.conduitRank}>\r\n          <>\r\n            <ItemDamageDone amount={this.addedDamage} />\r\n          </>\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default Bloodletting;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport React from 'react';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport HIT_TYPES from 'game/HIT_TYPES';\r\nimport { ECHOING_CALL_INCREASED_WILD_CALL_CHANCE } from 'parser/hunter/beastmastery/constants';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\n\r\n/**\r\n * Wild Call has a x%  increased chance to reset the cooldown of Barbed Shot.\r\n *\r\n * Example log\r\n *\r\n */\r\nclass EchoingCall extends Analyzer {\r\n\r\n  conduitRank: number = 0;\r\n  procChances: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.ECHOING_CALL_CONDUIT.id);\r\n    if (!this.conduitRank) {\r\n      this.active = false;\r\n      return;\r\n    }\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.AUTO_SHOT), this.onAutoShotDamage);\r\n  }\r\n\r\n  onAutoShotDamage(event: DamageEvent) {\r\n    if (event.hitType !== HIT_TYPES.CRIT) {\r\n      return;\r\n    }\r\n    this.procChances += 1;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n        tooltip={(\r\n          <>\r\n            Since there is no way to track Wild Call resets, this is an approximation of how many resets Echoing Call granted you.\r\n          </>\r\n        )}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.ECHOING_CALL_CONDUIT} rank={this.conduitRank}>\r\n          <>\r\n            {(this.procChances * ECHOING_CALL_INCREASED_WILD_CALL_CHANCE[this.conduitRank]).toFixed(1)} <small>resets</small>\r\n          </>\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default EchoingCall;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport SPELLS from 'common/SPELLS';\r\nimport HIT_TYPES from 'game/HIT_TYPES';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport { FEROCIOUS_APPETITE_ASPECT_REDUCTION } from 'parser/hunter/beastmastery/constants';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport React from 'react';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\n\r\n/**\r\n * Kill Command critical hits reduce the cooldown of Aspect of the Wild by 1.0 sec.\r\n *\r\n * Example log\r\n *\r\n */\r\nclass FerociousAppetite extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n  };\r\n\r\n  conduitRank: number = 0;\r\n  addedDamage: number = 0;\r\n  effectiveCDR: number = 0;\r\n  wastedCDR: number = 0;\r\n\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.FEROCIOUS_APPETITE_CONDUIT.id);\r\n    if (!this.conduitRank) {\r\n      this.active = false;\r\n      return;\r\n    }\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.KILL_COMMAND_DAMAGE_BM), this.onKillCommandDamage);\r\n  }\r\n\r\n  onKillCommandDamage(event: DamageEvent) {\r\n    if (event.hitType !== HIT_TYPES.CRIT) {\r\n      return;\r\n    }\r\n    if (this.spellUsable.isOnCooldown(SPELLS.ASPECT_OF_THE_WILD.id)) {\r\n      const reductionMs = this.spellUsable.reduceCooldown(SPELLS.ASPECT_OF_THE_WILD.id, FEROCIOUS_APPETITE_ASPECT_REDUCTION[this.conduitRank]);\r\n      this.effectiveCDR += reductionMs;\r\n      this.wastedCDR += FEROCIOUS_APPETITE_ASPECT_REDUCTION[this.conduitRank] - reductionMs;\r\n    } else {\r\n      this.wastedCDR += FEROCIOUS_APPETITE_ASPECT_REDUCTION[this.conduitRank];\r\n    }\r\n\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.FEROCIOUS_APPETITE_CONDUIT} rank={this.conduitRank}>\r\n          <>\r\n            {this.effectiveCDR}/{this.effectiveCDR + this.wastedCDR} <small>effective cooldown reduction</small>\r\n          </>\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default FerociousAppetite;\r\n","import Analyzer, { Options, SELECTED_PLAYER, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport SPELLS from 'common/SPELLS';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport { ONE_WITH_THE_BEAST_DAMAGE_INCREASE } from 'parser/hunter/beastmastery/constants';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport React from 'react';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\n\r\n/**\r\n * Bestial Wrath increases all damage you and your pet deal by X%.\r\n *\r\n * Example log\r\n *\r\n * TODO: Verify how this applies to Bestial Wrath (Multiplicate or Additive)\r\n */\r\nclass OneWithTheBeast extends Analyzer {\r\n\r\n  conduitRank: number = 0;\r\n  addedDamage: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.ONE_WITH_THE_BEAST_CONDUIT.id);\r\n    if (!this.conduitRank) {\r\n      this.active = false;\r\n      return;\r\n    }\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER), this.onGenericDamage);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET), this.onGenericDamage);\r\n  }\r\n\r\n  onGenericDamage(event: DamageEvent) {\r\n    if (!this.selectedCombatant.hasBuff(SPELLS.BESTIAL_WRATH.id)) {\r\n      return;\r\n    }\r\n    this.addedDamage += calculateEffectiveDamage(event, ONE_WITH_THE_BEAST_DAMAGE_INCREASE[this.conduitRank]);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.ONE_WITH_THE_BEAST_CONDUIT} rank={this.conduitRank}>\r\n          <>\r\n            <ItemDamageDone amount={this.addedDamage} />\r\n          </>\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default OneWithTheBeast;\r\n","import Analyzer, { Options, SELECTED_PLAYER, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport React from 'react';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { DamageEvent, SummonEvent } from 'parser/core/Events';\r\nimport { plotOneVariableBinomChart } from 'parser/shared/modules/helpers/Probability';\r\nimport SpellLink from 'common/SpellLink';\r\nimport { DIRE_COMMAND_PROC_CHANCE } from 'parser/hunter/beastmastery/constants';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport Haste from 'interface/icons/Haste';\r\nimport { formatPercentage } from 'common/format';\r\nimport { DIRE_BEAST_HASTE_PERCENT } from 'parser/hunter/shared/constants';\r\nimport { encodeTargetString } from 'parser/shared/modules/EnemyInstances';\r\n\r\n/**\r\n * TODO Find a log with both Dire Command and Dire Beast talent and account for them using the same spell for buff\r\n * Kill Command has a 20% chance to also summon a Dire Beast to attack your target.\r\n *\r\n * Example log:\r\n *\r\n */\r\nclass DireCommand extends Analyzer {\r\n\r\n  damage: number = 0;\r\n  activeDireBeasts: string[] = [];\r\n  targetId: string = '';\r\n  direCommandProcs: number = 0;\r\n  killCommandHits: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasLegendaryByBonusID(SPELLS.DIRE_COMMAND_EFFECT.bonusID);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    this.addEventListener(Events.summon.by(SELECTED_PLAYER).spell(SPELLS.DIRE_BEAST_SUMMON), this.direBeastSummon);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET).spell(SPELLS.KILL_COMMAND_DAMAGE_BM), this.killCommandDamage);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET), this.onPetDamage);\r\n  }\r\n\r\n  get uptime() {\r\n    return this.selectedCombatant.getBuffUptime(SPELLS.DIRE_BEAST_BUFF.id) / this.owner.fightDuration;\r\n  }\r\n\r\n  direBeastSummon(event: SummonEvent) {\r\n    this.direCommandProcs += 1;\r\n    this.targetId = encodeTargetString(event.targetID);\r\n    this.activeDireBeasts = [];\r\n    this.activeDireBeasts.push(this.targetId);\r\n    this.targetId = '';\r\n  }\r\n\r\n  onPetDamage(event: DamageEvent) {\r\n    const sourceId: string = encodeTargetString(event.sourceID);\r\n    if (this.activeDireBeasts.includes(sourceId)) {\r\n      this.damage += event.amount + (event.absorbed || 0);\r\n    }\r\n  }\r\n\r\n  killCommandDamage(event: DamageEvent) {\r\n    this.killCommandHits += 1;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.ITEMS}\r\n        tooltip={<>You had {formatPercentage(this.uptime)}% uptime on the Dire Beast Haste buff.</>}\r\n        dropdown={(\r\n          <>\r\n            <div style={{ padding: '8px' }}>\r\n              {plotOneVariableBinomChart(this.direCommandProcs, this.killCommandHits, DIRE_COMMAND_PROC_CHANCE)}\r\n              <p>Likelihood of getting <em>exactly</em> as many procs as estimated on a fight given your number of <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> casts.</p>\r\n            </div>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.DIRE_COMMAND_EFFECT}>\r\n          <ItemDamageDone amount={this.damage} />\r\n          <br />\r\n          <Haste /> {formatPercentage(DIRE_BEAST_HASTE_PERCENT * this.uptime)}% Haste<br />\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DireCommand;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport React from 'react';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events from 'parser/core/Events';\r\nimport { plotOneVariableBinomChart } from 'parser/shared/modules/helpers/Probability';\r\nimport { FLAMEWAKERS_PROC_CHANCE, KILL_COMMAND_BM_FOCUS_COST } from 'parser/hunter/beastmastery/constants';\r\nimport SpellLink from 'common/SpellLink';\r\n\r\n/**\r\n * Cobra Shot has a 25% chance to make your next Kill Command consume no Focus.\r\n *\r\n * Example log:\r\n *\r\n */\r\nclass FlamewakersCobraSting extends Analyzer {\r\n\r\n  cobraCasts: number = 0;\r\n  procs: number = 0;\r\n  utilizedFlamewakerBuffs: number = 0;\r\n  wastedFlamewakerBuffs: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasLegendaryByBonusID(SPELLS.FLAMEWAKERS_COBRA_STING_EFFECT.bonusID);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.COBRA_SHOT), this.onCobra);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.KILL_COMMAND_CAST_BM), this.onKillCommand);\r\n    this.addEventListener(Events.refreshbuff.by(SELECTED_PLAYER).spell(SPELLS.FLAMEWAKERS_COBRA_STING_BUFF), this.refreshFlamewaker);\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.FLAMEWAKERS_COBRA_STING_BUFF), this.applyFlamewaker);\r\n  }\r\n\r\n  onCobra() {\r\n    this.cobraCasts += 1;\r\n  }\r\n\r\n  onKillCommand() {\r\n    if (this.selectedCombatant.hasBuff(SPELLS.FLAMEWAKERS_COBRA_STING_BUFF.id)) {\r\n      this.utilizedFlamewakerBuffs += 1;\r\n    }\r\n  }\r\n\r\n  applyFlamewaker() {\r\n    this.procs += 1;\r\n  }\r\n\r\n  refreshFlamewaker() {\r\n    this.procs += 1;\r\n    this.wastedFlamewakerBuffs += 1;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.ITEMS}\r\n        dropdown={(\r\n          <>\r\n            <div style={{ padding: '8px' }}>\r\n              {plotOneVariableBinomChart(this.procs, this.cobraCasts, FLAMEWAKERS_PROC_CHANCE)}\r\n              <p>Likelihood of getting <em>exactly</em> as many procs as estimated on a fight given your number of <SpellLink id={SPELLS.KILL_COMMAND_CAST_BM.id} /> casts.</p>\r\n            </div>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.FLAMEWAKERS_COBRA_STING_EFFECT}>\r\n          {this.utilizedFlamewakerBuffs}/{this.wastedFlamewakerBuffs + this.utilizedFlamewakerBuffs} <small> Procs utilized </small>\r\n          <br />\r\n          {this.utilizedFlamewakerBuffs * KILL_COMMAND_BM_FOCUS_COST} <small> Focus saved</small>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default FlamewakersCobraSting;\r\n","import Analyzer, { Options, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport React from 'react';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport HIT_TYPES from 'game/HIT_TYPES';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport { RYLAKSTALKERS_PIERCING_FANGS_CRIT_DMG_INCREASE } from 'parser/hunter/beastmastery/constants';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\n\r\n/**\r\n * While Bestial Wrath is active, your pet's critical damage dealt is increased by 20%.\r\n *\r\n * Example log:\r\n *\r\n */\r\nclass RylakstalkersPiercingFangs extends Analyzer {\r\n\r\n  damage: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasLegendaryByBonusID(SPELLS.RYLAKSTALKERS_PIERCING_FANGS_EFFECT.bonusID);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET), this.onPetDamage);\r\n  }\r\n\r\n  onPetDamage(event: DamageEvent) {\r\n    if (!this.selectedCombatant.hasBuff(SPELLS.BESTIAL_WRATH.id)) {\r\n      return;\r\n    }\r\n    if (event.hitType !== HIT_TYPES.CRIT) {\r\n      return;\r\n    }\r\n    this.damage += calculateEffectiveDamage(event, RYLAKSTALKERS_PIERCING_FANGS_CRIT_DMG_INCREASE);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.ITEMS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.RYLAKSTALKERS_PIERCING_FANGS_EFFECT}>\r\n          <ItemDamageDone amount={this.damage} />\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default RylakstalkersPiercingFangs;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport React from 'react';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { EnergizeEvent } from 'parser/core/Events';\r\nimport ResourceIcon from 'common/ResourceIcon';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport { formatNumber } from 'common/format';\r\nimport AspectOfTheWild from 'parser/hunter/beastmastery/modules/spells/AspectOfTheWild';\r\nimport BarbedShot from 'parser/hunter/beastmastery/modules/spells/BarbedShot';\r\n\r\n/**\r\n * Whenever a trap is triggered, gain 45 Focus and increase all Focus gained by 100% for 5 sec.\r\n *\r\n * Example log:\r\n *\r\n */\r\nclass NesingwarysTrappingApparatus extends Analyzer {\r\n\r\n  static dependencies = {\r\n    aspectOfTheWild: AspectOfTheWild,\r\n    barbedShot: BarbedShot,\r\n  };\r\n\r\n  focusGained: number = 0;\r\n  focusWasted: number = 0;\r\n\r\n  protected aspectOfTheWild!: AspectOfTheWild;\r\n  protected barbedShot!: BarbedShot;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasLegendaryByBonusID(SPELLS.NESINGWARYS_TRAPPING_APPARATUS_EFFECT.bonusID);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    this.addEventListener(Events.energize.by(SELECTED_PLAYER).spell(SPELLS.NESINGWARYS_TRAPPING_APPARATUS_ENERGIZE), this.onEnergize);\r\n  }\r\n\r\n  onEnergize(event: EnergizeEvent) {\r\n    this.focusGained += event.resourceChange;\r\n    this.focusWasted += event.waste;\r\n  }\r\n\r\n  get effectiveFocus() {\r\n    return formatNumber(this.aspectOfTheWild.additionalFocusFromNesingwary + this.barbedShot.additionalFocusFromNesingwary);\r\n  }\r\n\r\n  get possibleFocus() {\r\n    return formatNumber(this.aspectOfTheWild.possibleAdditionalFocusFromNesingwary + this.barbedShot.possibleAdditionalFocusFromNesingwary);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.ITEMS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.NESINGWARYS_TRAPPING_APPARATUS_EFFECT}>\r\n          <ResourceIcon id={RESOURCE_TYPES.FOCUS.id} noLink /> {this.focusGained}/{this.focusWasted + this.focusGained} <small>gained Focus immediately</small>\r\n          <br />\r\n          <ResourceIcon id={RESOURCE_TYPES.FOCUS.id} noLink /> {this.effectiveFocus}/{this.possibleFocus} <small>gained Focus from generators</small>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default NesingwarysTrappingApparatus;\r\n","import CoreCombatLogParser from 'parser/core/CombatLogParser';\r\n\r\n//Overridden Core modules\r\nimport SpellUsable from './modules/core/SpellUsable';\r\nimport GlobalCooldown from './modules/core/GlobalCooldown';\r\n\r\n//Features\r\nimport Abilities from './modules/Abilities';\r\nimport Buffs from './modules/Buffs';\r\nimport CooldownThroughputTracker from './modules/features/CooldownThroughputTracker';\r\nimport AlwaysBeCasting from './modules/features/AlwaysBeCasting';\r\n\r\n//Checklist\r\nimport Checklist from './modules/checklist/Module';\r\n\r\n//Death Tracker\r\nimport DeathTracker from '../shared/modules/core/DeathTracker';\r\n\r\n//Talents\r\nimport KillerInstinct from './modules/talents/KillerInstinct';\r\nimport NaturalMending from '../shared/modules/talents/NaturalMending';\r\nimport Trailblazer from '../shared/modules/talents/Trailblazer';\r\nimport Barrage from '../shared/modules/talents/Barrage';\r\nimport ChimaeraShot from './modules/talents/ChimaeraShot';\r\nimport DireBeast from './modules/talents/DireBeast';\r\nimport KillerCobra from './modules/talents/KillerCobra';\r\nimport Stampede from './modules/talents/Stampede';\r\nimport Stomp from './modules/talents/Stomp';\r\nimport AMurderOfCrows from '../shared/modules/talents/AMurderOfCrows';\r\nimport ThrillOfTheHunt from './modules/talents/ThrillOfTheHunt';\r\nimport OneWithThePack from './modules/talents/OneWithThePack';\r\nimport AspectOfTheBeast from './modules/talents/AspectOfTheBeast';\r\nimport SpittingCobra from './modules/talents/SpittingCobra';\r\nimport ScentOfBlood from './modules/talents/ScentOfBlood';\r\nimport BornToBeWild from '../shared/modules/talents/BornToBeWild';\r\nimport BindingShot from '../shared/modules/talents/BindingShot';\r\nimport AnimalCompanion from './modules/talents/AnimalCompanion';\r\n\r\n//Pets\r\nimport BasicAttacks from './modules/pets/basicAttacksTracker';\r\n\r\n//Spells\r\nimport BeastCleave from './modules/spells/BeastCleave';\r\nimport CobraShot from './modules/spells/CobraShot';\r\nimport BarbedShot from './modules/spells/BarbedShot';\r\nimport AspectOfTheWild from './modules/spells/AspectOfTheWild';\r\nimport BestialWrath from './modules/spells/BestialWrath';\r\nimport KillShot from '../shared/modules/spells/KillShot';\r\n\r\n//Focus\r\nimport FocusTracker from '../shared/modules/resources/FocusTracker';\r\nimport FocusDetails from '../shared/modules/resources/FocusDetails';\r\nimport SpellFocusCost from '../shared/modules/resources/SpellFocusCost';\r\nimport BeastMasteryFocusCapTracker from './modules/resources/BeastMasteryFocusCapTracker';\r\nimport Focus from './modules/resources/Focus';\r\nimport BeastMasteryFocusUsage from './modules/resources/BeastMasteryFocusUsage';\r\n\r\n//Covenants\r\nimport ResonatingArrow from '../shared/modules/spells/covenants/kyrian/ResonatingArrow';\r\nimport DeathChakrams from '../shared/modules/spells/covenants/necrolord/DeathChakrams';\r\nimport WildSpirits from '../shared/modules/spells/covenants/nightfae/WildSpirits';\r\nimport FlayedShot from '../shared/modules/spells/covenants/venthyr/FlayedShot';\r\n\r\n//Conduits\r\nimport EnfeebledMark from '../shared/modules/spells/conduits/kyrian/EnfeebledMark';\r\nimport EmpoweredRelease from '../shared/modules/spells/conduits/venthyr/EmpoweredRelease';\r\nimport NecroticBarrage from '../shared/modules/spells/conduits/necrolord/NecroticBarrage';\r\nimport SpiritAttunement from '../shared/modules/spells/conduits/nightfae/SpiritAttunement';\r\nimport Bloodletting from './modules/spells/conduits/Bloodletting';\r\nimport EchoingCall from './modules/spells/conduits/EchoingCall';\r\nimport FerociousAppetite from './modules/spells/conduits/FerociousAppetite';\r\nimport OneWithTheBeast from './modules/spells/conduits/OneWithTheBeast';\r\n\r\n//Legendaries\r\nimport DireCommand from './modules/items/DireCommand';\r\nimport FlamewakersCobraSting from './modules/items/FlamewakersCobraSting';\r\nimport QaplaEredunWarOrder from './modules/items/QaplaEredunWarOrder';\r\nimport RylakstalkersPiercingFangs from './modules/items/RylakstalkersPiercingFangs';\r\nimport NesingwarysTrappingApparatus from './modules/items/NesingwarysTrappingApparatus';\r\nimport SoulforgeEmbers from '../shared/modules/items/SoulforgeEmbers';\r\n\r\nclass CombatLogParser extends CoreCombatLogParser {\r\n  static specModules = {\r\n    globalCooldown: GlobalCooldown,\r\n    spellUsable: SpellUsable,\r\n    checklist: Checklist,\r\n\r\n    //Features\r\n    alwaysBeCasting: AlwaysBeCasting,\r\n    abilities: Abilities,\r\n    buffs: Buffs,\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n\r\n    //Resources\r\n    focusTracker: FocusTracker,\r\n    focusDetails: FocusDetails,\r\n    spellFocusCost: SpellFocusCost,\r\n    beastMasteryFocusCapTracker: BeastMasteryFocusCapTracker,\r\n    focus: Focus,\r\n    beastMasteryFocusUsage: BeastMasteryFocusUsage,\r\n\r\n    //DeathTracker\r\n    deathTracker: DeathTracker,\r\n\r\n    //Pets\r\n    basicAttacks: BasicAttacks,\r\n\r\n    //Spells\r\n    bestialWrath: BestialWrath,\r\n    beastCleave: BeastCleave,\r\n    cobraShot: CobraShot,\r\n    barbedShot: BarbedShot,\r\n    aspectOfTheWild: AspectOfTheWild,\r\n    killShot: KillShot,\r\n\r\n    //Talents\r\n    killerInstinct: KillerInstinct,\r\n    chimaeraShot: ChimaeraShot,\r\n    direBeast: DireBeast,\r\n    naturalMending: NaturalMending,\r\n    trailblazer: Trailblazer,\r\n    barrage: Barrage,\r\n    killerCobra: KillerCobra,\r\n    stampede: Stampede,\r\n    stomp: Stomp,\r\n    aMurderOfCrows: AMurderOfCrows,\r\n    thrillOfTheHunt: ThrillOfTheHunt,\r\n    oneWithThePack: OneWithThePack,\r\n    aspectOfTheBeast: AspectOfTheBeast,\r\n    spittingCobra: SpittingCobra,\r\n    scentOfBlood: ScentOfBlood,\r\n    bornToBeWild: BornToBeWild,\r\n    bindingShot: BindingShot,\r\n    animalCompanion: AnimalCompanion,\r\n\r\n    //Covenants\r\n    resonatingArrow: ResonatingArrow,\r\n    deathChakrams: DeathChakrams,\r\n    wildSpirits: WildSpirits,\r\n    flayedShot: FlayedShot,\r\n\r\n    //Conduits\r\n    empoweredRelease: EmpoweredRelease,\r\n    enfeebledMark: EnfeebledMark,\r\n    necroticBarrage: NecroticBarrage,\r\n    spiritAttunement: SpiritAttunement,\r\n    bloodLetting: Bloodletting,\r\n    echoingCall: EchoingCall,\r\n    ferociousAppetite: FerociousAppetite,\r\n    oneWithTheBeast: OneWithTheBeast,\r\n\r\n    //Generic Legendaries\r\n    nesingwarysTrappingApparatus: NesingwarysTrappingApparatus,\r\n    soulforgeEmbers: SoulforgeEmbers,\r\n\r\n    //Beast Mastery Legendaries\r\n    direCommand: DireCommand,\r\n    flamewakersCobraSting: FlamewakersCobraSting,\r\n    qaplaEredunWarOrder: QaplaEredunWarOrder,\r\n    rylakstalkersPiercingFangs: RylakstalkersPiercingFangs,\r\n  };\r\n}\r\n\r\nexport default CombatLogParser;\r\n","export default function calculateEffectiveDamage(event, increase) {\r\n  const raw = (event.amount || 0) + (event.absorbed || 0);\r\n  return raw - (raw / (1 + increase));\r\n}\r\n","import React from 'react';\r\n\r\n// https://thenounproject.com/term/duration/370713/\r\n// duration by Bohdan Burmich from the Noun Project\r\nconst Icon = ({ ...other }) => (\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"10 10 80 80\" className=\"icon\" {...other}>\r\n    <path d=\"M50,86.4865c17.4361,0,31.6216-14.1855,31.6216-31.6216c0-16.6168-12.8865-30.2714-29.1892-31.5189v-4.9677h7.2973v-4.8649  H40.2703v4.8649h7.2973v4.9677c-16.3027,1.2475-29.1892,14.902-29.1892,31.5189C18.3784,72.3009,32.5639,86.4865,50,86.4865z M52.4324,28.2236c3.1101,0.2817,6.0664,1.0982,8.7798,2.356l-8.7798,15.2073V28.2236z M47.5676,28.2236v26.6412 c0,1.1008,0.7393,2.0647,1.8029,2.3497c0.209,0.0561,0.4205,0.0827,0.6295,0.0827c0.8533,0,1.6642-0.4504,2.1065-1.2162 l13.3146-23.0616c6.8507,4.8503,11.3357,12.8315,11.3357,21.8454c0,14.7537-12.0031,26.7567-26.7568,26.7567 s-26.7568-12.003-26.7568-26.7567C23.2432,40.9315,33.9501,29.4573,47.5676,28.2236z\" />\r\n  </svg>\r\n);\r\n\r\nexport default Icon;\r\n","/**\r\n * Velen's is a static 15% healing increase to the raw healing going out. If that increase turns out to be overhealing it is worthless, so my approach of reducing the healing gain by the overhealing really only gives you the gain in healing that actually did something. An implementation that ignores overhealing and acts like Velen's contributed 15% of the effective healing will be inaccurate if there was any overhealing.\r\n *\r\n * I'll try to explain this PoV with an example:\r\n * Normal spell heals for 1,000 raw\r\n * With Velen's this is 1,150 raw. So Velen's increased the heal by 150 raw healing, that healing is on top of the original 1,000 raw healing the spell normally does.\r\n * Then comes overhealing;\r\n * If the spell overheals for 50, then the spell will have healed for 1,100. At this point Velen's effectively contributes 100 healing.\r\n * If the spell overheals for 100, then the spell will have healed for 1,050. So velen's effectiveness is 50;\r\n * If the spell overheals for 150, then the spell will have healed for the original 1,000 and Velen's increase was completely wasted.\r\n * If the spell overheals for 200, then 50 healing of the original spell was already overhealing, and the increased healing from Velen's did nothing (0).\r\n *\r\n * If you ignore raw healing and look at the actual healing done you may see the last 950 healing and think 15% of that was contributed by Velen's, while in fact it was 0.\r\n */\r\n\r\nexport default function calculateEffectiveHealing(event, relativeHealIncrease) {\r\n  const amount = event.amount;\r\n  const absorbed = event.absorbed || 0;\r\n  const overheal = event.overheal || 0;\r\n  const raw = amount + absorbed + overheal;\r\n  const relativeHealingIncreaseFactor = 1 + relativeHealIncrease;\r\n  const healingIncrease = raw - raw / relativeHealingIncreaseFactor;\r\n  const effectiveHealing = healingIncrease - overheal;\r\n\r\n  return Math.max(0, effectiveHealing);\r\n}\r\n","import React from 'react';\r\n\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Spell from 'common/SPELLS/Spell';\r\n\r\ntype Props = {\r\n  spell: Spell;\r\n  rank: number;\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}\r\n\r\nconst ConduitSpellText = ({ spell, rank, children, className }: Props) => (\r\n  <div className={`pad boring-text ${className || ''}`}>\r\n    <label>\r\n      <SpellIcon id={spell.id} /> <SpellLink id={spell.id} icon={false} /> - Rank {rank}\r\n    </label>\r\n    <div className=\"value\">\r\n      {children}\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport default ConduitSpellText;\r\n","import SPELLS from 'common/SPELLS';\r\n\r\n//region Spells\r\n/** Butchery / Carve */\r\n//Butchery and Carve can hit up to 5 people\r\nexport const BUTCHERY_CARVE_MAX_TARGETS_HIT = 5;\r\n/** Coordinated Assault */\r\n//Coordinated Assault increases all damage done by 20%\r\nexport const COORDINATED_ASSAULT_DMG_MOD = 0.2;\r\n//Coordinated Assault lasts 20 seconds by default\r\nexport const COORDINATED_ASSAULT_BASELINE_DURATION = 20000;\r\n/** Wildfire Bomb */\r\n//People aren't robots, give them a bit of leeway in terms of when they cast WFB to avoid capping on charges\r\nexport const WILDFIRE_BOMB_LEEWAY_BUFFER = 500;\r\n/** Kill Command */\r\n//Kill Command for Survival regenerates 15 focus\r\nexport const SV_KILL_COMMAND_FOCUS_GAIN = 15;\r\n/** Serpent Sting */\r\n//Serpent Sting costs 20 focus\r\nexport const SV_SERPENT_STING_COST = 20;\r\n//Serpent Sting for SV pandemics at 30%\r\nexport const SERPENT_STING_SV_PANDEMIC = 0.3;\r\n//The baseduration of Serpent Sting before any haste reduction\r\nexport const SERPENT_STING_SV_BASE_DURATION = 12000;\r\n/** Raptor Strike / Mongoose Bite */\r\n//Raptor Strike turns into Mongoose Bite when talented into it, and during Aspect of the Eagle they change spellIDs.\r\nexport const RAPTOR_MONGOOSE_VARIANTS = [\r\n  SPELLS.RAPTOR_STRIKE,\r\n  SPELLS.RAPTOR_STRIKE_AOTE,\r\n  SPELLS.MONGOOSE_BITE_TALENT,\r\n  SPELLS.MONGOOSE_BITE_TALENT_AOTE,\r\n];\r\n/** Aspect of the Eagle */\r\n//This is the baseline cooldown of Aspect of the Eagle\r\nexport const BASELINE_AOTE_CD = 90000;\r\n//endregion\r\n\r\n//region Talents\r\n/** Vipers Venom */\r\n//Serpent Sting costs 0 when Vipers Venom is active\r\nexport const VIPERS_VENOM_COST_MULTIPLIER = 0;\r\n//The increased damage of the initial hit of Serpent Sting from Viper's Venom\r\nexport const VIPERS_VENOM_DAMAGE_MODIFIER = 2.5;\r\n/** Bird of Prey */\r\n//Bird of Prey extends Coordinated Assault by 1.5 seconds per trigger\r\nexport const BOP_CA_EXTENSION_PER_CAST = 1500;\r\n/** Chakrams */\r\n//Chakrams has a bunch of different spellIDs for damage\r\nexport const SURVIVAL_CHAKRAM_TYPES = [\r\n  SPELLS.CHAKRAMS_TO_MAINTARGET.id,\r\n  SPELLS.CHAKRAMS_BACK_FROM_MAINTARGET.id,\r\n  SPELLS.CHAKRAMS_NOT_MAINTARGET.id,\r\n];\r\n/** Flanking Strike */\r\n//Flanking Strikes regenerates 30 focus\r\nexport const FLANKING_STRIKE_FOCUS_GAIN = 30;\r\n/** Mongoose Bite */\r\n//Mongoose Bite has traveltime, so if used during Aspect of the Eagle it can have up to 700ms travel time\r\nexport const MONGOOSE_BITE_MAX_TRAVEL_TIME = 700;\r\n//Mongoose Bite can have a maximum of 5 stacks\r\nexport const MONGOOSE_BITE_MAX_STACKS = 5;\r\n/** Guerilla Tactics */\r\n//The initial hit modifier for Guerrilla Tactics talent\r\nexport const GUERRILLA_TACTICS_INIT_HIT_MODIFIER = 1;\r\n//Spells affected by Guerrilla Tactics talent\r\nexport const AFFECTED_BY_GUERRILLA_TACTICS = [\r\n  SPELLS.WILDFIRE_BOMB_IMPACT,\r\n  SPELLS.VOLATILE_BOMB_WFI_IMPACT,\r\n  SPELLS.PHEROMONE_BOMB_WFI_IMPACT,\r\n  SPELLS.SHRAPNEL_BOMB_WFI_IMPACT,\r\n];\r\n/** Tip of the Spear */\r\n//Tip of the Spear damage increase\r\nexport const TIP_DAMAGE_INCREASE = 0.25;\r\n//Tip maximum stacks\r\nexport const TIP_MAX_STACKS = 3;\r\n/** Alpha Predator */\r\n//The damage increase from Alpha Predator\r\nexport const ALPHA_DAMAGE_KC_MODIFIER = 0.3;\r\n/** Bloodseeker */\r\n//Attack speed gain per bleeding enemy from Bloodseeker\r\nexport const BLOODSEEKER_ATTACK_SPEED_GAIN = 0.1;\r\n/** Hydra's Bite */\r\n//Hydra's Bite DOT damage increase\r\nexport const HYDRAS_BITE_DOT_MODIFIER = 0.2;\r\n//endregion\r\n\r\n//region Resources\r\nexport const LIST_OF_FOCUS_SPENDERS_SV = [\r\n  SPELLS.BUTCHERY_TALENT,\r\n  SPELLS.CARVE,\r\n  SPELLS.WING_CLIP,\r\n  SPELLS.CHAKRAMS_TALENT,\r\n  SPELLS.SERPENT_STING_SV,\r\n  ...RAPTOR_MONGOOSE_VARIANTS,\r\n];\r\nexport const BASE_FOCUS_REGEN_SV = 5;\r\nexport const BASE_MAX_FOCUS_SV = 100;\r\n//endregion\r\n\r\n//region Conduits\r\n/** Deadly Tandem */\r\n//Deadly Tandem increases the duration of Coordinated Assault by a flat amount\r\nexport const DEADLY_TANDEM_CA_DURATION_INCREASE = [0, 1000, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000, 5500, 6000, 6500, 7000, 7500, 8000];\r\n/** Flame Infusion */\r\n//Flame infusion increases the damage of the next Wildfire Bomb (or WFI equivalent) by x%\r\nexport const FLAME_INFUSION_WFB_DAMAGE_INCREASE = [0, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25];\r\n//Flame Infusion can stack twice\r\nexport const FLAME_INFUSION_MAX_STACKS = 2;\r\n/** Stinging Strike */\r\n//Stinging Strike increases the damage of Mongoose Bite / Raptor Strike by a flat amount\r\nexport const STINGING_STRIKE_RS_MB_DMG_INCREASE = [0, 0.14, 0.16, 0.17, 0.19, 0.20, 0.22, 0.23, 0.25, 0.26, 0.28, 0.29, 0.31, 0.32, 0.34, 0.35];\r\n/** Strength of the Pack */\r\n//Strength of the Pack increases all damage done by a % for its duration\r\nexport const STRENGTH_OF_THE_PACK_DAMAGE_MODIFIER = [0, 0.03, 0.04, 0.04, 0.05, 0.05, 0.06, 0.06, 0.07, 0.07, 0.08, 0.08, 0.09, 0.09, 0.1, 0.1];\r\n//endregion\r\n","import SPELLS from 'common/SPELLS';\r\n\r\n//region Spells\r\n/** Barbed Shot */\r\n//max stacks your pet can have of the Frenzy buff\r\nexport const MAX_FRENZY_STACKS = 3;\r\n//Frenzy lasts 8 seconds normally, but can be adjusted by some effects\r\nexport const ORIGINAL_FRENZY_DURATION = 8000;\r\n/** Cobra Shot */\r\n//Cobra Shot reduces the cooldown of Kill Command by 1 second by default\r\nexport const COBRA_SHOT_CDR_MS = 1000;\r\n//A threshold where you can never realistically overcap on focus by waiting for AT MOST 1 GCD + 1 second.\r\nexport const COBRA_SHOT_FOCUS_THRESHOLD_TO_WAIT = 50;\r\n/** Kill Command */\r\n//Kill Command costs 30 focus for Beast Mastery hunters\r\nexport const KILL_COMMAND_BM_FOCUS_COST = 30;\r\n/** Bestial Wrath */\r\n//Bestial Wrath\r\nexport const BARBED_SHOT_BESTIAL_WRATH_CDR_MS = 12000;\r\nexport const BESTIAL_WRATH_BASE_CD = 90000;\r\n/** Aspect of the Wild */\r\n//Aspect of the Wild reduces the GCD of certain abilities\r\nexport const AOTW_GCD_REDUCTION_AFFECTED_ABILITIES = [\r\n  SPELLS.KILL_COMMAND_CAST_BM.id,\r\n  SPELLS.COBRA_SHOT.id,\r\n  SPELLS.BESTIAL_WRATH.id,\r\n  SPELLS.MULTISHOT_BM.id,\r\n  SPELLS.BARBED_SHOT.id,\r\n  SPELLS.ASPECT_OF_THE_WILD.id,\r\n  SPELLS.CALL_PET_1.id,\r\n  SPELLS.CALL_PET_2.id,\r\n  SPELLS.CALL_PET_3.id,\r\n  SPELLS.CALL_PET_4.id,\r\n  SPELLS.CALL_PET_5.id,\r\n  SPELLS.INTIMIDATION.id,\r\n  SPELLS.FREEZING_TRAP.id,\r\n  SPELLS.TAR_TRAP.id,\r\n  SPELLS.HUNTERS_MARK.id,\r\n  SPELLS.ARCANE_SHOT.id,\r\n  SPELLS.EXHILARATION.id,\r\n  SPELLS.FLARE.id,\r\n  SPELLS.BLOODSHED_TALENT.id,\r\n  SPELLS.DIRE_BEAST_TALENT.id,\r\n  SPELLS.SPITTING_COBRA_TALENT.id,\r\n  SPELLS.BARRAGE_TALENT.id,\r\n  SPELLS.STAMPEDE_TALENT.id,\r\n  SPELLS.CHIMAERA_SHOT_BM_TALENT.id,\r\n  SPELLS.A_MURDER_OF_CROWS_TALENT.id,\r\n  SPELLS.WILD_SPIRITS.id,\r\n  SPELLS.FLAYED_SHOT.id,\r\n  SPELLS.RESONATING_ARROW.id,\r\n  SPELLS.DEATH_CHAKRAM_INITIAL_AND_AOE.id,\r\n];\r\n//Aspect of the Wild gives 5 focus per second\r\nexport const ASPECT_OF_THE_WILD_FOCUS = 5;\r\n//endregion\r\n\r\n//region Talents\r\n/** Bloodshed */\r\n//Bloodshed increases the damage done by pets by 15%\r\nexport const BLOODSHED_DAMAGE_AMP = 0.15;\r\n/** Scent of Blood */\r\n//Scent of Blood recharges 2 barbed shot charges when you activate Bestial Wrath\r\nexport const SCENT_OF_BLOOD_BARBED_SHOT_RECHARGE = 2;\r\n/** Aspect of the Beast */\r\n//Aspect of the Beast increase pet damage and healing done by 30%\r\nexport const AOTB_MULTIPLIER = 0.3;\r\n//Aspect of the Beast does not affect all pet abilities\r\nexport const AOTB_ABILITIES_NOT_AFFECTED: number[] = [\r\n  SPELLS.MELEE.id,\r\n  SPELLS.KILL_COMMAND_DAMAGE_BM.id,\r\n  SPELLS.STOMP_DAMAGE.id,\r\n];\r\n/** Killer Instinct */\r\n//Killer Instinct is a execution like talent that activates at target hp sub 35%\r\nexport const KILLER_INSTINCT_THRESHOLD = 0.35;\r\n//When Killer Instinct is active Kill Command does 50% more damage\r\nexport const KILLER_INSTINCT_MULTIPLIER = 0.5;\r\n/** Wild Call */\r\n//Wild Call has a 20% chance to reset Barbed Shot cooldown on critical auto attacks\r\nexport const WILD_CALL_RESET_PERCENT = 0.2;\r\n/** Spitting Cobra */\r\n//Spitting Cobra has its damage increased by 10% for every Cobra Shot during Bestial Wrath\r\nexport const SPITTING_COBRA_DAMAGE_INCREASE = 0.1;\r\n/** Stampede */\r\n// The potential amount of hits per target per stampede cast.\r\n// By checking through various Zek'voz logs, it seems to consistently hit the boss 18 times, except if the boss was moved.\r\n// By using this number, we can calculate the average amount of targets hit per cast.\r\nexport const STAMPEDE_POTENTIAL_HITS = 18;\r\n/** Stomp */\r\n//If you have Animal Companion, Stomp will hit twice per cast - so we need to be aware of that\r\nexport const AMOUNT_OF_PETS_WITH_AC = 2;\r\n/** Thrill of the Hunt */\r\n//Thrill of the Hunt can stack up to 3 times\r\nexport const MAX_THRILL_STACKS = 3;\r\n//Each stack of Thrill of the Hunt gives 3% crit\r\nexport const CRIT_PER_THRILL_STACK = 0.03;\r\n//endregion\r\n\r\n//region Pets\r\n/** Pet Basic Attacks */\r\n//There are three different Basic Attacks for Pets\r\nexport const BASIC_ATTACK_SPELLS = [SPELLS.BITE_BASIC_ATTACK, SPELLS.CLAW_BASIC_ATTACK, SPELLS.SMACK_BASIC_ATTACK];\r\n//The actual current delay without macros is ~300ms on top of the 3 second cooldown, but adding 100 ms to act as a buffer.\r\nexport const MAX_TIME_BETWEEN_BASIC_ATK = 3400;\r\n//The delay is reduced to ~100-200ms depending on latency when you macro the abilities\r\nexport const MACRO_TIME_BETWEEN_BASIC_ATK = 3150;\r\n//This is what the optimal scenario would look like, if pet cast it instantly after it came off cooldown\r\nexport const NO_DELAY_TIME_BETWEEN_BASIC_ATK = 3000;\r\n//endregion\r\n\r\n//region Resources\r\n/** Focus */\r\n//Beast Mastery has 10 focus/second as baseline regen\r\nexport const BEAST_MASTERY_FOCUS_REGEN = 10;\r\n//Beast Mastery has 120 focus at start\r\nexport const BEAST_MASTERY_FOCUS_MAX = 120;\r\n//Minor threshold for focus wastage on focus generators\r\nexport const FOCUS_THRESHOLD_MINOR = 0.025;\r\n//Average threshold for focus wastage on focus generators\r\nexport const FOCUS_THRESHOLD_AVG = 0.05;\r\n//Major threshold for focus wastage on focus generators\r\nexport const FOCUS_THRESHOLD_MAJOR = 0.1;\r\n//The 8 focus regen buffs connected to Barbed Shot\r\nexport const BARBED_SHOT_FOCUS_REGEN_BUFFS = [\r\n  SPELLS.BARBED_SHOT_BUFF,\r\n  SPELLS.BARBED_SHOT_BUFF_2,\r\n  SPELLS.BARBED_SHOT_BUFF_3,\r\n  SPELLS.BARBED_SHOT_BUFF_4,\r\n  SPELLS.BARBED_SHOT_BUFF_5,\r\n  SPELLS.BARBED_SHOT_BUFF_6,\r\n  SPELLS.BARBED_SHOT_BUFF_7,\r\n  SPELLS.BARBED_SHOT_BUFF_8,\r\n];\r\n\r\nexport const BARBED_SHOT_FOCUS_REGEN_BUFFS_IDS = [\r\n  SPELLS.BARBED_SHOT_BUFF.id,\r\n  SPELLS.BARBED_SHOT_BUFF_2.id,\r\n  SPELLS.BARBED_SHOT_BUFF_3.id,\r\n  SPELLS.BARBED_SHOT_BUFF_4.id,\r\n  SPELLS.BARBED_SHOT_BUFF_5.id,\r\n  SPELLS.BARBED_SHOT_BUFF_6.id,\r\n  SPELLS.BARBED_SHOT_BUFF_7.id,\r\n  SPELLS.BARBED_SHOT_BUFF_8.id,\r\n];\r\n//Some energize spells don't have waste attached to their events\r\nexport const BEAST_MASTERY_SPELLS_WITHOUT_WASTE = [\r\n  SPELLS.ASPECT_OF_THE_WILD.id,\r\n  SPELLS.CHIMAERA_SHOT_FOCUS.id,\r\n  ...BARBED_SHOT_FOCUS_REGEN_BUFFS_IDS,\r\n];\r\n//Barbed Shot regenerates 5 focus per tick\r\nexport const BARBED_SHOT_REGEN = 5;\r\n//Aspect of the Wild regenerates 5 focus per tick\r\nexport const AOTW_REGEN = 5;\r\n//Chimaera Shot regenerates 10 focus per hit for BM hunters\r\nexport const CHIM_REGEN = 10;\r\n/** Focus Spenders specific to BM */\r\nexport const LIST_OF_FOCUS_SPENDERS_BM = [\r\n  SPELLS.COBRA_SHOT,\r\n  SPELLS.MULTISHOT_BM,\r\n  SPELLS.KILL_COMMAND_CAST_BM,\r\n  SPELLS.DIRE_BEAST_TALENT,\r\n];\r\n//endregion\r\n\r\n//region Conduits\r\n/** Ferocious Appetite */\r\n//Ferocious Appetite causes Kill Command crits to reduce the cooldown of Aspect of the Wild with X seconds.\r\nexport const FEROCIOUS_APPETITE_ASPECT_REDUCTION = [0, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400];\r\n/** One With the Beast */\r\n//One With the Beast increases all damage done during Bestial Wrath\r\nexport const ONE_WITH_THE_BEAST_DAMAGE_INCREASE = [0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15];\r\n/** Bloodletting */\r\n//Bloodletting reduces the recharge time of Barbed Shot by 1 second\r\nexport const BLOODLETTING_BARBED_SHOT_RECHARGE_REDUCTION = 1000;\r\n//Bloodletting increases the damage done by x%\r\nexport const BLOODLETTING_BARBED_DOT_INCREASE = [0, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25];\r\n/** Echoing Call */\r\n//Wild Call has a % increase chance to reset the cooldown of Barbed Shot\r\nexport const ECHOING_CALL_INCREASED_WILD_CALL_CHANCE = [0, 0.05, 0.06, 0.06, 0.07, 0.07, 0.08, 0.08, 0.09, 0.09, 0.1, 0.1, 0.11, 0.11, 0.12, 0.12];\r\n//endregion\r\n\r\n//region Legendaries\r\n/** Dire Command */\r\n//Dire Command has a 20% chance to summon a dire beast\r\nexport const DIRE_COMMAND_PROC_CHANCE = 0.2;\r\n/** Flamewaker's Cobra Sting */\r\n//Flamewaker's Cobra Sting has a 25% chance to reduce focus cost of next Kill Command by 100%\r\nexport const FLAMEWAKERS_PROC_CHANCE = 0.25;\r\n/** Qa'pla, Eredun War Order */\r\n//Qa'pla reduces the cooldown of Kill Command by 5 seconds everytime you cast Barbed Shot\r\nexport const QAPLA_KILL_COMMAND_REDUCTION_MS = 5000;\r\n/** Rylakstalker's Piercing Fangs */\r\n//Rylakstalker's Piercing Fang increases pet crit damage by 20% during Bestial Wrath\r\nexport const RYLAKSTALKERS_PIERCING_FANGS_CRIT_DMG_INCREASE = 0.20;\r\n//endregion\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport BaseChart from 'interface/others/BaseChart';\r\n\r\nimport { formatPercentage } from 'common/format';\r\nimport SpellLink from 'common/SpellLink';\r\nimport { TooltipElement } from 'common/Tooltip';\r\n\r\nimport './style.scss';\r\n\r\nclass DonutChart extends React.PureComponent {\r\n  static propTypes = {\r\n    items: PropTypes.arrayOf(PropTypes.shape({\r\n      value: PropTypes.number.isRequired,\r\n      label: PropTypes.node.isRequired,\r\n      color: PropTypes.string.isRequired,\r\n      tooltip: PropTypes.node,\r\n      spellId: PropTypes.number,\r\n      valueTooltip: PropTypes.node,\r\n    })).isRequired,\r\n    // While you could change the chart size, I strongly recommend you do not for consistency and to avoid breaking whenever this component is modified. Do you really need to adjust the size?\r\n    chartSize: PropTypes.number,\r\n    innerRadiusFactor: PropTypes.number,\r\n  };\r\n  static defaultProps = {\r\n    chartSize: 90,\r\n    innerRadiusFactor: 0.28,\r\n  };\r\n\r\n  renderLegend(items) {\r\n    const total = items.reduce((sum, item) => sum + item.value, 0);\r\n\r\n    return (\r\n      <div className=\"legend\">\r\n        {items.map(({ color, label, tooltip, value, spellId, valueTooltip }, index) => {\r\n          label = tooltip ? (\r\n            <TooltipElement content={tooltip}>{label}</TooltipElement>\r\n          ) : label;\r\n          label = spellId ? (\r\n            <SpellLink id={spellId}>{label}</SpellLink>\r\n          ) : label;\r\n          return (\r\n            <div key={index} className=\"flex\">\r\n              <div className=\"flex-sub\">\r\n                <div className=\"circle\" style={{ background: color }} />\r\n              </div>\r\n              <div className=\"flex-main\">\r\n                {label}\r\n              </div>\r\n              <div className=\"flex-sub\">\r\n                <TooltipElement content={valueTooltip ? valueTooltip : value}>\r\n                  {formatPercentage(value / total, 0)}%\r\n                </TooltipElement>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n  renderChart(items, chartSize, innerRadiusFactor) {\r\n    const innerRadius = chartSize * innerRadiusFactor;\r\n\r\n    const data = {\r\n      items,\r\n    };\r\n    const spec = {\r\n      data: {\r\n        name: 'items',\r\n      },\r\n      mark: {\r\n        type: 'arc',\r\n        innerRadius,\r\n      },\r\n      encoding: {\r\n        theta: {\r\n          field: 'value',\r\n          type: 'quantitative',\r\n        },\r\n        color: {\r\n          field: 'label',\r\n          type: 'nominal',\r\n          legend: null,\r\n          scale: {\r\n            domain: items.map(({label}) => label),\r\n            range: items.map(({color}) => color),\r\n          },\r\n        },\r\n      },\r\n      view: {\r\n        stroke: null,\r\n      },\r\n    };\r\n    return (\r\n      <div className=\"chart\">\r\n        <BaseChart\r\n          width={chartSize}\r\n          height={chartSize}\r\n          spec={spec}\r\n          data={data}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n  render() {\r\n    const { items, chartSize, innerRadiusFactor } = this.props;\r\n\r\n    return (\r\n      <div className=\"donut-chart\">\r\n        {this.renderLegend(items)}\r\n        {this.renderChart(items, chartSize, innerRadiusFactor)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DonutChart;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { AutoSizer } from 'react-virtualized';\r\nimport BaseChart from 'interface/others/BaseChart';\r\n\r\nclass OneVariableBinomialChart extends React.Component {\r\n  static propTypes = {\r\n    probabilities: PropTypes.arrayOf(\r\n      PropTypes.shape({\r\n        x: PropTypes.number.isRequired,\r\n        y: PropTypes.number.isRequired,\r\n      }),\r\n    ).isRequired,\r\n    actualEvent: PropTypes.shape({\r\n      x: PropTypes.number.isRequired,\r\n      y: PropTypes.number.isRequired,\r\n    }).isRequired,\r\n    xAxis: PropTypes.shape({\r\n      title: PropTypes.string.isRequired,\r\n      tickFormat: PropTypes.string.isRequired,\r\n    }).isRequired,\r\n    yAxis: PropTypes.shape({\r\n      title: PropTypes.string.isRequired,\r\n    }),\r\n    yDomain: PropTypes.arrayOf(PropTypes.number),\r\n    tooltip: PropTypes.string.isRequired,\r\n  };\r\n\r\n  state = {\r\n    hover: null,\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      probabilities,\r\n      actualEvent,\r\n      xAxis,\r\n      yAxis,\r\n      yDomain,\r\n      tooltip,\r\n    } = this.props;\r\n\r\n    const data = {\r\n      probabilities,\r\n      actual: actualEvent,\r\n    };\r\n\r\n    const spec = {\r\n      encoding: {\r\n        x: {\r\n          field: 'x',\r\n          type: 'quantitative',\r\n          title: xAxis.title,\r\n          axis: {\r\n            grid: false,\r\n            format: xAxis.tickFormat,\r\n          },\r\n        },\r\n        y: {\r\n          field: 'y',\r\n          type: 'quantitative',\r\n          title: yAxis.title,\r\n          axis: {\r\n            grid: false,\r\n            format: '.0%',\r\n          },\r\n          scale: {\r\n            domain: yDomain,\r\n          },\r\n        },\r\n      },\r\n      layer: [\r\n        {\r\n          data: {\r\n            name: 'probabilities',\r\n          },\r\n          mark: {\r\n            type: 'area',\r\n            color: 'rgba(250, 183, 0, 0.15)',\r\n            line: {\r\n              color: '#fab700',\r\n              strokeWidth: 1,\r\n            },\r\n          },\r\n        },\r\n        {\r\n          data: {\r\n            name: 'actual',\r\n          },\r\n          mark: {\r\n            type: 'point',\r\n            filled: true,\r\n            color: '#00ff96',\r\n            size: 60,\r\n          },\r\n          encoding: {\r\n            tooltip: [\r\n              { field: 'x', title: tooltip },\r\n            ],\r\n          },\r\n        },\r\n      ],\r\n    };\r\n\r\n\r\n    return (\r\n      <AutoSizer disableHeight>\r\n        {({width}) => (\r\n          <BaseChart\r\n            height={150}\r\n            width={width}\r\n            spec={spec}\r\n            data={data}\r\n          />\r\n        )}\r\n      </AutoSizer>\r\n    );\r\n  }\r\n}\r\n\r\nexport default OneVariableBinomialChart;\r\n","import OneVariableBinomialChart from 'interface/others/charts/OneVariableBinomialChart';\r\nimport React from 'react';\r\n\r\n/**\r\n * pn is the mean value of procs\r\n * @param procChance\r\n * @param procAttempts\r\n */\r\nexport function expectedProcCount(procChance: number, procAttempts: number) {\r\n  return procChance * procAttempts;\r\n}\r\n\r\n/**\r\n * Calculates the probability that out of n tries with probability p, we get exactly k positive outcomes\r\n * @param k {Number} Number of desired positive outcomes\r\n * @param n {Number} Number of tries\r\n * @param p {Number} Probability of positive outcome\r\n */\r\nexport function binomialPMF(k: number, n: number, p: number) {\r\n  return binomialDistribution(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);\r\n}\r\n\r\n/**\r\n * Calculates the probability that out of n tries with probability p, we get k or less positive outcomes\r\n * @param k {Number} Number of desired positive outcomes\r\n * @param n {Number} Number of tries\r\n * @param p {Number} Probability of positive outcome\r\n */\r\nexport function binomialCDF(k: number, n: number, p: number) {\r\n  let probability = 0;\r\n  for (let i = 0; i <= k; i += 1) {\r\n    probability += binomialPMF(i, n, p);\r\n  }\r\n  return probability;\r\n}\r\n\r\n/**\r\n * Finds the maximum of PMF of given distribution.\r\n * @param n {Number} Maximum number of tries for given event\r\n * @param {Function} pmf Callback that returns probability of exactly K events happening in N tries. Parameters - K, N\r\n * @returns {{ max: Number, p: Number }} Maximum of given PMF function - argument and probability itself\r\n */\r\nexport function findMax(n: number, pmf: (i: number, n: any) => any) {\r\n  let max = -1;\r\n  let maxP = 0;\r\n  for (let i = 0; i <= n; i += 1) {\r\n    const probability = pmf(i, n);\r\n    if (probability > maxP) {\r\n      max = i;\r\n      maxP = probability;\r\n    }\r\n  }\r\n  return {\r\n    max,\r\n    p: maxP,\r\n  };\r\n}\r\n\r\nfunction binomialDistribution(n: number, k: number) {\r\n  // n! / (k! * (n - k)!)\r\n  // factorials are awful, let's simplify a bit\r\n  // we know k < n:\r\n  // numerator: n! = 1 * 2 * ... * (n - k) * (n - k + 1) * (n - k + 2 ) * ... * n\r\n  // denominator: k! * (n - k)! = k! * 1 * 2 * ... * (n - k)\r\n  // cancelling out 1 * 2 * ... * (n - k) from both we get:\r\n  // (n - k + 1) * (n - k + 2) * ... n / k!\r\n  let numerator = 1;\r\n  let denominator = 1;\r\n  for (let i = n - k + 1; i <= n; i += 1) {\r\n    numerator *= i;\r\n  }\r\n  for (let i = 1; i <= k; i += 1) {\r\n    denominator *= i;\r\n  }\r\n  return numerator / denominator;\r\n}\r\n\r\nfunction resetProbabilityArray(actualProcs: number, procAttempts: number, procChance: number | number[]) {\r\n  const procProbabilities: Array<{ x: number; y: number; }> = Array.from({ length: procAttempts }, (_x, i: number) => {\r\n    if (typeof procChance === 'number') {\r\n      return { x: i, y: binomialPMF(i, procAttempts, procChance) };\r\n    } else {\r\n      return { x: i, y: poissonBinomialPMF(i, procAttempts, procChance) };\r\n    }\r\n  });\r\n\r\n  return procProbabilities;\r\n}\r\n\r\nfunction setMinMaxProbabilities(actualProcs: number, procAttempts: number, procChance: number | number[], threshold: number = 0.001) {\r\n  const procProbabilities = resetProbabilityArray(actualProcs, procAttempts, procChance);\r\n  const rangeMin = procProbabilities.findIndex(({ y }) => y >= threshold);\r\n  const rangeMax = rangeMin + procProbabilities.slice(rangeMin).findIndex(({ y }) => y < threshold);\r\n\r\n  return {\r\n    procProbabilities,\r\n    rangeMin,\r\n    rangeMax,\r\n  };\r\n}\r\n\r\n/**\r\n * Recursive formula for calculating the PMF (probability mass function) of Poisson's Binomial Distribution\r\n * @param k {Number} Number of desired positive outcomes\r\n * @param j {Number} Number of total tries\r\n * @param p {[Number]} Probability vector\r\n * @param lookup {Array} Lookup table\r\n * @returns {Number} Probability\r\n */\r\nfunction Ekj(k: number, j: number, p: number[], lookup: any[][]) {\r\n  if (k === -1) {\r\n    return 0;\r\n  }\r\n  if (k === j + 1) {\r\n    return 0;\r\n  }\r\n  if (k === 0 && j === 0) {\r\n    return 1;\r\n  }\r\n  if (lookup[k][j] !== null) {\r\n    return lookup[k][j];\r\n  }\r\n  // literature uses 1-based indices for probabilities, as we're using an array, we have to use 0 based\r\n  const value: number = (1 - p[j - 1]) * Ekj(k, j - 1, p, lookup) + p[j - 1] * Ekj(k - 1, j - 1, p, lookup);\r\n  lookup[k][j] = value;\r\n  return value;\r\n}\r\n\r\n// Poisson's Binomial Distribution\r\n// Methods based on Wikipedia page and this research paper:\r\n// https://www.researchgate.net/publication/257017356_On_computing_the_distribution_function_for_the_Poisson_binomial_distribution\r\n\r\n/**\r\n * Calculates the probability that out of n tries with p probabilities, we get exactly k positive outcomes\r\n * @param k {Number} Number of desired positive outcomes\r\n * @param n {Number} Number of total tries\r\n * @param p {[Number]} Probability vector\r\n */\r\nexport function poissonBinomialPMF(k: number, n: number, p: any[]) {\r\n  // denoted in the paper as k, I'll call it Ek for simplicity\r\n  // using the recursive formula in chapter 2.5\r\n  if (p.length !== n) {\r\n    throw new Error('You must supply a probability vector with the same length as the number of total tries into Poisson Binomial PMF');\r\n  }\r\n  // Using a lookup table to simplify recursion a little bit\r\n  // construct an (n+1) x (n+1) lookup table (because Ek,j uses indexes from 0 to n INCLUSIVE, with this we don't have to subtract indexes all the time)\r\n  // intentionally set tu nulls so we know which values are computed or not\r\n  const lookup = [...Array(n + 1)].map(_ => Array(n + 1).fill(null));\r\n  return Ekj(k, n, p, lookup);\r\n}\r\n\r\n/**\r\n * Calculates the probability that out of n tries with p probabilities, we get less than or equal k positive outcomes\r\n * @param k {Number} Number of desired positive outcomes\r\n * @param n {Number} Number of total tries\r\n * @param p {[Number]} Probability vector\r\n */\r\nexport function poissonBinomialCDF(k: number, n: number, p: number[]) {\r\n  // While technically equal to summing Ei from i = 0 to k, since we use recursion, a better solution is a lookup table\r\n  if (p.length !== n) {\r\n    throw new Error('You must supply a probability vector with the same length as the number of total tries into Poisson Binomial CDF');\r\n  }\r\n  // see comments in poissonBinomialPMF\r\n  const lookup = [...Array(n + 1)].map(_ => Array(n + 1).fill(null));\r\n  let probability = 0;\r\n  // since Ekj uses the values from \"previous row\" (Ekj(k - 1, j - 1, ...)), it's better to iterate from 0\r\n  // this way, it produces the least necessary amount of calculations with the lookup table (only the Ekj(k, j - 1) parts)\r\n  for (let i = 0; i <= k; i += 1) {\r\n    probability += Ekj(i, n, p, lookup);\r\n  }\r\n  return probability;\r\n}\r\n\r\nexport function plotOneVariableBinomChart(\r\n  actualProcs: number,\r\n  procAttempts: number,\r\n  procChance: number | number[],\r\n  trackedName: string = 'Procs',\r\n  tooltipText: string = trackedName,\r\n  yDomain: number[] = [0, 0.4],\r\n  xAxis: any = {\r\n    title: trackedName,\r\n    tickFormat: '~k',\r\n  },\r\n  yAxis: any = {\r\n    title: 'Likelihood',\r\n  },\r\n) {\r\n\r\n  const { procProbabilities, rangeMin, rangeMax } = setMinMaxProbabilities(actualProcs, procAttempts, procChance);\r\n  const actualEventY = typeof procChance === 'number' ? binomialPMF(actualProcs, procAttempts, procChance) : poissonBinomialPMF(actualProcs, procAttempts, procChance);\r\n  return (\r\n    <OneVariableBinomialChart\r\n      probabilities={procProbabilities.slice(rangeMin, rangeMax + 1)}\r\n      actualEvent={{ x: actualProcs, y: actualEventY }}\r\n      yDomain={yDomain}\r\n      xAxis={xAxis}\r\n      yAxis={yAxis}\r\n      tooltip={tooltipText}\r\n    />\r\n  );\r\n}\r\n","import Events, { ApplyBuffEvent, DamageEvent, FightEndEvent, RemoveBuffEvent } from 'parser/core/Events';\r\nimport Analyzer, { Options } from 'parser/core/Analyzer';\r\nimport { formatDuration } from 'common/format';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport Spell from 'common/SPELLS/Spell';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\n\r\nconst debug = false;\r\n\r\nconst MS_BUFFER = 500;\r\n\r\nclass ExecuteHelper extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n  };\r\n\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  //region IMPLEMENTME statics\r\n  /**\r\n   * Array of objects from common/SPELLS\r\n   * This should contain any execute spells such as Kill Shot, Execute etc.\r\n   */\r\n  static executeSpells: Spell[] = [];\r\n\r\n  /**\r\n   * SELECTED_PLAYER or SELECTED_PLAYER_PET for usage in the eventfilter\r\n   */\r\n  static executeSources: number;\r\n\r\n  /**\r\n   * Array of objects from common/SPELLS\r\n   * This should contain any SPELLS object that allows execute to be used outside normal execute range\r\n   */\r\n  static executeOutsideRangeEnablers: Spell[] = [];\r\n\r\n  /**\r\n   * The lower threshold where execute is enabled, shown in decimals.\r\n   */\r\n  static lowerThreshold: number;\r\n\r\n  /**\r\n   * The upper threshold where an execute can be enabled immediately at a pull, shown in decimals.\r\n   */\r\n  static upperThreshold: number;\r\n\r\n  /**\r\n   * A boolean representing if the given execute modifies the damage of an existing spell.\r\n   * An execute spell should be labelled as false, whereas a talent that modifies an existing spell should be labelled as true.\r\n   */\r\n  static modifiesDamage: boolean;\r\n\r\n  /**\r\n   * represents the modifier of of a talent (or some other effect) that modifies the damage done by an existing spell\r\n   */\r\n  static damageModifier: number;\r\n  //endregion\r\n\r\n  //region Generic Variables\r\n  /**\r\n   * Is true if we're in an execute window either because of a buff giving access to execute spells or because of health windows\r\n   */\r\n  inExecuteWindow: boolean = false;\r\n\r\n  /**\r\n   * Is true if we're in an execute window due to health on a target, so a buff granting access to execute is pointless at this point\r\n   */\r\n  inHealthExecuteWindow: boolean = false;\r\n\r\n  /**\r\n   * A variable marking the timestamp of the start of the current execute window\r\n   */\r\n  executeWindowStart: number = 0;\r\n\r\n  /**\r\n   * A variable marking the timestamp of the last damage event within the execute window\r\n   */\r\n  lastExecuteHitTimestamp: number = 0;\r\n\r\n  /**\r\n   * The amount of time spent inside executewindows, either caused by health or by buffs giving access to execute\r\n   */\r\n  totalExecuteWindowDuration: number = 0;\r\n\r\n  /**\r\n   * Amount of damage done by the spells defined in executeSpells\r\n   */\r\n  damage: number = 0;\r\n\r\n  /**\r\n   * returns the total amount of casts of the executes listed in executeSpells\r\n   */\r\n  casts: number = 0;\r\n\r\n  /**\r\n   * returns the amount of casts of the executes listed in executeSpells that were cast whilst being in an execute window\r\n   */\r\n  castsWithExecute: number = 0;\r\n  //endregion\r\n\r\n  //region Execute helpers\r\n  /**\r\n   * Returns true if the event has less HP than the threshold.\r\n   * This is useful for any generic execute.\r\n   * @param event\r\n   */\r\n  isTargetInExecuteRange(event: DamageEvent) {\r\n    if (!event.hitPoints || !event.maxHitPoints) {\r\n      return false;\r\n    }\r\n    return (event.hitPoints / event.maxHitPoints) < this.lowerThreshold;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the event has more HP than the threshold.\r\n   * This is useful for things like Firestarter and Flashpoint.\r\n   * @param event\r\n   */\r\n  isTargetInReverseExecuteRange(event: DamageEvent) {\r\n    if (!event.hitPoints || !event.maxHitPoints) {\r\n      return false;\r\n    }\r\n    return (event.hitPoints / event.maxHitPoints) > this.upperThreshold;\r\n  }\r\n\r\n  /**\r\n   * Returns true if either isTargetInExecuteRange() or isTargetInReverseExecuteRange() is true.\r\n   * @param event\r\n   */\r\n  isTargetInHealthExecuteWindow(event: DamageEvent) {\r\n    if (!event.hitPoints || !event.maxHitPoints) {\r\n      return false;\r\n    }\r\n    return (this.isTargetInExecuteRange(event) || this.isTargetInReverseExecuteRange(event));\r\n  }\r\n\r\n  /**\r\n   * Returns true if the combatant has one of the buffs that enable execute to be used outside of the regular execute windows\r\n   */\r\n  get isExecuteUsableOutsideExecuteRange() {\r\n    let usable: boolean = false;\r\n    this.executeOutsideRangeEnablers.forEach(spell => {\r\n      if (this.selectedCombatant.hasBuff(spell.id)) {\r\n        usable = true;\r\n      }\r\n    });\r\n    return usable;\r\n  }\r\n\r\n  /**\r\n   * If all execute spells are on cooldown, then we should count the entire period of cooldown as \"inside execute\" to properly calculate maxCasts\r\n   */\r\n  get areExecuteSpellsOnCD() {\r\n    let allOnCD: boolean = true;\r\n    this.executeSpells.forEach(spell => {\r\n      if (!this.spellUsable.isOnCooldown(spell.id)) {\r\n        allOnCD = false;\r\n      }\r\n    });\r\n    return allOnCD;\r\n  }\r\n\r\n  //endregion\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.addEventListener(Events.damage.by(this.executeSources), this.onGeneralDamage);\r\n    this.addEventListener(Events.cast.by(this.executeSources).spell(this.executeSpells), this.onExecuteCast);\r\n    this.addEventListener(Events.damage.by(this.executeSources).spell(this.executeSpells), this.onExecuteDamage);\r\n    this.addEventListener(Events.applybuff.to(this.executeSources).spell(this.executeOutsideRangeEnablers), this.applyExecuteEnablerBuff);\r\n    this.addEventListener(Events.removebuff.to(this.executeSources).spell(this.executeOutsideRangeEnablers), this.removeExecuteEnablerBuff);\r\n    this.addEventListener(Events.fightend, this.onFightEnd);\r\n  }\r\n\r\n  //region Static Getters\r\n  get executeSources() {\r\n    const ctor = this.constructor as typeof ExecuteHelper;\r\n    return ctor.executeSources;\r\n  }\r\n\r\n  get executeSpells() {\r\n    const ctor = this.constructor as typeof ExecuteHelper;\r\n    return ctor.executeSpells;\r\n  }\r\n\r\n  get executeOutsideRangeEnablers() {\r\n    const ctor = this.constructor as typeof ExecuteHelper;\r\n    return ctor.executeOutsideRangeEnablers;\r\n  }\r\n\r\n  get lowerThreshold() {\r\n    const ctor = this.constructor as typeof ExecuteHelper;\r\n    return ctor.lowerThreshold;\r\n  }\r\n\r\n  get upperThreshold() {\r\n    const ctor = this.constructor as typeof ExecuteHelper;\r\n    return ctor.upperThreshold;\r\n  }\r\n\r\n  get modifiesDamage() {\r\n    const ctor = this.constructor as typeof ExecuteHelper;\r\n    return ctor.modifiesDamage;\r\n  }\r\n\r\n  get damageModifier() {\r\n    const ctor = this.constructor as typeof ExecuteHelper;\r\n    return ctor.damageModifier;\r\n  }\r\n\r\n  //endregion\r\n\r\n  //region Generic Getters\r\n  get executeDamage() {\r\n    return this.damage;\r\n  }\r\n\r\n  get totalExecuteDuration() {\r\n    return this.totalExecuteWindowDuration;\r\n  }\r\n\r\n  get totalCasts() {\r\n    return this.casts;\r\n  }\r\n\r\n  get totalExecuteCasts() {\r\n    return this.castsWithExecute;\r\n  }\r\n\r\n  //endregion\r\n\r\n  //region Event Listener functions\r\n  onGeneralDamage(event: DamageEvent) {\r\n    if (event.targetIsFriendly) {\r\n      return;\r\n    }\r\n    if (this.areExecuteSpellsOnCD || this.isExecuteUsableOutsideExecuteRange || this.isTargetInHealthExecuteWindow(event)) {\r\n      this.lastExecuteHitTimestamp = event.timestamp;\r\n      if (!this.inExecuteWindow) {\r\n        this.inExecuteWindow = true;\r\n        this.inHealthExecuteWindow = true;\r\n        this.executeWindowStart = event.timestamp;\r\n        debug && console.log('Execute window started');\r\n      }\r\n    } else {\r\n      if (this.inExecuteWindow && event.timestamp > this.lastExecuteHitTimestamp + MS_BUFFER) {\r\n        this.inExecuteWindow = false;\r\n        this.inHealthExecuteWindow = false;\r\n        this.totalExecuteWindowDuration += event.timestamp - this.executeWindowStart;\r\n        debug && console.log('Execute window ended, current total: ', this.totalExecuteDuration);\r\n      }\r\n    }\r\n  }\r\n\r\n  onExecuteCast() {\r\n    this.casts += 1;\r\n    if (this.inExecuteWindow || this.inHealthExecuteWindow) {\r\n      this.castsWithExecute += 1;\r\n    }\r\n  }\r\n\r\n  onExecuteDamage(event: DamageEvent) {\r\n    if (this.inExecuteWindow || this.inHealthExecuteWindow) {\r\n      if (this.modifiesDamage) {\r\n        this.damage += calculateEffectiveDamage(event, this.damageModifier);\r\n      } else {\r\n        this.damage += event.amount + (event.absorbed || 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  applyExecuteEnablerBuff(event: ApplyBuffEvent) {\r\n    if (!this.inExecuteWindow && !this.inHealthExecuteWindow) {\r\n      this.executeWindowStart = event.timestamp;\r\n    }\r\n    this.inExecuteWindow = true;\r\n    this.lastExecuteHitTimestamp = event.timestamp;\r\n    debug && console.log(event.ability.name, ' was applied starting the execute window');\r\n  }\r\n\r\n  removeExecuteEnablerBuff(event: RemoveBuffEvent) {\r\n    if (!this.inHealthExecuteWindow) {\r\n      this.inExecuteWindow = false;\r\n      this.totalExecuteWindowDuration += event.timestamp - this.executeWindowStart;\r\n      debug && console.log(event.ability.name, ' was removed ending the execute window, current total: ', this.totalExecuteDuration);\r\n    } else {\r\n      debug && console.log('Execute enabler buff ended, but inside execute health window so window still ongoing.');\r\n    }\r\n  }\r\n\r\n  onFightEnd(event: FightEndEvent) {\r\n    if (this.inExecuteWindow) {\r\n      this.totalExecuteWindowDuration += event.timestamp - this.executeWindowStart;\r\n      this.inExecuteWindow = false;\r\n    }\r\n    debug && console.log('Fight ended, total duration of execute: ' + this.totalExecuteDuration + ' | ' + formatDuration(this.totalExecuteDuration));\r\n  }\r\n\r\n  //endregion\r\n}\r\n\r\nexport default ExecuteHelper;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst AverageTargetsHit = props => {\r\n  const { casts, hits, unique, approximate } = props;\r\n  const averageHits = (hits / casts) || 0;\r\n  return (\r\n    <>\r\n      {approximate && ''}{averageHits.toFixed(1)} <small> {unique ? 'unique targets hit' : 'average'} {unique ? '' : averageHits === 1 ? 'hit' : 'hits'} per cast</small>\r\n    </>\r\n  );\r\n};\r\n\r\nAverageTargetsHit.propTypes = {\r\n  casts: PropTypes.number.isRequired,\r\n  hits: PropTypes.number.isRequired,\r\n  unique: PropTypes.bool,\r\n  approximate: PropTypes.bool,\r\n};\r\n\r\nexport default AverageTargetsHit;\r\n\r\nAverageTargetsHit.defaultProps = {\r\n  approximate: false,\r\n  unique: false,\r\n};\r\n\r\n","import { ApplyBuffEvent, ApplyBuffStackEvent, ApplyDebuffEvent, ApplyDebuffStackEvent, EventType, RemoveBuffEvent, RemoveBuffStackEvent, RemoveDebuffEvent, RemoveDebuffStackEvent } from 'parser/core/Events';\r\n\r\n/**\r\n * Returns the current stacks on a given event\r\n * @param event\r\n */\r\nexport function currentStacks(event: RemoveBuffEvent | RemoveDebuffEvent | ApplyBuffEvent | ApplyDebuffEvent | ApplyBuffStackEvent | RemoveBuffStackEvent | ApplyDebuffStackEvent | RemoveDebuffStackEvent) {\r\n  switch (event.type) {\r\n    case EventType.RemoveBuff:\r\n    case EventType.RemoveDebuff:\r\n      return 0;\r\n    case EventType.ApplyBuff:\r\n    case EventType.ApplyDebuff:\r\n      return 1;\r\n    case EventType.ApplyBuffStack:\r\n    case EventType.RemoveBuffStack:\r\n    case EventType.ApplyDebuffStack:\r\n    case EventType.RemoveDebuffStack:\r\n      return event.stack;\r\n  }\r\n  throw new Error(\"Invalid event type for currentStacks\");\r\n}\r\n","import React from 'react';\r\nimport { formatPercentage } from 'common/format';\r\nimport SpellLink from 'common/SpellLink';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\nimport Spell from 'common/SPELLS/Spell';\r\n\r\nimport { When } from 'parser/core/ParseResults';\r\n\r\nimport ResourceTracker from './ResourceTracker';\r\n\r\ninterface Suggestion {\r\n  spell: Spell | any;\r\n  minor: number;\r\n  avg: number;\r\n  major: number;\r\n  extraSuggestion?: string | JSX.Element;\r\n}\r\n\r\nfunction suggest(when: When, tracker: ResourceTracker, suggestion: Suggestion) {\r\n  let tracked = { generated: 0, wasted: 0, casts: 0 };\r\n  //If an array of spells is passed, we manipulate the data to aggregate all the generated and wasted resources as well as the individual focus instances into 1 spell so that it can be displayed.\r\n  if (Array.isArray(suggestion.spell)) {\r\n    let newSuggestionSpell: Spell = { id: -1, name: \"\", icon: \"\" };\r\n    for (const spell of suggestion.spell) {\r\n      if (!tracker.buildersObj[spell.id]) {\r\n        continue;\r\n      }\r\n      if (newSuggestionSpell.id === -1) {\r\n        newSuggestionSpell = spell;\r\n      }\r\n      tracked.generated += tracker.buildersObj[spell.id].generated;\r\n      tracked.wasted += tracker.buildersObj[spell.id].wasted;\r\n      tracked.casts += tracker.buildersObj[spell.id].casts;\r\n    }\r\n    suggestion.spell = newSuggestionSpell;\r\n  } else {\r\n    tracked = tracker.buildersObj[suggestion.spell.id];\r\n  }\r\n  if (!tracked) {\r\n    return;\r\n  }\r\n\r\n  const maxGenerated = tracked.generated + tracked.wasted;\r\n  const wastedShare = (tracked.wasted / maxGenerated) || 0;\r\n  const resourceNameLower = tracker.resource.name.toLowerCase();\r\n\r\n  when(wastedShare).isGreaterThan(suggestion.minor)\r\n    .addSuggestion((suggest) => suggest(\r\n        <>\r\n          You are wasting {resourceNameLower} generated by <SpellLink id={suggestion.spell.id} />. {suggestion.extraSuggestion}\r\n        </>,\r\n      )\r\n        .icon(suggestion.spell.icon)\r\n        .actual(i18n._(t('shared.suggestions.resources.wasted')`${formatPercentage(wastedShare)}% wasted. Generated ${tracked.generated} out of ${maxGenerated} possible ${resourceNameLower}`))\r\n        .recommended(`<${formatPercentage(suggestion.minor)}%  ${resourceNameLower} wasted is recommend`)\r\n        .regular(suggestion.avg).major(suggestion.major));\r\n}\r\n\r\nexport default suggest;\r\n","import Analyzer, { SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Haste from 'parser/shared/modules/Haste';\r\nimport EventEmitter from 'parser/core/modules/EventEmitter';\r\nimport SpellResourceCost from 'parser/shared/modules/SpellResourceCost';\r\nimport HIT_TYPES from 'game/HIT_TYPES';\r\nimport Events from 'parser/core/Events';\r\n\r\n// turn on debug to find if there's inaccuracies, then verboseDebug to help track the cause.\r\nconst debug = false;\r\nconst verboseDebug = false;\r\n\r\n/**\r\n * Tracks when a regenerating resource reaches its cap. Most useful for specs such as rogues\r\n * and feral druids where their energy resource quickly recharges through natural regeneration\r\n * and may frequently reach its cap during a fight.\r\n *\r\n * It is an 'abstract' class, so should be extended and provided with settings for the resource\r\n * being tracked by your spec. Search for \"IMPLEMENTME\" for what should be set up.\r\n *\r\n * Reductions in spell costs should be handled by implementing parser/core/Modules/SpellResourceCost\r\n * for the relevant resource.\r\n *\r\n * If your derived class shares event handlers remember to call the original, e.g.\r\n * onCast(event) {\r\n *  super.onCast(event);\r\n *  // stuff related to your spec's implementation\r\n * }\r\n *\r\n * Example derived class: parser/Druid/Feral/Modules/Features/EnergyCapTracker\r\n *\r\n * For a more complete picture of how a combatant is using their resources you may want to\r\n * also use parser/core/Modules/ResourceTracker\r\n * ResourceTracker handles how it's energized and spent, RegenResourceCapTracker will tell\r\n * you about natural regeneration and how long it's at cap.\r\n *\r\n * The accuracy of this module's predictions depends heavily on finding the \"quirks\" of how\r\n * abilities and their resource behaviours appear in the combat log. It can never be perfectly\r\n * accurate due to resources being rounded to integer values and latency issues, but an error\r\n * of less than 2 should be possible.\r\n *\r\n * Fabricates events 'beginresourcecap' and 'endresourcecap'. See the functions fabricateBeginCap\r\n * and fabricateEndCap for details on these events and their limitations.\r\n */\r\n\r\n/**\r\n * How far (in ms) damage event can be separated from a cast and still use its information\r\n * to decide there should be a resource refund due to not hiting. 208ms is highest I've seen.\r\n */\r\nconst REFUND_SPENDER_WINDOW = 500;\r\nconst HIT_TYPES_THAT_REFUND = [\r\n  HIT_TYPES.MISS,\r\n  HIT_TYPES.DODGE,\r\n  HIT_TYPES.PARRY,\r\n];\r\n\r\n/**\r\n * @property {EventEmitter} eventEmitter\r\n * @property {Haste} haste\r\n * @property {SpellResourceCost} spellResourceCost\r\n */\r\nclass RegenResourceCapTracker extends Analyzer {\r\n  static dependencies = {\r\n    eventEmitter: EventEmitter,\r\n    haste: Haste,\r\n    // Needed for the `resourceCost` prop of events\r\n    spellResourceCost: SpellResourceCost,\r\n  };\r\n\r\n  // -- Start of IMPLEMENTME statics\r\n\r\n  // One of game/RESOURCE_TYPES\r\n  static resourceType;\r\n\r\n  // Resource's base regeneration rate in points per second (e.g. 10 for Energy)\r\n  static baseRegenRate = 0;\r\n\r\n  /**\r\n   * Is natural regeneration rate increased by haste.\r\n   * If a resource is affected by haste in an unusual way, set false and handle it manually in naturalRegenRate\r\n   */\r\n  static isRegenHasted = false;\r\n\r\n  /**\r\n   * Any buff or debuff IDs that change the max value for this resource. e.g. Berserk for Feral.\r\n   * Remember to check for their presence and apply the effect in currentMaxResource\r\n   */\r\n  static buffsChangeMax = [];\r\n\r\n  /**\r\n   * Any buff or debuff IDs that directly affect natural regeneration rate for this resource. e.g. Adrenaline Rush for Outlaw.\r\n   * Remember to check for their presence and apply the effect in naturalRegenRate\r\n   */\r\n  static buffsChangeRegen = [];\r\n\r\n  // Events for some abilities give inaccurate \"amount\" values, so their change is best applied cumulatively.\r\n  static energizersToApplyCumulatively = [];\r\n  static castsToApplyCumulatively = [];\r\n  static drainsToApplyCumulatively = [];\r\n\r\n  /**\r\n   * How close (in ms) a resource changing event must be to the last one to have the change handled cumulatively.\r\n   *\r\n   * When resource changing events occur in a very short time the values in the combat log can become inaccurate.\r\n   *  What happens in the fight:\r\n   * t: 1  player has 50 energy\r\n   * t: 2  cast spending 20 energy\r\n   * t: 2  energize gaining 30 energy\r\n   * t: 3  player has 60 energy\r\n   *\r\n   *  What the log shows:\r\n   * cast {timestamp: 2, classResources[i]: {amount: 50, cost: 20}}\r\n   * energize {timestamp: 2, resourceChange: 30, classResources[i]: {amount: 80}}\r\n   * ('amount' for cast events is what it was before the event, for energize events it's after.)\r\n   *\r\n   * If we trusted the resource information given by the last parsed event we'd expect energy to\r\n   * be 80 at t = 3.\r\n   */\r\n  static cumulativeEventWindow = 100;\r\n\r\n  /**\r\n   * For some specs (e.g. energy for rogues and feral) a ability that doesn't hit refunds some of the resource.\r\n   * A value of 0 means no refund, 0.8 seems to be the standard refund amount.\r\n   */\r\n  static resourceRefundOnMiss = 0;\r\n\r\n  // Some abilities never get their resources refunded, usually AoEs. List their spellIds here.\r\n  static exemptFromRefund = [];\r\n\r\n  // -- end of IMPLEMENTME statics\r\n\r\n  // Total time spent with resource at maximum (in ms)\r\n  atCap = 0;\r\n\r\n  // Total resources lost from natural regeneration (ONLY natural regeneration) due to being capped\r\n  missedRegen = 0;\r\n\r\n  // Total resources generated from natural regeneration, includes wasted resources.\r\n  naturalRegen = 0;\r\n\r\n  regenState = null;\r\n  prevSpender = null;\r\n  hasReportedBelowCap = false;\r\n\r\n  /**\r\n   * Amount of resource that should be available at current timestamp, accounting for natural regeneration.\r\n   * @returns {number}\r\n   */\r\n  get current() {\r\n    return this.predictValue(this.owner.currentTimestamp);\r\n  }\r\n\r\n  /**\r\n   * Whether the resource is at its cap at the current timestamp.\r\n   * @returns {boolean}\r\n   */\r\n  get isCapped() {\r\n    return this.current >= this.regenState.max;\r\n  }\r\n\r\n  /**\r\n   * What fraction of the fight was spent with this resource at its cap.\r\n   * @returns {number}\r\n   */\r\n  get cappedProportion() {\r\n    return this.atCap / this.owner.fightDuration;\r\n  }\r\n\r\n  /**\r\n   * Resource lost from natural regeneration (only from natural regeneration, not energizers) due\r\n   * to the resource reaching cap, averaged to a per-minute value.\r\n   */\r\n  get missedRegenPerMinute() {\r\n    return (this.missedRegen / this.owner.fightDuration) * 1000 * 60;\r\n  }\r\n\r\n  constructor(...args) {\r\n    super(...args);\r\n    // can't know resource state for certain until the first combat events, but assume a regenerating resource starts full.\r\n    const max = this.currentMaxResourceWithFallback();\r\n    this.regenState = {\r\n      amount: max ? max : 0,\r\n      max,\r\n      regen: this.naturalRegenRate(),\r\n      timestamp: this.owner.fight.start_time,\r\n    };\r\n    this.addEventListener(Events.fightend, this.onFightend);\r\n    this.addEventListener(Events.energize.to(SELECTED_PLAYER), this.onEnergize);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER), this.onCast);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER), this.onDamage);\r\n    this.addEventListener(Events.drain.by(SELECTED_PLAYER), this.onDrain);\r\n    this.addEventListener(Events.applybuff.to(SELECTED_PLAYER), this.onApplyBuff);\r\n    this.addEventListener(Events.removebuff.to(SELECTED_PLAYER), this.onRemoveBuff);\r\n    this.addEventListener(Events.ChangeHaste.to(SELECTED_PLAYER), this.onChangeHaste);\r\n  }\r\n\r\n  /**\r\n   * IMPLEMENTME\r\n   * Some specs have drain reductions that aren't already shown in events, which should be implemented\r\n   * here. Drain events are separate from an ability cast cost.\r\n   * @param   {object}  event A drain event being applied to the player.\r\n   * @returns {number}  Drain amount after any reductions are applied.\r\n   */\r\n  getReducedDrain(event) {\r\n    return event.resourceChange;\r\n  }\r\n\r\n  /**\r\n   * IMPLEMENTME\r\n   * Some specs have modifiers to the base regen rate that apply before haste, which should\r\n   * be implemented here.\r\n   * @returns {number} Base regen rate of the resource.\r\n   */\r\n  getBaseRegenRate(){\r\n    return this.constructor.baseRegenRate;\r\n  }\r\n\r\n  /**\r\n   * IMPLEMENTME\r\n   * Calculate current natural regeneration rate of the resource.\r\n   * When checking combant's buffs/debuffs you may want to use this.combatantHasBuffActive() rather than\r\n   * the .hasBuff of the combatant directly, doing so will exclude buffs which wore off at this timestamp.\r\n   * @returns {number}  Resource expected to be generated per ms.\r\n   */\r\n  naturalRegenRate() {\r\n    let regen = this.getBaseRegenRate() / 1000;\r\n    if (this.constructor.isRegenHasted) {\r\n      regen *= (1 + this.haste.current);\r\n    }\r\n    return regen;\r\n  }\r\n\r\n  /**\r\n   * IMPLEMENTME\r\n   * Calculate current maximum value for the resource. Accounting for items, talents, and active buffs.\r\n   * When checking combant's buffs/debuffs you may want to use this.combatantHasBuffActive() rather than\r\n   * the .hasBuff of the combatant directly, doing so will exclude buffs which wore off at this timestamp.\r\n   * @returns {number}  Maximum resource value, or null to try to use value from resource events.\r\n   */\r\n  currentMaxResource() {\r\n   /**\r\n    * If left unimplemented and no events provide max resource information the Analyzer will never know\r\n    * the resource's max value. It handles that situation without crashing, but without a cap value it\r\n    * is largely useless.\r\n    */\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Applies an energize of the tracked resource type at the current timestamp.\r\n   * Use when a spec has a source of resource which doesn't appear as an energize event in the log.\r\n   * If you have an invisible energize that happens over a duration you should generate an event for\r\n   * each tick, as applying it all at once can lead to inaccuracies. If it doesn't have ticks consider\r\n   * handling it as a buff to the natural regeneration rate instead.\r\n   * @param {number} amount Raw amount of resources to gain. Limiting to max is done within this function\r\n   * so there's no need to check before passing it in.\r\n   */\r\n  processInvisibleEnergize(amount) {\r\n    if (amount == null || isNaN(amount)) {\r\n      throw new Error(`processInvisibleEnergize called without required parameter. amount: ${amount}`);\r\n    }\r\n    if (amount === 0) {\r\n      return;\r\n    }\r\n    const before = this.current;\r\n    const after = Math.min(before + amount, this.currentMaxResourceWithFallback());\r\n    const gain = after - before;\r\n    this.applyEnergize(gain);\r\n  }\r\n\r\n  /**\r\n   * Fetches the appropriate classResources object from an event, or null if there is none available.\r\n   * @param {object} event An event object which may have an appropriate .classResources property.\r\n   */\r\n  getResource(event) {\r\n    if (!event || !event.classResources) {\r\n      return null;\r\n    }\r\n    return event.classResources.find(r => r.type === this.constructor.resourceType.id);\r\n  }\r\n\r\n  /**\r\n   * Fetches the cost of a cast event. Using its resourceCost property (added by SpellResourceCost)\r\n   * if it's available or the resource cost given by the combat log if not.\r\n   * @param {object} event A cast event object with a resource cost associated with it.\r\n   */\r\n  getCost(event) {\r\n    if (event.resourceCost[this.constructor.resourceType.id] !== undefined) {\r\n      return event.resourceCost[this.constructor.resourceType.id];\r\n    }\r\n    return this.getResource(event).cost;\r\n  }\r\n\r\n  /**\r\n   * A variation of this.selectedCombatant.hasBuff that excludes any buffs which were removed on the timestamp.\r\n   * @param {number} buffId ID of buff or debuff to check for on the current combatant.\r\n   * @param {number} timestamp Time to check, or null to use current timestamp. Cannot be a future timestamp.\r\n   */\r\n  combatantHasBuffActive(buffId, timestamp = null) {\r\n    if (!buffId || isNaN(buffId)) {\r\n      throw new Error(`combatantHasBuffActive called without required parameter. buffId: ${buffId}`);\r\n    }\r\n    if (!timestamp) {\r\n      timestamp = this.owner.currentTimestamp;\r\n    }\r\n    const buffHistory = this.selectedCombatant.getBuffHistory(buffId);\r\n    return Boolean(buffHistory.find(buff => (buff.start <= timestamp && (!buff.end || buff.end > timestamp))));\r\n  }\r\n\r\n  onFightend() {\r\n    // updateState one last time to catch any resource capping after the final resource event\r\n    this.updateState(this.predictValue(this.owner.fight.end_time));\r\n    debug && console.log(`mean prediction error magnitude: ${this.debugMeanPredictionError.toFixed(2)}`);\r\n    debug && console.log(`greatest magnitude prediction error: ${this.debugGreatestError.toFixed(2)}`);\r\n  }\r\n\r\n  onEnergize(event) {\r\n    if(event.resourceChangeType !== this.constructor.resourceType.id || !event.resourceChange) {\r\n      return;\r\n    }\r\n    const waste = event.waste ? event.waste : 0;\r\n    const gain = event.resourceChange - waste;\r\n    const applyCumulatively = this.constructor.energizersToApplyCumulatively.includes(event.ability.guid);\r\n    this.applyEnergize(gain, event, applyCumulatively);\r\n  }\r\n\r\n  applyEnergize(gain, event = null, applyCumulatively = false) {\r\n    if (gain == null || isNaN(gain)) {\r\n      // using == null to catch undefined, but still allow 0\r\n      throw new Error(`applyEnergize called without required parameter. gain: ${gain}`);\r\n    }\r\n    const time = event ? event.timestamp : this.owner.currentTimestamp;\r\n    const eventResource = event ? this.getResource(event) : null;\r\n\r\n    const shouldAccumulate = applyCumulatively ||\r\n      this.isLastUpdateRecent(time) ||\r\n      !eventResource || eventResource.amount == null;\r\n\r\n    // eventResource.amount for an energize is the value after the change\r\n    const current = shouldAccumulate ? (this.predictValue(time) + gain) : eventResource.amount;\r\n    if (debug && !shouldAccumulate) {\r\n      this.debugActualVsPredicted(eventResource.amount - gain, time);\r\n    }\r\n    const max = this.currentMaxResourceWithFallback(event);\r\n    this.updateState(current, max);\r\n  }\r\n\r\n  onCast(event) {\r\n    const eventResource = this.getResource(event);\r\n    if (!eventResource) {\r\n      return;\r\n    }\r\n    const cost = this.getCost(event);\r\n    if (!cost) {\r\n      // only interested in cast events that spend resource\r\n      return;\r\n    }\r\n    if (cost < 0) {\r\n      debug && console.warn(`${this.owner.formatTimestamp(event.timestamp, 3)} Unexpected negative cost ${cost} for spell ${event.ability.guid}`);\r\n    }\r\n    if (!this.constructor.exemptFromRefund.includes(event.ability.guid)) {\r\n      this.prevSpender = {\r\n        id: event.ability.guid,\r\n        cost,\r\n        timestamp: event.timestamp,\r\n      };\r\n    }\r\n\r\n    const shouldAccumulate = eventResource.amount == null ||\r\n      this.constructor.castsToApplyCumulatively.includes(event.ability.guid) ||\r\n      this.isLastUpdateRecent(event.timestamp);\r\n    const current = (shouldAccumulate ? this.predictValue(event.timestamp) : eventResource.amount) - cost;\r\n    if (debug && !shouldAccumulate) {\r\n      this.debugActualVsPredicted(eventResource.amount, event.timestamp);\r\n    }\r\n    const max = this.currentMaxResourceWithFallback(event);\r\n    this.updateState(current, max);\r\n  }\r\n\r\n  onDamage(event) {\r\n    // only interested in damage events if they show a spending ability failing to connect (and so triggering a refund)\r\n    if (!this.prevSpender || event.ability.guid !== this.prevSpender.id ||\r\n        (event.timestamp - this.prevSpender.timestamp) > REFUND_SPENDER_WINDOW ||\r\n        event.tick || !HIT_TYPES_THAT_REFUND.includes(event.hitType)) {\r\n      return;\r\n    }\r\n    verboseDebug && console.log(`${this.owner.formatTimestamp(this.owner.currentTimestamp, 3)} attack didn't connect so restoring ${Math.round(this.constructor.resourceRefundOnMiss * 100)}% resource`);\r\n    const refund = Math.floor(this.prevSpender.cost * this.constructor.resourceRefundOnMiss);\r\n    const current = this.predictValue(event.timestamp) + refund;\r\n    this.updateState(current);\r\n  }\r\n\r\n  onDrain(event) {\r\n    if(event.resourceChangeType !== this.constructor.resourceType.id || !event.resourceChange) {\r\n      return;\r\n    }\r\n    const eventResource = this.getResource(event);\r\n    const drain = this.getReducedDrain(event);\r\n\r\n    const shouldAccumulate = !eventResource || eventResource.amount == null ||\r\n      this.constructor.energizersToApplyCumulatively.includes(event.ability.guid) ||\r\n      this.isLastUpdateRecent(event.timestamp);\r\n\r\n    // eventResource.amount for a drain is the value before the change\r\n    const current = (shouldAccumulate ? this.predictValue(event.timestamp) : eventResource.amount) - drain;\r\n    if (debug && !shouldAccumulate) {\r\n      this.debugActualVsPredicted(eventResource.amount, event.timestamp);\r\n    }\r\n    const max = this.currentMaxResourceWithFallback(event);\r\n    this.updateState(current, max);\r\n  }\r\n\r\n  isLastUpdateRecent(timestamp) {\r\n    return this.regenState.timestamp + this.constructor.cumulativeEventWindow >= timestamp;\r\n  }\r\n\r\n  onApplyBuff(event) {\r\n    if (this.constructor.buffsChangeMax.includes(event.ability.guid)) {\r\n      this.buffChangesResourceMax(event);\r\n    }\r\n    if (this.constructor.buffsChangeRegen.includes(event.ability.guid)) {\r\n      this.buffChangesRegen();\r\n    }\r\n  }\r\n\r\n  onRemoveBuff(event) {\r\n    if (this.constructor.buffsChangeMax.includes(event.ability.guid)) {\r\n      this.buffChangesResourceMax(event);\r\n    }\r\n    if (this.constructor.buffsChangeRegen.includes(event.ability.guid)) {\r\n      this.buffChangesRegen();\r\n    }\r\n  }\r\n\r\n  onChangeHaste() {\r\n    const regen = this.naturalRegenRate();\r\n    this.updateState(null, null, regen);\r\n  }\r\n\r\n  buffChangesResourceMax(event) {\r\n    const max = this.currentMaxResourceWithFallback(event);\r\n    this.updateState(null, max);\r\n  }\r\n\r\n  buffChangesRegen() {\r\n    const regen = this.naturalRegenRate();\r\n    this.updateState(null, null, regen);\r\n  }\r\n\r\n  /**\r\n   * Called when current, max, or regen rate for the resource has changed.\r\n   * Builds a new regenState reflecting the current state.\r\n   * Detects if resource capping occurred since the last regenState.\r\n   * @param {number} amount Current amount of resource, or null to use prediction.\r\n   * @param {number} max Current resource maximum, or null to use calculation.\r\n   * @param {number} regen Current resource regeneration rate, or null to use calculation.\r\n   */\r\n  updateState(amount = null, max = null, regen = null) {\r\n    const timestamp = this.owner.currentTimestamp;\r\n    verboseDebug && console.log(`${this.owner.formatTimestamp(timestamp, 3)} amount: ${amount ? amount.toFixed(1) : 'n/a'}, max: ${max ? max.toFixed(1) : 'n/a'} , regen: ${regen ? (regen * 1000).toFixed(3) : 'n/a'}`);\r\n    if (amount == null || isNaN(amount)) {\r\n      amount = this.predictValue(timestamp);\r\n    }\r\n    if (max == null || isNaN(max)) {\r\n      max = this.currentMaxResourceWithFallback();\r\n    }\r\n    if (regen == null || isNaN(regen)) {\r\n      regen = this.naturalRegenRate();\r\n    }\r\n    amount = max ? Math.min(max, amount) : amount;\r\n    const oldState = this.regenState;\r\n    const newState = {\r\n      amount,\r\n      max,\r\n      regen,\r\n      timestamp,\r\n    };\r\n    this.regenState = newState;\r\n    if (oldState) {\r\n      const durationCapped = this.timeCappedBetweenStates(oldState, newState);\r\n      this.atCap += durationCapped;\r\n      this.missedRegen += durationCapped * oldState.regen;\r\n      this.naturalRegen += (newState.timestamp - oldState.timestamp) * oldState.regen;\r\n    }\r\n    if (newState.amount < newState.max) {\r\n      this.onBelowCap(newState.timestamp);\r\n    }\r\n  }\r\n\r\n  timeCappedBetweenStates(oldState, newState) {\r\n    if (!oldState || !newState){\r\n      throw new Error(`timeCappedBetweenStates called without required parameters. oldState: ${oldState}, newState: ${newState}`);\r\n    }\r\n    const reachCap = oldState.max ? this.predictReachValue(oldState.timestamp, oldState.amount, oldState.regen, oldState.max) : Infinity;\r\n    if (reachCap >= newState.timestamp) {\r\n      return 0;\r\n    }\r\n    this.onAtCap(reachCap);\r\n\r\n    return newState.timestamp - reachCap;\r\n  }\r\n\r\n  currentMaxResourceWithFallback(event = null) {\r\n    const calculated = this.currentMaxResource();\r\n    if (calculated) {\r\n      return calculated;\r\n    }\r\n    const eventResource = this.getResource(event);\r\n    if (eventResource && eventResource.max != null && !isNaN(eventResource.max)) {\r\n      return eventResource.max;\r\n    }\r\n    // when neither source provides a value just use the existing\r\n    return this.regenState.max;\r\n  }\r\n\r\n  /**\r\n   * Given a start value and regen rate, calculate when resource will reach a given value.\r\n   * @param {number} startTime Timestamp for known resource value\r\n   * @param {number} startValue Known resource value\r\n   * @param {number} regen Regeneration rate in units per ms\r\n   * @param {number} targetValue Resource value being aimed for\r\n   * @returns {number} Timestamp when targetValue would be reached through natural regen.\r\n   */\r\n  predictReachValue(startTime, startValue, regen, targetValue) {\r\n    if (startValue == null || isNaN(startValue) ||\r\n        regen == null || isNaN(regen) ||\r\n        targetValue == null || isNaN(targetValue) ||\r\n        startTime == null || isNaN(startTime)) {\r\n      throw new Error(`predictReachValue called without required parameters. startValue: ${startValue}, regen: ${regen}, cap: ${targetValue}, startTime: ${startTime}`);\r\n    }\r\n    if (startValue >= targetValue) {\r\n      return startTime;\r\n    }\r\n    if (regen === 0) {\r\n      return Infinity;\r\n    }\r\n    return startTime + ((targetValue - startValue) / regen);\r\n  }\r\n\r\n  /**\r\n   * Calculates available resource accounting for natural regen.\r\n   * @param {number} time Timestamp for which to create a prediction, or null for current timestamp.\r\n   * @returns {number} Predicted resource value at given time.\r\n   */\r\n  predictValue(time = null) {\r\n    if (!time) {\r\n      time = this.owner.currentTimestamp;\r\n    }\r\n    if (time < this.regenState.timestamp) {\r\n      debug && console.warn(`Attempting to predict the past. State's time: ${this.owner.formatTimestamp(this.regenState.timestamp, 3)}, target time: ${this.owner.formatTimestamp(time, 3)}`);\r\n      return this.regenState.amount;\r\n    }\r\n    const elapsed = time - this.regenState.timestamp;\r\n    const predicted = this.regenState.amount + this.regenState.regen * elapsed;\r\n    return this.regenState.max ? Math.min(this.regenState.max, predicted) : predicted;\r\n  }\r\n\r\n  onBelowCap(time) {\r\n    if (this.hasReportedBelowCap) {\r\n      return;\r\n    }\r\n    this.fabricateEndCap(time);\r\n    this.hasReportedBelowCap = true;\r\n  }\r\n\r\n  onAtCap(time) {\r\n    if (!this.hasReportedBelowCap) {\r\n      return;\r\n    }\r\n    this.fabricateBeginCap(time);\r\n    this.hasReportedBelowCap = false;\r\n  }\r\n\r\n  /**\r\n   * Fabricates an event indicating the tracked resource has reached its cap value.\r\n   * May be triggered by an energize or natural regeneration bringing the value to the cap, or\r\n   * by the cap being lowered.\r\n   *\r\n   * Although the timestamp of this event should be accurate, because cap events are sometimes\r\n   * only detected after they happen it may be misplaced within the event stream.\r\n   * So do NOT assume that an event parsed between beginresourcecap and endresourcecap events\r\n   * being parsed happened while the resource was capped. Either look at the timestamps of\r\n   * the events or if you're interested in the current cap state use this analyzer's isCapped\r\n   *\r\n   * Also note that endresourcecap and beginresourcecap events may occur extremely close to\r\n   * one-another, sometimes on the same timestamp if there's a spend and energize event.\r\n   *\r\n   * @param {number} time Timestamp for when the resource reached cap.\r\n   */\r\n  fabricateBeginCap(time) {\r\n    if (time == null || isNaN(time)) {\r\n      throw new Error(`fabricateBeginCap called without required parameter. time: ${time}`);\r\n    }\r\n    verboseDebug && console.log(`${this.owner.formatTimestamp(time, 3)} begin cap`);\r\n    this.eventEmitter.fabricateEvent({\r\n      type: 'beginresourcecap',\r\n      timestamp: time,\r\n      sourceID: this.owner.playerId,\r\n      targetID: this.owner.playerId,\r\n      resourceType: this.constructor.resourceType.id,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fabricates an event indicating that the tracked resource is no longer at its cap.\r\n   * May be triggered by cast or drain using resource or the cap value being increased.\r\n   * @param {number} time Timestamp for when the resource ceased to be at the cap.\r\n   */\r\n  fabricateEndCap(time) {\r\n    if (time == null || isNaN(time)) {\r\n      throw new Error(`fabricateEndCap called without required parameter. time: ${time}`);\r\n    }\r\n    verboseDebug && console.log(`${this.owner.formatTimestamp(time, 3)} end cap`);\r\n    this.eventEmitter.fabricateEvent({\r\n      type: 'endresourcecap',\r\n      timestamp: time,\r\n      sourceID: this.owner.playerId,\r\n      targetID: this.owner.playerId,\r\n      resourceType: this.constructor.resourceType.id,\r\n    });\r\n  }\r\n\r\n  // -- debug code to check accuracy of predictions against values reported by log\r\n  debugErrorSum = 0;\r\n  debugGreatestError = 0;\r\n  debugAccuracyCheckCount = 0;\r\n  debugActualVsPredicted(actual, timestamp) {\r\n    if (!debug) {\r\n      return;\r\n    }\r\n    const predicted = this.predictValue(timestamp);\r\n    const difference = predicted - actual;\r\n    const errorMagnitude = Math.abs(difference);\r\n    this.debugGreatestError = Math.max(this.debugGreatestError, errorMagnitude);\r\n    this.debugAccuracyCheckCount += 1;\r\n    this.debugErrorSum += errorMagnitude;\r\n    if (errorMagnitude > 3) {\r\n      console.log(`${this.owner.formatTimestamp(timestamp, 3)} actual: ${actual} prediction: ${predicted.toFixed(1)} (error: ${difference > 0 ? '+' : ''}${difference.toFixed(1)})`);\r\n    }\r\n  }\r\n  get debugMeanPredictionError() {\r\n    return this.debugErrorSum / this.debugAccuracyCheckCount;\r\n  }\r\n}\r\n\r\nexport default RegenResourceCapTracker;\r\n","import RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport ResourceTracker from 'parser/shared/modules/resources/resourcetracker/ResourceTracker';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { CastEvent, EnergizeEvent } from 'parser/core/Events';\r\nimport { AOTW_REGEN, BARBED_SHOT_FOCUS_REGEN_BUFFS_IDS, BARBED_SHOT_REGEN, BEAST_MASTERY_SPELLS_WITHOUT_WASTE, CHIM_REGEN } from 'parser/hunter/beastmastery/constants';\r\nimport { Options } from 'parser/core/Analyzer';\r\n\r\nclass FocusTracker extends ResourceTracker {\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.resource = RESOURCE_TYPES.FOCUS;\r\n  }\r\n\r\n  //Because energize events associated with certain spells don't provide a waste number, but instead a lower resourceChange number we can calculate the waste ourselves.\r\n  onEnergize(event: EnergizeEvent) {\r\n    if (event.resourceChangeType !== this.resource.id) {\r\n      return;\r\n    }\r\n    const spellId = event.ability.guid;\r\n    let waste = 0;\r\n    let gain;\r\n    if (BEAST_MASTERY_SPELLS_WITHOUT_WASTE.includes(spellId)) {\r\n      gain = event.resourceChange;\r\n      if (BARBED_SHOT_FOCUS_REGEN_BUFFS_IDS.includes(spellId)) {\r\n        waste = BARBED_SHOT_REGEN * (this.selectedCombatant.hasBuff(SPELLS.NESINGWARYS_TRAPPING_APPARATUS_ENERGIZE.id) ? 2 : 1) - gain;\r\n        gain = gain - waste;\r\n      } else if (spellId === SPELLS.ASPECT_OF_THE_WILD.id) {\r\n        waste = AOTW_REGEN * (this.selectedCombatant.hasBuff(SPELLS.NESINGWARYS_TRAPPING_APPARATUS_ENERGIZE.id) ? 2 : 1) - gain;\r\n        gain = gain - waste;\r\n      } else if (spellId === SPELLS.CHIMAERA_SHOT_FOCUS.id) {\r\n        waste = CHIM_REGEN * (this.selectedCombatant.hasBuff(SPELLS.NESINGWARYS_TRAPPING_APPARATUS_ENERGIZE.id) ? 2 : 1) - gain;\r\n        gain = gain - waste;\r\n      }\r\n    } else {\r\n      waste = event.waste;\r\n      gain = event.resourceChange - waste;\r\n    }\r\n\r\n    this._applyBuilder(spellId, gain, waste, this.getResource(event), event.timestamp);\r\n  }\r\n\r\n  //We're not interested in the fabricated events that are created prepull, as these tend to add focus costs things such as potion usage, Bestial Wrath, Trueshot or the likes whereas these don't cost focus.\r\n  shouldProcessCastEvent(event: CastEvent) {\r\n    return !event.__fabricated && Boolean(this.getResource(event));\r\n  }\r\n}\r\n\r\nexport default FocusTracker;\r\n","export const isPermanentPet = (guid: number) => guid.toString().length > 6;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Abilities from 'parser/core/modules/Abilities';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { ApplyBuffEvent, DamageEvent, RefreshBuffEvent } from 'parser/core/Events';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport React from 'react';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport { binomialCDF, expectedProcCount, plotOneVariableBinomChart } from 'parser/shared/modules/helpers/Probability';\r\nimport SpellLink from 'common/SpellLink';\r\nimport { FLAYED_SHOT_RESET_CHANCE } from 'parser/hunter/shared/constants';\r\nimport { formatNumber, formatPercentage } from 'common/format';\r\nimport SPECS from 'game/SPECS';\r\nimport COVENANTS from 'game/shadowlands/COVENANTS';\r\n\r\nclass FlayedShot extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n    abilities: Abilities,\r\n  };\r\n\r\n  damage: number = 0;\r\n  damageTicks: number = 0;\r\n  totalProcs: number = 0;\r\n  resets: number = 0;\r\n  offCDProcs: number = 0;\r\n  activeKillShotSpell = this.selectedCombatant.spec === SPECS.SURVIVAL_HUNTER ? SPELLS.KILL_SHOT_SV : SPELLS.KILL_SHOT_MM_BM;\r\n\r\n  protected spellUsable!: SpellUsable;\r\n  protected abilities!: Abilities;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.active = this.selectedCombatant.hasCovenant(COVENANTS.VENTHYR.id);\r\n\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n\r\n    (options.abilities as Abilities).add({\r\n      spell: SPELLS.FLAYED_SHOT,\r\n      category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n      cooldown: 30,\r\n      gcd: {\r\n        base: 1500,\r\n      },\r\n      castEfficiency: {\r\n        suggestion: true,\r\n        recommendedEfficiency: 0.9,\r\n      },\r\n    });\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.FLAYED_SHOT), this.onDamage);\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.FLAYERS_MARK), this.onProc);\r\n    this.addEventListener(Events.refreshbuff.by(SELECTED_PLAYER).spell(SPELLS.FLAYERS_MARK), this.onProc);\r\n  }\r\n\r\n  get expectedProcs() {\r\n    return expectedProcCount(FLAYED_SHOT_RESET_CHANCE, this.damageTicks);\r\n  }\r\n\r\n  onDamage(event: DamageEvent) {\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n    this.damageTicks += 1;\r\n  }\r\n\r\n  onProc(event: ApplyBuffEvent | RefreshBuffEvent) {\r\n    this.totalProcs += 1;\r\n    if (this.spellUsable.isOnCooldown(this.activeKillShotSpell.id)) {\r\n      this.spellUsable.endCooldown(this.activeKillShotSpell.id, false, event.timestamp);\r\n      this.resets += 1;\r\n    } else {\r\n      this.offCDProcs += 1;\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n        tooltip={(\r\n          <>\r\n            You had {this.offCDProcs} {this.offCDProcs === 1 ? `proc` : `procs`} with Kill Shot already off cooldown. <br />\r\n            You had {formatPercentage(this.totalProcs / this.expectedProcs, 1)}% procs of what you could expect to get over the encounter. <br />\r\n            You had a total of {this.totalProcs} procs, and your expected amount of procs was {formatNumber(this.expectedProcs)}. <br />\r\n            <ul>\r\n              <li>You have a {formatPercentage(binomialCDF(this.totalProcs, this.damageTicks, FLAYED_SHOT_RESET_CHANCE))}% chance of getting this amount of procs or fewer in the future with this amount of auto attacks.</li>\r\n            </ul>\r\n          </>\r\n        )}\r\n        dropdown={(\r\n          <>\r\n            <div style={{ padding: '8px' }}>\r\n              {plotOneVariableBinomChart(this.totalProcs, this.damageTicks, FLAYED_SHOT_RESET_CHANCE)}\r\n              <p>Likelihood of getting <em>exactly</em> as many procs as estimated on a fight given your number of <SpellLink id={SPELLS.FLAYED_SHOT.id} /> ticks.</p>\r\n            </div>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.FLAYED_SHOT}>\r\n          <>\r\n            {this.resets} / {this.totalProcs} ({formatPercentage(this.resets / (this.totalProcs))}%) <small>Kill Shot resets</small>\r\n            <br />\r\n            <ItemDamageDone amount={this.damage} />\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default FlayedShot;\r\n","import React from 'react';\r\n\r\nimport Analyzer from 'parser/core/Analyzer';\r\nimport { ThresholdStyle } from 'parser/core/ParseResults';\r\nimport Panel from 'interface/others/Panel';\r\nimport { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport { formatPercentage } from 'common/format';\r\nimport ResourceBreakdown from 'parser/shared/modules/resources/resourcetracker/ResourceBreakdown';\r\nimport BoringResourceValue from 'interface/statistics/components/BoringResourceValue';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport { RESOURCES_HUNTER_AVERAGE_THRESHOLD, RESOURCES_HUNTER_MAJOR_THRESHOLD, RESOURCES_HUNTER_MINOR_THRESHOLD } from 'parser/hunter/shared/constants';\r\n\r\nimport FocusTracker from './FocusTracker';\r\n\r\nclass FocusDetails extends Analyzer {\r\n  static dependencies = {\r\n    focusTracker: FocusTracker,\r\n  };\r\n\r\n  protected focusTracker!: FocusTracker;\r\n\r\n  get wasted() {\r\n    return this.focusTracker.wasted || 0;\r\n  }\r\n\r\n  get total() {\r\n    return this.focusTracker.wasted + this.focusTracker.generated || 0;\r\n  }\r\n\r\n  get wastedPercent() {\r\n    return this.wasted / this.total || 0;\r\n  }\r\n\r\n  get focusGeneratorWasteThresholds() {\r\n    return {\r\n      actual: 1 - this.wastedPercent,\r\n      isLessThan: {\r\n        minor: 1 - RESOURCES_HUNTER_MINOR_THRESHOLD,\r\n        average: 1 - RESOURCES_HUNTER_AVERAGE_THRESHOLD,\r\n        major: 1 - RESOURCES_HUNTER_MAJOR_THRESHOLD,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE(11)}\r\n        size=\"flexible\"\r\n        tooltip={`You wasted ${this.wasted} out of ${this.total} Focus from generators.`}\r\n      >\r\n        <BoringResourceValue\r\n          resource={RESOURCE_TYPES.FOCUS}\r\n          value={`${formatPercentage(this.wastedPercent)} %`}\r\n          label=\"Wasted generator Focus\"\r\n        />\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n  tab() {\r\n    return {\r\n      title: 'Focus',\r\n      url: 'focus',\r\n      render: () => (\r\n        <Panel>\r\n          <ResourceBreakdown\r\n            tracker={this.focusTracker}\r\n            showSpenders\r\n          />\r\n        </Panel>\r\n      ),\r\n    };\r\n  }\r\n}\r\n\r\nexport default FocusDetails;\r\n","import React from 'react';\r\n\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport { formatPercentage, formatThousands } from 'common/format';\r\nimport { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport Tooltip from 'common/Tooltip';\r\nimport RegenResourceCapTracker from 'parser/shared/modules/resources/resourcetracker/RegenResourceCapTracker';\r\nimport StatisticBar from 'interface/statistics/StatisticBar';\r\n\r\nimport { AutoSizer } from 'react-virtualized';\r\nimport FlushLineChart from 'interface/others/FlushLineChart';\r\nimport Events, { CastEvent, DamageEvent, EnergizeEvent } from 'parser/core/Events';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport { HUNTER_BASE_FOCUS_MAX, HUNTER_BASE_FOCUS_REGEN } from 'parser/hunter/shared/constants';\r\nimport { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\n/**\r\n * Sets up RegenResourceCapTracker to accurately track the regenerating focus of hunters.\r\n * Taking into account the effect of buffs, talents, and items on the focus cost of abilities, the maximum focus amount, and the regeneration rate.\r\n */\r\nclass FocusCapTracker extends RegenResourceCapTracker {\r\n  static dependencies = {\r\n    ...RegenResourceCapTracker.dependencies,\r\n  };\r\n\r\n  static resourceType = RESOURCE_TYPES.FOCUS;\r\n  static baseRegenRate = HUNTER_BASE_FOCUS_REGEN;\r\n  static isRegenHasted = true;\r\n  bySecond: { [key: number]: number } = {};\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.addEventListener(Events.energize.by(SELECTED_PLAYER), this.onEnergizeByPlayer);\r\n  }\r\n\r\n  get wastedPercent() {\r\n    return (this.missedRegen / this.naturalRegen) || 0;\r\n  }\r\n\r\n  get focusNaturalRegenWasteThresholds() {\r\n    return {\r\n      actual: 1 - this.wastedPercent,\r\n      isLessThan: {\r\n        minor: 0.9,\r\n        average: 0.85,\r\n        major: 0.8,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  currentMaxResource() {\r\n    return HUNTER_BASE_FOCUS_MAX;\r\n  }\r\n\r\n  onEnergizeByPlayer(event: EnergizeEvent) {\r\n    const secondsIntoFight = Math.floor((event.timestamp - this.owner.fight.start_time) / 1000);\r\n    this.bySecond[secondsIntoFight] = (this.bySecond[secondsIntoFight] || this.current);\r\n  }\r\n\r\n  onCast(event: CastEvent) {\r\n    super.onCast(event);\r\n    const secondsIntoFight = Math.floor((event.timestamp - this.owner.fight.start_time) / 1000);\r\n    this.bySecond[secondsIntoFight] = (this.bySecond[secondsIntoFight] || this.current);\r\n  }\r\n\r\n  onDamage(event: DamageEvent) {\r\n    super.onDamage(event);\r\n    const secondsIntoFight = Math.floor((event.timestamp - this.owner.fight.start_time) / 1000);\r\n    this.bySecond[secondsIntoFight] = (this.bySecond[secondsIntoFight] || this.current);\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.focusNaturalRegenWasteThresholds).addSuggestion((suggest, actual, recommended) => suggest(<>You're allowing your focus to reach its cap. While at its maximum value you miss out on the focus that would have regenerated. Although it can be beneficial to let focus pool ready to be used at the right time, try to spend some before it reaches the cap.</>)\r\n      .icon('ability_hunter_focusfire')\r\n      .actual(i18n._(t('hunter.marksmanship.suggestions.focusCapTracker.focusLost')`${formatPercentage(1 - actual)}% regenerated focus lost due to being capped.`))\r\n      .recommended(`<${formatPercentage(recommended, 0)}% is recommended.`));\r\n  }\r\n\r\n  statistic() {\r\n    const data = Object.entries(this.bySecond).map(([sec, val]) => ({ 'time': sec, 'val': val }));\r\n    return (\r\n      <StatisticBar\r\n        position={STATISTIC_ORDER.CORE(1)}\r\n        wide\r\n        style={{ marginBottom: 20, overflow: 'hidden' }} // since this is in a group, reducing margin should be fine\r\n        large={false}\r\n        ultrawide={false}\r\n      >\r\n        <Tooltip content={<>Natural Focus regen lost: <strong>{formatThousands(this.missedRegen)}</strong> <br /> That is <strong>{formatPercentage(this.wastedPercent)}%</strong> of natural regenerated focus over the course of the encounter.</>}>\r\n          <div className=\"flex\">\r\n            <div className=\"flex-sub icon\">\r\n              <img\r\n                src=\"/img/bullseye.png\"\r\n                alt=\"Focus\"\r\n              />\r\n            </div>\r\n            <div\r\n              className=\"flex-sub value\"\r\n              style={{ width: 100 }}\r\n            >\r\n              Focus\r\n            </div>\r\n            <div className=\"flex-main chart\">\r\n              {this.missedRegen > 0 && (\r\n                <AutoSizer disableWidth>\r\n                  {({ height }) => (\r\n                    <FlushLineChart data={data} duration={this.owner.fightDuration / 1000} height={height} />\r\n                  )}\r\n                </AutoSizer>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </Tooltip>\r\n      </StatisticBar>\r\n    );\r\n  }\r\n}\r\n\r\nexport default FocusCapTracker;\r\n","import CoreDeathTracker from 'parser/shared/modules/DeathTracker';\r\nimport { TIME_SPENT_DEAD_THRESHOLD } from 'parser/hunter/shared/constants';\r\n\r\n/**\r\n * Due to combatlog restrictions it is not possible to know whether the hunter cast Feign Death or the hunter actually died.\r\n * For this module we assume any single death lasting less than 0.2% of an encounter (1.2 seconds on a 10 minute fight) was due to Feign Death, and thus we remove it as it is improbable anyone is that fast to ress anyone.\r\n */\r\nclass DeathTracker extends CoreDeathTracker {\r\n  static dependencies = {\r\n    ...CoreDeathTracker.dependencies,\r\n  };\r\n\r\n  deathPercentageOfEncounter(deathTimestamp: number, ressTimestamp: number) {\r\n    return (ressTimestamp - deathTimestamp) / this.owner.fightDuration;\r\n  }\r\n\r\n  resurrect(event: any) {\r\n    this.lastResurrectionTimestamp = this.owner.currentTimestamp;\r\n    const percentSpentDead = this.deathPercentageOfEncounter(this.lastDeathTimestamp, this.lastResurrectionTimestamp);\r\n    if (percentSpentDead > TIME_SPENT_DEAD_THRESHOLD) {\r\n      super.resurrect(event);\r\n    } else {\r\n      this.isAlive = true;\r\n      this.deaths.pop();\r\n    }\r\n  }\r\n}\r\n\r\nexport default DeathTracker;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport { formatNumber } from 'common/format';\r\nimport SPECS from 'game/SPECS';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { CastEvent } from 'parser/core/Events';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport { BM_CDR_PER_FOCUS, MM_SV_CDR_PER_FOCUS } from 'parser/hunter/shared/constants';\r\n\r\n/**\r\n * Every 20 (MM/SV) or 30 (BM) focus you spend reduces the remaining cooldown of Exhilaration by 1 sec.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/GWwtNLVQD8adn6q9#fight=5&type=summary&source=18\r\n */\r\n\r\nclass NaturalMending extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n  };\r\n  cdrPerFocus = MM_SV_CDR_PER_FOCUS;\r\n  effectiveExhilReductionMs = 0;\r\n  wastedExhilReductionMs = 0;\r\n  lastFocusCost = 0;\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.NATURAL_MENDING_TALENT.id);\r\n    if (this.active && this.selectedCombatant.spec === SPECS.BEAST_MASTERY_HUNTER) {\r\n      this.cdrPerFocus = BM_CDR_PER_FOCUS;\r\n    }\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER), this.onCast);\r\n  }\r\n\r\n  onCast(event: CastEvent) {\r\n    const resource = event.classResources?.find(resource => resource.type === RESOURCE_TYPES.FOCUS.id);\r\n    if (!resource) {\r\n      return;\r\n    }\r\n\r\n    this.lastFocusCost = resource.cost || 0;\r\n    const cooldownReductionMS = this.cdrPerFocus * this.lastFocusCost;\r\n    if (!this.spellUsable.isOnCooldown(SPELLS.EXHILARATION.id)) {\r\n      this.wastedExhilReductionMs += cooldownReductionMS;\r\n      return;\r\n    }\r\n    if (this.spellUsable.cooldownRemaining(SPELLS.EXHILARATION.id) < cooldownReductionMS) {\r\n      const effectiveReductionMs = this.spellUsable.reduceCooldown(SPELLS.EXHILARATION.id, cooldownReductionMS);\r\n      this.effectiveExhilReductionMs += effectiveReductionMs;\r\n      this.wastedExhilReductionMs += (cooldownReductionMS - effectiveReductionMs);\r\n      return;\r\n    }\r\n    this.effectiveExhilReductionMs += this.spellUsable.reduceCooldown(SPELLS.EXHILARATION.id, cooldownReductionMS);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(14)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.NATURAL_MENDING_TALENT}>\r\n          <>\r\n            {formatNumber(this.effectiveExhilReductionMs / 1000)}s/{formatNumber((this.wastedExhilReductionMs + this.effectiveExhilReductionMs) / 1000)}s <small> cooldown reduction</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default NaturalMending;\r\n","import React from 'react';\r\nimport Analyzer, { Options } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport UptimeIcon from 'interface/icons/Uptime';\r\n\r\n/**\r\n * Trailblazer increases your movement speed by 30% whenever you have not\r\n * attacked for 3 seconds.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/1YZkWvbFGNgTA7L4#fight=3&type=summary&source=97\r\n */\r\nclass Trailblazer extends Analyzer {\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.TRAILBLAZER_TALENT.id);\r\n  }\r\n\r\n  get percentUptime() {\r\n    return this.selectedCombatant.getBuffUptime(SPELLS.TRAILBLAZER_BUFF.id) / this.owner.fightDuration;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(14)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.TRAILBLAZER_TALENT}>\r\n          <>\r\n            <UptimeIcon /> {formatPercentage(this.percentUptime)}% <small>uptime</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Trailblazer;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\n\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport Abilities from 'parser/core/modules/Abilities';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { AnyEvent, DamageEvent } from 'parser/core/Events';\r\nimport { AMOC_BASE_DURATION, AMOC_TICK_RATE, MS_BUFFER } from 'parser/hunter/shared/constants';\r\n\r\n/**\r\n * Summons a flock of crows to attack your target over the next 15 sec. If the target dies while under attack, A Murder of Crows' cooldown is reset.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/GFM9qZQy63zbxh7L#fight=49&type=damage-done&source=299&ability=131900\r\n */\r\n\r\nconst debug = false;\r\n\r\nclass AMurderOfCrows extends Analyzer {\r\n\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n    abilities: Abilities,\r\n  };\r\n  damage = 0;\r\n  casts = 0;\r\n  applicationTimestamp: number = 0;\r\n  lastDamageTick: number = 0;\r\n  crowsEndingTimestamp: number = 0;\r\n  maxCasts = 0;\r\n  resets = 0;\r\n  protected spellUsable!: SpellUsable;\r\n  protected abilities!: Abilities;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.A_MURDER_OF_CROWS_TALENT.id);\r\n    if (this.active) {\r\n      (options.abilities as Abilities).add({\r\n        spell: SPELLS.A_MURDER_OF_CROWS_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        cooldown: 60,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.85,\r\n          maxCasts: () => this.maxCasts,\r\n        },\r\n      });\r\n    }\r\n    this.addEventListener(Events.any, this.checkForReset);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.A_MURDER_OF_CROWS_TALENT), this.onCast);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.A_MURDER_OF_CROWS_DEBUFF), this.onDamage);\r\n    this.addEventListener(Events.fightend, this.adjustMaxCasts);\r\n  }\r\n\r\n  checkForReset(event: AnyEvent) {\r\n    // Checks if we've had atleast 1 damage tick of the currently applied crows, and checks that crows is in fact on cooldown.\r\n    if (this.lastDamageTick && this.spellUsable.isOnCooldown(SPELLS.A_MURDER_OF_CROWS_TALENT.id)\r\n      // Checks whether the current damage event happened while the time passed since crows application is less than the crows duration\r\n      && this.applicationTimestamp && event.timestamp < this.crowsEndingTimestamp\r\n      // Checks to see if more than 1 second has passed since last tick\r\n      && event.timestamp > this.lastDamageTick + AMOC_TICK_RATE + MS_BUFFER) {\r\n      // If more than 1 second has passed and less than the duration has elapsed, we can assume that crows has been reset, and thus we reset the CD.\r\n      this.spellUsable.endCooldown(SPELLS.A_MURDER_OF_CROWS_TALENT.id, false, event.timestamp);\r\n      this.maxCasts += 1;\r\n      this.resets += 1;\r\n      debug && this.log('Crows was reset');\r\n    }\r\n  }\r\n\r\n  onCast() {\r\n    this.casts += 1;\r\n    this.applicationTimestamp = 0;\r\n    this.lastDamageTick = 0;\r\n  }\r\n\r\n  onDamage(event: DamageEvent) {\r\n    if (this.casts === 0) {\r\n      this.casts += 1;\r\n      this.spellUsable.beginCooldown(SPELLS.A_MURDER_OF_CROWS_TALENT.id, event);\r\n      this.applicationTimestamp = this.owner.fight.start_time;\r\n    }\r\n    //This accounts for the travel time of crows, since the first damage marks the time where the crows debuff is applied\r\n    if (this.lastDamageTick === 0 && this.applicationTimestamp === 0) {\r\n      this.applicationTimestamp = event.timestamp;\r\n      this.crowsEndingTimestamp = this.applicationTimestamp + AMOC_BASE_DURATION;\r\n    }\r\n    this.lastDamageTick = event.timestamp;\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  adjustMaxCasts() {\r\n    this.maxCasts += Math.ceil(this.owner.fightDuration / 60000);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.A_MURDER_OF_CROWS_TALENT}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} /><br />\r\n            {this.resets} <small>resets</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default AMurderOfCrows;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport React from 'react';\r\nimport SPECS from 'game/SPECS';\r\nimport { formatNumber } from 'common/format';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { CastEvent } from 'parser/core/Events';\r\nimport { BASELINE_TURTLE_CHEETAH_CD, BORN_TO_BE_WILD_AFFECTED_SPELLS } from 'parser/hunter/shared/constants';\r\nimport { BASELINE_AOTE_CD } from 'parser/hunter/survival/constants';\r\n\r\n/**\r\n * Reduces the cooldowns of Aspect of the Cheetah and Aspect of the Turtle by 20%.\r\n * For Survival it also reduces the cooldown of Aspect of the Eagle.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/1YZkWvbFGNgTA7L4#fight=3&type=summary&source=97\r\n */\r\n\r\nconst debug = false;\r\n\r\nclass BornToBeWild extends Analyzer {\r\n\r\n  _spells = {\r\n    [SPELLS.ASPECT_OF_THE_CHEETAH.id]: {\r\n      effectiveCDR: 0,\r\n      lastCast: 0,\r\n      baseCD: BASELINE_TURTLE_CHEETAH_CD,\r\n    },\r\n    [SPELLS.ASPECT_OF_THE_TURTLE.id]: {\r\n      effectiveCDR: 0,\r\n      lastCast: 0,\r\n      baseCD: BASELINE_TURTLE_CHEETAH_CD,\r\n    },\r\n    [SPELLS.ASPECT_OF_THE_EAGLE.id]: {\r\n      effectiveCDR: 0,\r\n      lastCast: 0,\r\n      baseCD: BASELINE_AOTE_CD,\r\n    },\r\n  };\r\n\r\n  hasEagle = false;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.BORN_TO_BE_WILD_TALENT.id);\r\n    this.hasEagle = this.selectedCombatant.spec === SPECS.SURVIVAL_HUNTER;\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(BORN_TO_BE_WILD_AFFECTED_SPELLS), this.onCast);\r\n  }\r\n\r\n  get effectiveTotalCDR() {\r\n    return Object.values(this._spells)\r\n      .map(spell => spell.effectiveCDR)\r\n      .reduce((total, current) => total + current, 0);\r\n  }\r\n\r\n  onCast(event: CastEvent) {\r\n    const spellId = event.ability.guid;\r\n    const spell = this._spells[spellId];\r\n    debug && console.log(event.timestamp, `${SPELLS[spellId].name} cast - time since last cast: `, spell.lastCast !== 0 ? (event.timestamp - spell.lastCast) / 1000 : 'no previous cast');\r\n    if (spell.lastCast && event.timestamp < spell.lastCast + spell.baseCD) {\r\n      spell.effectiveCDR += spell.baseCD - (event.timestamp - spell.lastCast);\r\n    }\r\n    spell.lastCast = event.timestamp;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(14)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        tooltip={(\r\n          <>\r\n            Effective CDR constitutes the time that was left of the original CD (before reduction from Born To Be Wild) when you cast it again as that is the effective cooldown reduction it provided for you.\r\n            <ul>\r\n              {this.hasEagle &&\r\n              <li>Aspect of the Eagle: {formatNumber(this._spells[SPELLS.ASPECT_OF_THE_EAGLE.id].effectiveCDR / 1000)}s</li>}\r\n              <li>Aspect of the Cheetah: {formatNumber(this._spells[SPELLS.ASPECT_OF_THE_CHEETAH.id].effectiveCDR / 1000)}s</li>\r\n              <li>Aspect of the Turtle: {formatNumber(this._spells[SPELLS.ASPECT_OF_THE_TURTLE.id].effectiveCDR / 1000)}s</li>\r\n            </ul>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.BORN_TO_BE_WILD_TALENT}>\r\n          <>\r\n            {formatNumber(this.effectiveTotalCDR / 1000)}s <small>total effective CDR</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default BornToBeWild;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport React from 'react';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events from 'parser/core/Events';\r\nimport SPECS from 'game/SPECS';\r\nimport Abilities from 'parser/core/modules/Abilities';\r\n\r\n/**\r\n * Fires a magical projectile, tethering the enemy and any other enemies within\r\n * 5 yards for 10 sec, rooting them in place for 5 sec if they move more than 5\r\n * yards from the arrow. Example log:\r\n * https://www.warcraftlogs.com/reports/qZRdFv9Apg74wmMV#fight=3&type=damage-done\r\n */\r\n\r\nclass BindingShot extends Analyzer {\r\n\r\n  static dependencies = {\r\n    abilities: Abilities,\r\n  };\r\n  _roots = 0;\r\n  _applications = 0;\r\n  _casts = 0;\r\n  category: STATISTIC_CATEGORY;\r\n  protected abilities!: Abilities;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.BINDING_SHOT_TALENT.id) || this.selectedCombatant.spec === SPECS.MARKSMANSHIP_HUNTER;\r\n    this.category = this.selectedCombatant.spec === SPECS.MARKSMANSHIP_HUNTER ? STATISTIC_CATEGORY.GENERAL : STATISTIC_CATEGORY.TALENTS;\r\n    this.addEventListener(Events.applydebuff.by(SELECTED_PLAYER).spell(SPELLS.BINDING_SHOT_ROOT), this.onRoot);\r\n    this.addEventListener(Events.applydebuff.by(SELECTED_PLAYER).spell(SPELLS.BINDING_SHOT_TETHER), this.onTether);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.BINDING_SHOT_TALENT), this.onCast);\r\n    if (this.active) {\r\n      (options.abilities as Abilities).add({\r\n        spell: SPELLS.BINDING_SHOT_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 45,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  onTether() {\r\n    this._applications += 1;\r\n  }\r\n\r\n  onRoot() {\r\n    this._roots += 1;\r\n  }\r\n\r\n  onCast() {\r\n    this._casts += 1;\r\n  }\r\n\r\n  statistic() {\r\n    if (this._casts > 0) {\r\n      return (\r\n        <Statistic\r\n          position={STATISTIC_ORDER.OPTIONAL(14)}\r\n          size=\"flexible\"\r\n          category={this.category}\r\n        >\r\n          <BoringSpellValueText spell={SPELLS.BINDING_SHOT_TALENT}>\r\n            <>\r\n              {this._roots} <small>roots</small> / {this._applications} <small>possible</small> <br />\r\n              {this._casts} <small>casts</small>\r\n            </>\r\n          </BoringSpellValueText>\r\n        </Statistic>\r\n      );\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n\r\nexport default BindingShot;\r\n","import React from 'react';\r\n\r\nimport { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Abilities from 'parser/core/modules/Abilities';\r\nimport SPELLS from 'common/SPELLS';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport Events from 'parser/core/Events';\r\nimport { KILL_SHOT_EXECUTE_RANGE } from 'parser/hunter/shared/constants';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport SPECS from 'game/SPECS';\r\nimport ExecuteHelper from 'parser/shared/ExecuteHelper';\r\nimport FlayedShot from 'parser/hunter/shared/modules/spells/covenants/venthyr/FlayedShot';\r\n\r\nclass KillShot extends ExecuteHelper {\r\n  static executeSources = SELECTED_PLAYER;\r\n  static lowerThreshold = KILL_SHOT_EXECUTE_RANGE;\r\n  static executeOutsideRangeEnablers = [SPELLS.FLAYERS_MARK];\r\n  static modifiesDamage = false;\r\n\r\n  static dependencies = {\r\n    ...ExecuteHelper.dependencies,\r\n    abilities: Abilities,\r\n    flayedShot: FlayedShot,\r\n  };\r\n\r\n  maxCasts: number = 0;\r\n  activeKillShotSpell = this.selectedCombatant.spec === SPECS.SURVIVAL_HUNTER ? SPELLS.KILL_SHOT_SV : SPELLS.KILL_SHOT_MM_BM;\r\n\r\n  protected abilities!: Abilities;\r\n  protected flayedShot!: FlayedShot;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.fightend, this.adjustMaxCasts);\r\n    const ctor = this.constructor as typeof ExecuteHelper;\r\n    ctor.executeSpells.push(this.activeKillShotSpell);\r\n\r\n    (options.abilities as Abilities).add({\r\n      spell: this.activeKillShotSpell,\r\n      category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n      charges: this.selectedCombatant.hasTalent(SPELLS.DEAD_EYE_TALENT.id) ? 2 : 1,\r\n      cooldown: 10,\r\n      gcd: {\r\n        base: 1500,\r\n      },\r\n      castEfficiency: {\r\n        suggestion: true,\r\n        recommendedEfficiency: 0.85,\r\n        maxCasts: () => this.maxCasts,\r\n      },\r\n    });\r\n  }\r\n\r\n  adjustMaxCasts() {\r\n    this.maxCasts += Math.ceil(this.totalExecuteDuration / 10000);\r\n    if (this.selectedCombatant.hasTalent(SPELLS.DEAD_EYE_TALENT.id)) {\r\n      this.maxCasts += 1;\r\n    }\r\n    this.maxCasts += this.flayedShot.totalProcs;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.GENERAL}\r\n      >\r\n        <BoringSpellValueText spell={this.activeKillShotSpell}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} />\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default KillShot;\r\n","import RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\n\r\nimport SpellResourceCost from 'parser/shared/modules/SpellResourceCost';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { CastEvent } from 'parser/core/Events';\r\nimport { LNL_COST_MULTIPLIER } from 'parser/hunter/marksmanship/constants';\r\nimport { VIPERS_VENOM_COST_MULTIPLIER } from 'parser/hunter/survival/constants';\r\nimport { Options } from 'parser/core/Analyzer';\r\n\r\nclass SpellFocusCost extends SpellResourceCost {\r\n  static resourceType = RESOURCE_TYPES.FOCUS;\r\n\r\n  lockAndLoad: boolean;\r\n  vipersVenom: boolean;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.lockAndLoad = this.selectedCombatant.hasTalent(SPELLS.LOCK_AND_LOAD_TALENT.id);\r\n    this.vipersVenom = this.selectedCombatant.hasTalent(SPELLS.VIPERS_VENOM_TALENT.id);\r\n  }\r\n\r\n  getResourceCost(event: CastEvent) {\r\n    const cost = super.getResourceCost(event);\r\n    const spellId = event.ability.guid;\r\n    if (this.lockAndLoad && this.selectedCombatant.hasBuff(SPELLS.LOCK_AND_LOAD_BUFF.id) && spellId === SPELLS.AIMED_SHOT.id) {\r\n      return cost * LNL_COST_MULTIPLIER;\r\n    }\r\n    if (this.vipersVenom && this.selectedCombatant.hasBuff(SPELLS.VIPERS_VENOM_BUFF.id) && spellId === SPELLS.SERPENT_STING_SV.id) {\r\n      return cost * VIPERS_VENOM_COST_MULTIPLIER;\r\n    }\r\n    return cost;\r\n  }\r\n}\r\n\r\nexport default SpellFocusCost;\r\n","import React from 'react';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Abilities from 'parser/core/modules/Abilities';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Enemies from 'parser/shared/modules/Enemies';\r\nimport UptimeIcon from 'interface/icons/Uptime';\r\nimport { formatNumber, formatPercentage } from 'common/format';\r\nimport CritIcon from 'interface/icons/CriticalStrike';\r\nimport { RESONATING_ARROW_CRIT_INCREASE } from 'parser/hunter/shared/constants';\r\nimport COVENANTS from 'game/shadowlands/COVENANTS';\r\n\r\nclass ResonatingArrow extends Analyzer {\r\n  static dependencies = {\r\n    abilities: Abilities,\r\n    enemies: Enemies,\r\n  };\r\n\r\n  casts: number = 0;\r\n  debuffs: number = 0;\r\n  damage = 0;\r\n\r\n  protected abilities!: Abilities;\r\n  protected enemies!: Enemies;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.active = this.selectedCombatant.hasCovenant(COVENANTS.KYRIAN.id);\r\n\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n\r\n    (options.abilities as Abilities).add({\r\n      spell: SPELLS.RESONATING_ARROW,\r\n      category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n      cooldown: 60,\r\n      gcd: {\r\n        base: 1500,\r\n      },\r\n      castEfficiency: {\r\n        suggestion: true,\r\n        recommendedEfficiency: 0.9,\r\n      },\r\n    });\r\n\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.RESONATING_ARROW), this.onCast);\r\n    this.addEventListener(Events.applydebuff.by(SELECTED_PLAYER).spell(SPELLS.RESONATING_ARROW_DEBUFF), this.onDebuff);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.RESONATING_ARROW_DAMAGE), this.onDamage);\r\n  }\r\n\r\n  get uptime() {\r\n    return this.enemies.getBuffUptime(SPELLS.RESONATING_ARROW_DEBUFF.id) / this.owner.fightDuration;\r\n  }\r\n\r\n  onCast() {\r\n    this.casts += 1;\r\n  }\r\n\r\n  onDebuff() {\r\n    this.debuffs += 1;\r\n  }\r\n\r\n  onDamage(event: DamageEvent) {\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n        tooltip={(\r\n          <>\r\n            You had {this.casts} {this.casts === 1 ? 'cast' : 'casts'} of Resonating Arrow and applied the debuff {this.debuffs} {this.debuffs === 1 ? 'time' : 'times'}.\r\n            <br />\r\n            The direct damage of Resonating Arrow did {this.damage} damage or {formatNumber((this.damage / this.owner.fightDuration) * 1000)} DPS\r\n          </>\r\n        )}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.RESONATING_ARROW}>\r\n          <>\r\n            <UptimeIcon /> {formatPercentage(this.uptime)}% <small> debuff uptime</small>\r\n            <br />\r\n            <CritIcon /> {formatPercentage(this.uptime * RESONATING_ARROW_CRIT_INCREASE)}% <small>average Critical Strike</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default ResonatingArrow;\r\n","import React from 'react';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Abilities from 'parser/core/modules/Abilities';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { DamageEvent, EnergizeEvent } from 'parser/core/Events';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport ResourceIcon from 'common/ResourceIcon';\r\nimport COVENANTS from 'game/shadowlands/COVENANTS';\r\n\r\nclass DeathChakrams extends Analyzer {\r\n  static dependencies = {\r\n    abilities: Abilities,\r\n  };\r\n\r\n  damage: number = 0;\r\n  focusGained: number = 0;\r\n  focusWasted: number = 0;\r\n\r\n  protected abilities!: Abilities;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.active = this.selectedCombatant.hasCovenant(COVENANTS.NECROLORD.id);\r\n\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n\r\n    (options.abilities as Abilities).add({\r\n      spell: SPELLS.DEATH_CHAKRAM_INITIAL_AND_AOE,\r\n      category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n      cooldown: 45,\r\n      gcd: {\r\n        base: 1500,\r\n      },\r\n      castEfficiency: {\r\n        suggestion: true,\r\n        recommendedEfficiency: 0.9,\r\n      },\r\n    });\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell([SPELLS.DEATH_CHAKRAM_SINGLE_TARGET, SPELLS.DEATH_CHAKRAM_INITIAL_AND_AOE]), this.onDamage);\r\n    this.addEventListener(Events.energize.by(SELECTED_PLAYER).spell(SPELLS.DEATH_CHAKRAM_ENERGIZE), this.onEnergize);\r\n  }\r\n\r\n  onDamage(event: DamageEvent) {\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  onEnergize(event: EnergizeEvent) {\r\n    this.focusGained += event.resourceChange;\r\n    this.focusWasted += event.waste;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.DEATH_CHAKRAM_INITIAL_AND_AOE}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} />\r\n            <br />\r\n            <ResourceIcon id={RESOURCE_TYPES.FOCUS.id} noLink /> {this.focusGained}/{this.focusWasted + this.focusGained}<small> gained Focus</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DeathChakrams;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Abilities from 'parser/core/modules/Abilities';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport React from 'react';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Enemies from 'parser/shared/modules/Enemies';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport { WILD_MARK_DAMAGE_AMP } from 'parser/hunter/shared/constants';\r\nimport { formatNumber } from 'common/format';\r\nimport COVENANTS from 'game/shadowlands/COVENANTS';\r\n\r\n/**\r\n * TODO Revisit this when Blizzard is done messing with this changing it constantly.\r\n */\r\nclass WildSpirits extends Analyzer {\r\n  static dependencies = {\r\n    abilities: Abilities,\r\n    enemies: Enemies,\r\n  };\r\n\r\n  damage: number = 0;\r\n  ampDamage: number = 0;\r\n\r\n  protected abilities!: Abilities;\r\n  protected enemies!: Enemies;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.active = this.selectedCombatant.hasCovenant(COVENANTS.NIGHT_FAE.id);\r\n\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n\r\n    (options.abilities as Abilities).add({\r\n      spell: SPELLS.WILD_SPIRITS,\r\n      category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n      cooldown: 120,\r\n      gcd: {\r\n        base: 1500,\r\n      },\r\n      castEfficiency: {\r\n        suggestion: true,\r\n        recommendedEfficiency: 0.9,\r\n      },\r\n    });\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell([SPELLS.WILD_SPIRITS_DAMAGE, SPELLS.WILD_SPIRITS_DAMAGE_AOE]), this.onWildSpiritsDamage);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER), this.onDamage);\r\n  }\r\n\r\n  onWildSpiritsDamage(event: DamageEvent) {\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  onDamage(event: DamageEvent) {\r\n    const enemy = this.enemies.getEntity(event);\r\n    if (!enemy || !enemy.hasBuff(SPELLS.WILD_MARK.id)) {\r\n      return;\r\n    }\r\n    this.ampDamage += calculateEffectiveDamage(event, WILD_MARK_DAMAGE_AMP);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.WILD_SPIRITS}>\r\n          <>\r\n            <img src=\"/img/sword.png\" alt=\"Damage\" className=\"icon\" />{' '}\r\n            {formatNumber(this.damage)} <small> direct damage</small>\r\n            <br />\r\n            <img src=\"/img/sword.png\" alt=\"Damage\" className=\"icon\" />{' '}\r\n            {formatNumber(this.damage)} <small> Wild Mark damage</small>\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default WildSpirits;\r\n","import React from 'react';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport { ENFEEBLED_MARK_DAMAGE_INCREASE } from 'parser/hunter/shared/constants';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport SPELLS from 'common/SPELLS';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport Enemies from 'parser/shared/modules/Enemies';\r\nimport COVENANTS from 'game/shadowlands/COVENANTS';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\n\r\n/**\r\n * Your attacks and abilities deal 5.0% increased damage to enemies inside Resonating Arrow.\r\n *\r\n * Example log:\r\n *\r\n */\r\nclass EnfeebledMark extends Analyzer {\r\n  static dependencies = {\r\n    enemies: Enemies,\r\n  };\r\n\r\n  conduitRank: number = 0;\r\n  addedDamage: number = 0;\r\n\r\n  protected enemies!: Enemies;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasCovenant(COVENANTS.KYRIAN.id) && this.selectedCombatant.hasConduitBySpellID(SPELLS.ENFEEBLED_MARK_CONDUIT.id);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.ENFEEBLED_MARK_CONDUIT.id);\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER | SELECTED_PLAYER_PET), this.onGenericDamage);\r\n  }\r\n\r\n  onGenericDamage(event: DamageEvent) {\r\n    const enemy = this.enemies.getEntity(event);\r\n    if (!enemy || !enemy.hasBuff(SPELLS.RESONATING_ARROW_DEBUFF.id)) {\r\n      return;\r\n    }\r\n    this.addedDamage += calculateEffectiveDamage(event, ENFEEBLED_MARK_DAMAGE_INCREASE[this.conduitRank]);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.ENFEEBLED_MARK_CONDUIT} rank={this.conduitRank}>\r\n          <>\r\n            <ItemDamageDone amount={this.addedDamage} />\r\n          </>\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default EnfeebledMark;\r\n","import React from 'react';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport { EMPOWERED_RELEASE_INCREASE_KS_DAMAGE, EMPOWERED_RELEASE_INCREASED_FLAYED_PROC_CHANCE, FLAYED_SHOT_RESET_CHANCE } from 'parser/hunter/shared/constants';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport SPELLS from 'common/SPELLS';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport COVENANTS from 'game/shadowlands/COVENANTS';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\n\r\n/**\r\n * Flayed Shot has an additional 5% chance to pro Flayer's Mark\r\n * Flayer's Mark increases the damage of your next Kill Shot by 5.0%.\r\n *\r\n * Example log:\r\n *\r\n */\r\nclass EmpoweredRelease extends Analyzer {\r\n\r\n  flayersMarkProcs: number = 0;\r\n  aggregatedContribution: number = 0;\r\n  conduitRank: number = 0;\r\n  addedDamage: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasCovenant(COVENANTS.VENTHYR.id) && this.selectedCombatant.hasConduitBySpellID(SPELLS.EMPOWERED_RELEASE_CONDUIT.id);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.EMPOWERED_RELEASE_CONDUIT.id);\r\n\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.FLAYERS_MARK), this.flayedShotProc);\r\n    this.addEventListener(Events.refreshbuff.by(SELECTED_PLAYER).spell(SPELLS.FLAYERS_MARK), this.flayedShotProc);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell([SPELLS.KILL_SHOT_SV, SPELLS.KILL_SHOT_MM_BM]), this.onKillShotDamage);\r\n  }\r\n\r\n  get averageContributionPercentage() {\r\n    return this.aggregatedContribution / this.flayersMarkProcs;\r\n  }\r\n\r\n  get averageContributionAbsolute() {\r\n    return Math.round(this.averageContributionPercentage * this.flayersMarkProcs);\r\n  }\r\n\r\n  flayedShotProc() {\r\n    this.aggregatedContribution += EMPOWERED_RELEASE_INCREASED_FLAYED_PROC_CHANCE / (FLAYED_SHOT_RESET_CHANCE + EMPOWERED_RELEASE_INCREASED_FLAYED_PROC_CHANCE);\r\n    this.flayersMarkProcs += 1;\r\n  }\r\n\r\n  onKillShotDamage(event: DamageEvent) {\r\n    if (!this.selectedCombatant.hasBuff(SPELLS.EMPOWERED_RELEASE_BUFF.id)) {\r\n      return;\r\n    }\r\n    this.addedDamage += calculateEffectiveDamage(event, EMPOWERED_RELEASE_INCREASE_KS_DAMAGE[this.conduitRank]);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.EMPOWERED_RELEASE_CONDUIT} rank={this.conduitRank}>\r\n          <>\r\n             {this.averageContributionAbsolute} <small> additional procs </small>\r\n            <ItemDamageDone amount={this.addedDamage} />\r\n          </>\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default EmpoweredRelease;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { DamageEvent, EnergizeEvent } from 'parser/core/Events';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport React from 'react';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport { NECROTIC_BARRAGE_DAMAGE_INCREASE } from 'parser/hunter/shared/constants';\r\nimport COVENANTS from 'game/shadowlands/COVENANTS';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\n\r\n/**\r\n * Death Chakram generates an additional 2 Focus and the damage is increased by 5.0%.\r\n *\r\n * Example log\r\n *\r\n */\r\nclass NecroticBarrage extends Analyzer {\r\n\r\n  conduitRank: number = 0;\r\n  gainedFocus: number = 0;\r\n  wastedFocus: number = 0;\r\n  addedDamage: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasCovenant(COVENANTS.NECROLORD.id) && this.selectedCombatant.hasConduitBySpellID(SPELLS.NECROTIC_BARRAGE_CONDUIT.id);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.NECROTIC_BARRAGE_CONDUIT.id);\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell([SPELLS.DEATH_CHAKRAM_SINGLE_TARGET, SPELLS.DEATH_CHAKRAM_INITIAL_AND_AOE]), this.onDeathChakramDamage);\r\n    this.addEventListener(Events.energize.by(SELECTED_PLAYER).spell(SPELLS.DEATH_CHAKRAM_ENERGIZE), this.onEnergize);\r\n  }\r\n\r\n  onDeathChakramDamage(event: DamageEvent) {\r\n    this.addedDamage += calculateEffectiveDamage(event, NECROTIC_BARRAGE_DAMAGE_INCREASE[this.conduitRank]);\r\n  }\r\n\r\n  onEnergize(event: EnergizeEvent) {\r\n    this.gainedFocus += event.resourceChange;\r\n    this.wastedFocus += event.waste;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.NECROTIC_BARRAGE_CONDUIT} rank={this.conduitRank}>\r\n          <>\r\n            <ItemDamageDone amount={this.addedDamage} />\r\n            {this.gainedFocus}/{this.gainedFocus + this.wastedFocus} <small>gained focus</small>\r\n          </>\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default NecroticBarrage;\r\n","import Events, { CastEvent, DamageEvent } from 'parser/core/Events';\r\nimport { SELECTED_PLAYER } from 'parser/core/EventFilter';\r\nimport Analyzer, { Options } from 'parser/core/Analyzer';\r\nimport calculateEffectiveDamage from 'parser/core/calculateEffectiveDamage';\r\nimport { SPIRIT_ATTUNEMENT_DAMAGE_INCREASE, WILD_MARK_DAMAGE_AMP, WILD_SPIRITS_BASELINE_DURATION } from 'parser/hunter/shared/constants';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport React from 'react';\r\nimport { formatThousands } from 'common/format';\r\nimport COVENANTS from 'game/shadowlands/COVENANTS';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\n\r\n/**\r\n * Wild Spirits duration is increased by 3 sec and the damage dealt is increased by 10.0%.\r\n *\r\n * Example log\r\n *\r\n */\r\nclass SpiritAttunement extends Analyzer {\r\n\r\n  conduitRank: number = 0;\r\n  addedDamage: number = 0;\r\n  wildSpiritsCast: number = 0;\r\n  damageAfterOriginalDuration: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasCovenant(COVENANTS.NIGHT_FAE.id) && this.selectedCombatant.hasConduitBySpellID(SPELLS.SPIRIT_ATTUNEMENT_CONDUIT.id);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.SPIRIT_ATTUNEMENT_CONDUIT.id);\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell([SPELLS.WILD_SPIRITS_DAMAGE, SPELLS.WILD_SPIRITS_DAMAGE_AOE]), this.onWildSpiritsDamage);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER), this.onGenericDamage);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.WILD_SPIRITS), this.onWildSpiritsCast);\r\n  }\r\n\r\n  onWildSpiritsCast(event: CastEvent) {\r\n    this.wildSpiritsCast = event.timestamp;\r\n  }\r\n\r\n  onWildSpiritsDamage(event: DamageEvent) {\r\n    this.addedDamage += calculateEffectiveDamage(event, SPIRIT_ATTUNEMENT_DAMAGE_INCREASE[this.conduitRank]);\r\n\r\n    if (event.timestamp > this.wildSpiritsCast + WILD_SPIRITS_BASELINE_DURATION) {\r\n      this.damageAfterOriginalDuration += event.amount + (event.absorbed || 0);\r\n    }\r\n  }\r\n\r\n  onGenericDamage(event: DamageEvent) {\r\n    if (event.timestamp > this.wildSpiritsCast + WILD_SPIRITS_BASELINE_DURATION) {\r\n      this.damageAfterOriginalDuration += calculateEffectiveDamage(event, WILD_MARK_DAMAGE_AMP);\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n        tooltip={(\r\n          <>\r\n            After the original duration of Wild Spirits, Spirit Attunment contributed with {formatThousands(this.damageAfterOriginalDuration)}\r\n          </>\r\n        )}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.SPIRIT_ATTUNEMENT_CONDUIT} rank={this.conduitRank}>\r\n          <>\r\n            <ItemDamageDone amount={this.addedDamage} />\r\n            {formatThousands(this.damageAfterOriginalDuration)} <small>damage after normal duration</small>\r\n          </>\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default SpiritAttunement;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport React from 'react';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { CastEvent, DamageEvent } from 'parser/core/Events';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport SpellIcon from 'common/SpellIcon';\r\n\r\n/**\r\n * Launching a Flare into your Tar Trap causes all enemies inside of the Tar Trap to burn for (150% of Attack power) Fire damage over 12 sec.\r\n *\r\n * Example log:\r\n *\r\n */\r\nclass SoulforgeEmbers extends Analyzer {\r\n\r\n  damage: number = 0;\r\n  flareCasts: number = 0;\r\n  lastFlareCastTimestamp: number = 0;\r\n  tarTrapCasts: number = 0;\r\n  lastTarTrapCastTimestamp: number = 0;\r\n  lostEmberApplications: number = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasLegendaryByBonusID(SPELLS.SOULFORGE_EMBERS_EFFECT.bonusID);\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.FLARE), this.onFlare);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.TAR_TRAP), this.onTarTrap);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.SOULFORGE_EMBERS_DAMAGE), this.onEmbersDamage);\r\n  }\r\n\r\n  onFlare(event: CastEvent) {\r\n    this.flareCasts += 1;\r\n    this.lastFlareCastTimestamp = event.timestamp;\r\n  }\r\n\r\n  onTarTrap(event: CastEvent) {\r\n    this.tarTrapCasts += 1;\r\n    this.lastTarTrapCastTimestamp = event.timestamp;\r\n  }\r\n\r\n  onEmbersDamage(event: DamageEvent) {\r\n    this.damage += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.CORE()}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.ITEMS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.SOULFORGE_EMBERS_EFFECT}>\r\n          <ItemDamageDone amount={this.damage} />\r\n          <br />\r\n          {this.flareCasts} <SpellIcon id={SPELLS.FLARE.id} noLink /> / {this.tarTrapCasts} <SpellIcon id={SPELLS.TAR_TRAP.id} noLink />\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default SoulforgeEmbers;\r\n","import Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport DonutChart from 'interface/statistics/components/DonutChart';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport Events, { CastEvent } from 'parser/core/Events';\r\nimport ResourceLink from 'common/ResourceLink';\r\nimport { formatNumber } from 'common/format';\r\n\r\nimport Spell from 'common/SPELLS/Spell';\r\n\r\nimport React from 'react';\r\n\r\nclass ResourceUsage extends Analyzer {\r\n\r\n  //region IMPLEMENTME statics\r\n  /**\r\n   * One of the types from game/RESOURCE_TYPES\r\n   */\r\n  static resourceType: { id: number, name: string, icon: string, url: string };\r\n\r\n  /**\r\n   * Array of objects from common/SPELLS\r\n   */\r\n  static listOfResourceSpenders: Spell[] = [];\r\n\r\n  /**\r\n   * We might want some spells to show as other spells, if some buff can alter their spellID, but the spell is otherwise essentially the same.\r\n   * An example of this can be Mongoose Bite and Raptor Strike for Survival that gain a different spellID when\r\n   * Example format\r\n   * [SPELLS.RAPTOR_STRIKE_AOTE.id]: SPELLS.RAPTOR_STRIKE,\r\n   */\r\n  static spellsThatShouldShowAsOtherSpells: { [spellID: number]: { guid: number, name: string, abilityIcon: string, type: number } } = {};\r\n  //endregion\r\n\r\n  //region Optional IMPLEMENTME statics\r\n  /**\r\n   * String representations of hex colour codes\r\n   * Only replace if you want different colours, or need more colours (even utilising all 7 will lead to a very ugly chart and potential spell names overflowing out of the statistic box)\r\n   */\r\n  static listOfDefaultColours: string[] = [\r\n    '#ecd1b6',\r\n    '#abff3d',\r\n    '#ecda4c',\r\n    '#ff7d0a',\r\n    '#4ce4ec',\r\n    '#8b8dec',\r\n    '#00ec62',\r\n  ];\r\n\r\n  /**\r\n   * If you want to change where this module is shown, change this static.\r\n   */\r\n  static statisticOrder = STATISTIC_ORDER.CORE(12);\r\n  //endregion\r\n\r\n  listOfSpellsUsed: { [key: string]: { casts: number, resourceUsed: number } } = {};\r\n  ctor = this.constructor as typeof ResourceUsage;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(this.resourceSpenders), this.onCast);\r\n  }\r\n\r\n  get resourceSpenders() {\r\n    return this.ctor.listOfResourceSpenders;\r\n  }\r\n\r\n  get resourceTypeID() {\r\n    return this.ctor.resourceType.id;\r\n  }\r\n\r\n  get resourceTypeName() {\r\n    return this.ctor.resourceType.name;\r\n  }\r\n\r\n  get listOfDefaultColours() {\r\n    return this.ctor.listOfDefaultColours;\r\n  }\r\n\r\n  get spellsThatShouldShowAsOtherSpells() {\r\n    return this.ctor.spellsThatShouldShowAsOtherSpells;\r\n  }\r\n\r\n  get resourceUsageStatisticOrder() {\r\n    return this.ctor.statisticOrder;\r\n  }\r\n\r\n  onCast(event: CastEvent) {\r\n    //shouldn't really happen unless something messed up in the log where the cast event doesn't have any class resource information so we skip those.\r\n    if (!event.classResources) {\r\n      return;\r\n    }\r\n    let spellID = event.ability.guid;\r\n    if (this.spellsThatShouldShowAsOtherSpells[spellID]) {\r\n      event.ability = this.spellsThatShouldShowAsOtherSpells[spellID];\r\n      spellID = event.ability.guid;\r\n    }\r\n\r\n    const resource = event.classResources?.find(resource => resource.type === this.resourceTypeID);\r\n    if (!resource) {\r\n      return;\r\n    }\r\n\r\n    if (!this.listOfSpellsUsed[spellID]) {\r\n      this.listOfSpellsUsed[spellID] = {\r\n        casts: 0,\r\n        resourceUsed: 0,\r\n      };\r\n    }\r\n\r\n    this.listOfSpellsUsed[spellID].casts += 1;\r\n    this.listOfSpellsUsed[spellID].resourceUsed += resource.cost || 0;\r\n  }\r\n\r\n  makeResourceUsageTooltip(spell: { casts: number; resourceUsed: number }) {\r\n    return (\r\n      <>\r\n        {spell.casts} casts\r\n        <br />\r\n        {formatNumber(spell.resourceUsed)} {this.resourceTypeName} spent\r\n      </>\r\n    );\r\n  }\r\n\r\n  sortResourceUsage(a: { value: number; }, b: { value: number; }) {\r\n    let comparison = 0;\r\n    if (a.value > b.value) {\r\n      comparison = -1;\r\n    } else if (a.value < b.value) {\r\n      comparison = 1;\r\n    }\r\n    return comparison;\r\n  }\r\n\r\n  get resourceUsageChart() {\r\n    const items: Array<{ color: string, label: string, spellId: number, value: number, valueTooltip: JSX.Element }> = [];\r\n    let colourIndex = 0;\r\n    this.resourceSpenders.forEach(spell => {\r\n      if (this.listOfSpellsUsed[spell.id] && this.listOfSpellsUsed[spell.id].resourceUsed > 0) {\r\n        items.push({\r\n          color: this.listOfDefaultColours[colourIndex],\r\n          label: spell.name,\r\n          spellId: spell.id,\r\n          value: Math.round(this.listOfSpellsUsed[spell.id].resourceUsed),\r\n          valueTooltip: this.makeResourceUsageTooltip(this.listOfSpellsUsed[spell.id]),\r\n        });\r\n        colourIndex += 1;\r\n      }\r\n    });\r\n\r\n    items.sort(this.sortResourceUsage);\r\n\r\n    return (\r\n      <DonutChart\r\n        items={items}\r\n      />\r\n    );\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic position={this.resourceUsageStatisticOrder}>\r\n        <div className=\"pad\">\r\n          <label><ResourceLink id={this.resourceTypeID} /> usage</label>\r\n          {this.resourceUsageChart}\r\n        </div>\r\n\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default ResourceUsage;\r\n","import ResourceUsage from 'parser/shared/modules/resources/ResourceUsage';\r\nimport { LIST_OF_FOCUS_SPENDERS_SHARED } from 'parser/hunter/shared/constants';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport Spell from 'common/SPELLS/Spell';\r\n\r\nclass FocusUsage extends ResourceUsage {\r\n\r\n  static resourceType = RESOURCE_TYPES.FOCUS;\r\n\r\n  static listOfResourceSpenders: Spell[] = [\r\n    ...LIST_OF_FOCUS_SPENDERS_SHARED,\r\n  ];\r\n\r\n}\r\n\r\nexport default FocusUsage;\r\n","import React from 'react';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport SPELLS from 'common/SPELLS';\r\nimport ItemDamageDone from 'interface/ItemDamageDone';\r\nimport AverageTargetsHit from 'interface/others/AverageTargetsHit';\r\nimport { encodeTargetString } from 'parser/shared/modules/EnemyInstances';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport { BARRAGE_HITS_PER_CAST } from 'parser/hunter/shared/constants';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\n/**\r\n * Rapidly fires a spray of shots for 3 sec, dealing an average of (80% * 10)\r\n * Physical damage to all enemies in front of you. Usable while moving.\r\n *\r\n * Example log:\r\n * https://www.warcraftlogs.com/reports/wPdQLfFnhTVYRyJm#fight=12&type=damage-done&source=640&ability=120361\r\n */\r\nclass Barrage extends Analyzer {\r\n  damage = 0;\r\n  casts: Array<{ averageHits: number, hits: number }> = [];\r\n  hits = 0;\r\n  uniqueTargets: string[] = [];\r\n  uniqueTargetsHit = 0;\r\n  inefficientCasts = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.BARRAGE_TALENT.id);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.BARRAGE_TALENT), this.onCast);\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER).spell(SPELLS.BARRAGE_DAMAGE), this.onDamage);\r\n    this.addEventListener(Events.fightend, this.calculateAverageHits);\r\n  }\r\n\r\n  get currentCast() {\r\n    if (this.casts.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    return this.casts[this.casts.length - 1];\r\n  }\r\n\r\n  get barrageInefficientCastsThreshold() {\r\n    return {\r\n      actual: this.inefficientCasts,\r\n      isGreaterThan: {\r\n        minor: 0,\r\n        average: 0,\r\n        major: 1,\r\n      },\r\n      style: ThresholdStyle.NUMBER,\r\n    };\r\n  }\r\n\r\n  onCast() {\r\n    this.casts.push({ hits: 0, averageHits: 0 });\r\n    this.uniqueTargets = [];\r\n  }\r\n\r\n  onDamage(event: DamageEvent) {\r\n    const damageTarget = encodeTargetString(event.targetID, event.targetInstance);\r\n    if (!this.uniqueTargets.includes(damageTarget)) {\r\n      this.uniqueTargetsHit += 1;\r\n      this.uniqueTargets.push(damageTarget);\r\n    }\r\n    const damage = event.amount + (event.absorbed || 0);\r\n    if (this.currentCast !== null) {\r\n      this.currentCast.hits += 1;\r\n    }\r\n    this.hits += 1;\r\n    this.damage += damage;\r\n  }\r\n\r\n  calculateAverageHits() {\r\n    this.casts.forEach((cast: { averageHits: number, hits: number }) => {\r\n      cast.averageHits = cast.hits / BARRAGE_HITS_PER_CAST;\r\n      if (cast.averageHits < 1) {\r\n        this.inefficientCasts += 1;\r\n      }\r\n    });\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.barrageInefficientCastsThreshold).addSuggestion((suggest, actual, recommended) => suggest(<>You cast <SpellLink id={SPELLS.BARRAGE_TALENT.id} /> inefficiently {actual} {actual > 1 ? 'times' : 'time'} throughout the fight. This means you didn't hit all {BARRAGE_HITS_PER_CAST} shots of your barrage channel. Remember to always be facing your target when channelling <SpellLink id={SPELLS.BARRAGE_TALENT.id} />. </>)\r\n      .icon(SPELLS.BARRAGE_TALENT.icon)\r\n      .actual(i18n._(t('hunter.shared.suggestions.barrage.efficiency')`${actual} inefficient ${actual > 1 ? 'casts' : 'cast'}`))\r\n      .recommended(`${recommended} is recommended`));\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(20)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.BARRAGE_TALENT}>\r\n          <>\r\n            <ItemDamageDone amount={this.damage} /> <br />\r\n            <AverageTargetsHit casts={this.casts.length} hits={this.hits} /><br />\r\n            <AverageTargetsHit casts={this.casts.length} hits={this.uniqueTargetsHit} unique />\r\n          </>\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Barrage;\r\n"],"sourceRoot":""}