{"version":3,"sources":["interface/others/Feeding.js","parser/shaman/restoration/modules/core/HealingEfficiencyDetails.tsx","parser/shaman/restoration/modules/core/HealingDone.ts","parser/shaman/restoration/modules/core/RestorationAbilityTracker.ts","parser/shaman/restoration/modules/spells/ManaTideTotem.tsx","parser/shaman/restoration/modules/spells/WaterShield.tsx","parser/shaman/restoration/modules/spells/Resurgence.tsx","parser/shaman/restoration/modules/features/CooldownThroughputTracker.js","parser/shaman/restoration/modules/talents/UnleashLife.tsx","parser/shaman/restoration/modules/core/HealingEfficiencyTracker.ts","parser/shaman/restoration/modules/Abilities.ts","parser/shaman/restoration/modules/core/HealingRainLocation.tsx","parser/shaman/restoration/modules/features/MasteryEffectiveness.js","parser/shaman/restoration/modules/features/AlwaysBeCasting.ts","parser/shaman/restoration/modules/spells/ChainHeal.tsx","parser/shaman/restoration/modules/spells/HealingRain.tsx","parser/shaman/restoration/modules/spells/EarthShield.ts","parser/shaman/restoration/modules/talents/Wellspring.tsx","parser/shaman/restoration/modules/talents/EarthenWallTotem.tsx","parser/shaman/restoration/modules/talents/SurgeOfEarth.tsx","parser/shaman/restoration/modules/features/checklist/Component.tsx","parser/shaman/restoration/modules/features/checklist/Module.tsx","parser/shaman/restoration/modules/features/SpellUsable.ts","parser/shaman/restoration/modules/features/StatValuesSpellInfo.ts","parser/shaman/restoration/modules/features/StatValues.js","parser/shaman/restoration/modules/features/TidalWaves.tsx","parser/shaman/restoration/modules/features/CastBehavior.tsx","parser/shaman/restoration/modules/talents/Torrent.tsx","parser/shaman/restoration/modules/talents/Undulation.tsx","parser/shaman/restoration/modules/talents/Deluge.tsx","parser/shaman/restoration/modules/talents/NaturesGuardian.tsx","parser/shaman/restoration/modules/talents/Downpour.tsx","parser/shaman/restoration/modules/talents/CloudburstTotem.tsx","parser/shaman/restoration/modules/talents/Ascendance.tsx","parser/shaman/restoration/modules/talents/HighTide.tsx","parser/shaman/restoration/modules/talents/TalentStatisticBox.tsx","parser/shaman/restoration/modules/talents/FlashFlood.tsx","parser/shaman/restoration/modules/talents/AncestralVigor.tsx","parser/shaman/restoration/modules/talents/AncestralProtectionTotem.tsx","parser/shaman/restoration/modules/spells/HealingSurge.tsx","parser/shaman/restoration/modules/spells/HealingWave.tsx","parser/shaman/restoration/modules/spells/LavaSurge.ts","parser/shaman/restoration/modules/spells/SpiritLinkDamageReduction.tsx","parser/shaman/restoration/modules/shadowlands/conduits/EmbraceOfEarth.tsx","parser/shaman/restoration/modules/shadowlands/conduits/HeavyRainfall.tsx","parser/shaman/restoration/modules/shadowlands/conduits/SwirlingCurrents.tsx","parser/shaman/restoration/modules/shadowlands/conduits/NaturesFocus.tsx","parser/shaman/restoration/modules/shadowlands/legendaries/PrimalTideCore.tsx","parser/shaman/restoration/modules/shadowlands/legendaries/JonatsNaturalFocus.tsx","parser/shaman/restoration/modules/shadowlands/legendaries/EarthenHarmony.tsx","parser/shaman/restoration/normalizers/CloudburstNormalizer.js","parser/shaman/restoration/normalizers/RiptideNormalizer.ts","parser/shaman/restoration/CombatLogParser.tsx","interface/statistics/components/BoringSpellValueText/index.tsx","interface/icons/Uptime.js","interface/statistics/components/BoringValueText/index.tsx","parser/core/calculateEffectiveHealing.js","parser/shared/modules/resources/resourcetracker/ResourceTracker.ts","interface/statistics/components/ConduitSpellText/index.tsx","common/ResourceIcon.tsx","interface/others/StatisticListBoxItem.js","common/ResourceLink.tsx","../node_modules/react-animate-height/lib/AnimateHeight.js","interface/statistics/components/DonutChart/index.js","interface/others/StatisticsListBox.js","parser/core/healingEfficiency/ManaTracker.ts","parser/shaman/restoration/constants.ts","parser/core/healingEfficiency/HealingEfficiencyTracker.ts","interface/others/LazyLoadStatisticBox.js","interface/PerformanceBar.tsx","parser/shared/modules/features/images/QE-Logo-New-Small.png","parser/core/healingEfficiency/HealingEfficiencyBreakdown.tsx","interface/others/StatisticWrapper.js","parser/shared/modules/features/SpellInfo.js","parser/shared/modules/features/BaseHealerStatValues.js","parser/shaman/shared/talents/EarthShield.tsx","parser/core/healingEfficiency/HealingEfficiencyDetails.tsx","parser/shaman/shared/constants.ts","parser/shaman/shared/talents/SpiritWolf.tsx","parser/shaman/shared/talents/StaticCharge.ts","parser/shaman/shared/spells/AstralShift.tsx","interface/others/PlayerBreakdown.js","common/indexByProperty.js"],"names":["formatNumber","number","toFixed","Math","round","replace","formatThousands","Feeding","state","expand","cooldownThroughputTracker","this","props","name","feed","cbtFeed","spell","SPELLS","CLOUDBURST_TOTEM_TALENT","totals","cbtTotals","ascFeed","ASCENDANCE_TALENT_RESTORATION","ascTotals","map","category","max","reduce","a","b","mergedHealing","healing","filter","total","className","key","style","marginTop","marginBottom","fontSize","SpellLink","id","color","colSpan","Tooltip","content","Object","keys","sort","healingA","healingB","spellId","ability","effectiveHealing","mergedEffectiveHealing","totalHealing","mergedTotal","width","Icon","icon","alt","min","backgroundColor","mergedTotalEffective","totalEffective","React","Component","HealingEfficiencyDetails","healingEfficiencyTracker","title","explanation","RESURGENCE","UNLEASH_LIFE_TALENT","EARTH_SHIELD","pad","position","HealingEfficiencyBreakdown","tracker","CoreHealingEfficiencyDetails","dependencies","HealingEfficiencyTracker","HealingDone","options","addEventListener","Events","damage","by","SELECTED_PLAYER_PET","SPIRIT_LINK_TOTEM_REDISTRIBUTE","onSLTDamage","event","_subtractHealing","amount","CoreHealingDone","RestorationAbilityTracker","abilityInfo","AbilityTracker","ManaTideTotem","combatants","regenedMana","sourceID","summon","SELECTED_PLAYER","MANA_TIDE_TOTEM_CAST","mAnATiDeTotEm","targetID","value","Statistic","size","STATISTIC_ORDER","UNIMPORTANT","dropdown","render","values","regenPerHealer","p","specClassName","SPECS","healer","specId","SpecIcon","regenFromUptime","uptime","label","Mana","regenOnPlayer","regenOnHealers","selectedCombatant","getBuffUptime","MANA_TIDE_TOTEM_BUFF","player","assign","players","spec","role","ROLES","HEALER","Analyzer","Combatants","WaterShield","manaGain","prepullApplication","energize","WATER_SHIELD_ENERGIZE","waterShield","applybuff","WATER_SHIELD","waterShieldPrepullCheck","resourceChange","prepull","owner","fightDuration","actual","uptimePercent","isLessThan","minor","average","major","ThresholdStyle","PERCENTAGE","isEqual","BOOLEAN","SPELLS_PROCCING_RESURGENCE","HEALING_SURGE","HEALING_WAVE","CHAIN_HEAL","RIPTIDE","Resurgence","manaTracker","manaTideTotem","otherManaGain","resurgence","totalResurgenceGain","heal","onRelevantHeal","to","onResurgenceProc","tick","guid","resurgenceTotal","castAmount","hitType","HIT_TYPES","CRIT","maxResource","formatPercentage","totalMana","iconStyle","height","scope","SpellIcon","naturalManaRegen","mttMana","wsMana","ManaTracker","CooldownThroughputTracker","args","hasBeenCBTHealingEvent","hasBeenAscHealingOrCastEvent","lastCBT","addNewCooldown","summary","BUILT_IN_SUMMARY_TYPES","HEALING","OVERHEALING","MANA","fight","start_time","lastAsc","pastCooldowns","cooldown","end","processed","forEach","feedingFactor","percentOverheal","overheal","Number","rawHealing","generateFeedEvents","events","type","EventType","Heal","ASCENDANCE_HEAL","CLOUDBURST_TOTEM_HEAL","eventFeed","absorbed","eventEmitter","fabricateEvent","FeedHeal","timestamp","start","push","activeCooldowns","index","findIndex","splice","constructor","cooldownSpells","find","cooldownSpell","removeLastCooldown","end_time","processAll","indexactiveCooldowns","reverseIndexCooldowns","reverse","indexCooldowns","length","popCBT","healingDone","cooldownId","ABILITIES_FEEDING_INTO_CBT","some","s","ABILITIES_NOT_FEEDING_INTO_ASCENDANCE","abilityIcon","CoreCooldownThroughputTracker","EventEmitter","UnleashLife","healingBuff","playersActive","unleashLifeCasts","unleashLifeRemaining","unleashLifeHealRemaining","buffedChainHealTimestamp","MIN_SAFE_INTEGER","lastUnleashLifeTimestamp","MAX_SAFE_INTEGER","active","hasTalent","spellFilter","_onHeal","cast","_onCast","removebuff","_onRiptideRemoval","includes","calculateEffectiveHealing","indexOf","STATISTIC_CATEGORY","TALENTS","OPTIONAL","unleashLifeCastRatioChart","feeding","getIndirectHealing","StatisticListBoxItem","getPercentageOfTotalHealingDone","totalBuffedHealing","valueTooltip","sum","unusedUL","totalUses","items","RESTORATION_COLORS","UNUSED","tooltip","DonutChart","abilityTracker","damageDone","castEfficiency","abilities","unleashLife","earthShield","spellInfo","getResurgenceDetails","getUnleashLifeDetails","getUnleashLifeBuffDetails","getEarthShieldBuffDetails","LAVA_BURST","getLavaBurstDamageDetails","manaSpent","unleashLifeContribution","buffHealing","getAbility","LAVA_BURST_DAMAGE","damageHits","damageEffective","damageAbsorbed","CoreHealingEfficiencyTracker","DamageDone","CastEfficiency","Abilities","EarthShield","combatant","SPELL_CATEGORIES","ROTATIONAL","charges","ECHO_OF_THE_ELEMENTS_TALENT","timelineSortIndex","gcd","base","suggestion","recommendedEfficiency","HEALING_STREAM_TOTEM_CAST","enabled","static","majorIssueEfficiency","averageIssueEfficiency","healSpellIds","HEALING_STREAM_TOTEM_HEAL","ASTRAL_SHIFT","buffSpellId","DEFENSIVE","importance","ISSUE_IMPORTANCE","MINOR","HEALING_RAIN_CAST","HEALING_RAIN_HEAL","WELLSPRING_TALENT","lv50Talent","WELLSPRING_HEAL","EARTHEN_WALL_TOTEM_TALENT","EARTHEN_WALL_TOTEM_ABSORB","lv15Talent","COOLDOWNS","ASCENDANCE_INITIAL_HEAL","HEALING_TIDE_TOTEM_CAST","HEALING_TIDE_TOTEM_HEAL","SPIRIT_LINK_TOTEM","OTHERS","casts","castCount","healingTwHits","i18n","_","HIGH_TIDE_BUFF","PURIFY_SPIRIT","UTILITY","FLAME_SHOCK","HEALER_DAMAGING_SPELL","LAVA_SURGE","LIGHTNING_BOLT","CHAIN_LIGHTNING","GHOST_WOLF","SPIRITWALKERS_GRACE","GRACEFUL_SPIRIT_TALENT","EARTHBIND_TOTEM","PURGE","CAPACITOR_TOTEM","WIND_RUSH_TOTEM_TALENT","EARTHGRAB_TOTEM_TALENT","ANCESTRAL_PROTECTION_TOTEM_TALENT","REINCARNATION","WIND_SHEAR","HEX","HEX_RAPTOR","HEX_SNAKE","HEX_SPIDER","HEX_COCKROACH","EARTH_SHIELD_HEAL","TREMOR_TOTEM","DOWNPOUR_TALENT","BERSERKING","isUndetectable","EARTH_ELEMENTAL","NATURES_GUARDIAN_TALENT","NATURES_GUARDIAN_HEAL","ROCKET_JUMP","LIGHTNING_SHIELD","FROST_SHOCK","SURGE_OF_EARTH_TALENT","SURGE_OF_EARTH_HEAL","CoreAbilities","HealingRainLocation","healingRainDiameter","healingRainEvents","newHealingRain","lastHealingRainTick","firstHealingRainTick","DELUGE_TALENT","healingRainHeal","begincast","healingRainCast","getEntity","eventsDuringRain","healIncrease","healingRainLocation","locate","filteredEvents","sumHealing","pointToCheck","x","y","_isPlayerInsideHealingRain","result","minY","maxY","minX","maxX","MAX_VALUE","ellipseWidth","ellipseHeight","console","warn","ellipseCenterPoint","location","pow","MasteryEffectiveness","totalMasteryHealing","totalMaxPotentialMasteryHealing","masteryHealEvents","ABILITIES_AFFECTED_BY_MASTERY","onHeal","HealingValue","healthBeforeHeal","hitPoints","masteryEffectiveness","maxHitPoints","masteryPercent","statTracker","currentMasteryPercentage","baseHealingDone","raw","masteryHealingDone","maxPotentialMasteryHealing","effective","avgEffectiveMasteryPercent","masteryEffectivenessPercent","StatisticBox","DEEP_HEALING","CORE","PlayerBreakdown","report","spellreport","spellReport","obj","healingReceived","healingFromMastery","maxPotentialHealingFromMastery","playerStats","BASE_ABILITIES_AFFECTED_BY_MASTERY","spellStats","StatTracker","AlwaysBeCasting","when","nonHealingTimeSuggestionThresholds","deadTimePercentage","downtimeSuggestionThresholds","isGreaterThan","addSuggestion","suggest","recommended","regular","CoreAlwaysBeCastingHealing","HEALING_ABILITIES_ON_GCD","PRIMORDIAL_WAVE_CAST","ChainHeal","buffer","chainHealHistory","castIndex","chainHealTimestamp","maxTargets","suggestedTargets","chainHeal","processBuffer","currentCast","Cast","target","castNo","hits","suggestedThreshold","suggestionThreshold","isNaN","_actual","_recommended","singleHits","avgHits","formatNth","formatDuration","healingHits","HealingRain","healingRainTicks","onHealingRainHeal","healingRainTick","averageHitsPerTick","earthShieldPrepullCheck","EarthShieldCore","Wellspring","wellspringCasts","wellspringTimestamps","castNumber","castEvent","undefined","_onBegincast","fightend","_onFightend","isCancelled","registerInefficientCast","meta","isInefficientCast","inefficientCastReason","averageHitsPerCast","wellspringEfficiency","fontWeight","numberOfCasts","inefficientCasts","EarthenWallTotem","earthenWallTotems","prePullCast","isMaghar","race","EARTHEN_WALL_TOTEM_SELF_DAMAGE","_updateTotemHealth","_onAbsorbed","potentialHealing","floor","earthenWallEfficiency","totalPotentialHealing","totalEffectiveHealing","SurgeOfEarth","surgeCast","surgeHeal","DECIMAL","RestoShamanChecklist","thresholds","AbilityRequirement","GenericCastEfficiencyRequirement","getCastEfficiencyForSpellId","Rule","description","href","rel","chainHealTargetThresholds","Requirement","healingRainTargetThreshold","wellspringTargetThreshold","ewtTargetThreshold","soeTargetThreshold","waterShieldPrepull","waterShieldUptime","earthShieldPrepull","earthShieldUptime","wrapperStyles","display","ResourceLink","RESOURCE_TYPES","manaLeft","PreparationRule","Checklist","alwaysBeCasting","manaValues","preparationRuleAnalyzer","healingRain","wellspring","earthenWallTotem","surgeOfEarth","selected","suggestionThresholds","suggestionThresholdsPrepull","BaseChecklist","ManaValues","PreparationRuleAnalyzer","SpellUsable","dispel","onDispel","cooldownTriggerEvent","CoreSpellUsable","int","crit","hasteHpct","mastery","vers","hasteHpm","ignored","StatValues","SPELL_INFO","qeLive","feedheal","onFeedHeal","_getSpellInfo","healVal","targetHealthPercentage","_handleHeal","critChanceBreakdown","hasTidalWaves","hasBuff","TIDAL_WAVES_BUFF","baseCritChance","error","healIncreaseFromOneMastery","statMultiplier","ratingNeededForNextPercentage","currentMasteryRating","statBaselineRatingPerPercent","STAT","MASTERY","masteryCoefficient","INTELLECT","stat","CRITICAL_STRIKE","HASTE_HPCT","HASTE_HPM","VERSATILITY","VERSATILITY_DR","LEECH","BaseHealerStatValues","critEffectBonus","CritEffectBonus","TidalWaves","_onHealingSurge","_onHealingWave","suggestedThresholds","riptide","healingWave","healingSurge","chainHealCasts","totalTwGenerated","CastBehavior","StatisticGroup","GENERAL","large","wide","ultrawide","twUsageRatioChart","fillerCastRatioChart","riptideCasts","twHealingWaves","twHealingSurges","totalTwUsed","unusedTw","fillerHealingWaves","fillerHealingSurges","Torrent","TORRENT_TALENT","Undulation","UNDULATION_TALENT","UNDULATION_BUFF","Deluge","_onHealingRainBegincast","playerId","recordHealing","processHealingRain","NaturesGuardian","fabricatedCastEvent","sourceIsFriendly","targetIsFriendly","Downpour","spellUsable","downpourHits","downpourHitsSum","downpourTimestamp","reductionMS","reduceCooldown","downpour","downpourCasts","downpourAverageHits","downpourAverageOverhealedHits","downpourAverageCooldown","CloudburstTotem","cbtActive","_createFabricatedEvent","RemoveBuff","ApplyBuff","fabricatedEvent","Ascendance","HighTide","usedHighTides","unusedHighTides","currentHighTideBuff","HIGH_TIDE_TALENT","onFightEnd","onChainHealCast","onHighTideBuff","applybuffstack","onHighTideRemoveBuff","getBonus","entries","i","parseInt","FACTOR_CONTRIBUTED_BY_HT_HIT","HIGH_TIDE_COEFFICIENT","CHAIN_HEAL_COEFFICIENT","highTideToolTip","TalentStatisticBox","torrent","undulation","deluge","naturesGuardian","cloudburstTotem","ascendance","highTide","StatisticsListBox","bodyStyle","borderBottom","paddingBottom","subStatistic","FlashFlood","globalCooldown","beginCastTimestamp","beginCastGlobalCooldown","spellsConsumingFlashFlood","timesBuffed","timeSaved","timeWasted","FLASH_FLOOD_TALENT","_onBeginCast","getGlobalCooldownDuration","FLASH_FLOOD_BUFF","castTime","totalTimeWasted","totalTimeSaved","flashFloodUsageRatioChart","makeTooltip","GlobalCooldown","AncestralVigor","loaded","lifeSavingEvents","disableStatistics","Boolean","ANCESTRAL_VIGOR_TALENT","pathname","query","checkAndFetch","_query","fetchWcl","json","nextPageTimestamp","Damage","ceil","ANCESTRAL_VIGOR","timeout","fetchAll","code","getEntities","restoShamans","RESTORATION_SHAMAN","shaman","LazyLoadStatisticBox","loader","load","bind","textAlign","NaN","AncestralProtectionTotem","aptEvents","ApplyDebuff","TOTEMIC_REVIVAL_DEBUFF","TOTEMIC_REVIVAL_CAST","HasSource","spellToText","HealingSurge","healingSurgeCasts","HealingWave","_isCurrentCastInefficient","onHealingWaveBegincast","onHealingWaveCast","_isInefficientCastEvent","hasTidalWave","hasFlashFlood","isAvailable","healingWaveCasts","LavaSurge","onLavaSurgeProc","isOnCooldown","reduction","getExpectedCooldownDuration","SpiritLinkDamageReduction","damageReduced","then","totalDamageTaken","damageTaken","entry","drps","drilldown","makeWclUrl","fightId","pins","view","playerName","SPIRIT_LINK_TOTEM_BUFF","EmbraceOfEarth","conduitRank","boost","conduitRankBySpellID","EMBRACE_OF_EARTH","EMBRACE_OF_EARTH_RANKS","normalizeBoost","bonusHeal","EARTHSHIELD_HEALING_INCREASE","COVENANTS","ConduitSpellText","rank","ItemHealingDone","HeavyRainfall","healingBoost","HEAVY_RAINFALL","HEAVY_RAINFALL_RANKS","HEAVY_RAINFALL_BUFF","SwirlingCurrents","targetsWithBoostedRiptides","SWIRLING_CURRENTS","SWIRLING_CURRENTS_RANKS","riptideHeal","notRiptideHeal","trackRiptide","removeRiptide","refreshbuff","pandemicRiptide","SWIRLING_CURRENTS_BUFF","HasTarget","NaturesFocus","chainHealEvent","NATURES_FOCUS","NATURES_FOCUS_RANKS","_onChainHealCast","_onChainHealHeal","PrimalTideCore","overhealing","gainedRiptideCasts","hasLegendaryByBonusID","PRIMAL_TIDE_CORE","bonusID","castedRiptide","ITEMS","BoringSpellValueText","JonatsNaturalFocus","JONATS_NATURAL_FOCUS","buff","getBuff","JONATS_NATURAL_FOCUS_BUFF","stacks","EarthenHarmony","EARTHEN_HARMONY","CloudburstNormalizer","fixedEvents","eventIndex","castTimestamp","recallTimestamp","nextEventIndex","nextEvent","newTimestamp","__fabricated","CLOUDBURST_TOTEM_RECALL","EventsNormalizer","RiptideNormalizer","healEvent","__modified","CombatLogParser","results","tabs","url","Panel","padding","getModule","CoreCombatLogParser","abilitiesAffectedByHealingIncreases","ABILITIES_AFFECTED_BY_HEALING_INCREASES","specModules","lowHealthHealing","LowHealthHealing","restorationAbilityTracker","hpmDetails","hpmTracker","manaLevelChart","ManaLevelChart","manaUsageChart","ManaUsageChart","tidalWaves","castBehavior","checklist","statValues","flashFlood","ancestralVigor","ancestralProtectionTotem","talentStatisticBox","lavaSurge","spiritLinkDamageReduction","spiritWolf","SpiritWolf","staticCharge","StaticCharge","astralShift","AstralShift","cloudburstNormalizer","riptideNormalizer","embraceOfEarth","heavyRainfall","swirlingCurrents","naturesFocus","primalTideCore","jonatsNaturalFocus","earthenHarmony","children","other","xmlns","viewBox","d","BoringValue","relativeHealIncrease","ResourceTracker","current","resourceUpdates","buildersObj","spendersObj","resource","onEnergize","onCast","generated","wasted","spent","spentByCast","resourceChangeType","waste","gain","_applyBuilder","getResource","maxGain","initBuilderAbility","used","shouldProcessCastEvent","eventResource","cost","getReducedCost","initSpenderAbility","triggerSpendEvent","resourceCost","classResources","r","SpendResource","acc","ResourceIcon","noLink","others","titleTooltip","useState","elem","setElem","useEffect","TooltipProvider","refresh","ref","defineProperty","exports","_typeof","Symbol","iterator","prototype","_extends","arguments","source","hasOwnProperty","call","_createClass","defineProperties","descriptor","enumerable","configurable","writable","Constructor","protoProps","staticProps","_react2","_interopRequireDefault","require","_propTypes2","_classnames2","__esModule","default","_defineProperty","ANIMATION_STATE_CLASSES","animating","animatingUp","animatingDown","animatingToHeightZero","animatingToHeightAuto","animatingToHeightSpecific","staticHeightZero","staticHeightAuto","staticHeightSpecific","PROPS_TO_OMIT","omit","_len","Array","_key","res","objectKeys","cancelAnimationFrames","requestAnimationFrameIDs","cancelAnimationFrame","isNumber","n","parseFloat","isFinite","isPercentage","search","substr","runCallback","callback","params","AnimateHeight","_React$Component","instance","TypeError","_classCallCheck","_this","self","ReferenceError","_possibleConstructorReturn","__proto__","getPrototypeOf","animationFrameIDs","overflow","animationStateClasses","getStaticStateClasses","shouldUseTransitions","subClass","superClass","create","setPrototypeOf","_inherits","contentElement","hideContent","prevProps","prevState","_this2","_props","delay","duration","onAnimationEnd","onAnimationStart","_cx","showContent","contentHeight","offsetHeight","totalDuration","newHeight","timeoutState","isCurrentHeightAuto","timeoutAnimationStateClasses","setState","clearTimeout","timeoutID","animationClassesTimeoutID","requestAnimationFrame","startAnimationHelper","setTimeout","_cx2","_cx3","_this3","_props2","animateOpacity","applyInlineTransitions","contentClassName","easing","_state","componentStyle","transition","WebkitTransition","contentStyle","opacity","componentClasses","ariaHidden","createElement","apply","concat","el","propTypes","bool","object","any","isRequired","string","propName","componentName","func","defaultProps","item","background","chartSize","innerRadiusFactor","data","mark","innerRadius","encoding","theta","field","legend","scale","domain","range","stroke","renderLegend","renderChart","PureComponent","SHAMAN_BASE_ABILITIES","healingSpellIds","overhealingDone","manaGained","percentOverhealingDone","percentHealingDone","percentDamageDone","manaPercentSpent","hpm","dpm","timeSpentCasting","percentTimeSpentCasting","hpet","dpet","healingEffective","healingAbsorbed","healingOverheal","healingSpellId","healingAbility","spenders","getCustomSpellStats","getTimeSpentCasting","gcdSpent","includeCooldowns","spells","topHpm","topDpm","topHpet","topDpet","manaCost","getSpellStats","loading","handleClick","context","updateResults","onClick","cursor","contextTypes","PropTypes","PerformanceBar","percent","colorForPerformance","module","HealingEfficiencyTable","getAllSpellStats","showCooldowns","spellArray","showHealing","spellRows","spellDetail","HealingEfficiencySpellRow","detailedView","DetailView","BarView","BarHeader","hasHealing","hasDamage","barWidth","DetailHeader","hasOverhealing","marginRight","defaultChecked","icons","onChange","checked","htmlFor","marginLeft","StatisticWrapper","multiplier","HEALTHSTONE","MARK_OF_THE_ANCIENT_PRIESTESS","fallbackSpellInfo","sharedSpellInfo","CORE_SPELL_INFO","mentioned","totalAdjustedHealing","totalOneInt","totalOneCrit","totalOneHasteHpct","totalOneHasteHpm","totalOneMastery","totalOneVers","totalOneVersDr","totalOneLeech","playerHealthMissing","scaleWeightsWithHealth","moreInformationLink","onAbsorb","onRemoveBuff","onHealTaken","onDamageTaken","onFightend","specSpecific","shared","_handleHealEvent","absorb","eventForWeights","_adjustGain","_leech","_intellect","_criticalStrike","_hasteHpct","_hasteHpm","_mastery","_versatility","mult","currentLeechPercentage","_leechHasLeech","_leechPrediction","currentLeechRating","toPlayer","healIncreaseFromOneLeech","leech","healIncreaseFromOneInt","intellect","currentIntellectRating","rating","currentCritRating","baseCritPercentage","ratingCritChance","_isCrit","_getCritChance","totalCritChance","ratingCritChanceContribution","critMult","rawBaseHealing","effectiveCritHealing","currHastePerc","currentHastePercentage","healIncreaseFromOneHaste","haste","currentHasteRating","HASTE","Error","currVersPerc","currentVersatilityPercentage","healIncreaseFromOneVers","versatility","currentVersatilityRating","_updateMissingHealth","damageVal","DamageValue","blocked","overkill","_versatilityDamageReduction","baseStats","itemLevel","hps","primary","calculatePrimaryStat","hpsPerIntellect","criticalStrike","calculateSecondaryStatDefault","hpsPerCriticalStrike","hpsPerHaste","hpsPerMastery","hpsPerVersatility","hpsPerLeech","oneRatingHealing","_prepareResults","urlParts","statValue","weight","_getGain","statName","getName","join","data-place","Info","margin","minWidth","row","_getTooltip","ratingForOne","_ratingPerOnePercent","getIcon","gainPerSecond","Infinity","informationIconTooltip","getClassNameColor","getNameTranslated","Information","hpsPerHasteHPCT","hpsPerHasteHPM","earthShieldHealingIncrease","isRsham","onEarthShieldHeal","HEALING_ABILITIES_AMPED_BY_EARTH_SHIELD_FILTERED","HEALING_ABILITIES_AMPED_BY_EARTH_SHIELD","onEarthShieldAmpSpellHeal","getFeeding","ELEMENTAL_BLAST_BUFFS","ELEMENTAL_BLAST_CRIT","ELEMENTAL_BLAST_MASTERY","ELEMENTAL_BLAST_HASTE","SPIRIT_WOLF_TALENT","SPIRIT_WOLF_BUFF","totalDrps","STATIC_CHARGE_TALENT","applydebuff","STATIC_CHARGE_DEBUFF","stunApplication","cooldownRemaining","showPlayers","statsByTargetId","friendlyStats","playersById","arr","objByKey","indexByProperty","targetId","playerInfo","statsBySpellId","calculatePlayerBreakdown","highestEffectiveHealing","highest","highestMasteryEffectiveness","totalSpellEffectiveHealing","highestSpellEffectiveHealing","highestSpellMasteryEffectiveness","calculateSpellBreakdown","textTransform","performanceBarMasteryEffectiveness","performanceBarHealingDonePercentage","actualHealingDonePercentage","performanceBarHealingReceivedPercentage","actualHealingReceivedPercentage"],"mappings":"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","file":"static/js/RestorationShaman.89f1dfe8.chunk.js","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport SPELLS from 'common/SPELLS';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport Icon from 'common/Icon';\r\nimport { TooltipElement } from 'common/Tooltip';\r\n// import Toggle from 'react-toggle';\r\n\r\nfunction formatThousands(number) {\r\n  return (`${Math.round(number || 0)}`).replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, '$1,');\r\n}\r\n\r\nfunction formatNumber(number) {\r\n  if (number > 1000000) {\r\n    return `${(number / 1000000).toFixed(2)}m`;\r\n  }\r\n  if (number > 10000) {\r\n    return `${Math.round(number / 1000)}k`;\r\n  }\r\n  return formatThousands(number);\r\n}\r\n\r\nclass Feeding extends React.Component {\r\n  static propTypes = {\r\n    cooldownThroughputTracker: PropTypes.object,\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      expand: false,\r\n    };\r\n  }\r\n\r\n  render() {\r\n    const { cooldownThroughputTracker } = this.props;\r\n\r\n    return (\r\n      <div>\r\n        {([\r\n          {\r\n            name: 'Cloudburst Totem',\r\n            feed: cooldownThroughputTracker.cbtFeed,\r\n            spell: SPELLS.CLOUDBURST_TOTEM_TALENT,\r\n            totals: cooldownThroughputTracker.cbtTotals,\r\n          },\r\n          {\r\n            name: 'Ascendance',\r\n            feed: cooldownThroughputTracker.ascFeed,\r\n            spell: SPELLS.ASCENDANCE_TALENT_RESTORATION,\r\n            totals: cooldownThroughputTracker.ascTotals,\r\n          },\r\n        ]).map((category) => {\r\n          category.max = category.feed.reduce((a, b) => {\r\n            const aHealing = this.state.expand ? a.mergedHealing : a.healing;\r\n            const bHealing = this.state.expand ? b.mergedHealing : b.healing;\r\n            return (aHealing > bHealing) ? a : b;\r\n          }, 0).healing;\r\n          return category;\r\n        })\r\n          .filter(category => category.totals.total > 0)\r\n          .map(category => (\r\n            <table className=\"data-table\" key={category.name} style={{ marginTop: 10, marginBottom: 10 }}>\r\n              <thead>\r\n                <tr>\r\n                  <th style={{ fontSize: '1.25em' }}>\r\n                    <SpellLink id={category.spell.id} style={{ color: '#fff' }}>\r\n                      {category.name}\r\n                    </SpellLink>\r\n                  </th>\r\n                  <th className=\"text-center\" colSpan=\"3\"><TooltipElement content={`The amount of healing done by spells that feed into ${category.name} while it was up.`}>Feeding done per spell</TooltipElement></th>\r\n                  <th className=\"text-center\"><TooltipElement content={`The approximated effective healing each of the spells feeding into ${category.name} did, accounting for overhealing. This should roughly at up to the total effective healing of ${category.name}.`}>Approx. effective healing</TooltipElement></th>\r\n                  <th />\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {Object.keys(category.feed)\r\n                  .sort((a, b) => {\r\n                    const healingA = category.feed[a].healing;\r\n                    const healingB = category.feed[b].healing;\r\n                    return healingA > healingB ? -1 : (healingB > healingA ? 1 : 0);\r\n                  })\r\n                  .filter(spellId => (!this.state.expand) || category.feed[spellId].mergedHealing > 0)\r\n                  .map((spellId) => {\r\n                    const ability = category.feed[spellId];\r\n                    const healing = this.state.expand ? ability.mergedHealing : ability.healing;\r\n                    const effectiveHealing = this.state.expand ? ability.mergedEffectiveHealing : ability.effectiveHealing;\r\n                    const totalHealing = this.state.expand ? category.totals.mergedTotal : category.totals.total;\r\n\r\n                    return (\r\n                      <tr key={`${category.name} ${ability.name}`}>\r\n                        <td style={{ width: '30%' }}>\r\n                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <Icon icon={ability.icon} alt={ability.name} /> {ability.name}\r\n                        </td>\r\n                        <td className=\"text-right\" style={{ width: '10%' }}>\r\n                          {(healing / totalHealing * 100).toFixed(2)}%\r\n                        </td>\r\n                        <td style={{ width: '30%' }}>\r\n                          <div\r\n                            className=\"performance-bar\"\r\n                            style={{ width: `${Math.min(healing / category.max * 100, 100)}%`, backgroundColor: '#70b570' }}\r\n                          />\r\n                        </td>\r\n                        <td style={{ width: '10%' }}>\r\n                          {formatNumber(healing)}\r\n                        </td>\r\n                        <td className=\"text-center\" style={{ width: '20%' }}>\r\n                          {formatNumber(effectiveHealing)}\r\n                        </td>\r\n\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                <tr key={`${category.name}Summary`}>\r\n                  <td />\r\n                  <td />\r\n                  <td className=\"text-right\"><b>Total:</b></td>\r\n                  <td className=\"text-left\">\r\n                    <b>{formatNumber(this.state.expand ? category.totals.mergedTotal : category.totals.total)}</b>\r\n                  </td>\r\n                  <td className=\"text-center\">\r\n                    <b>{formatNumber(this.state.expand ? category.totals.mergedTotalEffective : category.totals.totalEffective)}</b>\r\n                  </td>\r\n                </tr>\r\n\r\n              </tbody>\r\n            </table>\r\n          ))\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Feeding;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Panel from 'interface/statistics/Panel';\r\nimport CoreHealingEfficiencyDetails from 'parser/core/healingEfficiency/HealingEfficiencyDetails';\r\nimport HealingEfficiencyTracker from 'parser/core/healingEfficiency/HealingEfficiencyTracker';\r\nimport HealingEfficiencyBreakdown from 'parser/core/healingEfficiency/HealingEfficiencyBreakdown';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nclass HealingEfficiencyDetails extends CoreHealingEfficiencyDetails {\r\n  static dependencies = {\r\n    healingEfficiencyTracker: HealingEfficiencyTracker,\r\n  };\r\n\r\n  protected healingEfficiencyTracker!: HealingEfficiencyTracker;\r\n\r\n  statistic() {\r\n    return (\r\n      <Panel\r\n        title={<Trans id=\"shared.healingEfficiency.title\">Mana Efficiency</Trans>}\r\n        explanation={(\r\n          <Trans id=\"shaman.restoration.healingEfficiencyDetails\">\r\n            <SpellLink id={SPELLS.RESURGENCE.id} /> mana gained is removed from the spell, meaning the mana spent of that spell will be lower.<br />\r\n            Healing that is caused by the <SpellLink id={SPELLS.UNLEASH_LIFE_TALENT.id} /> buff, is added to <SpellLink id={SPELLS.UNLEASH_LIFE_TALENT.id} /> instead of the spell that was buffed.<br />\r\n            <SpellLink id={SPELLS.EARTH_SHIELD.id} /> is given the healing from its healing buff and is removed from the spells that were buffed.\r\n          </Trans>\r\n        )}\r\n        pad={false}\r\n        position={120}\r\n      >\r\n        <HealingEfficiencyBreakdown tracker={this.healingEfficiencyTracker} />\r\n      </Panel>\r\n    );\r\n  }\r\n}\r\n\r\nexport default HealingEfficiencyDetails;\r\n","import SPELLS from 'common/SPELLS';\r\nimport { Options, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\n\r\nimport CoreHealingDone from 'parser/shared/modules/throughput/HealingDone';\r\n\r\nclass HealingDone extends CoreHealingDone {\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.damage.by(SELECTED_PLAYER_PET).spell(SPELLS.SPIRIT_LINK_TOTEM_REDISTRIBUTE), this.onSLTDamage);\r\n  }\r\n\r\n  onSLTDamage(event: DamageEvent) {\r\n    // Removing Spirit link from total healing done by subtracting the damage done of it\r\n    this._subtractHealing(event, event.amount, 0, 0);\r\n  }\r\n}\r\n\r\nexport default HealingDone;\r\n","import { Ability } from 'parser/core/Events';\r\nimport AbilityTracker, { TrackedAbility } from 'parser/shared/modules/AbilityTracker';\r\n\r\nexport interface TrackedRestoShamanAbility extends TrackedAbility {\r\n  healingTwHits?: number;\r\n}\r\n\r\nclass RestorationAbilityTracker extends AbilityTracker {\r\n  getAbility(spellId: number, abilityInfo: Ability | null = null): TrackedRestoShamanAbility {\r\n    return super.getAbility(spellId, abilityInfo);\r\n  }\r\n}\r\n\r\nexport default RestorationAbilityTracker;\r\n","import React from 'react';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport Events, { SummonEvent } from 'parser/core/Events';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatNumber } from 'common/format';\r\n\r\nimport { Trans } from '@lingui/macro';\r\nimport ROLES from 'game/ROLES';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport BoringValue from 'interface/statistics/components/BoringValueText';\r\nimport ManaIcon from 'interface/icons/Mana';\r\n\r\nimport './ManaTideTotem.scss'\r\nimport Combatant from 'parser/core/Combatant';\r\nimport SPECS from 'game/SPECS';\r\nimport SpecIcon from 'common/SpecIcon';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\n\r\nexport const MANA_REGEN_PER_SECOND = 2000 / 5;\r\n\r\nclass ManaTideTotem extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n  };\r\n\r\n  protected combatants!: Combatants;\r\n  regenedMana = 0;\r\n  sourceID = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.summon.by(SELECTED_PLAYER).spell(SPELLS.MANA_TIDE_TOTEM_CAST), this.mAnATiDeTotEm);\r\n  }\r\n\r\n  mAnATiDeTotEm(event: SummonEvent) {\r\n    this.sourceID = event.targetID;\r\n  }\r\n\r\n  get regenOnPlayer() {\r\n    return this.selectedCombatant.getBuffUptime(SPELLS.MANA_TIDE_TOTEM_BUFF.id, this.sourceID);\r\n  };\r\n  get regenOnHealers() {\r\n    return Object.values(this.regenPerHealer).reduce((uptime, player) => uptime + player.uptime, 0);\r\n  };\r\n  get regenPerHealer(): { [playerId: number]: { healer: Combatant; uptime: number; } } {\r\n    return Object.assign({}, ...Object.values((this.combatants.players))\r\n      .filter(player => player.spec.role === ROLES.HEALER)\r\n      .map(player => ({ [player.id]: { healer: player, uptime: player.getBuffUptime(SPELLS.MANA_TIDE_TOTEM_BUFF.id, this.sourceID) } })));\r\n  }\r\n\r\n  regenFromUptime(value: number) {\r\n    return value / 1000 * MANA_REGEN_PER_SECOND;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        size='flexible'\r\n        position={STATISTIC_ORDER.UNIMPORTANT(89)}\r\n        dropdown={(\r\n          <table className=\"table table-condensed\">\r\n            <thead>\r\n              <tr>\r\n                <Trans render=\"th\" id=\"common.player\">Player</Trans>\r\n                <Trans render=\"th\" id=\"common.stat.mana\">Mana</Trans>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {\r\n                Object.values(this.regenPerHealer)\r\n                  .map(p => {\r\n                    const spec = SPECS[p.healer.specId];\r\n                    const specClassName = spec.className.replace(' ', '');\r\n\r\n                    return (\r\n                      <tr key={p.healer.id}>\r\n                        <th className={specClassName}><SpecIcon id={p.healer.specId} />{' '}{p.healer.name}</th>\r\n                        <td>{formatNumber(this.regenFromUptime(p.uptime))}</td>\r\n                      </tr>\r\n                    );\r\n                  })\r\n              }\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      >\r\n        <BoringValue label={<SpellLink id={SPELLS.MANA_TIDE_TOTEM_CAST.id} />}>\r\n          <div className=\"flex mtt-value\">\r\n            <div className=\"flex-sub icon\">\r\n              <ManaIcon />\r\n            </div>\r\n            <div className=\"flex-main value\">\r\n              {formatNumber(this.regenFromUptime(this.regenOnPlayer))}\r\n              <br /><small><Trans id=\"shaman.restoration.manaTideTotem.statistic.manaRestored\">Mana restored</Trans></small>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex mtt-value\">\r\n            <div className=\"flex-sub icon\">\r\n              <ManaIcon />\r\n            </div>\r\n            <div className=\"flex-main value\">\r\n              {formatNumber(this.regenFromUptime(this.regenOnHealers))}\r\n              <br /><small><Trans id=\"shaman.restoration.manaTideTotem.statistic.healerManaRestored\">Mana restored (all Healers)</Trans></small>\r\n            </div>\r\n          </div>\r\n        </BoringValue>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ManaTideTotem;\r\n","import React from 'react';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { ApplyBuffEvent, EnergizeEvent } from 'parser/core/Events';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatNumber } from 'common/format';\r\n\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport BoringValue from 'interface/statistics/components/BoringValueText';\r\nimport ManaIcon from 'interface/icons/Mana';\r\n// just gonna steal my mtt formatting\r\nimport './ManaTideTotem.scss'\r\nimport { TooltipElement } from 'common/Tooltip';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport { ThresholdStyle } from 'parser/core/ParseResults';\r\n\r\nconst WATER_SHIELD_MANA_REGEN_PER_SECOND = 50 / 5;\r\n\r\nclass WaterShield extends Analyzer {\r\n  manaGain = 0;\r\n  prepullApplication = false;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.energize.by(SELECTED_PLAYER).spell(SPELLS.WATER_SHIELD_ENERGIZE), this.waterShield);\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.WATER_SHIELD), this.waterShieldPrepullCheck);\r\n  }\r\n\r\n  waterShield(event: EnergizeEvent) {\r\n    this.manaGain += event.resourceChange;\r\n  }\r\n\r\n  waterShieldPrepullCheck(event: ApplyBuffEvent) {\r\n    if (event.prepull) {\r\n      this.prepullApplication = true;\r\n    }\r\n  }\r\n\r\n  get regenOnPlayer() {\r\n    const uptime = this.selectedCombatant.getBuffUptime(SPELLS.WATER_SHIELD.id) / this.owner.fightDuration;\r\n\r\n    return (this.owner.fightDuration / 1000) * WATER_SHIELD_MANA_REGEN_PER_SECOND * uptime;\r\n  };\r\n\r\n  get uptime() {\r\n    return this.selectedCombatant.getBuffUptime(SPELLS.WATER_SHIELD.id);\r\n  }\r\n\r\n  get uptimePercent() {\r\n    return this.uptime / this.owner.fightDuration;\r\n  }\r\n\r\n  get suggestionThresholds() {\r\n    return {\r\n      actual: this.uptimePercent,\r\n      isLessThan: {\r\n        minor: 0.95,\r\n        average: 0.90,\r\n        major: 0.85,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  get suggestionThresholdsPrepull() {\r\n    return {\r\n      actual: this.prepullApplication,\r\n      isEqual: false,\r\n      style: ThresholdStyle.BOOLEAN,\r\n    };\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        size='flexible'\r\n        position={STATISTIC_ORDER.UNIMPORTANT(88)}\r\n      >\r\n        <BoringValue label={<SpellLink id={SPELLS.WATER_SHIELD.id} />}>\r\n          <div className=\"flex mtt-value\">\r\n            <div className=\"flex-sub icon\">\r\n              <ManaIcon />\r\n            </div>\r\n            <div className=\"flex-main value\">\r\n              {formatNumber(this.regenOnPlayer + this.manaGain)}\r\n              <br />\r\n              <small>\r\n                <TooltipElement content={<Trans id=\"shaman.restoration.waterShield.statistic.tooltip\">{formatNumber(this.regenOnPlayer)} mana from the passive regen and {this.manaGain} from getting hit</Trans>}>\r\n                  <Trans id=\"shaman.restoration.manaTideTotem.statistic.manaRestored\">Mana restored</Trans>\r\n                </TooltipElement>\r\n              </small>\r\n            </div>\r\n          </div>\r\n        </BoringValue>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default WaterShield;\r\n","import React from 'react';\r\n\r\nimport { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\n\r\nimport HIT_TYPES from 'game/HIT_TYPES';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { EnergizeEvent, HealEvent } from 'parser/core/Events';\r\nimport ManaTracker from 'parser/core/healingEfficiency/ManaTracker';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport { formatNumber, formatPercentage } from 'common/format';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport BoringValue from 'interface/statistics/components/BoringValueText';\r\nimport ManaIcon from 'interface/icons/Mana';\r\n\r\nimport './ManaTideTotem.scss'\r\nimport ManaTideTotem, { MANA_REGEN_PER_SECOND } from './ManaTideTotem';\r\nimport WaterShield from './WaterShield';\r\n\r\n\r\nconst SPELLS_PROCCING_RESURGENCE = {\r\n  [SPELLS.HEALING_SURGE.id]: 0.006,\r\n  [SPELLS.HEALING_WAVE.id]: 0.01,\r\n  [SPELLS.CHAIN_HEAL.id]: 0.0025,\r\n  [SPELLS.UNLEASH_LIFE_TALENT.id]: 0.006,\r\n  [SPELLS.RIPTIDE.id]: 0.006,\r\n};\r\n\r\ninterface ResurgenceInfo {\r\n  spellId: number;\r\n  resurgenceTotal: number;\r\n  castAmount: number;\r\n}\r\n\r\nclass Resurgence extends Analyzer {\r\n  static dependencies = {\r\n    manaTracker: ManaTracker,\r\n    manaTideTotem: ManaTideTotem,\r\n    waterShield: WaterShield,\r\n  };\r\n\r\n  protected manaTracker!: ManaTracker;\r\n  protected manaTideTotem!: ManaTideTotem;\r\n  protected waterShield!: WaterShield;\r\n\r\n  otherManaGain = 0;\r\n  resurgence: ResurgenceInfo[] = [];\r\n  totalResurgenceGain = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell([SPELLS.HEALING_SURGE, SPELLS.HEALING_WAVE, SPELLS.CHAIN_HEAL, SPELLS.UNLEASH_LIFE_TALENT, SPELLS.RIPTIDE]), this.onRelevantHeal);\r\n    this.addEventListener(Events.energize.to(SELECTED_PLAYER).spell(SPELLS.RESURGENCE), this.onResurgenceProc);\r\n  }\r\n\r\n  onRelevantHeal(event: HealEvent) {\r\n    if (event.tick) {\r\n      return;\r\n    }\r\n    const spellId = event.ability.guid;\r\n\r\n    if (!this.resurgence[spellId]) {\r\n      this.resurgence[spellId] = {\r\n        spellId: spellId,\r\n        resurgenceTotal: 0,\r\n        castAmount: 0,\r\n      };\r\n    }\r\n\r\n    if (event.hitType === HIT_TYPES.CRIT) {\r\n      this.resurgence[spellId].resurgenceTotal += SPELLS_PROCCING_RESURGENCE[spellId] * this.manaTracker.maxResource;\r\n      this.resurgence[spellId].castAmount += 1;\r\n    }\r\n  }\r\n\r\n  onResurgenceProc(event: EnergizeEvent) {\r\n    const spellId = event.ability.guid;\r\n\r\n    if (spellId !== SPELLS.RESURGENCE.id) {\r\n      this.otherManaGain += event.resourceChange;\r\n      return;\r\n    }\r\n\r\n    this.totalResurgenceGain += event.resourceChange;\r\n  }\r\n\r\n  get totalMana() {\r\n    const naturalManaRegen = (this.owner.fightDuration / 1000) * MANA_REGEN_PER_SECOND;\r\n    const mttMana = this.manaTideTotem.regenOnPlayer;\r\n    const wsMana = this.waterShield.regenOnPlayer;\r\n    return naturalManaRegen + this.totalResurgenceGain + this.manaTracker.maxResource + this.otherManaGain + mttMana + wsMana;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.UNIMPORTANT(90)}\r\n        size='flexible'\r\n        dropdown={(\r\n          <>\r\n            <div>\r\n              <Trans id=\"shaman.restoration.resurgence.statistic.table.description\"><SpellLink id={SPELLS.RESURGENCE.id} iconStyle={{ height: '1.25em' }} /> accounted for {formatPercentage(this.totalResurgenceGain / this.totalMana, 0)}% of your mana pool ({formatNumber(this.totalMana)} mana).</Trans>\r\n            </div>\r\n            <table className=\"table table-condensed\">\r\n              <thead>\r\n                <tr>\r\n                  <th><Trans id=\"shaman.restoration.resurgence.statistic.tableHeader.spell\">Spell</Trans></th>\r\n                  <th><Trans id=\"shaman.restoration.resurgence.statistic.tableHeader.amount\">Amount</Trans></th>\r\n                  <th><Trans id=\"shaman.restoration.resurgence.statistic.tableHeader.crits\">Crits</Trans></th>\r\n                  <th><Trans id=\"shaman.restoration.resurgence.statistic.tableHeader.mana\">% of mana</Trans></th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {\r\n                  this.resurgence\r\n                    .map(spell => (\r\n                      <tr key={spell.spellId}>\r\n                        <th scope=\"row\"><SpellIcon id={spell.spellId} style={{ height: '2.5em' }} /></th>\r\n                        <td>{formatNumber(spell.resurgenceTotal)}</td>\r\n                        <td>{formatNumber(spell.castAmount)}</td>\r\n                        <td>{formatPercentage(spell.resurgenceTotal / this.totalMana)}%</td>\r\n                      </tr>\r\n                    ))\r\n                }\r\n              </tbody>\r\n            </table>\r\n          </>\r\n        )}\r\n      >\r\n        <BoringValue label={<SpellLink id={SPELLS.RESURGENCE.id} />}>\r\n          <div className=\"flex mtt-value\">\r\n            <div className=\"flex-sub icon\">\r\n              <ManaIcon />\r\n            </div>\r\n            <div className=\"flex-main value\">\r\n              {formatNumber(this.totalResurgenceGain)}\r\n              <br />\r\n              <small>\r\n                <Trans id=\"shaman.restoration.resurgence.statistic.label\">Mana gained from Resurgence</Trans>\r\n              </small>\r\n            </div>\r\n          </div>\r\n        </BoringValue>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Resurgence;\r\n","import SPELLS from 'common/SPELLS';\r\nimport { EventType } from 'parser/core/Events';\r\nimport EventEmitter from 'parser/core/modules/EventEmitter';\r\nimport CoreCooldownThroughputTracker, { BUILT_IN_SUMMARY_TYPES } from 'parser/shared/modules/CooldownThroughputTracker';\r\n\r\nimport { ABILITIES_NOT_FEEDING_INTO_ASCENDANCE, ABILITIES_FEEDING_INTO_CBT } from '../../constants';\r\n\r\n// The purpose of this class is threefold:\r\n// 1) provide cooldown data for the cooldowns tab. I had to rewrite some of the functions because\r\n// cloudburst totem does not appear as a buff in the combat log.\r\n// 2) Track the spells feeding into Asc/CBT so we can provide a breakdownn of the feeding\r\n// for the Feeding tab.\r\n// 3) Generate feed_heal events to be used for statweights.\r\n//\r\n// For each active CBT/Asc we track for each spell how much raw- and effective healing it\r\n// contributed. Whenever new results are generated in CombatLogParser.tsx processAll will\r\n// be called. This function looks through all cooldowns that have not been processed yet\r\n// and adds their healing to the total spell breakdown per cooldown, which is stored in\r\n// cbtFeed and ascFeed. It is necessary to do it this way because only after\r\n// cloudburst has done all its healing you know how much overhealing it has done, and\r\n// thus how much effective healing each of the feeding spells did.\r\n//\r\n// getIndirectHealing can be used to query for one spellId how much healing it provided\r\n// through CBT/Asc.\r\n\r\n// This seems inaccurate compared to live logs\r\n// checking BFA logs it appears that it redistributes more than the healing events sum up to, even checking for precasted spells\r\n// https://www.warcraftlogs.com/reports/NQZ63C1FmxhpBH8a/#fight=7&source=11&type=healing&options=8&start=1999815&end=2013727\r\n// 134k healing during and around Ascendance, but ascendance did 156k\r\n\r\nclass CooldownThroughputTracker extends CoreCooldownThroughputTracker {\r\n  static dependencies = {\r\n    ...CoreCooldownThroughputTracker.dependencies,\r\n    eventEmitter: EventEmitter,\r\n  };\r\n  static cooldownSpells = [\r\n    ...CoreCooldownThroughputTracker.cooldownSpells,\r\n    {\r\n      spell: SPELLS.ASCENDANCE_TALENT_RESTORATION,\r\n      summary: [\r\n        BUILT_IN_SUMMARY_TYPES.HEALING,\r\n        BUILT_IN_SUMMARY_TYPES.OVERHEALING,\r\n        BUILT_IN_SUMMARY_TYPES.MANA,\r\n      ],\r\n    },\r\n  ];\r\n\r\n  cbtFeed = [];\r\n  cbtTotals = { total: 0, totalEffective: 0 };\r\n\r\n  ascFeed = [];\r\n  ascTotals = { total: 0, totalEffective: 0 };\r\n\r\n  hasBeenCBTHealingEvent = false;\r\n  hasBeenAscHealingOrCastEvent = false;\r\n\r\n  processAll() {\r\n    this.pastCooldowns\r\n      .filter(cooldown => cooldown.end && !cooldown.processed)\r\n      .forEach((cooldown) => {\r\n        let feed = null;\r\n        let totals = null;\r\n        let feedingFactor = 0;\r\n        if (cooldown.spell.id === SPELLS.CLOUDBURST_TOTEM_TALENT.id) {\r\n          feed = this.cbtFeed;\r\n          totals = this.cbtTotals;\r\n          feedingFactor = 0.25;\r\n        } else if (cooldown.spell.id === SPELLS.ASCENDANCE_TALENT_RESTORATION.id) {\r\n          feed = this.ascFeed;\r\n          totals = this.ascTotals;\r\n          feedingFactor = 1.0;\r\n        }\r\n\r\n        let percentOverheal = 0;\r\n        if ((cooldown.healing + cooldown.overheal) > 0) {\r\n          percentOverheal = cooldown.overheal / (cooldown.healing + cooldown.overheal);\r\n        }\r\n\r\n        Object.keys(cooldown.feed).forEach((spellId) => {\r\n          spellId = Number(spellId);\r\n          if (!feed[spellId]) {\r\n            feed[spellId] = [];\r\n            feed[spellId].healing = 0;\r\n            feed[spellId].effectiveHealing = 0;\r\n            feed[spellId].name = cooldown.feed[spellId].name;\r\n            feed[spellId].icon = cooldown.feed[spellId].icon;\r\n          }\r\n          const rawHealing = cooldown.feed[spellId].healing;\r\n          const effectiveHealing = rawHealing * (1 - percentOverheal) * feedingFactor;\r\n          feed[spellId].healing += rawHealing;\r\n          feed[spellId].effectiveHealing += effectiveHealing;\r\n          totals.total += rawHealing;\r\n          totals.totalEffective += effectiveHealing;\r\n        });\r\n\r\n        this.generateFeedEvents(cooldown, feedingFactor, percentOverheal);\r\n\r\n        cooldown.processed = true;\r\n      });\r\n  }\r\n\r\n  // Fabricate new events to make it easy to listen to just feed heal events while being away of the original heals.\r\n  // While we could also modify the original heal event and add a reference to the feed amount, this would be less clean as mutating objects makes things harder and more confusing to use, and may lead to conflicts.\r\n  // Due to how the Shaman CooldonwThroughputTracker works, these events will be bunched together at the very end of the events list.\r\n  generateFeedEvents(cooldown, feedingFactor, percentOverheal) {\r\n    cooldown.events.forEach((event) => {\r\n      if (event.type !== EventType.Heal || !cooldown.feed[event.ability.guid]) {\r\n        return;\r\n      }\r\n\r\n      // skipping all the events that do not get treated anyway, helping calculation time and removing a lot of fabricated event spam\r\n      if (event.ability.guid === SPELLS.ASCENDANCE_HEAL.id || event.ability.guid === SPELLS.CLOUDBURST_TOTEM_HEAL.id) {\r\n        return;\r\n      }\r\n\r\n      const eventFeed = ((event.amount || 0) + (event.absorbed || 0) + (event.overheal || 0)) * feedingFactor * (1 - percentOverheal);\r\n\r\n      this.eventEmitter.fabricateEvent({\r\n        ...event,\r\n        type: EventType.FeedHeal,\r\n        feed: eventFeed,\r\n      }, cooldown.spell);\r\n    });\r\n  }\r\n\r\n  getIndirectHealing(spellId) {\r\n    let healing = 0;\r\n    if (this.cbtFeed[spellId]) {\r\n      healing += this.cbtFeed[spellId].effectiveHealing || 0;\r\n    }\r\n\r\n    if (this.ascFeed[spellId]) {\r\n      healing += this.ascFeed[spellId].effectiveHealing || 0;\r\n    }\r\n\r\n    return healing;\r\n  }\r\n\r\n  addNewCooldown(spell, timestamp) {\r\n    const cooldown = {\r\n      ...spell,\r\n      start: timestamp,\r\n      end: null,\r\n      processed: false,\r\n      healing: 0,\r\n      overheal: 0,\r\n      feed: [],\r\n      events: [],\r\n    };\r\n\r\n    this.pastCooldowns.push(cooldown);\r\n    this.activeCooldowns.push(cooldown);\r\n\r\n    return cooldown;\r\n  }\r\n\r\n  popCBT(event) {\r\n    const index = this.activeCooldowns.findIndex(cooldown => cooldown.spell.id === SPELLS.CLOUDBURST_TOTEM_TALENT.id);\r\n    if (index === -1) {\r\n      return;\r\n    }\r\n    const cooldown = this.activeCooldowns[index];\r\n    cooldown.end = event.timestamp;\r\n    this.activeCooldowns.splice(index, 1);\r\n  }\r\n\r\n  constructor(...args) {\r\n    super(...args);\r\n    // Store cooldown info in case it was cast before pull. If we see a cast before it expires, all data in it is discarded.\r\n    this.lastCBT = this.addNewCooldown({\r\n      spell: SPELLS.CLOUDBURST_TOTEM_TALENT,\r\n      summary: [\r\n        BUILT_IN_SUMMARY_TYPES.HEALING,\r\n        BUILT_IN_SUMMARY_TYPES.OVERHEALING,\r\n        BUILT_IN_SUMMARY_TYPES.MANA,\r\n      ],\r\n    }, this.owner.fight.start_time);\r\n    this.lastAsc = this.addNewCooldown({\r\n      spell: SPELLS.ASCENDANCE_TALENT_RESTORATION,\r\n      summary: [\r\n        BUILT_IN_SUMMARY_TYPES.HEALING,\r\n        BUILT_IN_SUMMARY_TYPES.OVERHEALING,\r\n        BUILT_IN_SUMMARY_TYPES.MANA,\r\n      ],\r\n    }, this.owner.fight.start_time);\r\n  }\r\n\r\n  onApplyBuffToPlayer(event) {\r\n    const spellId = event.ability.guid;\r\n    const spell = this.constructor.cooldownSpells.find(cooldownSpell => cooldownSpell.spell.id === spellId);\r\n    if (!spell) {\r\n      return;\r\n    }\r\n\r\n    // If the Asc we stored on pull is still up, discard all data in it.\r\n    if (spellId === SPELLS.ASCENDANCE_TALENT_RESTORATION.id) {\r\n      if (this.activeCooldowns.findIndex(cooldown => cooldown.spell.id === spellId) !== -1) {\r\n        this.removeLastCooldown(spellId);\r\n      }\r\n    }\r\n\r\n    const cooldown = this.addNewCooldown(spell, event.timestamp);\r\n\r\n    if (spellId === SPELLS.ASCENDANCE_TALENT_RESTORATION.id) {\r\n      this.lastAsc = cooldown;\r\n      this.hasBeenAscHealingOrCastEvent = true;\r\n    }\r\n  }\r\n\r\n  onFightend() {\r\n    if (!this.hasBeenAscHealingOrCastEvent && this.lastAsc) {\r\n      this.removeLastCooldown(SPELLS.ASCENDANCE_TALENT_RESTORATION.id);\r\n    }\r\n\r\n    if (!this.hasBeenCBTHealingEvent && this.lastCBT) {\r\n      this.removeLastCooldown(SPELLS.CLOUDBURST_TOTEM_TALENT.id);\r\n    }\r\n\r\n    this.activeCooldowns.forEach((cooldown) => {\r\n      cooldown.end = this.owner.fight.end_time;\r\n\r\n      // If cloudburst is still up at the end of the fight, it didn't do any healing, so dont process it.\r\n      if (cooldown.spell.id === SPELLS.CLOUDBURST_TOTEM_TALENT.id) {\r\n        cooldown.processed = true;\r\n      }\r\n    });\r\n    this.activeCooldowns = [];\r\n\r\n    this.processAll();\r\n  }\r\n\r\n  onCast(event) {\r\n    const spellId = event.ability.guid;\r\n\r\n    if (spellId === SPELLS.CLOUDBURST_TOTEM_TALENT.id) {\r\n      if (!this.hasBeenCBTHealingEvent) {\r\n        // If the CBT we stored on pull is still up, discard all data in it.\r\n        this.removeLastCooldown(SPELLS.CLOUDBURST_TOTEM_TALENT.id);\r\n      }\r\n      this.lastCBT = this.addNewCooldown({\r\n        spell: SPELLS.CLOUDBURST_TOTEM_TALENT,\r\n        summary: [\r\n          BUILT_IN_SUMMARY_TYPES.HEALING,\r\n          BUILT_IN_SUMMARY_TYPES.OVERHEALING,\r\n          BUILT_IN_SUMMARY_TYPES.MANA,\r\n        ],\r\n      }, event.timestamp);\r\n    }\r\n\r\n    super.onCast(event);\r\n  }\r\n\r\n  removeLastCooldown(spellId) {\r\n    const indexactiveCooldowns = this.activeCooldowns.findIndex(cooldown => cooldown.spell.id === spellId);\r\n\r\n    const reverseIndexCooldowns = [...this.pastCooldowns].reverse().findIndex(cooldown => cooldown.spell.id === spellId);\r\n    const indexCooldowns = this.pastCooldowns.length - reverseIndexCooldowns - 1;\r\n\r\n    if (indexactiveCooldowns !== -1 && indexCooldowns !== -1) {\r\n      this.activeCooldowns.splice(indexactiveCooldowns, 1);\r\n      this.pastCooldowns.splice(indexCooldowns, 1);\r\n    }\r\n  }\r\n\r\n  onHeal(event) {\r\n    if (event.ability.guid === SPELLS.CLOUDBURST_TOTEM_HEAL.id && this.lastCBT) {\r\n      this.hasBeenCBTHealingEvent = true;\r\n      this.popCBT(event);\r\n      this.lastCBT.healing += (event.amount || 0) + (event.absorbed || 0);\r\n      this.lastCBT.overheal += (event.overheal || 0);\r\n    } else if (event.ability.guid === SPELLS.ASCENDANCE_HEAL.id && this.lastAsc) {\r\n      this.hasBeenAscHealingOrCastEvent = true;\r\n      this.lastAsc.healing += (event.amount || 0) + (event.absorbed || 0);\r\n      this.lastAsc.overheal += (event.overheal || 0);\r\n    }\r\n\r\n    const spellId = event.ability.guid;\r\n    const healingDone = (event.amount || 0) + (event.absorbed || 0) + (event.overheal || 0);\r\n\r\n    this.activeCooldowns.forEach((cooldown) => {\r\n      const cooldownId = cooldown.spell.id;\r\n\r\n      if ((cooldownId === SPELLS.CLOUDBURST_TOTEM_TALENT.id && ABILITIES_FEEDING_INTO_CBT.some(s => s.id === spellId)) ||\r\n        (cooldownId === SPELLS.ASCENDANCE_TALENT_RESTORATION.id && !ABILITIES_NOT_FEEDING_INTO_ASCENDANCE.some(s => s.id === spellId))) {\r\n        if (!cooldown.feed[spellId]) {\r\n          cooldown.feed[spellId] = [];\r\n          cooldown.feed[spellId].healing = 0;\r\n          cooldown.feed[spellId].name = event.ability.name;\r\n          cooldown.feed[spellId].icon = event.ability.abilityIcon;\r\n        }\r\n        cooldown.feed[spellId].healing += healingDone;\r\n      }\r\n      cooldown.events.push(event);\r\n    });\r\n  }\r\n\r\n  onAbsorb(event) {\r\n    this.activeCooldowns.forEach((cooldown) => {\r\n      cooldown.events.push(event);\r\n    });\r\n  }\r\n}\r\n\r\nexport default CooldownThroughputTracker;\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport { STATISTIC_ORDER } from 'interface/others/StatisticsListBox';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport DonutChart from 'interface/statistics/components/DonutChart';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\nimport Events, { CastEvent, HealEvent, RemoveBuffEvent } from 'parser/core/Events';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport { RESTORATION_COLORS } from 'parser/shaman/restoration/constants';\r\n\r\nimport CooldownThroughputTracker from '../features/CooldownThroughputTracker';\r\n\r\nconst UNLEASH_LIFE_HEALING_INCREASE = 0.35;\r\nconst BUFFER_MS = 200;\r\nconst UNLEASH_LIFE_DURATION = 10000;\r\nconst debug = false;\r\n\r\ninterface HealingBuffInfo {\r\n  [SpellID: number]: HealingBuffHot | HealingBuff\r\n}\r\n\r\ninterface HealingBuffHot {\r\n  healing: number,\r\n  castAmount: number,\r\n  playersActive: number[]\r\n}\r\n\r\ninterface HealingBuff {\r\n  healing: number,\r\n  castAmount: number\r\n}\r\n\r\n/**\r\n * Unleash Life:\r\n * Unleashes elemental forces of Life, healing a friendly target and increasing the effect of the Shaman's next direct heal.\r\n */\r\n\r\nclass UnleashLife extends Analyzer {\r\n  static dependencies = {\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n  };\r\n\r\n  protected cooldownThroughputTracker!: CooldownThroughputTracker;\r\n\r\n  healing = 0;\r\n  healingBuff: HealingBuffInfo = {\r\n    [SPELLS.RIPTIDE.id]: {\r\n      healing: 0,\r\n      castAmount: 0,\r\n      playersActive: [],\r\n    },\r\n    [SPELLS.CHAIN_HEAL.id]: {\r\n      healing: 0,\r\n      castAmount: 0,\r\n    },\r\n    [SPELLS.HEALING_WAVE.id]: {\r\n      healing: 0,\r\n      castAmount: 0,\r\n    },\r\n    [SPELLS.HEALING_SURGE.id]: {\r\n      healing: 0,\r\n      castAmount: 0,\r\n    },\r\n  };\r\n\r\n  unleashLifeCasts = 0;\r\n  unleashLifeRemaining = false;\r\n  unleashLifeHealRemaining = 0;\r\n\r\n  buffedChainHealTimestamp: number = Number.MIN_SAFE_INTEGER;\r\n  lastUnleashLifeTimestamp: number = Number.MAX_SAFE_INTEGER;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.UNLEASH_LIFE_TALENT.id);\r\n\r\n    const spellFilter = [SPELLS.UNLEASH_LIFE_TALENT, SPELLS.RIPTIDE, SPELLS.CHAIN_HEAL, SPELLS.HEALING_WAVE, SPELLS.HEALING_SURGE]; // TODO ADD CHAIN HARVEST\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(spellFilter), this._onHeal);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(spellFilter), this._onCast);\r\n    this.addEventListener(Events.removebuff.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this._onRiptideRemoval);\r\n  }\r\n\r\n  _onHeal(event: HealEvent) {\r\n    const spellId = event.ability.guid;\r\n\r\n    if (spellId === SPELLS.UNLEASH_LIFE_TALENT.id) {\r\n      this.unleashLifeHealRemaining = 1;\r\n      this.lastUnleashLifeTimestamp = event.timestamp;\r\n      this.healing += event.amount + (event.absorbed || 0);\r\n    }\r\n\r\n    if (this.unleashLifeHealRemaining > 0 && (this.lastUnleashLifeTimestamp + UNLEASH_LIFE_DURATION) <= event.timestamp) {\r\n      debug && console.log('Heal Timed out', event.timestamp);\r\n      this.unleashLifeHealRemaining = 0;\r\n    }\r\n\r\n    // Riptide HoT handling, ticks on whoever its active\r\n    if (spellId === SPELLS.RIPTIDE.id && (this.healingBuff[spellId] as HealingBuffHot).playersActive.includes(event.targetID)) {\r\n      if (event.tick) {\r\n        this.healingBuff[spellId].healing += calculateEffectiveHealing(event, UNLEASH_LIFE_HEALING_INCREASE);\r\n\r\n        // Initial Riptide Heal without Unleash Life\r\n        // casting an unbuffed Riptide on a target that already has a buffed Riptide, will completely negate the buff, so we remove that person\r\n      } else if (!event.tick && !this.unleashLifeHealRemaining) {\r\n        (this.healingBuff[spellId] as HealingBuffHot).playersActive.splice((this.healingBuff[spellId] as HealingBuffHot).playersActive.indexOf(event.targetID), 1);\r\n      }\r\n    }\r\n\r\n    // These 3 heals only have 1 event and are handled easily\r\n    if (this.unleashLifeHealRemaining > 0 && ((spellId === SPELLS.HEALING_WAVE.id) || (spellId === SPELLS.HEALING_SURGE.id) || (spellId === SPELLS.RIPTIDE.id && !event.tick))) {\r\n      this.healingBuff[spellId].healing += calculateEffectiveHealing(event, UNLEASH_LIFE_HEALING_INCREASE);\r\n      this.unleashLifeHealRemaining = 0;\r\n      debug && console.log('Heal:', spellId);\r\n\r\n      // I had to move the HoT application to the heal event as the buffapply event had too many false positives\r\n      if (spellId === SPELLS.RIPTIDE.id) {\r\n        (this.healingBuff[spellId] as HealingBuffHot).playersActive.push(event.targetID);\r\n        debug && console.log('HoT Applied:', spellId, event.targetID);\r\n      }\r\n\r\n      // Chain heal has up to 4 events, setting the variable to -1 to indicate that there might be more events coming\r\n    } else if (spellId === SPELLS.CHAIN_HEAL.id && (this.unleashLifeHealRemaining > 0 || (this.unleashLifeHealRemaining < 0 && this.buffedChainHealTimestamp + BUFFER_MS > event.timestamp))) {\r\n      this.healingBuff[spellId].healing += calculateEffectiveHealing(event, UNLEASH_LIFE_HEALING_INCREASE);\r\n      this.unleashLifeHealRemaining = -1;\r\n      this.buffedChainHealTimestamp = event.timestamp;\r\n      debug && console.log('Heal:', spellId);\r\n    }\r\n  }\r\n\r\n  _onCast(event: CastEvent) {\r\n    const spellId = event.ability.guid;\r\n\r\n    if (spellId === SPELLS.UNLEASH_LIFE_TALENT.id) {\r\n      this.unleashLifeCasts += 1;\r\n      this.unleashLifeRemaining = true;\r\n      this.lastUnleashLifeTimestamp = event.timestamp;\r\n      debug && console.log('New Unleash', event.timestamp);\r\n    }\r\n\r\n    if (this.unleashLifeRemaining && (this.lastUnleashLifeTimestamp + UNLEASH_LIFE_DURATION) <= event.timestamp) {\r\n      this.unleashLifeRemaining = false;\r\n      debug && console.log('Cast Timed out', event.timestamp);\r\n      return;\r\n    }\r\n\r\n    if (this.unleashLifeRemaining) {\r\n      if (this.healingBuff[spellId]) {\r\n        this.healingBuff[spellId].castAmount += 1;\r\n        this.unleashLifeRemaining = false;\r\n        debug && console.log('Cast:', spellId);\r\n      }\r\n    }\r\n  }\r\n\r\n  _onRiptideRemoval(event: RemoveBuffEvent) {\r\n    const spellId = event.ability.guid;\r\n    if (!(this.healingBuff[spellId] as HealingBuffHot).playersActive.includes(event.targetID)) {\r\n      return;\r\n    }\r\n\r\n    (this.healingBuff[spellId] as HealingBuffHot).playersActive.splice((this.healingBuff[spellId] as HealingBuffHot).playersActive.indexOf(event.targetID), 1);\r\n  }\r\n\r\n  get totalBuffedHealing() {\r\n    return Object.values(this.healingBuff).reduce((sum, spell) => sum + spell.healing, 0);\r\n  }\r\n\r\n  get totalUses() {\r\n    return Object.values(this.healingBuff).reduce((sum, spell) => sum + spell.castAmount, 0);\r\n  }\r\n\r\n  get unleashLifeCastRatioChart() {\r\n    const unusedUL = this.unleashLifeCasts - this.totalUses;\r\n\r\n    const items = [\r\n      {\r\n        color: RESTORATION_COLORS.CHAIN_HEAL,\r\n        label: <Trans id=\"shaman.restoration.spell.chainHeal\">Chain Heal</Trans>,\r\n        spellId: SPELLS.CHAIN_HEAL.id,\r\n        value: this.healingBuff[SPELLS.CHAIN_HEAL.id].castAmount,\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.HEALING_WAVE,\r\n        label: <Trans id=\"shaman.restoration.spell.healingWave\">Healing Wave</Trans>,\r\n        spellId: SPELLS.HEALING_WAVE.id,\r\n        value: this.healingBuff[SPELLS.HEALING_WAVE.id].castAmount,\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.HEALING_SURGE,\r\n        label: <Trans id=\"shaman.restoration.spell.healingSurge\">Healing Surge</Trans>,\r\n        spellId: SPELLS.HEALING_SURGE.id,\r\n        value: this.healingBuff[SPELLS.HEALING_SURGE.id].castAmount,\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.RIPTIDE,\r\n        label: <Trans id=\"shaman.restoration.spell.riptide\">Riptide</Trans>,\r\n        spellId: SPELLS.RIPTIDE.id,\r\n        value: this.healingBuff[SPELLS.RIPTIDE.id].castAmount,\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.UNUSED,\r\n        label: <Trans id=\"shaman.restoration.unleashLife.chart.unused.label\">Unused Buffs</Trans>,\r\n        tooltip: <Trans id=\"shaman.restoration.unleashLife.chart.unused.label.tooltip\">The amount of Unleash Life buffs you did not use out of the total available. You cast {this.unleashLifeCasts} Unleash Lifes, of which you used {this.totalUses}.</Trans>,\r\n        value: unusedUL,\r\n      },\r\n    ];\r\n\r\n    return (\r\n      <DonutChart\r\n        items={items}\r\n      />\r\n    );\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        position={STATISTIC_ORDER.OPTIONAL(15)}\r\n        size=\"flexible\"\r\n      >\r\n        <div className=\"pad\">\r\n          <label><Trans id=\"shaman.restoration.unleashLife.statistic.label\"><SpellLink id={SPELLS.UNLEASH_LIFE_TALENT.id} /> usage</Trans></label>\r\n          {this.unleashLifeCastRatioChart}\r\n        </div>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n  subStatistic() {\r\n    const feeding = this.cooldownThroughputTracker.getIndirectHealing(SPELLS.UNLEASH_LIFE_TALENT.id);\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.UNLEASH_LIFE_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing + this.totalBuffedHealing + feeding))} %`}\r\n        valueTooltip={<Trans id=\"shaman.restoration.unleashLife.statistic.tooltip\">{formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing + feeding))}% from Unleash Life and {formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.totalBuffedHealing))}% from the healing buff.</Trans>}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default UnleashLife;\r\n\r\n","import DamageDone from 'parser/shared/modules/throughput/DamageDone';\r\nimport CastEfficiency from 'parser/shared/modules/CastEfficiency';\r\nimport Abilities from 'parser/core/modules/Abilities';\r\nimport CoreHealingEfficiencyTracker, { SpellInfoDetails } from 'parser/core/healingEfficiency/HealingEfficiencyTracker';\r\nimport ManaTracker from 'parser/core/healingEfficiency/ManaTracker';\r\nimport EarthShield from 'parser/shaman/shared/talents/EarthShield';\r\nimport SPELLS from 'common/SPELLS';\r\n\r\nimport HealingDone from './HealingDone';\r\nimport RestorationAbilityTracker from './RestorationAbilityTracker';\r\nimport Resurgence from '../spells/Resurgence';\r\nimport CooldownThroughputTracker from '../features/CooldownThroughputTracker';\r\nimport UnleashLife from '../talents/UnleashLife';\r\n\r\nclass HealingEfficiencyTracker extends CoreHealingEfficiencyTracker {\r\n  static dependencies = {\r\n    manaTracker: ManaTracker,\r\n    abilityTracker: RestorationAbilityTracker,\r\n    healingDone: HealingDone,\r\n    damageDone: DamageDone,\r\n    castEfficiency: CastEfficiency,\r\n    abilities: Abilities,\r\n    resurgence: Resurgence,\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n    unleashLife: UnleashLife,\r\n    earthShield: EarthShield,\r\n  };\r\n\r\n  protected manaTracker!: ManaTracker;\r\n  protected abilityTracker!: RestorationAbilityTracker;\r\n  protected healingDone!: HealingDone;\r\n  protected damageDone!: DamageDone;\r\n  protected castEfficiency!: CastEfficiency;\r\n  protected abilities!: Abilities;\r\n  protected resurgence!: Resurgence;\r\n  protected cooldownThroughputTracker!: CooldownThroughputTracker;\r\n  protected unleashLife!: UnleashLife;\r\n  protected earthShield!: EarthShield;\r\n\r\n  getCustomSpellStats(spellInfo: SpellInfoDetails, spellId: number) {\r\n    if (this.resurgence.resurgence[spellId]) {\r\n      this.getResurgenceDetails(spellInfo, spellId);\r\n    }\r\n    if (spellId === SPELLS.UNLEASH_LIFE_TALENT.id) {\r\n      this.getUnleashLifeDetails(spellInfo);\r\n    } else if (this.unleashLife.healingBuff[spellId]) {\r\n      this.getUnleashLifeBuffDetails(spellInfo, spellId);\r\n    } else if (spellId === SPELLS.EARTH_SHIELD.id) {\r\n      this.getEarthShieldBuffDetails(spellInfo);\r\n    } else if (spellId === SPELLS.LAVA_BURST.id) {\r\n      this.getLavaBurstDamageDetails(spellInfo);\r\n    }\r\n\r\n    return spellInfo;\r\n  }\r\n\r\n  // Resurgence \"refunds\" mana, so the spell is essentially cheaper\r\n  getResurgenceDetails(spellInfo: SpellInfoDetails, spellId: number) {\r\n    spellInfo.manaSpent -= this.resurgence.resurgence[spellId].resurgenceTotal;\r\n  }\r\n\r\n  // Healing from other spells that Unleash Life is responsible for\r\n  getUnleashLifeDetails(spellInfo: SpellInfoDetails) {\r\n    const unleashLifeContribution = this.unleashLife.totalBuffedHealing;\r\n    spellInfo.healingDone += unleashLifeContribution;\r\n  }\r\n\r\n  // Remove Unleash Life's contribution to the affected spells\r\n  getUnleashLifeBuffDetails(spellInfo: SpellInfoDetails, spellId: number) {\r\n    const unleashLifeContribution = (this.unleashLife.healingBuff[spellId].healing || 0);\r\n    spellInfo.healingDone -= unleashLifeContribution;\r\n  }\r\n\r\n  // Todo: Same treatment for Earth Shield as for Unleash Life and remove the healing from affected spells\r\n  getEarthShieldBuffDetails(spellInfo: SpellInfoDetails) {\r\n    spellInfo.healingDone += this.earthShield.buffHealing || 0;\r\n  }\r\n\r\n  // Different spellId for damage and no existing \"damageSpellIds\" implementation\r\n  getLavaBurstDamageDetails(spellInfo: SpellInfoDetails) {\r\n    const ability = this.abilityTracker.getAbility(SPELLS.LAVA_BURST_DAMAGE.id);\r\n    spellInfo.damageHits = ability.damageHits || 0;\r\n    spellInfo.damageDone = ability.damageEffective || 0;\r\n    spellInfo.damageAbsorbed = ability.damageAbsorbed || 0;\r\n  }\r\n}\r\n\r\nexport default HealingEfficiencyTracker;\r\n","import { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\nimport SPELLS from 'common/SPELLS';\r\nimport ISSUE_IMPORTANCE from 'parser/core/ISSUE_IMPORTANCE';\r\nimport CoreAbilities from 'parser/core/modules/Abilities';\r\nimport { SpellbookAbility } from 'parser/core/modules/Ability';\r\nimport { TrackedRestoShamanAbility } from 'parser/shaman/restoration/modules/core/RestorationAbilityTracker';\r\n\r\nconst totemGCD = 1000;\r\n\r\nclass Abilities extends CoreAbilities {\r\n  spellbook(): Array<SpellbookAbility<TrackedRestoShamanAbility>> {\r\n    const combatant = this.selectedCombatant;\r\n    return [\r\n      {\r\n        spell: SPELLS.RIPTIDE,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        charges: combatant.hasTalent(SPELLS.ECHO_OF_THE_ELEMENTS_TALENT.id) ? 2 : 1,\r\n        cooldown: 6,\r\n        timelineSortIndex: 11,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: combatant.hasTalent(SPELLS.ECHO_OF_THE_ELEMENTS_TALENT.id) ? 0.75 : 0.60,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.HEALING_STREAM_TOTEM_CAST,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        charges: combatant.hasTalent(SPELLS.ECHO_OF_THE_ELEMENTS_TALENT.id) ? 2 : 1,\r\n        timelineSortIndex: 18,\r\n        enabled: !combatant.hasTalent(SPELLS.CLOUDBURST_TOTEM_TALENT.id),\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        cooldown: 30,\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.50,\r\n          averageIssueEfficiency: 0.70,\r\n          recommendedEfficiency: 0.90,\r\n        },\r\n        healSpellIds: [\r\n          SPELLS.HEALING_STREAM_TOTEM_HEAL.id,\r\n        ],\r\n      },\r\n      {\r\n        spell: SPELLS.ASTRAL_SHIFT,\r\n        buffSpellId: SPELLS.ASTRAL_SHIFT.id,\r\n        category: Abilities.SPELL_CATEGORIES.DEFENSIVE,\r\n        timelineSortIndex: 82,\r\n        cooldown: 90,\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          recommendedEfficiency: 0.6,\r\n          importance: ISSUE_IMPORTANCE.MINOR,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.HEALING_RAIN_CAST,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        cooldown: 10,\r\n        timelineSortIndex: 17,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.30,\r\n          averageIssueEfficiency: 0.50,\r\n          recommendedEfficiency: 0.70,\r\n        },\r\n        healSpellIds: [\r\n          SPELLS.HEALING_RAIN_HEAL.id,\r\n        ],\r\n      },\r\n      {\r\n        spell: SPELLS.WELLSPRING_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        cooldown: 20,\r\n        timelineSortIndex: 20,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        enabled: combatant.lv50Talent === SPELLS.WELLSPRING_TALENT.id,\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.30,\r\n          averageIssueEfficiency: 0.50,\r\n          recommendedEfficiency: 0.70,\r\n        },\r\n        healSpellIds: [\r\n          SPELLS.WELLSPRING_HEAL.id,\r\n        ],\r\n      },\r\n      {\r\n        spell: SPELLS.CLOUDBURST_TOTEM_TALENT,\r\n        buffSpellId: SPELLS.CLOUDBURST_TOTEM_TALENT.id,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        charges: combatant.hasTalent(SPELLS.ECHO_OF_THE_ELEMENTS_TALENT.id) ? 2 : 1,\r\n        cooldown: 30,\r\n        timelineSortIndex: 16,\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        enabled: combatant.hasTalent(SPELLS.CLOUDBURST_TOTEM_TALENT.id),\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.50,\r\n          averageIssueEfficiency: 0.70,\r\n          recommendedEfficiency: 0.90,\r\n        },\r\n        healSpellIds: [\r\n          SPELLS.CLOUDBURST_TOTEM_HEAL.id,\r\n        ],\r\n      },\r\n      {\r\n        spell: SPELLS.EARTHEN_WALL_TOTEM_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        cooldown: 60,\r\n        timelineSortIndex: 20,\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        enabled: combatant.hasTalent(SPELLS.EARTHEN_WALL_TOTEM_TALENT.id),\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.50,\r\n          averageIssueEfficiency: 0.70,\r\n          recommendedEfficiency: 0.90,\r\n        },\r\n        healSpellIds: [\r\n          SPELLS.EARTHEN_WALL_TOTEM_ABSORB.id,\r\n        ],\r\n      },\r\n      {\r\n        spell: SPELLS.UNLEASH_LIFE_TALENT,\r\n        buffSpellId: SPELLS.UNLEASH_LIFE_TALENT.id,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        cooldown: 15,\r\n        timelineSortIndex: 5,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        enabled: combatant.lv15Talent === SPELLS.UNLEASH_LIFE_TALENT.id,\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.50,\r\n          averageIssueEfficiency: 0.70,\r\n          recommendedEfficiency: 0.90,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.ASCENDANCE_TALENT_RESTORATION,\r\n        buffSpellId: SPELLS.ASCENDANCE_TALENT_RESTORATION.id,\r\n        category: Abilities.SPELL_CATEGORIES.COOLDOWNS,\r\n        cooldown: 180,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        enabled: combatant.lv50Talent === SPELLS.ASCENDANCE_TALENT_RESTORATION.id,\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.2,\r\n          averageIssueEfficiency: 0.5,\r\n          recommendedEfficiency: 0.8,\r\n        },\r\n        healSpellIds: [\r\n          SPELLS.ASCENDANCE_HEAL.id,\r\n          SPELLS.ASCENDANCE_INITIAL_HEAL.id,\r\n        ],\r\n      },\r\n      {\r\n        spell: SPELLS.HEALING_TIDE_TOTEM_CAST,\r\n        buffSpellId: SPELLS.HEALING_TIDE_TOTEM_CAST.id,\r\n        category: Abilities.SPELL_CATEGORIES.COOLDOWNS,\r\n        cooldown: 180,\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.2,\r\n          averageIssueEfficiency: 0.5,\r\n          recommendedEfficiency: 0.7,\r\n        },\r\n        healSpellIds: [\r\n          SPELLS.HEALING_TIDE_TOTEM_HEAL.id,\r\n        ],\r\n      },\r\n      {\r\n        spell: SPELLS.SPIRIT_LINK_TOTEM,\r\n        category: Abilities.SPELL_CATEGORIES.COOLDOWNS,\r\n        cooldown: 180,\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.2,\r\n          averageIssueEfficiency: 0.4,\r\n          recommendedEfficiency: 0.6,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.MANA_TIDE_TOTEM_CAST,\r\n        category: Abilities.SPELL_CATEGORIES.COOLDOWNS,\r\n        cooldown: 180,\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.2,\r\n          averageIssueEfficiency: 0.4,\r\n          recommendedEfficiency: 0.6,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.HEALING_WAVE,\r\n        timelineSortIndex: 13,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        category: Abilities.SPELL_CATEGORIES.OTHERS,\r\n        castEfficiency: {\r\n          casts: castCount => castCount.casts - (castCount.healingTwHits || 0),\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.HEALING_WAVE,\r\n        name: i18n._(t('shaman.restoration.abilities.buffedByTidalWave')`Tidal Waved ${SPELLS.HEALING_WAVE.name}`),\r\n        timelineSortIndex: 13,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        category: Abilities.SPELL_CATEGORIES.OTHERS,\r\n        castEfficiency: {\r\n          casts: castCount => castCount.healingTwHits || 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.HEALING_SURGE,\r\n        timelineSortIndex: 14,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        category: Abilities.SPELL_CATEGORIES.OTHERS,\r\n        castEfficiency: {\r\n          casts: castCount => (castCount.casts) - (castCount.healingTwHits || 0),\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.HEALING_SURGE,\r\n        name: i18n._(t('shaman.restoration.abilities.buffedByTidalWave')`Tidal Waved ${SPELLS.HEALING_SURGE.name}`),\r\n        timelineSortIndex: 14,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        category: Abilities.SPELL_CATEGORIES.OTHERS,\r\n        castEfficiency: {\r\n          casts: castCount => castCount.healingTwHits || 0,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.CHAIN_HEAL,\r\n        buffSpellId: SPELLS.HIGH_TIDE_BUFF.id,\r\n        category: Abilities.SPELL_CATEGORIES.OTHERS,\r\n        timelineSortIndex: 12,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.PURIFY_SPIRIT,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        timelineSortIndex: 80,\r\n        cooldown: 8,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.FLAME_SHOCK,\r\n        buffSpellId: SPELLS.FLAME_SHOCK.id,\r\n        category: Abilities.SPELL_CATEGORIES.HEALER_DAMAGING_SPELL,\r\n        timelineSortIndex: 60,\r\n        cooldown: 6,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.LAVA_BURST,\r\n        buffSpellId: SPELLS.LAVA_SURGE.id,\r\n        category: Abilities.SPELL_CATEGORIES.HEALER_DAMAGING_SPELL,\r\n        charges: combatant.hasTalent(SPELLS.ECHO_OF_THE_ELEMENTS_TALENT.id) ? 2 : 1,\r\n        timelineSortIndex: 60,\r\n        cooldown: 8,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.LIGHTNING_BOLT,\r\n        category: Abilities.SPELL_CATEGORIES.HEALER_DAMAGING_SPELL,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        timelineSortIndex: 60,\r\n      },\r\n      {\r\n        spell: SPELLS.CHAIN_LIGHTNING,\r\n        category: Abilities.SPELL_CATEGORIES.HEALER_DAMAGING_SPELL,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        timelineSortIndex: 60,\r\n      },\r\n      {\r\n        spell: SPELLS.GHOST_WOLF,\r\n        buffSpellId: SPELLS.GHOST_WOLF.id,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        timelineSortIndex: 80,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.SPIRITWALKERS_GRACE,\r\n        buffSpellId: SPELLS.SPIRITWALKERS_GRACE.id,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: combatant.hasTalent(SPELLS.GRACEFUL_SPIRIT_TALENT.id) ? 60 : 120,\r\n        timelineSortIndex: 81,\r\n      },\r\n      {\r\n        spell: SPELLS.EARTHBIND_TOTEM,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        timelineSortIndex: 80,\r\n        gcd: {\r\n          base: totemGCD, // totem GCD but affected by Haste for some reason\r\n        },\r\n        cooldown: 30,\r\n      },\r\n      {\r\n        spell: SPELLS.PURGE,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        timelineSortIndex: 80,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.CAPACITOR_TOTEM,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        timelineSortIndex: 80,\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        cooldown: 60,\r\n      },\r\n      {\r\n        spell: SPELLS.WIND_RUSH_TOTEM_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        timelineSortIndex: 80,\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        enabled: combatant.hasTalent(SPELLS.WIND_RUSH_TOTEM_TALENT.id),\r\n        cooldown: 120,\r\n      },\r\n      {\r\n        spell: SPELLS.EARTHGRAB_TOTEM_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        timelineSortIndex: 80,\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        enabled: combatant.hasTalent(SPELLS.EARTHGRAB_TOTEM_TALENT.id),\r\n        cooldown: 30,\r\n      },\r\n      {\r\n        spell: SPELLS.ANCESTRAL_PROTECTION_TOTEM_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.COOLDOWNS,\r\n        gcd: {\r\n          static: totemGCD,\r\n        },\r\n        enabled: combatant.hasTalent(SPELLS.ANCESTRAL_PROTECTION_TOTEM_TALENT.id),\r\n        cooldown: 300,\r\n      },\r\n      {\r\n        spell: SPELLS.REINCARNATION,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 1800,\r\n      },\r\n      {\r\n        spell: SPELLS.WIND_SHEAR,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        timelineSortIndex: 80,\r\n        cooldown: 12,\r\n        gcd: null,\r\n      },\r\n      {\r\n        // had to remove SPELLS.HEX_SKELETAL since the Blizzard API doesn't think it exists, causing issues. Please add it again if it's encountered in a log, and if so leave a comment with the log\r\n        spell: [SPELLS.HEX, SPELLS.HEX_RAPTOR, SPELLS.HEX_SNAKE, SPELLS.HEX_SPIDER, SPELLS.HEX_COCKROACH],\r\n        buffSpellId: [SPELLS.HEX.id, SPELLS.HEX_RAPTOR.id, SPELLS.HEX_SNAKE.id, SPELLS.HEX_SPIDER.id, SPELLS.HEX_COCKROACH.id],\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        timelineSortIndex: 80,\r\n        cooldown: 30,\r\n      },\r\n      {\r\n        spell: SPELLS.EARTH_SHIELD,\r\n        category: Abilities.SPELL_CATEGORIES.OTHERS,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        timelineSortIndex: 80,\r\n        healSpellIds: [\r\n          SPELLS.EARTH_SHIELD_HEAL.id,\r\n        ],\r\n      },\r\n      {\r\n        spell: SPELLS.TREMOR_TOTEM,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 60,\r\n        gcd: {\r\n          base: totemGCD, // totem GCD but affected by Haste for some reason\r\n        },\r\n        timelineSortIndex: 80,\r\n      },\r\n      {\r\n        spell: SPELLS.DOWNPOUR_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL,\r\n        cooldown: 35, // CD changes depending on amount of effective targets hit (0 = 5s, 6 = 35s)\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        timelineSortIndex: 20,\r\n        enabled: combatant.hasTalent(SPELLS.DOWNPOUR_TALENT.id),\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.20,\r\n          averageIssueEfficiency: 0.40,\r\n          recommendedEfficiency: 0.60,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.BERSERKING,\r\n        buffSpellId: SPELLS.BERSERKING.id,\r\n        category: Abilities.SPELL_CATEGORIES.COOLDOWNS,\r\n        cooldown: 180,\r\n        isUndetectable: true,\r\n        gcd: null,\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: 0.2,\r\n          averageIssueEfficiency: 0.5,\r\n          recommendedEfficiency: 0.7,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.EARTH_ELEMENTAL,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        cooldown: 300,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        timelineSortIndex: 80,\r\n      },\r\n      {\r\n        spell: SPELLS.NATURES_GUARDIAN_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.DEFENSIVE,\r\n        cooldown: 45,\r\n        enabled: combatant.hasTalent(SPELLS.NATURES_GUARDIAN_TALENT.id),\r\n        healSpellIds: [\r\n          SPELLS.NATURES_GUARDIAN_HEAL.id,\r\n        ],\r\n      },\r\n      {\r\n        spell: SPELLS.ROCKET_JUMP,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        timelineSortIndex: 80,\r\n        cooldown: 90,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        isUndetectable: true,\r\n      },\r\n      {\r\n        spell: SPELLS.WATER_SHIELD,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.LIGHTNING_SHIELD,\r\n        category: Abilities.SPELL_CATEGORIES.UTILITY,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        isUndetectable: true, // its not but, why.\r\n      },\r\n      {\r\n        spell: SPELLS.FROST_SHOCK,\r\n        category: Abilities.SPELL_CATEGORIES.HEALER_DAMAGING_SPELL,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n      },\r\n      {\r\n        spell: SPELLS.SURGE_OF_EARTH_TALENT,\r\n        category: Abilities.SPELL_CATEGORIES.ROTATIONAL, // Rotational? CD? idk, is there a \"useless\" category?\r\n        cooldown: 20,\r\n        gcd: {\r\n          base: 1500,\r\n        },\r\n        enabled: combatant.hasTalent(SPELLS.SURGE_OF_EARTH_TALENT.id),\r\n        healSpellIds: [\r\n          SPELLS.SURGE_OF_EARTH_HEAL.id,\r\n        ],\r\n        castEfficiency: {\r\n          suggestion: true,\r\n          majorIssueEfficiency: .4,\r\n          averageIssueEfficiency: .6,\r\n          recommendedEfficiency: .8,\r\n        },\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\nexport default Abilities;\r\n","import SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\n\r\n/**\r\n * Module to find the position of healing rain, and return how much extra healing spells modified by healing rain did.\r\n *\r\n * The position is calculated by gathering all coordinates of people getting healed by rain, finding the extremes and treating it as an ellipse.\r\n * Player position on heal is then compared against that.\r\n */\r\n\r\ninterface Point {\r\n  x: number,\r\n  y: number\r\n}\r\ninterface Location {\r\n  ellipseCenterPoint: Point;\r\n  ellipseWidth: number;\r\n  ellipseHeight: number;\r\n}\r\n\r\n\r\nclass HealingRainLocation extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n  };\r\n\r\n  protected combatants!: Combatants;\r\n\r\n  healingRainDiameter = 2100; // 5% margin of error\r\n  healingRainEvents: HealEvent[] = [];\r\n  newHealingRain = false;\r\n  lastHealingRainTick = 0;\r\n  firstHealingRainTick = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.DELUGE_TALENT.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.HEALING_RAIN_HEAL), this.healingRainHeal);\r\n    this.addEventListener(Events.begincast.by(SELECTED_PLAYER).spell(SPELLS.HEALING_RAIN_CAST), this.healingRainCast);\r\n  }\r\n\r\n  healingRainHeal(event: HealEvent) {\r\n    // Pets with their insane movement speed (or blinking) messed the size up, so I decided to filter them out\r\n    const combatant = this.combatants.getEntity(event);\r\n    if (!combatant) {\r\n      return;\r\n    }\r\n\r\n    if (this.newHealingRain) {\r\n      this.firstHealingRainTick = event.timestamp;\r\n      this.healingRainEvents.length = 0;\r\n      this.newHealingRain = false;\r\n    }\r\n\r\n    this.lastHealingRainTick = event.timestamp;\r\n    this.healingRainEvents.push(event);\r\n  }\r\n\r\n  // We use begincast instead of cast in this, and all modules depending on this, since it is the only event that is guaranteed\r\n  // to occur after Healing Rain is done, and before the next one starts, as the cast event tends to be in the middle between\r\n  // its own healing events, and we can't check for gaps in heal events as the cast time is faster than the time between ticks.\r\n  healingRainCast() {\r\n    // Setting a variable to reset the array on the next heal\r\n    // If we'd reset here it would sometimes clear the array before the healing is calculated\r\n    this.newHealingRain = true;\r\n  }\r\n\r\n  processHealingRain(eventsDuringRain: HealEvent[], healIncrease: number) {\r\n    if (this.healingRainEvents.length === 0) {\r\n      return 0;\r\n    }\r\n\r\n    const healingRainLocation = this.locate(this.healingRainEvents);\r\n\r\n    // No healingRainLocation is caused by having errors in the position data\r\n    if (!healingRainLocation) {\r\n      return 0;\r\n    }\r\n\r\n    // Filtering events that didn't actually happen during the rain cast we're looking at\r\n    const filteredEvents = eventsDuringRain.filter(event => event.timestamp >= this.firstHealingRainTick && event.timestamp <= this.lastHealingRainTick);\r\n    if (!filteredEvents) {\r\n      return 0;\r\n    }\r\n\r\n    return this.sumHealing(filteredEvents, healIncrease, healingRainLocation);\r\n  }\r\n\r\n  sumHealing(eventsDuringRain: HealEvent[], healIncrease: number, healingRainLocation: Location) {\r\n    return eventsDuringRain.reduce((healing, event) => {\r\n      const pointToCheck = { x: event.x, y: event.y };\r\n      if (this._isPlayerInsideHealingRain(pointToCheck, healingRainLocation)) {\r\n        return healing + calculateEffectiveHealing(event, healIncrease);\r\n      }\r\n      return healing;\r\n    }, 0);\r\n  }\r\n\r\n  locate(events: HealEvent[]) {\r\n    const { minY, maxY, minX, maxX } = events.reduce((result, event) => {\r\n      result.minY = Math.min(event.y, result.minY);\r\n      result.maxY = Math.max(event.y, result.maxY);\r\n      result.minX = Math.min(event.x, result.minX);\r\n      result.maxX = Math.max(event.x, result.maxX);\r\n      return result;\r\n    }, { minY: Number.MAX_VALUE, maxY: -Number.MAX_VALUE, minX: Number.MAX_VALUE, maxX: -Number.MAX_VALUE });\r\n\r\n    const ellipseWidth = (maxX - minX);\r\n    const ellipseHeight = (maxY - minY);\r\n\r\n    // If there are erroneous data, it's better to not count the rain instead of having it overvalue the effect.\r\n    if (ellipseHeight >= this.healingRainDiameter || ellipseWidth >= this.healingRainDiameter) {\r\n      console.warn(\r\n        'Reported Healing Rain size is too large, something went wrong.',\r\n        'Allowed Size:', this.healingRainDiameter,\r\n        'Reported Width:', ellipseWidth,\r\n        'Reported Height:', ellipseHeight,\r\n      );\r\n      return null;\r\n    }\r\n\r\n    const ellipseCenterPoint: Point = {\r\n      x: (maxX + minX) / 2,\r\n      y: (maxY + minY) / 2,\r\n    };\r\n\r\n    return { ellipseCenterPoint, ellipseWidth, ellipseHeight };\r\n  }\r\n\r\n  // also called: is point inside ellipse\r\n  _isPlayerInsideHealingRain(pointToCheck: Point, location: Location) {\r\n    const xComponent = (Math.pow(pointToCheck.x - location.ellipseCenterPoint.x, 2) / Math.pow(location.ellipseWidth, 2));\r\n    const yComponent = (Math.pow(pointToCheck.y - location.ellipseCenterPoint.y, 2) / Math.pow(location.ellipseHeight, 2));\r\n\r\n    if ((xComponent + yComponent) <= 1) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default HealingRainLocation;\r\n","import React from 'react';\r\n\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\nimport { TooltipElement } from 'common/Tooltip';\r\nimport StatisticBox, { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport Panel from 'interface/statistics/Panel';\r\nimport PlayerBreakdown from 'interface/others/PlayerBreakdown';\r\nimport Analyzer, { SELECTED_PLAYER, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport Events from 'parser/core/Events';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport StatTracker from 'parser/shared/modules/StatTracker';\r\nimport HealingValue from 'parser/shared/modules/HealingValue';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport RestorationAbilityTracker from '../core/RestorationAbilityTracker';\r\n\r\nimport { ABILITIES_AFFECTED_BY_MASTERY, BASE_ABILITIES_AFFECTED_BY_MASTERY } from '../../constants';\r\n\r\nclass MasteryEffectiveness extends Analyzer {\r\n  static dependencies = {\r\n    abilityTracker: RestorationAbilityTracker,\r\n    combatants: Combatants,\r\n    statTracker: StatTracker,\r\n  };\r\n\r\n  totalMasteryHealing = 0;\r\n  totalMaxPotentialMasteryHealing = 0;\r\n\r\n  masteryHealEvents = [];\r\n\r\n  constructor(options){\r\n    super(options);\r\n    // Totems count as pets, but are still affected by mastery.\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER | SELECTED_PLAYER_PET).spell(ABILITIES_AFFECTED_BY_MASTERY), this.onHeal);\r\n  }\r\n\r\n  onHeal(event) {\r\n    const heal = new HealingValue(event.amount, event.absorbed, event.overheal);\r\n    const healthBeforeHeal = event.hitPoints - event.amount;\r\n    const masteryEffectiveness = Math.max(0, 1 - healthBeforeHeal / event.maxHitPoints);\r\n\r\n    // The base healing of the spell (excluding any healing added by mastery)\r\n    const masteryPercent = this.statTracker.currentMasteryPercentage;\r\n    const baseHealingDone = heal.raw / (1 + masteryPercent * masteryEffectiveness);\r\n    const masteryHealingDone = heal.raw - baseHealingDone;\r\n    // The max potential mastery healing if we had a mastery effectiveness of 100% on this spell. This does NOT include the base healing\r\n    // Example: a heal that did 1,324 healing with 32.4% mastery with 100% mastery effectiveness will have a max potential mastery healing of 324.\r\n    const maxPotentialMasteryHealing = baseHealingDone * masteryPercent; // * 100% mastery effectiveness\r\n\r\n    this.totalMasteryHealing += Math.max(0, masteryHealingDone - (event.overheal || 0));\r\n    this.totalMaxPotentialMasteryHealing += Math.max(0, maxPotentialMasteryHealing - (event.overheal || 0));\r\n\r\n    this.masteryHealEvents.push({\r\n      ...event,\r\n      effectiveHealing: heal.effective,\r\n      healthBeforeHeal,\r\n      masteryEffectiveness,\r\n      baseHealingDone,\r\n      masteryHealingDone,\r\n      maxPotentialMasteryHealing,\r\n    });\r\n\r\n    event.masteryEffectiveness = masteryEffectiveness;\r\n  }\r\n\r\n  get masteryEffectivenessPercent() {\r\n    return this.totalMasteryHealing / this.totalMaxPotentialMasteryHealing;\r\n  }\r\n\r\n  statistic() {\r\n    const masteryPercent = this.statTracker.currentMasteryPercentage;\r\n    const avgEffectiveMasteryPercent = this.masteryEffectivenessPercent * masteryPercent;\r\n\r\n    return [\r\n      (\r\n        <StatisticBox\r\n          key=\"StatisticBox\"\r\n          icon={<SpellIcon id={SPELLS.DEEP_HEALING.id} />}\r\n          value={`${formatPercentage(this.masteryEffectivenessPercent)} %`}\r\n          position={STATISTIC_ORDER.CORE(30)}\r\n          label={(\r\n            <TooltipElement content={<Trans id=\"shaman.restoration.masteryEffectiveness.statistic.tooltip\">The percent of your mastery that you benefited from on average (so always between 0% and 100%). Since you have {formatPercentage(masteryPercent)}% mastery, this means that on average your heals were increased by {formatPercentage(avgEffectiveMasteryPercent)}% by your mastery.</Trans>}>\r\n              <Trans id=\"shaman.restoration.masteryEffectiveness.statistic.label\">Mastery benefit</Trans>\r\n            </TooltipElement>\r\n          )}\r\n        />\r\n      ),\r\n      (\r\n        <Panel\r\n          key=\"Panel\"\r\n          title={<Trans id=\"shaman.restoration.masteryEffectiveness.statistic.panel\">Mastery effectiveness breakdown</Trans>}\r\n          position={200}\r\n          pad={false}\r\n        >\r\n          <PlayerBreakdown\r\n            report={this.report}\r\n            spellreport={this.spellReport}\r\n            players={this.owner.players}\r\n          />\r\n        </Panel>\r\n      ),\r\n  ];\r\n  }\r\n\r\n  get report() {\r\n    const statsByTargetId = this.masteryHealEvents.reduce((obj, event) => {\r\n      // Update the player-totals\r\n      if (!obj[event.targetID]) {\r\n        const combatant = this.combatants.players[event.targetID];\r\n        obj[event.targetID] = {\r\n          combatant,\r\n          effectiveHealing: 0,\r\n          healingReceived: 0,\r\n          healingFromMastery: 0,\r\n          maxPotentialHealingFromMastery: 0,\r\n        };\r\n      }\r\n      const playerStats = obj[event.targetID];\r\n      playerStats.effectiveHealing += event.effectiveHealing;\r\n      playerStats.healingReceived += event.amount;\r\n      playerStats.healingFromMastery += event.masteryHealingDone;\r\n      playerStats.maxPotentialHealingFromMastery += event.maxPotentialMasteryHealing;\r\n\r\n      return obj;\r\n    }, {});\r\n\r\n    return statsByTargetId;\r\n  }\r\n\r\n  get spellReport() {\r\n    const statsBySpellId = this.masteryHealEvents.reduce((obj, event) => {\r\n      if (!BASE_ABILITIES_AFFECTED_BY_MASTERY.some(s => s.id === event.ability.guid)) {\r\n        return obj;\r\n      }\r\n      // Update the spell-totals\r\n      if (!obj[event.ability.guid]) {\r\n        obj[event.ability.guid] = {\r\n          spellId: event.ability.guid,\r\n          effectiveHealing: 0,\r\n          healingReceived: 0,\r\n          healingFromMastery: 0,\r\n          maxPotentialHealingFromMastery: 0,\r\n        };\r\n      }\r\n      const spellStats = obj[event.ability.guid];\r\n      spellStats.effectiveHealing += event.effectiveHealing;\r\n      spellStats.healingReceived += event.amount;\r\n      spellStats.healingFromMastery += event.masteryHealingDone;\r\n      spellStats.maxPotentialHealingFromMastery += event.maxPotentialMasteryHealing;\r\n\r\n      return obj;\r\n    }, {});\r\n\r\n    return statsBySpellId;\r\n  }\r\n}\r\n\r\nexport default MasteryEffectiveness;\r\n","import SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport CoreAlwaysBeCastingHealing from 'parser/shared/modules/AlwaysBeCastingHealing';\r\nimport { When } from 'parser/core/ParseResults';\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\nclass AlwaysBeCasting extends CoreAlwaysBeCastingHealing {\r\n  static HEALING_ABILITIES_ON_GCD = [\r\n    SPELLS.HEALING_WAVE.id,\r\n    SPELLS.CHAIN_HEAL.id,\r\n    SPELLS.HEALING_SURGE.id,\r\n    SPELLS.RIPTIDE.id,\r\n    SPELLS.HEALING_RAIN_CAST.id,\r\n    SPELLS.HEALING_STREAM_TOTEM_CAST.id,\r\n    SPELLS.HEALING_TIDE_TOTEM_CAST.id,\r\n    SPELLS.SPIRIT_LINK_TOTEM.id,\r\n    SPELLS.WELLSPRING_TALENT.id,\r\n    SPELLS.CLOUDBURST_TOTEM_TALENT.id,\r\n    SPELLS.EARTHEN_WALL_TOTEM_TALENT.id,\r\n    SPELLS.UNLEASH_LIFE_TALENT.id,\r\n    SPELLS.EARTH_SHIELD.id,\r\n    SPELLS.DOWNPOUR_TALENT.id,\r\n    SPELLS.MANA_TIDE_TOTEM_CAST.id,\r\n    SPELLS.SURGE_OF_EARTH_TALENT.id,\r\n    SPELLS.PRIMORDIAL_WAVE_CAST.id, // TODO add other covenant abilities\r\n  ];\r\n\r\n  suggestions(when: When) {\r\n    const nonHealingTimeSuggestionThresholds = this.nonHealingTimeSuggestionThresholds;\r\n    const deadTimePercentage = this.downtimeSuggestionThresholds;\r\n    when(nonHealingTimeSuggestionThresholds.actual).isGreaterThan(nonHealingTimeSuggestionThresholds.isGreaterThan.minor)\r\n      .addSuggestion((suggest, actual, recommended) =>\r\n        suggest(`Your non healing time can be improved. Try to cast heals more regularly (${Math.round(nonHealingTimeSuggestionThresholds.actual * 100)}% non healing time).`)\r\n          .icon('petbattle_health-down')\r\n          .actual(`${formatPercentage(nonHealingTimeSuggestionThresholds.actual)}% ${i18n._(t('shared.suggestions.alwaysBeCasting.nonHealingTime')`non healing time`)}`)\r\n          .recommended(`<${formatPercentage(nonHealingTimeSuggestionThresholds.isGreaterThan.minor)}% is recommended`)\r\n          .regular(nonHealingTimeSuggestionThresholds.isGreaterThan.average).major(nonHealingTimeSuggestionThresholds.isGreaterThan.major),\r\n      );\r\n    when(deadTimePercentage.actual).isGreaterThan(0.2)\r\n      .addSuggestion((suggest, actual, recommended) =>\r\n        suggest(`Your downtime can be improved. Try to Always Be Casting (ABC); when you're not healing try to contribute some damage.`)\r\n          .icon('spell_mage_altertime')\r\n          .actual(`${formatPercentage(deadTimePercentage.actual)}% ${i18n._(t('shared.suggestions.alwaysBeCasting.downtime')`downtime`)}`)\r\n          .recommended(`<${formatPercentage(deadTimePercentage.isGreaterThan.minor)}% is recommended`)\r\n          .regular(deadTimePercentage.isGreaterThan.average).major(deadTimePercentage.isGreaterThan.major),\r\n      );\r\n  }\r\n}\r\n\r\nexport default AlwaysBeCasting;\r\n","import React from 'react';\r\n\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { TooltipElement } from 'common/Tooltip';\r\nimport SPECS, { Spec } from 'game/SPECS';\r\nimport SpecIcon from 'common/SpecIcon';\r\nimport { formatNth, formatDuration } from 'common/format';\r\n\r\nimport Events, { CastEvent, EventType, HealEvent } from 'parser/core/Events';\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\n\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport StatisticBox, { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport { When } from 'parser/core/ParseResults';\r\n\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport RestorationAbilityTracker from '../core/RestorationAbilityTracker';\r\n\r\nconst CHAIN_HEAL_TARGET_EFFICIENCY = 0.97;\r\nconst HEAL_WINDOW_MS = 250;\r\n\r\ninterface ChainHealInfo {\r\n  target: {\r\n    id: number | undefined,\r\n    name: string,\r\n    spec: Spec,\r\n    specClassName: string\r\n  }\r\n  timestamp: number,\r\n  castNo: number,\r\n  hits: number\r\n}\r\n\r\nclass ChainHeal extends Analyzer {\r\n  static dependencies = {\r\n    abilityTracker: RestorationAbilityTracker,\r\n    combatants: Combatants,\r\n  };\r\n\r\n  protected abilityTracker!: RestorationAbilityTracker;\r\n  protected combatants!: Combatants;\r\n\r\n  buffer: Array<HealEvent | CastEvent> = [];\r\n  chainHealHistory: ChainHealInfo[] = [];\r\n  castIndex = 0;\r\n  chainHealTimestamp = 0;\r\n  maxTargets = 4;\r\n  suggestedTargets = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.suggestedTargets = this.maxTargets * CHAIN_HEAL_TARGET_EFFICIENCY;\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.CHAIN_HEAL), this.chainHeal);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.CHAIN_HEAL), this.chainHeal);\r\n  }\r\n\r\n  chainHeal(event: HealEvent | CastEvent) {\r\n    if (!this.chainHealTimestamp || event.timestamp - this.chainHealTimestamp > HEAL_WINDOW_MS) {\r\n      this.processBuffer();\r\n      this.chainHealTimestamp = event.timestamp;\r\n    }\r\n\r\n    this.buffer.push({\r\n      ...event,\r\n    });\r\n  }\r\n\r\n  processBuffer() {\r\n    if (this.buffer.length === 0) {\r\n      return;\r\n    }\r\n    this.castIndex += 1;\r\n    const currentCast = this.buffer.find(event => event.type === EventType.Cast);\r\n    if (!currentCast) {\r\n      return;\r\n    }\r\n    const combatant = this.combatants.getEntity(currentCast);\r\n    if (!combatant) {\r\n      return;\r\n    }\r\n    this.chainHealHistory[this.castIndex] = {\r\n      target: {\r\n        id: currentCast.targetID,\r\n        name: combatant.name,\r\n        spec: SPECS[combatant.specId],\r\n        specClassName: SPECS[combatant.specId].className.replace(' ', ''),\r\n      },\r\n      timestamp: currentCast.timestamp,\r\n      castNo: this.castIndex,\r\n      hits: this.buffer.filter(event => event.type === EventType.Heal).length,\r\n    };\r\n    this.buffer = [];\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    const suggestedThreshold = this.suggestionThreshold;\r\n    if (isNaN(suggestedThreshold.actual)) {\r\n      return;\r\n    }\r\n    when(suggestedThreshold.actual).isLessThan(suggestedThreshold.isLessThan.minor)\r\n      .addSuggestion((suggest, _actual, _recommended) => suggest(<Trans id=\"shaman.restoration.suggestions.aoeTargets.label\">Try to always cast <SpellLink id={SPELLS.CHAIN_HEAL.id} /> on groups of people, so that it heals all {this.maxTargets} potential targets.</Trans>)\r\n          .icon(SPELLS.CHAIN_HEAL.icon)\r\n          .actual(`${suggestedThreshold.actual.toFixed(2)} ${i18n._(t('shaman.restoration.suggestions.aoeTargets.averageTargets')`average targets healed`)}`)\r\n          .recommended(`${suggestedThreshold.isLessThan.minor} ${i18n._(t('shaman.restoration.suggestions.aoeTargets.averageTargets')`average targets healed`)}`)\r\n          .regular(suggestedThreshold.isLessThan.average).major(suggestedThreshold.isLessThan.major));\r\n  }\r\n\r\n  get avgHits() {\r\n    const chainHeal = this.abilityTracker.getAbility(SPELLS.CHAIN_HEAL.id);\r\n    const casts = chainHeal.casts;\r\n    const hits = chainHeal.healingHits;\r\n    return hits / casts || 0;\r\n  }\r\n\r\n  get casts() {\r\n    return this.abilityTracker.getAbility(SPELLS.CHAIN_HEAL.id).casts;\r\n  }\r\n\r\n  get suggestionThreshold() {\r\n    return {\r\n      actual: this.avgHits,\r\n      isLessThan: {\r\n        minor: this.suggestedTargets,//Missed 1 target\r\n        average: this.suggestedTargets - 1,//Missed 2-3 targets\r\n        major: this.suggestedTargets - 2,//Missed more than 3 targets\r\n      },\r\n      style: 'number',\r\n    };\r\n  }\r\n\r\n  statistic() {\r\n    if (this.casts === 0) {\r\n      return false;\r\n    }\r\n\r\n    const singleHits = this.chainHealHistory.filter(cast => cast.hits === 1);\r\n\r\n    return (\r\n      <StatisticBox\r\n        icon={<SpellIcon id={SPELLS.CHAIN_HEAL.id} />}\r\n        value={this.avgHits.toFixed(2)}\r\n        position={STATISTIC_ORDER.OPTIONAL(70)}\r\n        label={(\r\n          <TooltipElement content={<Trans id=\"shaman.restoration.chainHeal.averageTargets.tooltip\">The average number of targets healed by Chain Heal out of the maximum amount of targets. You cast a total of {this.casts} Chain Heals, which healed an average of {this.avgHits.toFixed(2)} out of {this.maxTargets} targets.</Trans>}>\r\n            <Trans id=\"shaman.restoration.chainHeal.averageTargets\">Average Chain Heal targets</Trans>\r\n          </TooltipElement>\r\n        )}\r\n      >\r\n        {singleHits.length > 0 && (\r\n          <>\r\n            <div>\r\n              <Trans id=\"shaman.restoration.chainHeal.averageTargets.title\">Below are the casts that only hit the initial target. A large list indicates that target selection is an area for improvement.</Trans>\r\n            </div>\r\n            <table className=\"table table-condensed\">\r\n              <thead>\r\n                <tr>\r\n                  <th><Trans id=\"common.cast\">Cast</Trans></th>\r\n                  <th><Trans id=\"common.time\">Time</Trans></th>\r\n                  <th><Trans id=\"common.target\">Target</Trans></th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {\r\n                  this.chainHealHistory\r\n                    .filter(cast => cast.hits === 1)\r\n                    .map(cast => (\r\n                      <tr key={cast.timestamp}>\r\n                        <th scope=\"row\">{formatNth(cast.castNo)}</th>\r\n                        <td>{formatDuration((cast.timestamp - this.owner.fight.start_time) / 1000, 0)}</td>\r\n                        <td className={cast.target.specClassName}> <SpecIcon id={cast.target.spec.id} />{' '}{cast.target.name}</td>\r\n                      </tr>\r\n                    ))\r\n                }\r\n              </tbody>\r\n            </table>\r\n          </>\r\n        )}\r\n      </StatisticBox>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ChainHeal;\r\n","import React from 'react';\r\n\r\nimport StatisticBox, { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\n\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { TooltipElement } from 'common/Tooltip';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport { When } from 'parser/core/ParseResults';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\n\r\nimport { i18n } from '@lingui/core';\r\nimport { t, Trans } from '@lingui/macro';\r\n\r\n// 50 was too low, 100 was too high\r\n// had no issues with 85ms\r\nconst BUFFER_MS = 85;\r\n\r\ninterface HealingRainTickInfo {\r\n  timestamp: number,\r\n  hits: number\r\n}\r\n\r\nclass HealingRain extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n  };\r\n\r\n  protected combatants!: Combatants;\r\n\r\n  healingRainTicks: HealingRainTickInfo[] = [];\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.HEALING_RAIN_HEAL), this.onHealingRainHeal);\r\n  }\r\n\r\n  get averageHitsPerTick() {\r\n    const totalHits = this.healingRainTicks.reduce((total, tick) => total + tick.hits, 0);\r\n    return totalHits / this.healingRainTicks.length;\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    const suggestionThreshold = this.suggestionThreshold;\r\n    when(suggestionThreshold.actual).isLessThan(suggestionThreshold.isLessThan.minor)\r\n      .addSuggestion((suggest, actual, recommended) => suggest(<span>Try to always cast <SpellLink id={SPELLS.HEALING_RAIN_CAST.id} /> in areas where players stack. This allows the spell to consitantly hit all 6 possible targets.</span>)\r\n          .icon(SPELLS.HEALING_RAIN_CAST.icon)\r\n          .actual(i18n._(t('shaman.restoration.suggestions.healingRain.averageTargets')`${suggestionThreshold.actual.toFixed(2)} average targets healed`))\r\n          .recommended(`${suggestionThreshold.isLessThan.minor} average targets healed`)\r\n          .regular(suggestionThreshold.isLessThan.average).major(suggestionThreshold.isLessThan.average));\r\n  }\r\n\r\n  get suggestionThreshold() {\r\n    return {\r\n      actual: this.averageHitsPerTick,\r\n      isLessThan: {\r\n        minor: 5,\r\n        average: 3,\r\n        major: 2,\r\n      },\r\n      style: 'number',\r\n    };\r\n  }\r\n\r\n  onHealingRainHeal(event: HealEvent) {\r\n    // Filter out pets, but only if it fully overhealed as Rain will prioritize injured pets over non-injured players\r\n    // fully overhealing guarantees that there are not enough players in the healing rain\r\n    const combatant = this.combatants.getEntity(event);\r\n    if (!combatant && event.overheal && event.amount === 0) {\r\n      return;\r\n    }\r\n\r\n    const healingRainTick = this.healingRainTicks.find(tick => event.timestamp - BUFFER_MS <= tick.timestamp);\r\n    if (!healingRainTick) {\r\n      this.healingRainTicks.push({\r\n        timestamp: event.timestamp,\r\n        hits: 1,\r\n      });\r\n    } else {\r\n      // dirty fix for partial ticks happening at the same time as a real tick\r\n      healingRainTick.hits = healingRainTick.hits + 1 > 6 ? healingRainTick.hits = 6 : healingRainTick.hits + 1;\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    if (isNaN(this.averageHitsPerTick)) {\r\n      return false;\r\n    }\r\n\r\n    return (\r\n      <StatisticBox\r\n        icon={<SpellIcon id={SPELLS.HEALING_RAIN_HEAL.id} />}\r\n        value={`${this.averageHitsPerTick.toFixed(2)}`}\r\n        position={STATISTIC_ORDER.OPTIONAL()}\r\n        label={(\r\n          <TooltipElement content={<Trans id=\"shaman.restoration.healingRain.averageTargets.label.tooltip\">The average number of targets healed by Healing Rain out of the maximum amount of 6 targets.</Trans>}>\r\n            <Trans id=\"shaman.restoration.healingRain.averageTargets.label\">Average Healing Rain Targets</Trans>\r\n          </TooltipElement>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default HealingRain;\r\n","import SPELLS from 'common/SPELLS';\r\nimport { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { ApplyBuffEvent } from 'parser/core/Events';\r\nimport { ThresholdStyle } from 'parser/core/ParseResults';\r\n\r\nimport EarthShieldCore from '../../../shared/talents/EarthShield';\r\nimport CooldownThroughputTracker from '../features/CooldownThroughputTracker';\r\n\r\nclass EarthShield extends EarthShieldCore {\r\n  static dependencies = {\r\n    ...EarthShieldCore.dependencies,\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n  };\r\n\r\n  protected cooldownThroughputTracker!: CooldownThroughputTracker;\r\n  prepullApplication = false;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.EARTH_SHIELD), this.earthShieldPrepullCheck);\r\n  }\r\n\r\n  earthShieldPrepullCheck(event: ApplyBuffEvent) {\r\n    if (event.prepull) {\r\n      this.prepullApplication = true;\r\n    }\r\n  }\r\n\r\n  get suggestionThresholds() {\r\n    return {\r\n      actual: this.uptimePercent,\r\n      isLessThan: {\r\n        minor: .9,\r\n        average:.85,\r\n        major: .8,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  get suggestionThresholdsPrepull() {\r\n    return {\r\n      actual: this.prepullApplication,\r\n      isEqual: false,\r\n      style: ThresholdStyle.BOOLEAN,\r\n    };\r\n  }\r\n\r\n  getFeeding() {\r\n    return this.cooldownThroughputTracker.getIndirectHealing(SPELLS.EARTH_SHIELD_HEAL.id);\r\n  }\r\n}\r\n\r\nexport default EarthShield;\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport { formatPercentage, formatDuration, formatNth } from 'common/format';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport { When } from 'parser/core/ParseResults';\r\nimport Events, { BeginCastEvent, CastEvent, HealEvent } from 'parser/core/Events';\r\n\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\nimport { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport StatisticBox from 'interface/others/StatisticBox';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\n\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\n\r\nimport { i18n } from '@lingui/core';\r\nimport { t, Trans } from '@lingui/macro';\r\n\r\nimport CooldownThroughputTracker from '../features/CooldownThroughputTracker';\r\n\r\nclass Wellspring extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n  };\r\n\r\n  protected combatants!: Combatants;\r\n  protected cooldownThroughputTracker!: CooldownThroughputTracker;\r\n\r\n  healing = 0;\r\n  wellspringCasts: number[] = [];\r\n  wellspringTimestamps: number[] = [];\r\n  castNumber = 0;\r\n  castEvent: CastEvent | undefined = undefined;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.WELLSPRING_TALENT.id);\r\n\r\n    this.addEventListener(Events.begincast.by(SELECTED_PLAYER).spell(SPELLS.WELLSPRING_TALENT), this._onBegincast);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.WELLSPRING_TALENT), this._onCast);\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.WELLSPRING_HEAL), this._onHeal);\r\n    this.addEventListener(Events.fightend, this._onFightend);\r\n  }\r\n\r\n  _onBegincast(event: BeginCastEvent) {\r\n    if (event.ability.guid !== SPELLS.WELLSPRING_TALENT.id || event.isCancelled) {\r\n      return;\r\n    }\r\n\r\n    if (this.wellspringCasts[this.castNumber] && this.wellspringCasts[this.castNumber] < 6) {\r\n      this.registerInefficientCast();\r\n    }\r\n\r\n    this.castNumber += 1;\r\n    this.wellspringTimestamps[this.castNumber] = event.timestamp;\r\n  }\r\n\r\n  _onCast(event: CastEvent) {\r\n    this.castEvent = event;\r\n  }\r\n\r\n  _onHeal(event: HealEvent) {\r\n    if (!this.wellspringCasts[this.castNumber]) {\r\n      this.wellspringCasts[this.castNumber] = 0;\r\n    }\r\n\r\n    this.healing += event.amount + (event.absorbed || 0);\r\n\r\n    // Pets aren't really interesting to us as they don't work against the mechanic of wellspring\r\n    const combatant = this.combatants.getEntity(event);\r\n    if (!combatant) {\r\n      return;\r\n    }\r\n\r\n    // Fully overhealed events don't affect wellsprings cap and are discarded\r\n    if (event.overheal && event.amount === 0) {\r\n      return;\r\n    }\r\n\r\n    this.wellspringCasts[this.castNumber] += 1;\r\n  }\r\n\r\n  _onFightend() {\r\n    if (this.wellspringCasts[this.castNumber] && this.wellspringCasts[this.castNumber] < 6 && (this.castEvent && !this.castEvent.meta)) {\r\n      this.registerInefficientCast();\r\n    }\r\n  }\r\n\r\n  registerInefficientCast() {\r\n    // Avoid breaking the page on pre-combat casts\r\n    if (!this.castEvent) {\r\n      return;\r\n    }\r\n    this.castEvent.meta = this.castEvent.meta || {};\r\n    this.castEvent.meta.isInefficientCast = true;\r\n    this.castEvent.meta.inefficientCastReason = <Trans id=\"shaman.restoration.wellspring.inefficientCast.reason\">This Wellspring cast hit less than 6 targets.</Trans>;\r\n  }\r\n\r\n  get averageHitsPerCast() {\r\n    const totalHits = this.wellspringCasts.reduce((total, hits) => total + hits, 0);\r\n    return totalHits / this.numberOfCasts;\r\n  }\r\n\r\n  get wellspringEfficiency() {\r\n    return 1 - this.inefficientCasts / this.numberOfCasts;\r\n  }\r\n\r\n  get numberOfCasts() {\r\n    // this.wellspringCasts[0] is there for pre-combat casts, most of the time this will be empty\r\n    return this.wellspringCasts.length - (!this.wellspringCasts[0] ? 1 : 0);\r\n  }\r\n\r\n  get inefficientCasts() {\r\n    return this.wellspringCasts.reduce((total, hits) => hits < 6 ? total + 1 : total, 0);\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    const suggestionThreshold = this.suggestionThreshold;\r\n    when(suggestionThreshold.actual).isLessThan(suggestionThreshold.isLessThan.minor)\r\n      .addSuggestion((suggest, _actual, _recommended) => suggest(<Trans id=\"shaman.restoration.suggestions.wellSpring.label\">You're not making full use of the potential of <SpellLink id={SPELLS.WELLSPRING_TALENT.id} />. Try to aim it towards stacks of injured players with 6 people or more.</Trans>)\r\n          .icon(SPELLS.WELLSPRING_TALENT.icon)\r\n          .actual(`${formatPercentage(suggestionThreshold.actual)}% ${i18n._(t('shared.suggestions.efficiency')`efficiency`)}`)\r\n          .recommended(`>${formatPercentage(suggestionThreshold.isLessThan.minor)}% efficiency is recommended`)\r\n          .regular(suggestionThreshold.isLessThan.average).major(suggestionThreshold.isLessThan.average));\r\n  }\r\n\r\n  get suggestionThreshold() {\r\n    return {\r\n      actual: this.wellspringEfficiency,\r\n      isLessThan: {\r\n        minor: 0.8,\r\n        average: 0.6,\r\n        major: 0.5,\r\n      },\r\n      style: 'percentage',\r\n    };\r\n  }\r\n\r\n  statistic() {\r\n    if (isNaN(this.averageHitsPerCast)) {\r\n      return false;\r\n    }\r\n\r\n    return (\r\n      <StatisticBox\r\n        icon={<SpellIcon id={SPELLS.WELLSPRING_TALENT.id} />}\r\n        label={<Trans id=\"shaman.restoration.wellspring.statistic.label\">Wellspring target efficiency</Trans>}\r\n        value={`${formatPercentage(this.wellspringEfficiency)} %`}\r\n        tooltip={<Trans id=\"shaman.restoration.wellspring.statistic.tooltip\">The average number of targets healed by Wellspring out of the minimum amount of 6 targets to archive the maximum potential healing.</Trans>}\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        position={STATISTIC_ORDER.OPTIONAL(100)}\r\n      >\r\n        <table className=\"table table-condensed\">\r\n          <thead>\r\n            <tr>\r\n              <th><Trans id=\"common.cast\">Cast</Trans></th>\r\n              <th><Trans id=\"common.time\">Time</Trans></th>\r\n              <th />\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {\r\n              this.wellspringCasts.map((hits, index) => (\r\n                <tr key={index}>\r\n                  <th scope=\"row\">{formatNth(index)}</th>\r\n                  <td>{formatDuration((this.wellspringTimestamps[index] - this.owner.fight.start_time) / 1000) || 0}</td>\r\n                  <td style={hits < 6 ? { color: 'red', fontWeight: 'bold' } : {}}>{hits} hits</td>\r\n                </tr>\r\n              ))\r\n            }\r\n          </tbody>\r\n        </table>\r\n      </StatisticBox>\r\n    );\r\n  }\r\n\r\n  subStatistic() {\r\n    const feeding = this.cooldownThroughputTracker.getIndirectHealing(SPELLS.WELLSPRING_HEAL.id);\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.WELLSPRING_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing + feeding))} %`}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default Wellspring;\r\n\r\n","import React from 'react';\r\n\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatNumber, formatPercentage, formatDuration, formatNth } from 'common/format';\r\n\r\nimport Analyzer, { SELECTED_PLAYER, SELECTED_PLAYER_PET, Options } from 'parser/core/Analyzer';\r\nimport Events, { AbsorbedEvent, CastEvent, DamageEvent } from 'parser/core/Events';\r\n\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\n\r\nimport StatisticBox, { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\nimport { When } from 'parser/core/ParseResults';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nconst RECOMMENDED_EFFICIENCY = 0.8;\r\nconst MAGHAR_ORC_PET_HEALTH_INCREASE = 0.1;\r\n\r\ninterface EarthenWallTotemInfo {\r\n  potentialHealing: number,\r\n  effectiveHealing: number,\r\n  timestamp: number\r\n}\r\n\r\n/**\r\n * Earthen Wall Totem\r\n * Summons a totem with the players health for 15 sec.\r\n * Some damage from each attack against allies within 10 yards of the totem is redirected to the totem.\r\n *\r\n * https://user-images.githubusercontent.com/2842471/48328510-96fb0d00-e644-11e8-8eb8-d2d2c40373a2.png\r\n * The efficiency can go higher than 100% as the totem doesn't instantly realize that it absorbed more damage than its supposed to.\r\n */\r\nclass EarthenWallTotem extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n  };\r\n\r\n  earthenWallTotems: EarthenWallTotemInfo[] = [];\r\n  castNumber = 0;\r\n  prePullCast = true;\r\n  isMaghar: boolean | null = false;\r\n\r\n  protected combatants!: Combatants;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.EARTHEN_WALL_TOTEM_TALENT.id);\r\n    this.isMaghar = this.selectedCombatant.race && this.selectedCombatant.race.name === \"Mag'har Orc\";\r\n\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.EARTHEN_WALL_TOTEM_TALENT), this._onCast);\r\n    this.addEventListener(Events.damage.to(SELECTED_PLAYER_PET).spell(SPELLS.EARTHEN_WALL_TOTEM_SELF_DAMAGE), this._updateTotemHealth);\r\n    this.addEventListener(Events.absorbed.by(SELECTED_PLAYER_PET).spell(SPELLS.EARTHEN_WALL_TOTEM_ABSORB), this._onAbsorbed);\r\n  }\r\n\r\n  _onCast(event: CastEvent) {\r\n    if (this.prePullCast) {\r\n      this.prePullCast = false;\r\n    }\r\n\r\n    this.castNumber += 1;\r\n    this.earthenWallTotems[this.castNumber] = {\r\n      potentialHealing: this.isMaghar ? Math.floor(event.maxHitPoints || 0 * (1 + MAGHAR_ORC_PET_HEALTH_INCREASE)) : event.maxHitPoints || 0,\r\n      effectiveHealing: 0,\r\n      timestamp: event.timestamp,\r\n    };\r\n  }\r\n\r\n  _updateTotemHealth(event: DamageEvent) {\r\n    if (this.prePullCast) {\r\n      this.earthenWallTotems[this.castNumber] = {\r\n        potentialHealing: event.maxHitPoints || 0, // this is taking the totems max HP, which is the same result as the players unless Mag'har Orc\r\n        effectiveHealing: (this.earthenWallTotems[this.castNumber] && this.earthenWallTotems[this.castNumber].effectiveHealing) || 0,\r\n        timestamp: this.owner.fight.start_time,\r\n      };\r\n      this.prePullCast = false;\r\n    }\r\n\r\n    // If for some reason something goes wrong with the race detection, this should be the only reason for differences in health\r\n    // The reason this isn't always using the totems health, is that you need to account for totems that never had damage taken events (0% efficiency)\r\n    if (event.maxHitPoints && this.earthenWallTotems[this.castNumber].potentialHealing !== event.maxHitPoints) {\r\n      this.isMaghar = true; // likely\r\n      this.earthenWallTotems[this.castNumber].potentialHealing = event.maxHitPoints;\r\n    }\r\n  }\r\n\r\n  _onAbsorbed(event: AbsorbedEvent) {\r\n    // Filtering out pets as healing on them is pointless, sadly\r\n    const combatant = this.combatants.getEntity(event);\r\n    if (!combatant) {\r\n      return;\r\n    }\r\n    // Prepull EWT casts will have absorb events first, but those don't have any health information\r\n    if (!this.earthenWallTotems[this.castNumber]) {\r\n      this.earthenWallTotems[this.castNumber] = {\r\n        effectiveHealing: 0,\r\n        potentialHealing: 0,\r\n        timestamp: event.timestamp, // maybe change to combat start timestamp\r\n      };\r\n    }\r\n    this.earthenWallTotems[this.castNumber].effectiveHealing += event.amount;\r\n  }\r\n\r\n  get totalEffectiveHealing() {\r\n    return Object.values(this.earthenWallTotems).reduce((sum, cast) => sum + cast.effectiveHealing, 0);\r\n  }\r\n\r\n  get totalPotentialHealing() {\r\n    return Object.values(this.earthenWallTotems).reduce((sum, cast) => sum + cast.potentialHealing, 0);\r\n  }\r\n\r\n  get earthenWallEfficiency() {\r\n    return this.totalEffectiveHealing / this.totalPotentialHealing;\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    when(this.earthenWallEfficiency).isLessThan(RECOMMENDED_EFFICIENCY)\r\n      .addSuggestion((suggest, actual, recommended) => suggest(<Trans id=\"shaman.restoration.ewt.suggestion.label\">Try to cast <SpellLink id={SPELLS.EARTHEN_WALL_TOTEM_TALENT.id} /> at times - and positions where there will be as many people taking damage possible inside of it to maximize the amount it absorbs.</Trans>)\r\n          .icon(SPELLS.EARTHEN_WALL_TOTEM_TALENT.icon)\r\n          .actual(`${this.earthenWallEfficiency.toFixed(2)}%`)\r\n          .recommended(`${recommended}%`)\r\n          .regular(recommended - .15).major(recommended - .3));\r\n  }\r\n\r\n  get suggestionThreshold() {\r\n    return {\r\n      actual: this.earthenWallEfficiency,\r\n      isLessThan: {\r\n        minor: 0.75,\r\n        average: 0.6,\r\n        major: 0.45,\r\n      },\r\n      style: 'percentage',\r\n    };\r\n  }\r\n\r\n  statistic() {\r\n    const casts = this.earthenWallTotems.filter((cast => cast.timestamp > 0)).length;\r\n\r\n    return (\r\n      <StatisticBox\r\n        icon={<SpellIcon id={SPELLS.EARTHEN_WALL_TOTEM_TALENT.id} />}\r\n        value={`${formatPercentage(this.earthenWallEfficiency)} %`}\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        position={STATISTIC_ORDER.OPTIONAL(60)}\r\n        label={<Trans id=\"shaman.restoration.ewt.statistic.label\">Earthen Wall Totem efficiency</Trans>}\r\n        tooltip={(\r\n          <Trans id=\"shaman.restoration.ewt.statistic.tooltip\">\r\n            The percentage of the potential absorb of Earthen Wall Totem that was actually used. You cast a total of {casts} Earthen Wall Totems with a combined health of {formatNumber(this.totalPotentialHealing)}, which absorbed a total of {formatNumber(this.totalEffectiveHealing)} damage.<br /><br />\r\n\r\n            This can be higher than 100% because it sometimes absorbs a few more damage hits before the totem realizes it is supposed to be dead already.<br /><br />\r\n            <strong>Pet healing is filtered out.</strong>\r\n          </Trans>\r\n        )}\r\n      >\r\n        <table className=\"table table-condensed\">\r\n          <thead>\r\n            <tr>\r\n              <th><Trans id=\"common.cast\">Cast</Trans></th>\r\n              <th><Trans id=\"common.time\">Time</Trans></th>\r\n              <th><Trans id=\"common.efficiency\">Efficiency</Trans></th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {\r\n              this.earthenWallTotems.filter((cast => cast.timestamp > 0)).map((cast, index) => {\r\n                const castEfficiency = cast.effectiveHealing / cast.potentialHealing;\r\n                return (\r\n                  <tr key={index}>\r\n                    <th scope=\"row\">{formatNth(index + 1)}</th>\r\n                    <td>{formatDuration((cast.timestamp - this.owner.fight.start_time) / 1000) || 0}</td>\r\n                    <td style={castEfficiency < RECOMMENDED_EFFICIENCY ? { color: 'red', fontWeight: 'bold' } : {}}>{formatPercentage(castEfficiency)} %</td>\r\n                  </tr>\r\n                );\r\n              })\r\n            }\r\n          </tbody>\r\n        </table>\r\n      </StatisticBox>\r\n    );\r\n  }\r\n\r\n  subStatistic() {\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.EARTHEN_WALL_TOTEM_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.totalEffectiveHealing))} %`}\r\n        valueTooltip={<Trans id=\"shaman.restoration.ewt.statisticlist.tooltip\">Pet healing is filtered out</Trans>}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default EarthenWallTotem;\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport { i18n } from '@lingui/core';\r\nimport { t, Trans } from '@lingui/macro';\r\n\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\n\r\nimport RestorationAbilityTracker from '../core/RestorationAbilityTracker';\r\nimport CooldownThroughputTracker from '../features/CooldownThroughputTracker';\r\n\r\n// Could maybe use some more advanced analysis\r\n// Removes stacks of Earth Shield but doesn't log that it did\r\n// Probably not relevant though until the legendary so why bother\r\nclass SurgeOfEarth extends Analyzer {\r\n  static dependencies = {\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n    abilityTracker: RestorationAbilityTracker,\r\n  };\r\n  healing = 0;\r\n\r\n  protected cooldownThroughputTracker!: CooldownThroughputTracker;\r\n  protected abilityTracker!: RestorationAbilityTracker;\r\n  maxTargets = 3;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.SURGE_OF_EARTH_TALENT.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.SURGE_OF_EARTH_HEAL), this._onHeal);\r\n  }\r\n\r\n  _onHeal(event: HealEvent) {\r\n    this.healing += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  get feeding() {\r\n    return this.cooldownThroughputTracker.getIndirectHealing(SPELLS.SURGE_OF_EARTH_HEAL.id);\r\n  }\r\n\r\n  subStatistic() {\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.SURGE_OF_EARTH_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing + this.feeding))} %`}\r\n      />\r\n    );\r\n  }\r\n\r\n  get averageHitsPerCast() {\r\n    const surgeCast = this.abilityTracker.getAbility(SPELLS.SURGE_OF_EARTH_TALENT.id);\r\n    const surgeHeal = this.abilityTracker.getAbility(SPELLS.SURGE_OF_EARTH_HEAL.id);\r\n    const casts = surgeCast.casts;\r\n    const hits = surgeHeal.healingHits;\r\n    return hits / casts || 0;\r\n  }\r\n\r\n  get numberOfCasts() {\r\n    return this.abilityTracker.getAbility(SPELLS.SURGE_OF_EARTH_TALENT.id).casts;\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    const suggestionThreshold = this.suggestionThreshold;\r\n    when(suggestionThreshold.actual).isLessThan(suggestionThreshold.isLessThan.minor)\r\n      .addSuggestion((suggest, _actual, _recommended) => suggest(<Trans id=\"shaman.restoration.suggestions.aoeTargets.label\">Try to always cast <SpellLink id={SPELLS.SURGE_OF_EARTH_TALENT.id} /> on groups of people, so that it heals all {this.maxTargets} potential targets.</Trans>)\r\n          .icon(SPELLS.SURGE_OF_EARTH_TALENT.icon)\r\n          .actual(`${suggestionThreshold.actual.toFixed(2)} ${i18n._(t('shaman.restoration.suggestions.aoeTargets.averageTargets')`average targets healed`)}`)\r\n          .recommended(`>${suggestionThreshold.isLessThan.minor.toFixed(2)} ${i18n._(t('shaman.restoration.suggestions.aoeTargets.averageTargets')`average targets healed`)}`)\r\n          .regular(suggestionThreshold.isLessThan.average).major(suggestionThreshold.isLessThan.average));\r\n  }\r\n\r\n  get suggestionThreshold() {\r\n    return {\r\n      actual: this.averageHitsPerCast,\r\n      isLessThan: {\r\n        minor: 2.6,\r\n        average: 2.2,\r\n        major: 1.9,\r\n      },\r\n      style: ThresholdStyle.DECIMAL,\r\n    };\r\n  }\r\n}\r\n\r\nexport default SurgeOfEarth;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport ResourceLink from 'common/ResourceLink';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport { TooltipElement } from 'common/Tooltip';\r\nimport Checklist from 'parser/shared/modules/features/Checklist';\r\nimport Rule from 'parser/shared/modules/features/Checklist/Rule';\r\nimport Requirement from 'parser/shared/modules/features/Checklist/Requirement';\r\nimport PreparationRule from 'parser/shared/modules/features/Checklist/PreparationRule';\r\nimport GenericCastEfficiencyRequirement from 'parser/shared/modules/features/Checklist/GenericCastEfficiencyRequirement';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nconst RestoShamanChecklist = ({ combatant, castEfficiency, thresholds }: any) => {\r\n  const AbilityRequirement = (props: any) => (\r\n    <GenericCastEfficiencyRequirement\r\n      castEfficiency={castEfficiency.getCastEfficiencyForSpellId(props.spell)}\r\n      {...props}\r\n    />\r\n  );\r\n  AbilityRequirement.propTypes = {\r\n    spell: PropTypes.number.isRequired,\r\n  };\r\n\r\n  return (\r\n    <Checklist>\r\n      <Rule\r\n        name={<Trans id=\"shaman.restoration.checklist.efficientSpells\">Use core efficient spells as often as possible</Trans>}\r\n        description={(\r\n          <Trans id=\"shaman.restoration.checklist.efficientSpells.description\">\r\n            Spells such as <SpellLink id={SPELLS.RIPTIDE.id} />, <SpellLink id={SPELLS.HEALING_RAIN_CAST.id} /> and <SpellLink id={SPELLS.HEALING_STREAM_TOTEM_CAST.id} /> are your most efficient spells available. Try to cast them as much as possible without overhealing. <TooltipElement content={<Trans id=\"shaman.restoration.checklist.efficientSpells.description.tooltip\">When you're not bringing too many healers.</Trans>}>On Mythic*</TooltipElement> you can often still cast these spells more even if you were overhealing by casting it quicker when it comes off cooldown and improving your target selection.\r\n            <a href=\"http://www.wowhead.com/restoration-shaman-rotation-guide#raid-healing-priority-list\" target=\"_blank\" rel=\"noopener noreferrer\">More info.</a>\r\n          </Trans>\r\n        )}\r\n      >\r\n        <AbilityRequirement spell={SPELLS.RIPTIDE.id} />\r\n        <AbilityRequirement spell={SPELLS.HEALING_RAIN_CAST.id} />\r\n        {!combatant.hasTalent(SPELLS.CLOUDBURST_TOTEM_TALENT.id) && <AbilityRequirement spell={SPELLS.HEALING_STREAM_TOTEM_CAST.id} />}\r\n        {combatant.hasTalent(SPELLS.CLOUDBURST_TOTEM_TALENT.id) && <AbilityRequirement spell={SPELLS.CLOUDBURST_TOTEM_TALENT.id} />}\r\n        {combatant.hasTalent(SPELLS.UNLEASH_LIFE_TALENT.id) && <AbilityRequirement spell={SPELLS.UNLEASH_LIFE_TALENT.id} />}\r\n        {combatant.hasTalent(SPELLS.EARTHEN_WALL_TOTEM_TALENT.id) && <AbilityRequirement spell={SPELLS.EARTHEN_WALL_TOTEM_TALENT.id} />}\r\n        {combatant.hasTalent(SPELLS.WELLSPRING_TALENT.id) && <AbilityRequirement spell={SPELLS.WELLSPRING_TALENT.id} />}\r\n        {combatant.hasTalent(SPELLS.DOWNPOUR_TALENT.id) && <AbilityRequirement spell={SPELLS.DOWNPOUR_TALENT.id} />}\r\n      </Rule>\r\n      <Rule\r\n        name={<Trans id=\"shaman.restoration.checklist.cooldownUsage\">Use cooldowns effectively</Trans>}\r\n        description={(\r\n          <Trans id=\"shaman.restoration.checklist.cooldownUsage.description\">\r\n            Your cooldowns are an important contributor to your healing throughput. Try to get in as many efficient casts as the fight allows.\r\n            <a href=\"http://www.wowhead.com/restoration-shaman-rotation-guide#throughput-cooldowns\" target=\"_blank\" rel=\"noopener noreferrer\">More info.</a>\r\n          </Trans>\r\n        )}\r\n      >\r\n        <AbilityRequirement spell={SPELLS.HEALING_TIDE_TOTEM_CAST.id} />\r\n        <AbilityRequirement spell={SPELLS.SPIRIT_LINK_TOTEM.id} />\r\n        <AbilityRequirement spell={SPELLS.MANA_TIDE_TOTEM_CAST.id} />\r\n        {combatant.hasTalent(SPELLS.ASCENDANCE_TALENT_RESTORATION.id) && (\r\n          <AbilityRequirement spell={SPELLS.ASCENDANCE_TALENT_RESTORATION.id} />\r\n        )}\r\n        {/* We can't detect race, so disable this when it has never been cast. */}\r\n        {castEfficiency.getCastEfficiencyForSpellId(SPELLS.BERSERKING.id) && (\r\n          <AbilityRequirement spell={SPELLS.BERSERKING.id} />\r\n        )}\r\n      </Rule>\r\n      <Rule\r\n        name={<Trans id=\"shaman.restoration.checklist.aoeSpell\">Target AOE spells effectively</Trans>}\r\n        description={<Trans id=\"shaman.restoration.checklist.aoeSpell.description\">As a resto shaman our core AOE spells rely on not just who we target but where they are on the ground to maximize healing potential. You should plan you AOE spells ahead of time in preparation for where you expect raid members to be for the spells duration.</Trans>}\r\n      >\r\n        {thresholds.chainHealTargetThresholds.actual > 0 && (\r\n          <Requirement name={(<Trans id=\"shaman.restoration.checklist.aoeSpell.targets\">Average <SpellLink id={SPELLS.CHAIN_HEAL.id} /> targets</Trans>)} thresholds={thresholds.chainHealTargetThresholds} />\r\n        )}\r\n        {thresholds.healingRainTargetThreshold.actual > 0 && (\r\n          <Requirement name={(<Trans id=\"shaman.restoration.checklist.aoeSpell.targets\">Average <SpellLink id={SPELLS.HEALING_RAIN_HEAL.id} /> targets</Trans>)} thresholds={thresholds.healingRainTargetThreshold} />\r\n        )}\r\n        {combatant.hasTalent(SPELLS.WELLSPRING_TALENT.id) && (\r\n          <Requirement name={(<Trans id=\"shaman.restoration.checklist.aoeSpell.efficiency\">Average <SpellLink id={SPELLS.WELLSPRING_TALENT.id} /> efficiency</Trans>)} thresholds={thresholds.wellspringTargetThreshold} />\r\n        )}\r\n        {combatant.hasTalent(SPELLS.EARTHEN_WALL_TOTEM_TALENT.id) && (\r\n          <Requirement name={(<Trans id=\"shaman.restoration.checklist.aoeSpell.efficiency\">Average <SpellLink id={SPELLS.EARTHEN_WALL_TOTEM_TALENT.id} /> efficiency</Trans>)} thresholds={thresholds.ewtTargetThreshold} />\r\n        )}\r\n        {combatant.hasTalent(SPELLS.SURGE_OF_EARTH_TALENT.id) && (\r\n          <Requirement name={(<Trans id=\"shaman.restoration.checklist.aoeSpell.targets\">Average <SpellLink id={SPELLS.SURGE_OF_EARTH_TALENT.id} /> targets</Trans>)} thresholds={thresholds.soeTargetThreshold} />\r\n        )}\r\n      </Rule>\r\n      <Rule\r\n        name={<Trans id=\"shaman.restoration.checklist.buffUptime\">Keep your buffs up</Trans>}\r\n        description={<Trans id=\"shaman.restoration.checklist.buffUptime.description\">Water Shield and Earth Shield should be applied prior to the fight starting and maintained.</Trans>}\r\n      >\r\n          <Requirement\r\n            name={<Trans id=\"shaman.restoration.checklist.appliedPrepull\"><SpellLink id={SPELLS.WATER_SHIELD.id}/> applied prepull</Trans>}\r\n            thresholds={thresholds.waterShieldPrepull}\r\n          />\r\n          <Requirement\r\n            name={<Trans id=\"shaman.restoration.checklist.uptime\"><SpellLink id={SPELLS.WATER_SHIELD.id} /> Uptime</Trans>}\r\n            thresholds={thresholds.waterShieldUptime}\r\n          />\r\n          <Requirement\r\n            name={<Trans id=\"shaman.restoration.checklist.appliedPrepull\"><SpellLink id={SPELLS.EARTH_SHIELD.id} /> applied prepull</Trans>}\r\n            thresholds={thresholds.earthShieldPrepull}\r\n          />\r\n          <Requirement\r\n            name={<Trans id=\"shaman.restoration.checklist.uptime\"><SpellLink id={SPELLS.EARTH_SHIELD.id} /> Uptime</Trans>}\r\n            thresholds={thresholds.earthShieldUptime}\r\n          />\r\n      </Rule>\r\n      <Rule\r\n        name={<Trans id=\"shaman.restoration.checklist.inactivity\">Try to avoid being inactive for a large portion of the fight</Trans>}\r\n        description={(\r\n          <Trans id=\"shaman.restoration.checklist.inactivity.description\">\r\n            While it's suboptimal to always be casting as a healer you should still try to always be doing something during the entire fight and high downtime is inexcusable. You can reduce your downtime by reducing the delay between casting spells, anticipating movement, moving during the GCD, and <TooltipElement wrapperStyles={{ display: 'inline' }} content={<Trans id=\"shaman.restoration.checklist.inactivity.description.tooltip\">While helping with damage would be optimal, it's much less important as a healer than any of the other suggestions on this checklist. You should ignore this suggestion while you are having difficulties with anything else.</Trans>}>when you're not healing try to contribute some damage*</TooltipElement>.\r\n          </Trans>\r\n        )}\r\n      >\r\n        <Requirement name={<Trans id=\"shaman.restoration.checklist.inactivity.nonHealTime\">Non healing time</Trans>} thresholds={thresholds.nonHealingTimeSuggestionThresholds} />\r\n        <Requirement name={<Trans id=\"shaman.restoration.checklist.inactivity.downtime\">Downtime</Trans>} thresholds={thresholds.downtimeSuggestionThresholds} />\r\n      </Rule>\r\n      <Rule\r\n        name={<Trans id=\"shaman.restoration.checklist.manaUsage\">Use all of your <ResourceLink id={RESOURCE_TYPES.MANA.id} /> effectively</Trans>}\r\n        description={<Trans id=\"shaman.restoration.checklist.manaUsage.description\">If you have a large amount of mana left at the end of the fight that's mana you could have turned into healing. Try to use all your mana during a fight. A good rule of thumb is to try to match your mana level with the boss's health.</Trans>}\r\n      >\r\n        <Requirement name={<Trans id=\"shaman.restoration.checklist.manaUsage.manaLeft\">Mana left</Trans>} thresholds={thresholds.manaLeft} />\r\n      </Rule>\r\n      <PreparationRule thresholds={thresholds} />\r\n    </Checklist>\r\n  );\r\n};\r\n\r\nRestoShamanChecklist.propTypes = {\r\n  castEfficiency: PropTypes.object.isRequired,\r\n  combatant: PropTypes.shape({\r\n    hasTalent: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n  thresholds: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default RestoShamanChecklist;\r\n","import React from 'react';\r\n\r\nimport BaseChecklist from 'parser/shared/modules/features/Checklist/Module';\r\nimport CastEfficiency from 'parser/shared/modules/CastEfficiency';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport ManaValues from 'parser/shared/modules/ManaValues';\r\nimport PreparationRuleAnalyzer from 'parser/shared/modules/features/Checklist/PreparationRuleAnalyzer';\r\n\r\nimport AlwaysBeCasting from '../AlwaysBeCasting';\r\nimport ChainHeal from '../../spells/ChainHeal';\r\nimport HealingRain from '../../spells/HealingRain';\r\nimport WaterShield from '../../spells/WaterShield';\r\nimport EarthShield from '../../spells/EarthShield';\r\nimport Wellspring from '../../talents/Wellspring';\r\nimport EarthenWallTotem from '../../talents/EarthenWallTotem';\r\nimport SurgeOfEarth from '../../talents/SurgeOfEarth';\r\n\r\nimport Component from './Component';\r\n\r\nclass Checklist extends BaseChecklist {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n    castEfficiency: CastEfficiency,\r\n    alwaysBeCasting: AlwaysBeCasting,\r\n    manaValues: ManaValues,\r\n    preparationRuleAnalyzer: PreparationRuleAnalyzer,\r\n    chainHeal: ChainHeal,\r\n    healingRain: HealingRain,\r\n    waterShield: WaterShield,\r\n    earthShield: EarthShield,\r\n    wellspring: Wellspring,\r\n    earthenWallTotem: EarthenWallTotem,\r\n    surgeOfEarth: SurgeOfEarth,\r\n  };\r\n\r\n  protected combatants!: Combatants;\r\n  protected castEfficiency!: CastEfficiency;\r\n  protected alwaysBeCasting!: AlwaysBeCasting;\r\n  protected manaValues!: ManaValues;\r\n  protected preparationRuleAnalyzer!: PreparationRuleAnalyzer;\r\n  protected chainHeal!: ChainHeal;\r\n  protected healingRain!: HealingRain;\r\n  protected waterShield!: WaterShield;\r\n  protected earthShield!: EarthShield;\r\n  protected wellspring!: Wellspring;\r\n  protected earthenWallTotem!: EarthenWallTotem;\r\n  protected surgeOfEarth!: SurgeOfEarth;\r\n\r\n  render() {\r\n    return (\r\n      <Component\r\n        combatant={this.combatants.selected}\r\n        castEfficiency={this.castEfficiency}\r\n        thresholds={{\r\n          ...this.preparationRuleAnalyzer.thresholds,\r\n\r\n          nonHealingTimeSuggestionThresholds: this.alwaysBeCasting.nonHealingTimeSuggestionThresholds,\r\n          downtimeSuggestionThresholds: this.alwaysBeCasting.downtimeSuggestionThresholds,\r\n          chainHealTargetThresholds: this.chainHeal.suggestionThreshold,\r\n          healingRainTargetThreshold: this.healingRain.suggestionThreshold,\r\n          wellspringTargetThreshold: this.wellspring.suggestionThreshold,\r\n          ewtTargetThreshold: this.earthenWallTotem.suggestionThreshold,\r\n          soeTargetThreshold: this.surgeOfEarth.suggestionThreshold,\r\n          manaLeft: this.manaValues.suggestionThresholds,\r\n          waterShieldPrepull: this.waterShield.suggestionThresholdsPrepull,\r\n          waterShieldUptime: this.waterShield.suggestionThresholds,\r\n          earthShieldPrepull: this.earthShield.suggestionThresholdsPrepull,\r\n          earthShieldUptime: this.earthShield.suggestionThresholds,\r\n        }}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default Checklist;\r\n","import SPELLS from 'common/SPELLS';\r\nimport Events, { DispelEvent } from 'parser/core/Events';\r\nimport CoreSpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\n\r\nclass SpellUsable extends CoreSpellUsable {\r\n  constructor(options: Options){\r\n    super(options);\r\n    this.addEventListener(Events.dispel.by(SELECTED_PLAYER).spell(SPELLS.PURIFY_SPIRIT), this.onDispel);\r\n  }\r\n  onDispel(event: DispelEvent) {\r\n    super.beginCooldown(event.ability.guid, event);\r\n  }\r\n\r\n  beginCooldown(spellId: number, cooldownTriggerEvent: DispelEvent) {\r\n    // Essentially having the purify spirit cast not be able to trigger the cooldown, the dispel event does it instead.\r\n    if (spellId === SPELLS.PURIFY_SPIRIT.id) {\r\n      return;\r\n    }\r\n\r\n    super.beginCooldown(spellId, cooldownTriggerEvent);\r\n  }\r\n}\r\n\r\nexport default SpellUsable;\r\n","import SPELLS from 'common/SPELLS';\r\n\r\n/*\r\n * Fields:\r\n * int: spell scales with Intellect\r\n * crit: spell scales with Critical Strike\r\n * hasteHpm: spell does more healing due to Haste, e.g. Spells and Totems that gain more ticks\r\n * hasteHpct: spell can be cast more frequently due to Haste\r\n * mastery: spell is boosted by Mastery\r\n * vers: spell scales with Versatility\r\n * multiplier: spell scales with whatever procs it, should be ignored for purpose of weights and for 'total healing' number\r\n * ignored: spell should be ignored for purpose of stat weights\r\n */\r\n\r\n// This only works with actual healing events; casts are not recognized.\r\n\r\nexport default {\r\n  [SPELLS.HEALING_SURGE.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpct: true,\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.HEALING_WAVE.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpct: true,\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.RIPTIDE.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpm: true,\r\n    hasteHpct: false, // static CD\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.HEALING_STREAM_TOTEM_HEAL.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpm: true,\r\n    hasteHpct: false, // static CD\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.CHAIN_HEAL.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpct: true,\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.HEALING_RAIN_HEAL.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpm: true,\r\n    hasteHpct: false, // static CD\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.HEALING_TIDE_TOTEM_HEAL.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpm: true,\r\n    hasteHpct: false, // static CD\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.ASCENDANCE_HEAL.id]: {\r\n    // This gets special treatment with the `feed_heal` event\r\n    ignored: true,\r\n  },\r\n  [SPELLS.ASCENDANCE_INITIAL_HEAL.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpct: false, // static CD\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.CLOUDBURST_TOTEM_HEAL.id]: {\r\n    // This gets special treatment with the `feed_heal` event\r\n    ignored: true,\r\n  },\r\n  [SPELLS.EARTHEN_WALL_TOTEM_ABSORB.id]: {\r\n    // EST scales with INT per hit but the total absorb is limited by the players max HP\r\n    ignored: true,\r\n  },\r\n  [SPELLS.SPIRIT_LINK_TOTEM_REDISTRIBUTE.id]: {\r\n    ignored: true,\r\n  },\r\n  [SPELLS.SPIRIT_LINK_TOTEM.id]: {\r\n    ignored: true,\r\n  },\r\n  [SPELLS.UNLEASH_LIFE_TALENT.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpct: false, // static CD\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.WELLSPRING_HEAL.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpct: false, // static CD\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.EARTH_SHIELD_HEAL.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpct: false,\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  [SPELLS.NATURES_GUARDIAN_HEAL.id]: {\r\n    ignored: true, // scales only with HP\r\n  },\r\n  [SPELLS.DOWNPOUR_TALENT.id]: {\r\n    int: true,\r\n    crit: true,\r\n    hasteHpct: false, // static CD\r\n    mastery: true,\r\n    vers: true,\r\n  },\r\n  // TODO add covenant abilities\r\n};\r\n","import { Trans } from '@lingui/macro';\r\nimport React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport BaseHealerStatValues from 'parser/shared/modules/features/BaseHealerStatValues';\r\nimport STAT from 'parser/shared/modules/features/STAT';\r\nimport StatTracker from 'parser/shared/modules/StatTracker';\r\nimport HealingValue from 'parser/shared/modules/HealingValue';\r\nimport CritEffectBonus from 'parser/shared/modules/helpers/CritEffectBonus';\r\n\r\nimport Events from 'parser/core/Events';\r\n\r\nimport SPELL_INFO from './StatValuesSpellInfo';\r\nimport MasteryEffectiveness from './MasteryEffectiveness';\r\n\r\n/**\r\n * Restoration Shaman Stat Values\r\n */\r\n\r\nconst BUFFER_MS = 100;\r\n\r\nclass StatValues extends BaseHealerStatValues {\r\n  static dependencies = {\r\n    statTracker: StatTracker,\r\n    critEffectBonus: CritEffectBonus,\r\n    masteryEffectiveness: MasteryEffectiveness,\r\n  };\r\n\r\n  spellInfo = SPELL_INFO;\r\n  qeLive = true;\r\n\r\n  constructor(options) {\r\n    super(options);\r\n    this.addEventListener(Events.feedheal, this.onFeedHeal);\r\n  }\r\n\r\n  onFeedHeal(event) {\r\n    const spellInfo = this._getSpellInfo(event);\r\n    const healVal = new HealingValue(event.feed, 0, 0);\r\n    const targetHealthPercentage = (event.hitPoints - event.amount) / event.maxHitPoints; // hitPoints contains HP *after* the heal\r\n    this._handleHeal(spellInfo, event, healVal, targetHealthPercentage);\r\n  }\r\n\r\n  _getCritChance(event) {\r\n    const spellId = event.ability.guid;\r\n    const critChanceBreakdown = super._getCritChance(event);\r\n\r\n    const hasTidalWaves = this.selectedCombatant.hasBuff(SPELLS.TIDAL_WAVES_BUFF.id, event.timestamp, 0, BUFFER_MS);\r\n    if (spellId === SPELLS.HEALING_SURGE.id && hasTidalWaves) {\r\n      critChanceBreakdown.baseCritChance += 0.4;\r\n    }\r\n\r\n    return critChanceBreakdown;\r\n  }\r\n\r\n  _hasteHpm(event, healVal) {\r\n    if (healVal.overheal) {\r\n      return 0;\r\n    }\r\n    if (event.ability.guid === SPELLS.RIPTIDE.id && !event.tick) {\r\n      return 0;\r\n    }\r\n    return super._hasteHpm(event, healVal);\r\n  }\r\n\r\n  _mastery(event, healVal) {\r\n    if (healVal.overheal) {\r\n      // If a spell overheals, it could not have healed for more. Seeing as Mastery only adds HP on top of the existing heal we can skip it as increasing the power of this heal would only be more overhealing.\r\n      return 0;\r\n    }\r\n    if (event.masteryEffectiveness === undefined) {\r\n      console.error('This spell does not have a known masteryEffectiveness:', event.ability.guid, event.ability.name);\r\n      return 0;\r\n    }\r\n\r\n    const masteryEffectiveness = event.masteryEffectiveness;\r\n    const healIncreaseFromOneMastery = this.statTracker.statMultiplier.mastery / this.statTracker.ratingNeededForNextPercentage(this.statTracker.currentMasteryRating, this.statTracker.statBaselineRatingPerPercent[STAT.MASTERY], this.selectedCombatant.spec.masteryCoefficient) * masteryEffectiveness;\r\n    const baseHeal = healVal.effective / (1 + this.statTracker.currentMasteryPercentage * masteryEffectiveness);\r\n\r\n    return baseHeal * healIncreaseFromOneMastery;\r\n  }\r\n\r\n  _prepareResults() {\r\n    return [\r\n      STAT.INTELLECT,\r\n      {\r\n        stat: STAT.CRITICAL_STRIKE,\r\n        tooltip: <Trans id=\"shaman.restoration.statValues.crit\">Weight does not include Resurgence mana gain.</Trans>,\r\n      },\r\n      {\r\n        stat: STAT.HASTE_HPCT,\r\n        tooltip: (\r\n          <Trans id=\"shaman.restoration.statValues.hpct\">\r\n            HPCT stands for \"Healing per Cast Time\". This is the max value that Haste would be worth if you would cast everything you are already casting (that scales with Haste) faster. Mana and overhealing are not accounted for in any way.<br /><br />\r\n\r\n            The real value of Haste (HPCT) will be between 0 and the shown value. It depends on various things, such as if you have the mana left to spend, if the gained casts would overheal, and how well you are at casting spells end-to-end. If you are going OOM before the end of the fight you might instead want to drop some Haste or cast fewer bad heals. If you had mana left-over, Haste could help you convert that into healing. If your Haste usage is optimal Haste will then be worth the shown max value.<br /><br />\r\n\r\n            Haste can also help you safe lives during intense damage phases. If you notice you're GCD capped when people are dying, Haste might help you land more heals. This may contribute more towards actually getting the kill.\r\n          </Trans>\r\n        ),\r\n      },\r\n      STAT.HASTE_HPM,\r\n      STAT.MASTERY,\r\n      STAT.VERSATILITY,\r\n      STAT.VERSATILITY_DR,\r\n      STAT.LEECH,\r\n    ];\r\n  }\r\n}\r\n\r\nexport default StatValues;\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\n\r\nimport { ThresholdStyle, When } from 'parser/core/ParseResults';\r\nimport Events, { BeginCastEvent, CastEvent } from 'parser/core/Events';\r\n\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport RestorationAbilityTracker from '../core/RestorationAbilityTracker';\r\n\r\nconst TIDAL_WAVES_BUFF_MINIMAL_ACTIVE_TIME = 100; // Minimal duration for which you must have tidal waves. Prevents it from counting a HS/HW as buffed when you cast a riptide at the end.\r\n\r\nclass TidalWaves extends Analyzer {\r\n  static dependencies = {\r\n    abilityTracker: RestorationAbilityTracker,\r\n  };\r\n  protected abilityTracker!: RestorationAbilityTracker;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.HEALING_SURGE), this._onHealingSurge);\r\n    this.addEventListener(Events.begincast.by(SELECTED_PLAYER).spell(SPELLS.HEALING_WAVE), this._onHealingWave);\r\n  }\r\n\r\n  _onHealingSurge(event: CastEvent) {\r\n    const hasTw = this.selectedCombatant.hasBuff(SPELLS.TIDAL_WAVES_BUFF.id, event.timestamp, 0, TIDAL_WAVES_BUFF_MINIMAL_ACTIVE_TIME);\r\n    if (hasTw) {\r\n      const cast = this.abilityTracker.getAbility(event.ability.guid, event.ability);\r\n      cast.healingTwHits = (cast.healingTwHits || 0) + 1;\r\n    }\r\n  }\r\n\r\n  _onHealingWave(event: BeginCastEvent) {\r\n    if (event.isCancelled) {\r\n      return;\r\n    }\r\n\r\n    const hasTw = this.selectedCombatant.hasBuff(SPELLS.TIDAL_WAVES_BUFF.id, event.timestamp, 0, TIDAL_WAVES_BUFF_MINIMAL_ACTIVE_TIME);\r\n    if (hasTw) {\r\n      const cast = this.abilityTracker.getAbility(event.ability.guid, event.ability);\r\n      cast.healingTwHits = (cast.healingTwHits || 0) + 1;\r\n    }\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    const suggestedThresholds = this.suggestionThresholds;\r\n    when(suggestedThresholds.actual).isGreaterThan(suggestedThresholds.isGreaterThan.minor)\r\n      .addSuggestion((suggest) => suggest(<Trans id=\"shaman.restoration.suggestions.tidalWaves.label\"><SpellLink id={SPELLS.TIDAL_WAVES_BUFF.id} /> buffed <SpellLink id={SPELLS.HEALING_WAVE.id} /> can make for some very efficient healing, consider casting more of them if you are running into mana issues ({formatPercentage(suggestedThresholds.actual)}% unused Tidal Waves).</Trans>)\r\n        .icon(SPELLS.TIDAL_WAVES_BUFF.icon)\r\n        .actual(<Trans id=\"shaman.restoration.suggestions.tidalWaves.actual\">{formatPercentage(suggestedThresholds.actual)}% unused Tidal waves</Trans>)\r\n        .recommended(<Trans id=\"shaman.restoration.suggestions.tidalWaves.recommended\">Less than {formatPercentage(suggestedThresholds.isGreaterThan.minor, 0)}% unused is recommended</Trans>)\r\n        .regular(suggestedThresholds.isGreaterThan.average).major(suggestedThresholds.isGreaterThan.major));\r\n  }\r\n\r\n  get suggestionThresholds() {\r\n    const riptide = this.abilityTracker.getAbility(SPELLS.RIPTIDE.id);\r\n    const healingWave = this.abilityTracker.getAbility(SPELLS.HEALING_WAVE.id);\r\n    const healingSurge = this.abilityTracker.getAbility(SPELLS.HEALING_SURGE.id);\r\n    const chainHeal = this.abilityTracker.getAbility(SPELLS.CHAIN_HEAL.id);\r\n\r\n    const chainHealCasts = chainHeal.casts || 0;\r\n    const riptideCasts = riptide.casts || 0;\r\n    const totalTwGenerated = riptideCasts + chainHealCasts;\r\n    const twHealingWaves = healingWave.healingTwHits || 0;\r\n    const twHealingSurges = healingSurge.healingTwHits || 0;\r\n\r\n    const totalTwUsed = twHealingWaves + twHealingSurges;\r\n\r\n    const unusedTwRate = 1 - totalTwUsed / totalTwGenerated;\r\n\r\n    return {\r\n      actual: unusedTwRate,\r\n      isGreaterThan: {\r\n        minor: 0.5,\r\n        average: 0.8,\r\n        major: 0.9,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n}\r\n\r\nexport default TidalWaves;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\n\r\nimport Analyzer from 'parser/core/Analyzer';\r\n\r\nimport StatisticGroup from 'interface/statistics/StatisticGroup';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport DonutChart from 'interface/statistics/components/DonutChart';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport { RESTORATION_COLORS } from 'parser/shaman/restoration/constants';\r\n\r\nimport RestorationAbilityTracker from '../core/RestorationAbilityTracker';\r\n\r\nclass CastBehavior extends Analyzer {\r\n  static dependencies = {\r\n    abilityTracker: RestorationAbilityTracker,\r\n  };\r\n\r\n  protected abilityTracker!: RestorationAbilityTracker;\r\n\r\n  get twUsageRatioChart() {\r\n    const riptide = this.abilityTracker.getAbility(SPELLS.RIPTIDE.id);\r\n    const healingWave = this.abilityTracker.getAbility(SPELLS.HEALING_WAVE.id);\r\n    const healingSurge = this.abilityTracker.getAbility(SPELLS.HEALING_SURGE.id);\r\n    const chainHeal = this.abilityTracker.getAbility(SPELLS.CHAIN_HEAL.id);\r\n\r\n    const chainHealCasts = chainHeal.casts || 0;\r\n    const riptideCasts = riptide.casts || 0;\r\n    const totalTwGenerated = riptideCasts + chainHealCasts;\r\n    const twHealingWaves = healingWave.healingTwHits || 0;\r\n    const twHealingSurges = healingSurge.healingTwHits || 0;\r\n\r\n    const totalTwUsed = twHealingWaves + twHealingSurges;\r\n    const unusedTw = totalTwGenerated - totalTwUsed;\r\n\r\n    const items = [\r\n      {\r\n        color: RESTORATION_COLORS.HEALING_WAVE,\r\n        label: <Trans id=\"shaman.restoration.spell.healingWave\">Healing Wave</Trans>,\r\n        spellId: SPELLS.HEALING_WAVE.id,\r\n        value: twHealingWaves,\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.HEALING_SURGE,\r\n        label: <Trans id=\"shaman.restoration.spell.healingSurge\">Healing Surge</Trans>,\r\n        spellId: SPELLS.HEALING_SURGE.id,\r\n        value: twHealingSurges,\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.UNUSED,\r\n        label: <Trans id=\"shaman.restoration.castBehaviour.unusedTW\">Unused Tidal Waves</Trans>,\r\n        tooltip: <Trans id=\"shaman.restoration.castBehaviour.unusedTW.tooltip\">The amount of Tidal Waves you did not use out of the total available. You cast {riptideCasts} Riptides and {chainHealCasts} Chain Heals which gave you {totalTwGenerated} Tidal Waves charges, of which you used ${totalTwUsed}.</Trans>,\r\n        value: unusedTw,\r\n      },\r\n    ];\r\n\r\n    return (\r\n      <DonutChart\r\n        items={items}\r\n      />\r\n    );\r\n  }\r\n\r\n  get fillerCastRatioChart() {\r\n    const healingWave = this.abilityTracker.getAbility(SPELLS.HEALING_WAVE.id);\r\n    const healingSurge = this.abilityTracker.getAbility(SPELLS.HEALING_SURGE.id);\r\n    const twHealingWaves = healingWave.healingTwHits || 0;\r\n    const twHealingSurges = healingSurge.healingTwHits || 0;\r\n\r\n    const healingWaveHeals = healingWave.casts || 0;\r\n    const healingSurgeHeals = healingSurge.casts || 0;\r\n    const fillerHealingWaves = healingWaveHeals - twHealingWaves;\r\n    const fillerHealingSurges = healingSurgeHeals - twHealingSurges;\r\n\r\n    const items = [\r\n      {\r\n        color: RESTORATION_COLORS.HEALING_WAVE,\r\n        label: <Trans id=\"shaman.restoration.spell.healingWave\">Healing Wave</Trans>,\r\n        spellId: SPELLS.HEALING_WAVE.id,\r\n        value: fillerHealingWaves,\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.HEALING_SURGE,\r\n        label: <Trans id=\"shaman.restoration.spell.healingSurge\">Healing Surge</Trans>,\r\n        spellId: SPELLS.HEALING_SURGE.id,\r\n        value: fillerHealingSurges,\r\n      },\r\n    ];\r\n\r\n    return (\r\n      <DonutChart\r\n        items={items}\r\n      />\r\n    );\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <StatisticGroup category={STATISTIC_CATEGORY.GENERAL} large={false} wide={false} style={{}}>\r\n        <Statistic ultrawide>\r\n          <div className=\"pad\">\r\n            <label><Trans id=\"shaman.restoration.castBehaviour.statistic.tidalWaves\"><SpellLink id={SPELLS.TIDAL_WAVES_BUFF.id} /> usage</Trans></label>\r\n            {this.twUsageRatioChart}\r\n          </div>\r\n        </Statistic>\r\n        <Statistic ultrawide>\r\n          <div className=\"pad\">\r\n            <label><Trans id=\"shaman.restoration.castBehaviour.statistic.fillers\">Fillers</Trans></label>\r\n            {this.fillerCastRatioChart}\r\n          </div>\r\n        </Statistic>\r\n      </StatisticGroup>\r\n    );\r\n  }\r\n}\r\n\r\nexport default CastBehavior;\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\n\r\nconst TORRENT_HEALING_INCREASE = 0.2;\r\n\r\nclass Torrent extends Analyzer {\r\n  healing = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.TORRENT_TALENT.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this._onHeal);\r\n  }\r\n\r\n  _onHeal(event: HealEvent) {\r\n    if (event.tick) {\r\n      return;\r\n    }\r\n\r\n    this.healing += calculateEffectiveHealing(event, TORRENT_HEALING_INCREASE);\r\n  }\r\n\r\n  subStatistic() {\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.TORRENT_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing))} %`}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default Torrent;\r\n\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\n\r\nconst UNDULATION_HEALING_INCREASE = 0.5;\r\nconst BUFFER_MS = 300;\r\n\r\nclass Undulation extends Analyzer {\r\n  healing = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.UNDULATION_TALENT.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell([SPELLS.HEALING_WAVE, SPELLS.HEALING_SURGE]), this._onHeal);\r\n  }\r\n  // TODO this might need to account for pwave covenant ability in SL as it copies healing waves\r\n  _onHeal(event: HealEvent) {\r\n    const hasUndulation = this.selectedCombatant.hasBuff(SPELLS.UNDULATION_BUFF.id, event.timestamp, BUFFER_MS, BUFFER_MS);\r\n\r\n    if (hasUndulation) {\r\n      this.healing += calculateEffectiveHealing(event, UNDULATION_HEALING_INCREASE);\r\n    }\r\n  }\r\n\r\n  subStatistic() {\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.UNDULATION_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing))} %`}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default Undulation;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\nimport SpellLink from 'common/SpellLink';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\nimport Events, { HealEvent, BeginCastEvent } from 'parser/core/Events';\r\n\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\n\r\nimport HealingRainLocation from '../core/HealingRainLocation';\r\n\r\nconst DELUGE_HEALING_INCREASE = 0.20;\r\n\r\n/**\r\n * Chain Heal heals for an additional 20% on targets within your Healing Rain or affected by your Riptide.\r\n */\r\nclass Deluge extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n    healingRainLocation: HealingRainLocation,\r\n  };\r\n  protected combatants!: Combatants;\r\n  protected healingRainLocation!: HealingRainLocation;\r\n\r\n  healing = 0;\r\n  eventsDuringRain: HealEvent[] = [];\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.DELUGE_TALENT.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell([SPELLS.CHAIN_HEAL, SPELLS.HEALING_WAVE, SPELLS.HEALING_SURGE]), this._onHeal);\r\n    this.addEventListener(Events.begincast.by(SELECTED_PLAYER).spell(SPELLS.HEALING_RAIN_CAST), this._onHealingRainBegincast);\r\n    this.addEventListener(Events.fightend, this._onFightend);\r\n  }\r\n\r\n  _onHeal(event: HealEvent) {\r\n    const combatant = this.combatants.getEntity(event);\r\n    if (!combatant) {\r\n      // Pet healing\r\n      this.eventsDuringRain.push(event);\r\n      return;\r\n    }\r\n\r\n    const hasBuff = combatant.hasBuff(SPELLS.RIPTIDE.id, event.timestamp, undefined, undefined, this.owner.playerId);\r\n    if (!hasBuff) {\r\n      // We add events for the Healing Rain here, so that it doesn't double dip on targets with Riptide\r\n      this.eventsDuringRain.push(event);\r\n      return;\r\n    }\r\n\r\n    this.healing += calculateEffectiveHealing(event, DELUGE_HEALING_INCREASE);\r\n  }\r\n\r\n  // Due to the nature of having to wait until rain is over, to be able to find out its position,\r\n  // we only start processing the healing contribution on the next cast of Healing Rain or at the end of combat.\r\n  _onHealingRainBegincast(event: BeginCastEvent) {\r\n    if (event.isCancelled) {\r\n      return;\r\n    }\r\n\r\n    this.recordHealing();\r\n    this.eventsDuringRain.length = 0;\r\n  }\r\n\r\n  _onFightend() {\r\n    this.recordHealing();\r\n  }\r\n\r\n  recordHealing() {\r\n    // filters out the first cast in combat if there was no pre-cast, or if there were no Chain Heal casts anyway.\r\n    if (this.eventsDuringRain.length === 0) {\r\n      return;\r\n    }\r\n\r\n    this.healing += this.healingRainLocation.processHealingRain(this.eventsDuringRain, DELUGE_HEALING_INCREASE);\r\n  }\r\n\r\n  subStatistic() {\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.DELUGE_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing))} %`}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default Deluge;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\nimport { formatPercentage } from 'common/format';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { CastEvent, EventType, HealEvent } from 'parser/core/Events';\r\nimport EventEmitter from 'parser/core/modules/EventEmitter';\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\n\r\nimport CooldownThroughputTracker from '../features/CooldownThroughputTracker';\r\n\r\n/**\r\n * When your health is brought below 35%, you instantly heal for 20% of your maximum health.\r\n * Cannot occur more than once every 45 sec.\r\n *\r\n * As this talent has no cast event, but you should still be able to see it on the timeline,\r\n * this module creates that event whenever this talent heals the player.\r\n */\r\nclass NaturesGuardian extends Analyzer {\r\n  static dependencies = {\r\n    eventEmitter: EventEmitter,\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n  };\r\n\r\n  protected eventEmitter!: EventEmitter;\r\n  protected cooldownThroughputTracker!: CooldownThroughputTracker;\r\n\r\n  healing = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.NATURES_GUARDIAN_TALENT.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.NATURES_GUARDIAN_HEAL), this._onHeal);\r\n  }\r\n\r\n  _onHeal(event: HealEvent) {\r\n    const fabricatedCastEvent: CastEvent = {\r\n      ability: {\r\n        ...event.ability,\r\n        guid: SPELLS.NATURES_GUARDIAN_TALENT.id,\r\n      },\r\n      sourceID: event.sourceID,\r\n      sourceIsFriendly: event.sourceIsFriendly,\r\n      targetIsFriendly: event.targetIsFriendly,\r\n      timestamp: event.timestamp,\r\n      type: EventType.Cast,\r\n    };\r\n\r\n    this.eventEmitter.fabricateEvent(fabricatedCastEvent, event);\r\n\r\n    this.healing += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  get feeding() {\r\n    return this.cooldownThroughputTracker.getIndirectHealing(SPELLS.NATURES_GUARDIAN_HEAL.id);\r\n  }\r\n\r\n  subStatistic() {\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.NATURES_GUARDIAN_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing + this.feeding))} %`}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default NaturesGuardian;\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\nimport { TooltipElement } from 'common/Tooltip';\r\n\r\nimport StatisticBox, { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport CooldownThroughputTracker from '../features/CooldownThroughputTracker';\r\nimport RestorationAbilityTracker from '../core/RestorationAbilityTracker';\r\n\r\nconst BUFFER = 100;\r\nconst cooldownIncrease = 5000;\r\nconst maxHits = 6;\r\n\r\n/**\r\n * CD changes depending on amount of effective targets hit (0 = 5s, 6 = 35s)\r\n */\r\n\r\nclass Downpour extends Analyzer {\r\n  static dependencies = {\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n    spellUsable: SpellUsable,\r\n    abilityTracker: RestorationAbilityTracker,\r\n  };\r\n\r\n  protected cooldownThroughputTracker!: CooldownThroughputTracker;\r\n  protected spellUsable!: SpellUsable;\r\n  protected abilityTracker!: RestorationAbilityTracker;\r\n\r\n  healing = 0;\r\n  downpourHits = 0;\r\n  downpourHitsSum = 0;\r\n  downpourTimestamp = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.DOWNPOUR_TALENT.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER), this._onHeal);\r\n  }\r\n\r\n  _onHeal(event: HealEvent) {\r\n    // This spells cooldown gets increased depending on how many targets you heal\r\n    // instead we set it to the maximum possible cooldown and reduce it by how many it fully overhealed or missed\r\n    if (this.downpourTimestamp && event.timestamp > this.downpourTimestamp + BUFFER) {\r\n      const reductionMS = (maxHits - this.downpourHits) * cooldownIncrease;\r\n      this.spellUsable.reduceCooldown(SPELLS.DOWNPOUR_TALENT.id, reductionMS);\r\n      this.downpourTimestamp = 0;\r\n      this.downpourHits = 0;\r\n    }\r\n\r\n    const spellId = event.ability.guid;\r\n    if (spellId !== SPELLS.DOWNPOUR_TALENT.id) {\r\n      return;\r\n    }\r\n\r\n    if (event.amount) {\r\n      this.downpourHits += 1;\r\n      this.downpourHitsSum += 1;\r\n    }\r\n\r\n    this.downpourTimestamp = event.timestamp;\r\n    this.healing += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  statistic() {\r\n    const downpour = this.abilityTracker.getAbility(SPELLS.DOWNPOUR_TALENT.id);\r\n\r\n    const downpourCasts = downpour.casts;\r\n    if (!downpourCasts) {\r\n      return null;\r\n    }\r\n    // downpourHits are all hits and downpourHitsSum are only the ones with effective healing done\r\n    const downpourHits = downpour.healingHits;\r\n    const downpourAverageHits = (this.downpourHitsSum) / downpourCasts;\r\n    const downpourAverageOverhealedHits = (downpourHits - this.downpourHitsSum) / downpourCasts;\r\n    const downpourAverageCooldown = 5 + (this.downpourHitsSum / downpourCasts * 5);\r\n\r\n    return (\r\n      <StatisticBox\r\n        icon={<SpellIcon id={SPELLS.DOWNPOUR_TALENT.id} />}\r\n        value={<Trans id=\"shaman.restoration.downpour.statistic.value\">{downpourAverageCooldown.toFixed(1)} seconds</Trans>}\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        position={STATISTIC_ORDER.OPTIONAL(90)}\r\n        label={(\r\n          <TooltipElement\r\n            content={(\r\n              <Trans id=\"shaman.restoration.downpour.statistic.label.tooltip\">\r\n                You cast a total of {downpourCasts} Downpours, which on average hit {(downpourAverageHits + downpourAverageOverhealedHits).toFixed(1)} out of 6 targets. <br />\r\n                Of those hits, {downpourAverageHits.toFixed(1)} had effective healing and increased the cooldown.\r\n              </Trans>\r\n            )}\r\n          >\r\n            <Trans id=\"shaman.restoration.downpour.statistic.label\">Average Downpour cooldown</Trans>\r\n          </TooltipElement>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n\r\n  subStatistic() {\r\n    const feeding = this.cooldownThroughputTracker.getIndirectHealing(SPELLS.DOWNPOUR_TALENT.id);\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.DOWNPOUR_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing + feeding))} %`}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default Downpour;\r\n\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { ApplyBuffEvent, CastEvent, EventType, HealEvent, RemoveBuffEvent } from 'parser/core/Events';\r\nimport EventEmitter from 'parser/core/modules/EventEmitter';\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\n\r\nimport CooldownThroughputTracker from '../features/CooldownThroughputTracker';\r\n\r\nconst DELAY_MS = 200;\r\n\r\n/**\r\n * Cloudburst Totem has no buff events in the combatlog, so we're fabricating it on cast and\r\n * removing it when its done, so we can track the buff and have it show up on the timeline.\r\n *\r\n * Also sums up the healing it does and feeds for the Talents module.\r\n */\r\n\r\nclass CloudburstTotem extends Analyzer {\r\n  static dependencies = {\r\n    eventEmitter: EventEmitter,\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n  };\r\n\r\n  protected eventEmitter!: EventEmitter;\r\n  protected cooldownThroughputTracker!: CooldownThroughputTracker;\r\n\r\n\r\n  healing = 0;\r\n  cbtActive = false;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.CLOUDBURST_TOTEM_TALENT.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.CLOUDBURST_TOTEM_HEAL), this._onHeal);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.CLOUDBURST_TOTEM_TALENT), this._onCast);\r\n  }\r\n\r\n  _onHeal(event: HealEvent) {\r\n    if (this.cbtActive) {\r\n      this._createFabricatedEvent(event, EventType.RemoveBuff, event.timestamp);\r\n      this.cbtActive = false;\r\n    }\r\n\r\n    this.healing += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  _onCast(event: CastEvent) {\r\n    // Patch 7.3.5 added a buffer before CBT can collect healing after casting,\r\n    // this turns out to be around 200ms and causes it to not collect healing from\r\n    // spells casted right before it, essentially removing pre-feeding.\r\n    // This adds those 200ms to it so you can visually see that the feeding starts later.\r\n    const timestamp = event.timestamp + DELAY_MS;\r\n    this._createFabricatedEvent(event, EventType.ApplyBuff, timestamp);\r\n    this.cbtActive = true;\r\n  }\r\n\r\n  _createFabricatedEvent(event: CastEvent | HealEvent, type: EventType.ApplyBuff | EventType.RemoveBuff, timestamp: number) {\r\n    const fabricatedEvent: ApplyBuffEvent | RemoveBuffEvent = {\r\n      ability: {\r\n        ...event.ability,\r\n        guid: SPELLS.CLOUDBURST_TOTEM_TALENT.id,\r\n      },\r\n      sourceID: event.sourceID,\r\n      targetID: event.sourceID,\r\n      sourceIsFriendly: event.sourceIsFriendly,\r\n      targetIsFriendly: event.targetIsFriendly,\r\n      timestamp: timestamp,\r\n      type: type,\r\n    };\r\n\r\n    this.eventEmitter.fabricateEvent(fabricatedEvent, event);\r\n  }\r\n\r\n  subStatistic() {\r\n    const feeding = this.cooldownThroughputTracker.getIndirectHealing(SPELLS.CLOUDBURST_TOTEM_HEAL.id);\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.CLOUDBURST_TOTEM_TALENT.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing + feeding))} %`}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default CloudburstTotem;\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\n\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\n\r\nimport CooldownThroughputTracker from '../features/CooldownThroughputTracker';\r\n\r\nclass Ascendance extends Analyzer {\r\n  static dependencies = {\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n  };\r\n  healing = 0;\r\n\r\n  protected cooldownThroughputTracker!: CooldownThroughputTracker;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.ASCENDANCE_TALENT_RESTORATION.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell([SPELLS.ASCENDANCE_HEAL, SPELLS.ASCENDANCE_INITIAL_HEAL]), this._onHeal);\r\n  }\r\n\r\n  _onHeal(event: HealEvent) {\r\n    this.healing += event.amount + (event.absorbed || 0);\r\n  }\r\n\r\n  get feeding() {\r\n    return this.cooldownThroughputTracker.getIndirectHealing(SPELLS.ASCENDANCE_HEAL.id) + this.cooldownThroughputTracker.getIndirectHealing(SPELLS.ASCENDANCE_INITIAL_HEAL.id);\r\n  }\r\n\r\n  subStatistic() {\r\n    return (\r\n      <StatisticListBoxItem\r\n        title={<SpellLink id={SPELLS.ASCENDANCE_TALENT_RESTORATION.id} />}\r\n        value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing + this.feeding))} %`}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default Ascendance;\r\n\r\n","import React from 'react';\r\n\r\nimport HIT_TYPES from 'game/HIT_TYPES';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\nimport Events, { ApplyBuffEvent, ApplyBuffStackEvent, CastEvent, HealEvent, RemoveBuffEvent } from 'parser/core/Events';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\nimport StatTracker from 'parser/shared/modules/StatTracker';\r\nimport CritEffectBonus from 'parser/shared/modules/helpers/CritEffectBonus';\r\nimport StatisticListBoxItem from 'interface/others/StatisticListBoxItem';\r\nimport { Trans } from '@lingui/macro';\r\nimport { CHAIN_HEAL_COEFFICIENT, HIGH_TIDE_COEFFICIENT } from 'parser/shaman/restoration/constants';\r\n\r\nconst HEAL_WINDOW_MS = 150;\r\nconst bounceReduction = 0.7;\r\nconst debug = false;\r\n\r\ninterface BufferHealEvent extends HealEvent {\r\n  baseHealingDone: number\r\n}\r\n\r\n/**\r\n * High Tide:\r\n * Every 40000 mana you spend brings a High Tide, making your next 2 Chain Heals heal for an additional 20% and not reduce with each jump.\r\n */\r\n\r\n/**\r\n * Logs for testing High Tide buff usage:\r\n * Double stack log: https://www.warcraftlogs.com/reports/Qb91XvyqtNjaHRPr#fight=21&type=auras&source=11&pins=0%24Separate%24%23244F4B%24healing%240%240.0.0.Any%24137004809.0.0.Shaman%24true%240.0.0.Any%24false%241064&ability=288675\r\n * Buff applied pre-pull: https://www.warcraftlogs.com/reports/R4JncHyajt8VQr9h#fight=48&type=auras&source=14&ability=288675\r\n */\r\n\r\nclass HighTide extends Analyzer {\r\n  static dependencies = {\r\n    statTracker: StatTracker,\r\n    critEffectBonus: CritEffectBonus,\r\n  };\r\n\r\n  protected statTracker!: StatTracker;\r\n  protected critEffectBonus!: CritEffectBonus;\r\n\r\n  healing = 0;\r\n  chainHealTimestamp = 0;\r\n  buffer: BufferHealEvent[] = [];\r\n\r\n  // high tide efficiency trackers\r\n  usedHighTides = 0;\r\n  unusedHighTides = 0;\r\n  currentHighTideBuff = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.HIGH_TIDE_TALENT.id);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.CHAIN_HEAL), this.chainHeal);\r\n    this.addEventListener(Events.fightend, this.onFightEnd);\r\n\r\n    // these are for tracking high tide efficiency\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.CHAIN_HEAL), this.onChainHealCast);\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.HIGH_TIDE_BUFF), this.onHighTideBuff);\r\n    this.addEventListener(Events.applybuffstack.by(SELECTED_PLAYER).spell(SPELLS.HIGH_TIDE_BUFF), this.onHighTideBuff);\r\n    this.addEventListener(Events.removebuff.by(SELECTED_PLAYER).spell(SPELLS.HIGH_TIDE_BUFF), this.onHighTideRemoveBuff);\r\n  }\r\n\r\n  // in the event of a High Tide buff, if a buff still exists adds it to unused then resets buff counter to 2\r\n  onHighTideBuff(event: ApplyBuffEvent | ApplyBuffStackEvent) {\r\n    this.unusedHighTides += this.currentHighTideBuff;\r\n    this.currentHighTideBuff = 2;\r\n  }\r\n\r\n  // in the event of a High Tide remove buff, adds any existing buff to unused and sets buff counter to 0\r\n  onHighTideRemoveBuff(event: RemoveBuffEvent) {\r\n    this.unusedHighTides += this.currentHighTideBuff; //if there were leftovers when buff expires\r\n    this.currentHighTideBuff = 0;\r\n  }\r\n\r\n  // on a chain heal cast and buff counter is greater than 0, adds one to used counter\r\n  // and reduces buff counter by one.\r\n  onChainHealCast(event: CastEvent) {\r\n    if (this.currentHighTideBuff > 0) {\r\n      this.usedHighTides += 1;\r\n      this.currentHighTideBuff -= 1;\r\n    }\r\n  }\r\n\r\n  chainHeal(event: HealEvent) {\r\n    const hasHighTide = this.selectedCombatant.hasBuff(SPELLS.HIGH_TIDE_BUFF.id, null, 50, 20);\r\n    if (!hasHighTide) {\r\n      return;\r\n    }\r\n\r\n    // Detects new chain heal casts, can't use the cast event for this as its often somewhere in between its healing events\r\n    if (!this.chainHealTimestamp || event.timestamp - this.chainHealTimestamp > HEAL_WINDOW_MS) {\r\n      this.processBuffer();\r\n      this.chainHealTimestamp = event.timestamp;\r\n    }\r\n\r\n    /**\r\n     * Due to how Chain Heal interacts with the combatlog, we have to take a lot of extra steps here.\r\n     * Issues:\r\n     * 1. The healing events are backwards [4,3,2,1]\r\n     * 2. If the Shaman heals himself, his healing event is always first [3,4,2,1] (3 = Shaman)\r\n     * 3. If 2. happens, the heal on the shaman is also happening before the cast event, which the lines above already deal with.\r\n     *\r\n     * Calculating out High Tide requires us to know the exact jump order, as High Tide affects each jump differently.\r\n     * https://ancestralguidance.com/hidden-spell-mechanics/\r\n     * The solution is to reorder the events into the correct hit order, which could be done since each consecutive heal is weaker\r\n     * than the one beforehand (by 30%), except, you have the Shaman mastery which will result in random healing numbers\r\n     * as each hit has a different mastery effectiveness - the higher the Shamans mastery, the more rapidly different the numbers end up.\r\n     * With traits like https://www.wowhead.com/spell=277942/ancestral-resonance existing, shamans mastery can randomly double or triple mid combat.\r\n     *\r\n     * So we take 1 cast of chain heal at a time (4 hits maximum), calculate out crits and the mastery bonus, reorder them according to the new values\r\n     * (High healing to Low healing or [4,3,2,1] to [1,2,3,4]) and get the High Tide contribution by comparing the original heal values against\r\n     * what a non-High Tide Chain Heal would have done each bounce.\r\n     *\r\n     * Things that are able to break the sorting: Deluge (Pls don't take it) as its undetectable, random player-based heal increases\r\n     * (possibly encounter mechanics) if not accounted for.\r\n     */\r\n    let heal = event.amount + (event.absorbed || 0) + (event.overheal || 0);\r\n    if (event.hitType === HIT_TYPES.CRIT) {\r\n      const critMult = this.critEffectBonus.getBonus(event);\r\n      heal /= critMult;\r\n    }\r\n    const currentMastery = this.statTracker.currentMasteryPercentage;\r\n    const masteryEffectiveness = Math.max(0, 1 - (event.hitPoints - event.amount) / event.maxHitPoints);\r\n    const baseHealingDone = heal / (1 + currentMastery * masteryEffectiveness);\r\n\r\n    this.buffer.push({\r\n      baseHealingDone: baseHealingDone,\r\n      ...event,\r\n    });\r\n  }\r\n\r\n  onFightEnd() {\r\n    this.processBuffer();\r\n  }\r\n\r\n  processBuffer() {\r\n    this.buffer.sort((a, b) => b.baseHealingDone - a.baseHealingDone);\r\n\r\n    for (const [index, event] of Object.entries(this.buffer)) {\r\n      // 20%, 71%, 145%, 250% increase per hit over not having High Tide\r\n      const i = parseInt(index); // why is it a string tho\r\n      const FACTOR_CONTRIBUTED_BY_HT_HIT = (HIGH_TIDE_COEFFICIENT) / (CHAIN_HEAL_COEFFICIENT * bounceReduction ** i) - 1;\r\n\r\n      this.healing += calculateEffectiveHealing(event, FACTOR_CONTRIBUTED_BY_HT_HIT);\r\n      debug && this.log(`HT: ${this.owner.formatTimestamp(event.timestamp)} ${event.amount + (event.overheal || 0)} - ${FACTOR_CONTRIBUTED_BY_HT_HIT} - ${calculateEffectiveHealing(event, FACTOR_CONTRIBUTED_BY_HT_HIT)}`);\r\n    }\r\n    this.buffer = [];\r\n  }\r\n\r\n  subStatistic() {\r\n    const highTideToolTip = <Trans id=\"shaman.restoration.highTide.statistic.tooltip\">{this.usedHighTides} High Tide buff stacks used out of {(this.usedHighTides + this.unusedHighTides + this.currentHighTideBuff)}.</Trans>;\r\n\r\n    return (\r\n      <div>\r\n        <StatisticListBoxItem\r\n          title={<SpellLink id={SPELLS.HIGH_TIDE_TALENT.id} />}\r\n          value={`${formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing))} %`}\r\n          valueTooltip={highTideToolTip}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default HighTide;\r\n\r\n","import React from 'react';\r\n\r\nimport StatisticsListBox, { STATISTIC_ORDER } from 'interface/others/StatisticsListBox';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport SPELLS from 'common/SPELLS';\r\n\r\nimport Analyzer from 'parser/core/Analyzer';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport Torrent from './Torrent';\r\nimport UnleashLife from './UnleashLife';\r\nimport Undulation from './Undulation';\r\nimport Deluge from './Deluge';\r\nimport EarthenWallTotem from './EarthenWallTotem';\r\nimport SurgeOfEarth from './SurgeOfEarth';\r\nimport NaturesGuardian from './NaturesGuardian';\r\nimport Downpour from './Downpour';\r\nimport CloudburstTotem from './CloudburstTotem';\r\nimport Ascendance from './Ascendance';\r\nimport Wellspring from './Wellspring';\r\nimport HighTide from './HighTide';\r\n\r\n\r\nclass TalentStatisticBox extends Analyzer {\r\n  static dependencies = {\r\n    torrent: Torrent,\r\n    unleashLife: UnleashLife,\r\n    undulation: Undulation,\r\n    deluge: Deluge,\r\n    earthenWallTotem: EarthenWallTotem,\r\n    surgeOfEarth: SurgeOfEarth,\r\n    naturesGuardian: NaturesGuardian,\r\n    downpour: Downpour,\r\n    cloudburstTotem: CloudburstTotem,\r\n    ascendance: Ascendance,\r\n    wellspring: Wellspring,\r\n    highTide: HighTide,\r\n  };\r\n\r\n  protected torrent!: Torrent;\r\n  protected unleashLife!: UnleashLife;\r\n  protected undulation!: Undulation;\r\n  protected deluge!: Deluge;\r\n  protected earthenWallTotem!: EarthenWallTotem;\r\n  protected surgeOfEarth!: SurgeOfEarth;\r\n  protected naturesGuardian!: NaturesGuardian;\r\n  protected downpour!: Downpour;\r\n  protected cloudburstTotem!: CloudburstTotem;\r\n  protected ascendance!: Ascendance;\r\n  protected wellspring!: Wellspring;\r\n  protected highTide!: HighTide;\r\n\r\n  statistic() {\r\n    return (\r\n      <StatisticsListBox\r\n        title={<Trans id=\"shaman.restoration.talentBox.title\">Healing Contribution</Trans>}\r\n        tooltip={(\r\n          <Trans id=\"shaman.restoration.talentBox.tooltip\">\r\n            The purpose of this is to show the overall HPS impact of each talent. So not only what the talent itself did, but also feeding and synergy or interactions with other spells or talents. The percentage shown is what you'd lose without the talent, ignoring what you'd gain from the other options.<br /><br />\r\n\r\n            <strong>Not Supported:</strong><br />\r\n            Echo of the Elements\r\n          </Trans>\r\n        )}\r\n        position={STATISTIC_ORDER.CORE(1)}\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        bodyStyle={{}} // idk\r\n      >\r\n        <div style={{ borderBottom: 0, marginBottom: 0, paddingBottom: 0 }} />\r\n        {this.selectedCombatant.hasTalent(SPELLS.TORRENT_TALENT.id) ? this.torrent.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.UNLEASH_LIFE_TALENT.id) ? this.unleashLife.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.UNDULATION_TALENT.id) ? this.undulation.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.DELUGE_TALENT.id) ? this.deluge.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.EARTHEN_WALL_TOTEM_TALENT.id) ? this.earthenWallTotem.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.SURGE_OF_EARTH_TALENT.id) ? this.surgeOfEarth.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.NATURES_GUARDIAN_TALENT.id) ? this.naturesGuardian.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.DOWNPOUR_TALENT.id) ? this.downpour.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.CLOUDBURST_TOTEM_TALENT.id) ? this.cloudburstTotem.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.HIGH_TIDE_TALENT.id) ? this.highTide.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.WELLSPRING_TALENT.id) ? this.wellspring.subStatistic() : ''}\r\n        {this.selectedCombatant.hasTalent(SPELLS.ASCENDANCE_TALENT_RESTORATION.id) ? this.ascendance.subStatistic() : ''}\r\n      </StatisticsListBox>\r\n    );\r\n  }\r\n}\r\n\r\nexport default TalentStatisticBox;\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { TooltipElement } from 'common/Tooltip';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport GlobalCooldown from 'parser/shared/modules/GlobalCooldown';\r\nimport { STATISTIC_ORDER } from 'interface/others/StatisticsListBox';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport DonutChart from 'interface/statistics/components/DonutChart';\r\nimport Events, { BeginCastEvent, CastEvent } from 'parser/core/Events';\r\nimport { Trans } from '@lingui/macro';\r\nimport { RESTORATION_COLORS } from 'parser/shaman/restoration/constants';\r\n\r\nconst FLASH_FLOOD_HASTE = 0.2;\r\nconst BUFFER_MS = 50;\r\n\r\ninterface FlashFloodInfo {\r\n  [SpellID: number]: FlashFloodSpell\r\n}\r\n\r\ninterface FlashFloodSpell {\r\n  timesBuffed: number,\r\n  timeSaved: number,\r\n  timeWasted: number\r\n}\r\n\r\nclass FlashFlood extends Analyzer {\r\n  static dependencies = {\r\n    globalCooldown: GlobalCooldown,\r\n  };\r\n\r\n  protected globalCooldown!: GlobalCooldown;\r\n\r\n  beginCastTimestamp = 0;\r\n  beginCastGlobalCooldown = 0;\r\n\r\n  spellsConsumingFlashFlood: FlashFloodInfo = {\r\n    [SPELLS.HEALING_WAVE.id]: {\r\n      timesBuffed: 0,\r\n      timeSaved: 0,\r\n      timeWasted: 0,\r\n    },\r\n    [SPELLS.CHAIN_HEAL.id]: {\r\n      timesBuffed: 0,\r\n      timeSaved: 0,\r\n      timeWasted: 0,\r\n    },\r\n    [SPELLS.HEALING_SURGE.id]: { //-- always below GCD\r\n      timesBuffed: 0,\r\n      timeSaved: 0,\r\n      timeWasted: 0,\r\n    },\r\n    [SPELLS.HEALING_RAIN_CAST.id]: {\r\n      timesBuffed: 0,\r\n      timeSaved: 0,\r\n      timeWasted: 0,\r\n    },\r\n  };\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.FLASH_FLOOD_TALENT.id);\r\n\r\n    if (this.selectedCombatant.hasTalent(SPELLS.WELLSPRING_TALENT.id)) { //-- always below GCD\r\n      this.spellsConsumingFlashFlood[SPELLS.WELLSPRING_TALENT.id] = {\r\n        timesBuffed: 0,\r\n        timeSaved: 0,\r\n        timeWasted: 0,\r\n      };\r\n    }\r\n\r\n    const spellFilter = [SPELLS.HEALING_WAVE, SPELLS.CHAIN_HEAL, SPELLS.HEALING_SURGE, SPELLS.HEALING_RAIN_CAST, SPELLS.WELLSPRING_TALENT];\r\n    this.addEventListener(Events.begincast.by(SELECTED_PLAYER).spell(spellFilter), this._onBeginCast);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(spellFilter), this._onCast);\r\n  }\r\n\r\n  _onBeginCast(event: BeginCastEvent) {\r\n    if (event.isCancelled) {\r\n      return;\r\n    }\r\n\r\n    const spellId = event.ability.guid;\r\n    this.beginCastTimestamp = event.timestamp;\r\n    this.beginCastGlobalCooldown = this.globalCooldown.getGlobalCooldownDuration(spellId);\r\n  }\r\n\r\n  _onCast(event: CastEvent) {\r\n    if (!this.beginCastTimestamp) {\r\n      return;\r\n    }\r\n\r\n    const hasFlashFlood = this.selectedCombatant.hasBuff(SPELLS.FLASH_FLOOD_BUFF.id, this.beginCastTimestamp + BUFFER_MS);\r\n    if (!hasFlashFlood) {\r\n      return;\r\n    }\r\n\r\n    const spellId = event.ability.guid;\r\n    this.spellsConsumingFlashFlood[spellId].timesBuffed += 1;\r\n    const castTime = event.timestamp - this.beginCastTimestamp;\r\n    this.beginCastTimestamp = 0;\r\n    if (castTime <= this.beginCastGlobalCooldown) {\r\n      // The next 2 lines together add up to the total reduction, but everything below the GCD is discarded\r\n      this.spellsConsumingFlashFlood[spellId].timeWasted += this.beginCastGlobalCooldown - castTime;\r\n      this.spellsConsumingFlashFlood[spellId].timeSaved += Math.max((castTime) / (1 - FLASH_FLOOD_HASTE) - this.beginCastGlobalCooldown, 0);\r\n      return;\r\n    }\r\n\r\n    this.spellsConsumingFlashFlood[spellId].timeSaved += castTime / (1 - FLASH_FLOOD_HASTE) * FLASH_FLOOD_HASTE;\r\n  }\r\n\r\n  get totalTimeSaved() {\r\n    return Object.values(this.spellsConsumingFlashFlood).reduce((sum, spell) => sum + spell.timeSaved, 0);\r\n  }\r\n\r\n  get totalTimeWasted() {\r\n    return Object.values(this.spellsConsumingFlashFlood).reduce((sum, spell) => sum + spell.timeWasted, 0);\r\n  }\r\n\r\n  get flashFloodUsageRatioChart() {\r\n    const makeTooltip = (value: FlashFloodSpell) => (\r\n      <>\r\n        <strong>{(value.timeSaved / 1000).toFixed(2)} seconds saved</strong> <br />\r\n        {(value.timeWasted / 1000).toFixed(2)} seconds reduced below GCD <br />\r\n        You buffed this spell <strong>{value.timesBuffed}</strong> times.\r\n      </>\r\n    );\r\n    const items = [\r\n      {\r\n        color: RESTORATION_COLORS.CHAIN_HEAL,\r\n        label: <Trans id=\"shaman.restoration.spell.chainHeal\">Chain Heal</Trans>,\r\n        spellId: SPELLS.CHAIN_HEAL.id,\r\n        value: this.spellsConsumingFlashFlood[SPELLS.CHAIN_HEAL.id].timeSaved,\r\n        valueTooltip: makeTooltip(this.spellsConsumingFlashFlood[SPELLS.CHAIN_HEAL.id]),\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.HEALING_WAVE,\r\n        label: <Trans id=\"shaman.restoration.spell.healingWave\">Healing Wave</Trans>,\r\n        spellId: SPELLS.HEALING_WAVE.id,\r\n        value: this.spellsConsumingFlashFlood[SPELLS.HEALING_WAVE.id].timeSaved,\r\n        valueTooltip: makeTooltip(this.spellsConsumingFlashFlood[SPELLS.HEALING_WAVE.id]),\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.HEALING_SURGE,\r\n        label: <Trans id=\"shaman.restoration.spell.healingSurge\">Healing Surge</Trans>,\r\n        spellId: SPELLS.HEALING_SURGE.id,\r\n        value: this.spellsConsumingFlashFlood[SPELLS.HEALING_SURGE.id].timeSaved,\r\n        valueTooltip: makeTooltip(this.spellsConsumingFlashFlood[SPELLS.HEALING_SURGE.id]),\r\n      },\r\n      {\r\n        color: RESTORATION_COLORS.RIPTIDE,\r\n        label: <Trans id=\"shaman.restoration.spell.healingRain\">Healing Rain</Trans>,\r\n        spellId: SPELLS.HEALING_RAIN_CAST.id,\r\n        value: this.spellsConsumingFlashFlood[SPELLS.HEALING_RAIN_CAST.id].timeSaved,\r\n        valueTooltip: makeTooltip(this.spellsConsumingFlashFlood[SPELLS.HEALING_RAIN_CAST.id]),\r\n      },\r\n    ];\r\n\r\n    if (this.spellsConsumingFlashFlood[SPELLS.WELLSPRING_TALENT.id]) {\r\n      const wellspring = {\r\n        color: '#FEFEFE',\r\n        label: <Trans id=\"shaman.restoration.spell.wellspring\">Wellspring</Trans>,\r\n        spellId: SPELLS.WELLSPRING_TALENT.id,\r\n        value: this.spellsConsumingFlashFlood[SPELLS.WELLSPRING_TALENT.id].timeSaved,\r\n        valueTooltip: makeTooltip(this.spellsConsumingFlashFlood[SPELLS.WELLSPRING_TALENT.id]),\r\n      };\r\n      items.splice(4, 0, wellspring);\r\n    }\r\n\r\n    return (\r\n      <DonutChart\r\n        items={items}\r\n      />\r\n    );\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        position={STATISTIC_ORDER.OPTIONAL(90)}\r\n        size=\"flexible\"\r\n      >\r\n        <div className=\"pad\">\r\n          <label><Trans id=\"shaman.restoration.flashFlood.statistic.label\"><SpellLink id={SPELLS.FLASH_FLOOD_TALENT.id} /> usage</Trans></label>\r\n          <div className=\"flex\">\r\n            <div className=\"flex-main\">\r\n              <Trans id=\"shaman.restoration.flashFlood.statistic.title\">Total Cast Time Saved</Trans>\r\n            </div>\r\n            <div className=\"flex-sub text-right\">\r\n              <TooltipElement\r\n                content={(\r\n                  <Trans id=\"shaman.restoration.flashFlood.statistic.description.tooltip\">\r\n                    Cast time saved by Flash Flood. <br />\r\n                    {(this.totalTimeWasted / 1000).toFixed(2)} seconds 'saved' on reductions below GCD.\r\n                  </Trans>\r\n                )}\r\n              >\r\n                <Trans id=\"shaman.restoration.flashFlood.statistic.description\">{(this.totalTimeSaved / 1000).toFixed(2)} seconds</Trans>\r\n              </TooltipElement>\r\n            </div>\r\n          </div>\r\n          {this.flashFloodUsageRatioChart}\r\n        </div>\r\n      </Statistic>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default FlashFlood;\r\n","import React from 'react';\r\n\r\nimport fetchWcl from 'common/fetchWclApi';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Icon from 'common/Icon';\r\nimport { formatDuration, formatPercentage } from 'common/format';\r\nimport SPECS from 'game/SPECS';\r\n\r\nimport StatisticBox from 'interface/others/StatisticBox';\r\nimport LazyLoadStatisticBox, { STATISTIC_ORDER } from 'interface/others/LazyLoadStatisticBox';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\n\r\nimport Analyzer from 'parser/core/Analyzer';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport { DamageEvent, EventType } from 'parser/core/Events';\r\nimport { WCLEventsResponse, WclOptions } from 'common/WCL_TYPES';\r\nimport { Options } from 'parser/core/Module';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nconst ANCESTRAL_VIGOR_INCREASED_MAX_HEALTH = 0.1;\r\nconst HP_THRESHOLD = 1 - 1 / (1 + ANCESTRAL_VIGOR_INCREASED_MAX_HEALTH);\r\n\r\nclass AncestralVigor extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n  };\r\n\r\n  protected combatants!: Combatants;\r\n\r\n  loaded = false;\r\n  lifeSavingEvents: DamageEvent[] = [];\r\n  disableStatistics = false;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = Boolean(this.selectedCombatant.hasTalent(SPELLS.ANCESTRAL_VIGOR_TALENT.id));\r\n  }\r\n\r\n  // recursively fetch events until no nextPageTimestamp is returned\r\n  fetchAll(pathname: string, query: WclOptions) {\r\n    const checkAndFetch: any = async (_query: WclOptions) => {\r\n      const json = await fetchWcl(pathname, _query) as WCLEventsResponse;\r\n      const events = json.events as DamageEvent[];\r\n      this.lifeSavingEvents.push(...events);\r\n      if (json.nextPageTimestamp) {\r\n        return checkAndFetch(Object.assign(query, {\r\n          start: json.nextPageTimestamp,\r\n        }));\r\n      }\r\n      this.loaded = true;\r\n      return null;\r\n    };\r\n    return checkAndFetch(query);\r\n  }\r\n\r\n  load() {\r\n    // clear array to avoid duplicate entries after switching tabs and clicking it again\r\n    this.lifeSavingEvents = [];\r\n    const query: WclOptions = {\r\n      start: this.owner.fight.start_time,\r\n      end: this.owner.fight.end_time,\r\n      filter: `(\r\n        IN RANGE\r\n        WHEN type='${EventType.Damage}'\r\n          AND target.disposition='friendly'\r\n          AND resources.hitPoints>0\r\n          AND 100*resources.hpPercent<=${Math.ceil(10000 * HP_THRESHOLD)}\r\n          AND 10000*(resources.hitPoints+effectiveDamage)/resources.maxHitPoints>=${Math.floor(10000 * HP_THRESHOLD)}\r\n        FROM type='${EventType.ApplyBuff}'\r\n          AND ability.id=${SPELLS.ANCESTRAL_VIGOR.id}\r\n          AND source.name='${this.selectedCombatant.name}'\r\n        TO type='${EventType.RemoveBuff}'\r\n          AND ability.id=${SPELLS.ANCESTRAL_VIGOR.id}\r\n          AND source.name='${this.selectedCombatant.name}'\r\n        END\r\n      )`,\r\n      timeout: 2000,\r\n    };\r\n    return this.fetchAll(`report/events/${this.owner.report.code}`, query);\r\n  }\r\n\r\n  statistic() {\r\n    const players = this.combatants.getEntities();\r\n    const restoShamans = Object.values(players).filter(combatant => (combatant.specId === SPECS.RESTORATION_SHAMAN.id) && (combatant !== this.selectedCombatant));\r\n    if (restoShamans && restoShamans.some(shaman => shaman.hasTalent(SPELLS.ANCESTRAL_VIGOR_TALENT.id))) {\r\n      this.disableStatistics = true;\r\n    }\r\n    const tooltip = this.loaded\r\n      ? <Trans id=\"shaman.restoration.av.statistic.tooltip.active\">The amount of players that would have died without your Ancestral Vigor buff.</Trans>\r\n      : <Trans id=\"shaman.restoration.av.statistic.tooltip.inactive\">Click to analyze how many lives were saved by the ancestral vigor buff.</Trans>;\r\n    if (this.disableStatistics) {\r\n      return (\r\n        <StatisticBox\r\n          icon={<SpellIcon id={SPELLS.ANCESTRAL_VIGOR.id} />}\r\n          label={<Trans id=\"shaman.restoration.av.statistic.label\">Lives saved</Trans>}\r\n          value={<Trans id=\"shaman.restoration.av.statistic.disabled\">Module disabled</Trans>}\r\n          tooltip={<Trans id=\"shaman.restoration.av.statistic.disabled.reason\">There were multiple Restoration Shamans with Ancestral Vigor in your raid group, this causes major issues with buff tracking. As the results from this module would be very inaccurate, it was disabled.</Trans>}\r\n          category={STATISTIC_CATEGORY.TALENTS}\r\n          position={STATISTIC_ORDER.OPTIONAL(60)}\r\n        />\r\n      );\r\n    } else {\r\n      return (\r\n        <LazyLoadStatisticBox\r\n          loader={this.load.bind(this)}\r\n          icon={<SpellIcon id={SPELLS.ANCESTRAL_VIGOR.id} />}\r\n          value={`≈${this.lifeSavingEvents.length}`}\r\n          label={<Trans id=\"shaman.restoration.av.statistic.label\">Lives saved</Trans>}\r\n          tooltip={tooltip}\r\n          category={STATISTIC_CATEGORY.TALENTS}\r\n          position={STATISTIC_ORDER.OPTIONAL(60)}\r\n        >\r\n          <table className=\"table table-condensed\">\r\n            <thead>\r\n              <tr>\r\n                <th><Trans id=\"common.time\">Time</Trans></th>\r\n                <th><Trans id=\"common.player\">Player</Trans></th>\r\n                <th style={{ textAlign: 'center' }}><Trans id=\"common.ability\">Ability</Trans></th>\r\n                <th><Trans id=\"common.health\">Health</Trans></th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {\r\n                this.lifeSavingEvents.map((event, index) => {\r\n                  const combatant = this.combatants.getEntity(event);\r\n                  if (!combatant) {\r\n                    return null;\r\n                  }\r\n                  const spec = SPECS[combatant.specId];\r\n                  const specClassName = spec.className.replace(' ', '');\r\n\r\n                  return (\r\n                    <tr key={index}>\r\n                      <th scope=\"row\">{formatDuration((event.timestamp - this.owner.fight.start_time) / 1000, 0)}</th>\r\n                      <td className={specClassName}>{combatant.name}</td>\r\n                      <td style={{ textAlign: 'center' }}>\r\n                        <SpellLink id={event.ability.guid} icon={false}>\r\n                          <Icon icon={event.ability.abilityIcon} />\r\n                        </SpellLink></td>\r\n                      <td>{(formatPercentage((event.hitPoints || NaN) / (event.maxHitPoints || NaN)))}%</td>\r\n                    </tr>\r\n                  );\r\n                })\r\n              }\r\n            </tbody>\r\n          </table>\r\n        </LazyLoadStatisticBox>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default AncestralVigor;\r\n","import React from 'react';\r\n\r\nimport fetchWcl from 'common/fetchWclApi';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Icon from 'common/Icon';\r\nimport { formatDuration } from 'common/format';\r\nimport SPECS from 'game/SPECS';\r\n\r\nimport LazyLoadStatisticBox, { STATISTIC_ORDER } from 'interface/others/LazyLoadStatisticBox';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\n\r\nimport Analyzer, { Options } from 'parser/core/Analyzer';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport { ApplyDebuffEvent, CastEvent, EventType, HasSource } from 'parser/core/Events';\r\nimport { WCLEventsResponse, WclOptions } from 'common/WCL_TYPES';\r\nimport { Trans } from '@lingui/macro';\r\n\r\n//RQXjBJ1kG9pAC2DV/21-Mythic++Atal'Dazar+-+Kill+(51:52)/Koorshaman/\r\n\r\nclass AncestralProtectionTotem extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n  };\r\n\r\n  protected combatants!: Combatants;\r\n\r\n  loaded = false;\r\n  aptEvents: Array<CastEvent | ApplyDebuffEvent> = [];\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = Boolean(this.selectedCombatant.hasTalent(SPELLS.ANCESTRAL_PROTECTION_TOTEM_TALENT.id));\r\n  }\r\n\r\n  // recursively fetch events until no nextPageTimestamp is returned\r\n  fetchAll(pathname: string, query: WclOptions) {\r\n    const checkAndFetch: any = async (_query: WclOptions) => {\r\n      const json = await fetchWcl(pathname, _query) as WCLEventsResponse;\r\n      const events = json.events as Array<CastEvent | ApplyDebuffEvent>;\r\n      this.aptEvents.push(...events);\r\n      if (json.nextPageTimestamp) {\r\n        return checkAndFetch(Object.assign(query, {\r\n          start: json.nextPageTimestamp,\r\n        }));\r\n      }\r\n      this.loaded = true;\r\n      return null;\r\n    };\r\n    return checkAndFetch(query);\r\n  }\r\n\r\n  load() {\r\n    this.aptEvents = [];\r\n    const query: WclOptions = {\r\n      start: this.owner.fight.start_time,\r\n      end: this.owner.fight.end_time,\r\n      filter: `(\r\n        (type='${EventType.Cast}' AND ability.id=${SPELLS.ANCESTRAL_PROTECTION_TOTEM_TALENT.id})\r\n        OR\r\n        (type='${EventType.ApplyDebuff}' AND ability.id=${SPELLS.TOTEMIC_REVIVAL_DEBUFF.id})\r\n        OR\r\n        (type='${EventType.Cast}' AND ability.id=${SPELLS.TOTEMIC_REVIVAL_CAST.id})\r\n      )`,\r\n      timeout: 2000,\r\n    };\r\n    return this.fetchAll(`report/events/${this.owner.report.code}`, query);\r\n  }\r\n\r\n  spellToText(ability: number) {\r\n    switch (ability) {\r\n      case SPELLS.ANCESTRAL_PROTECTION_TOTEM_TALENT.id:\r\n        return <Trans id=\"shaman.restoration.apt.status.totemPlaced\">Totem placed</Trans>;\r\n      case SPELLS.TOTEMIC_REVIVAL_DEBUFF.id:\r\n        return <Trans id=\"shaman.restoration.apt.status.revivable\">Able to revive</Trans>;\r\n      case SPELLS.TOTEMIC_REVIVAL_CAST.id:\r\n        return <Trans id=\"shaman.restoration.apt.status.res\">Resurrected</Trans>;\r\n      default:\r\n        return \"\";\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    const tooltip = this.loaded\r\n      ? <Trans id=\"shaman.restoration.apt.statistic.tooltip.active\">This includes the APT casts of all Restoration Shamans in the fight.</Trans>\r\n      : <Trans id=\"shaman.restoration.apt.statistic.tooltip.inactive\">Click to analyze APT usage on this fight.</Trans>;\r\n    const value = this.aptEvents.length > 0 ? <Trans id=\"shaman.restoration.apt.statistic.label.success\">{this.aptEvents.length} events found</Trans> : <Trans id=\"shaman.restoration.apt.statistic.label.failure\">No Results</Trans>;\r\n\r\n    return (\r\n      <LazyLoadStatisticBox\r\n        loader={this.load.bind(this)}\r\n        icon={<SpellIcon id={SPELLS.ANCESTRAL_PROTECTION_TOTEM_TALENT.id} />}\r\n        label={<Trans id=\"shaman.restoration.apt.statistic.label\">Ancestral Protection Totem</Trans>}\r\n        value={value}\r\n        tooltip={tooltip}\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        position={STATISTIC_ORDER.OPTIONAL(60)}\r\n      >\r\n        {(this.aptEvents.length > 0) && (\r\n          <table className=\"table table-condensed\">\r\n            <thead>\r\n              <tr>\r\n                <th><Trans id=\"common.time\">Time</Trans></th>\r\n                <th><Trans id=\"common.player\">Player</Trans></th>\r\n                <th style={{ textAlign: 'center' }}><Trans id=\"common.ability\">Ability</Trans></th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {\r\n                this.aptEvents.map((event, index) => {\r\n                  if (!HasSource(event)) {\r\n                    return null;\r\n                  }\r\n                  const combatant = this.combatants.players[event.sourceID];\r\n                  if (!combatant) {\r\n                    return null; // pet or something\r\n                  }\r\n\r\n                  const spec = SPECS[combatant.specId];\r\n                  const specClassName = spec.className.replace(' ', '');\r\n\r\n                  return (\r\n                    <tr key={index}>\r\n                      <th scope=\"row\">{formatDuration((event.timestamp - this.owner.fight.start_time) / 1000, 0)}</th>\r\n                      <td className={specClassName}>{combatant.name}</td>\r\n                      <td style={{ textAlign: 'center' }}>\r\n                        <SpellLink id={event.ability.guid} icon={false}>\r\n                          <Icon icon={event.ability.abilityIcon} /> {this.spellToText(event.ability.guid)}\r\n                        </SpellLink></td>\r\n                    </tr>\r\n                  );\r\n                })\r\n              }\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      </LazyLoadStatisticBox>\r\n    );\r\n  }\r\n}\r\n\r\nexport default AncestralProtectionTotem;\r\n","import React from 'react';\r\n\r\nimport SpellLink from 'common/SpellLink';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\n\r\nimport Analyzer from 'parser/core/Analyzer';\r\nimport { When } from 'parser/core/ParseResults';\r\n\r\nimport { i18n } from '@lingui/core';\r\nimport { t } from '@lingui/macro';\r\n\r\nimport RestorationAbilityTracker from '../core/RestorationAbilityTracker';\r\n\r\nclass HealingSurge extends Analyzer {\r\n  static dependencies = {\r\n    abilityTracker: RestorationAbilityTracker,\r\n  };\r\n  protected abilityTracker!: RestorationAbilityTracker;\r\n\r\n  get suggestedThreshold() {\r\n    const healingSurge = this.abilityTracker.getAbility(SPELLS.HEALING_SURGE.id);\r\n\r\n    const twHealingSurges = healingSurge.healingTwHits || 0;\r\n    const healingSurgeCasts = healingSurge.casts || 0;\r\n    const unbuffedHealingSurges = healingSurgeCasts - twHealingSurges;\r\n    const unbuffedHealingSurgesPerc = unbuffedHealingSurges / healingSurgeCasts;\r\n\r\n    return {\r\n      actual: unbuffedHealingSurgesPerc,\r\n      isGreaterThan: {\r\n        minor: 0.20,\r\n        average: 0.40,\r\n        major: 0.60,\r\n      },\r\n      style: 'percentage',\r\n    };\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    const suggestedThreshold = this.suggestedThreshold;\r\n    when(suggestedThreshold.actual).isGreaterThan(suggestedThreshold.isGreaterThan.minor)\r\n      .addSuggestion((suggest) => suggest(<span>Casting <SpellLink id={SPELLS.HEALING_SURGE.id} /> without <SpellLink id={SPELLS.TIDAL_WAVES_BUFF.id} /> is very inefficient, try not to cast more than is necessary.</span>)\r\n          .icon(SPELLS.HEALING_SURGE.icon)\r\n          .actual(i18n._(t('shaman.restoration.suggestions.healingSurge.unbuffed')`${formatPercentage(suggestedThreshold.actual)}% of unbuffed Healing Surges`))\r\n          .recommended(`${formatPercentage(suggestedThreshold.isGreaterThan.minor)}% of unbuffed Healing Surges`)\r\n          .regular(suggestedThreshold.isGreaterThan.average).major(suggestedThreshold.isGreaterThan.major));\r\n  }\r\n\r\n}\r\n\r\nexport default HealingSurge;\r\n\r\n","import React from 'react';\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellLink from 'common/SpellLink';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport { formatPercentage } from 'common/format';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\nimport Events, { BeginCastEvent, CastEvent } from 'parser/core/Events';\r\nimport { When } from 'parser/core/ParseResults';\r\n\r\nimport { i18n } from '@lingui/core';\r\nimport { t, Trans } from '@lingui/macro';\r\n\r\nimport RestorationAbilityTracker from '../core/RestorationAbilityTracker';\r\n\r\nclass HealingWave extends Analyzer {\r\n  static dependencies = {\r\n    abilityTracker: RestorationAbilityTracker,\r\n    spellUsable: SpellUsable,\r\n  };\r\n\r\n  protected abilityTracker!: RestorationAbilityTracker;\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.begincast.by(SELECTED_PLAYER).spell(SPELLS.HEALING_WAVE), this.onHealingWaveBegincast);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.HEALING_WAVE), this.onHealingWaveCast);\r\n  }\r\n\r\n  _isCurrentCastInefficient = false;\r\n  onHealingWaveBegincast(event: BeginCastEvent) {\r\n    if (this._isInefficientCastEvent(event)) {\r\n      this._isCurrentCastInefficient = true;\r\n    } else {\r\n      this._isCurrentCastInefficient = false;\r\n    }\r\n  }\r\n\r\n  _isInefficientCastEvent(event: BeginCastEvent) {\r\n    const hasTidalWave = this.selectedCombatant.hasBuff(SPELLS.TIDAL_WAVES_BUFF.id, event.timestamp, -1);\r\n    const hasFlashFlood = this.selectedCombatant.hasBuff(SPELLS.FLASH_FLOOD_BUFF.id, event.timestamp, -1);\r\n    if (hasTidalWave || hasFlashFlood) {\r\n      return false;\r\n    }\r\n\r\n    const hasRiptideAvailable = this.spellUsable.isAvailable(SPELLS.RIPTIDE.id);\r\n    if (!hasRiptideAvailable) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * This marks spells as inefficient casts in the timeline.\r\n   * @param event\r\n   */\r\n  onHealingWaveCast(event: CastEvent) {\r\n    if (this._isCurrentCastInefficient) {\r\n      event.meta = event.meta || {};\r\n      event.meta.isInefficientCast = true;\r\n      event.meta.inefficientCastReason = <Trans id=\"shaman.restoration.healingWave.inefficientCast.reason\">Riptide was off cooldown when you started casting this unbuffed Healing Wave. Casting Riptide into Healing Wave to generate and use a Tidal Wave stack, or using a Flash Flood buff (if talented) is a lot more efficient compared to casting a full-length Healing Wave.</Trans>;\r\n    }\r\n  }\r\n\r\n  get suggestedThreshold() {\r\n    const healingWave = this.abilityTracker.getAbility(SPELLS.HEALING_WAVE.id);\r\n\r\n    const twHealingWaves = healingWave.healingTwHits || 0;\r\n    const healingWaveCasts = healingWave.casts || 0;\r\n    const unbuffedHealingWaves = healingWaveCasts - twHealingWaves;\r\n    const unbuffedHealingWavesPerc = unbuffedHealingWaves / healingWaveCasts;\r\n\r\n    return {\r\n      actual: unbuffedHealingWavesPerc,\r\n      isGreaterThan: {\r\n        minor: 0.20,\r\n        average: 0.40,\r\n        major: 0.60,\r\n      },\r\n      style: 'percentage',\r\n    };\r\n  }\r\n\r\n  suggestions(when: When) {\r\n    const suggestedThreshold = this.suggestedThreshold;\r\n    when(suggestedThreshold.actual).isGreaterThan(suggestedThreshold.isGreaterThan.minor)\r\n      .addSuggestion((suggest) => suggest(<span>Casting <SpellLink id={SPELLS.HEALING_WAVE.id} /> without <SpellLink id={SPELLS.TIDAL_WAVES_BUFF.id} icon /> is slow and generally inefficient. Consider casting a riptide first to generate <SpellLink id={SPELLS.TIDAL_WAVES_BUFF.id} icon /></span>)\r\n          .icon(SPELLS.HEALING_WAVE.icon)\r\n          .actual(i18n._(t('shaman.restoration.suggestions.healingWave.unbuffed')`${formatPercentage(suggestedThreshold.actual)}% of unbuffed Healing Waves`))\r\n          .recommended(`${formatPercentage(suggestedThreshold.isGreaterThan.minor)}% of unbuffed Healing Waves`)\r\n          .regular(suggestedThreshold.isGreaterThan.average).major(suggestedThreshold.isGreaterThan.major));\r\n  }\r\n}\r\n\r\nexport default HealingWave;\r\n","import SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events from 'parser/core/Events';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\n\r\nimport Abilities from '../Abilities';\r\n\r\nclass LavaSurge extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n    abilities: Abilities,\r\n  };\r\n\r\n  protected spellUsable!: SpellUsable;\r\n  protected abilities!: Abilities;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.LAVA_SURGE), this.onLavaSurgeProc);\r\n  }\r\n\r\n  onLavaSurgeProc() {\r\n    if (this.spellUsable.isOnCooldown(SPELLS.LAVA_BURST.id)) {\r\n      const reduction = this.abilities.getExpectedCooldownDuration(SPELLS.LAVA_BURST.id, this.spellUsable.cooldownTriggerEvent(SPELLS.LAVA_BURST.id));\r\n      if (reduction) {\r\n        this.spellUsable.reduceCooldown(SPELLS.LAVA_BURST.id, reduction);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default LavaSurge;\r\n","import React from 'react';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport fetchWcl from 'common/fetchWclApi';\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport { formatThousands, formatNumber } from 'common/format';\r\n\r\nimport LazyLoadStatisticBox, { STATISTIC_ORDER } from 'interface/others/LazyLoadStatisticBox';\r\n\r\nimport Analyzer from 'parser/core/Analyzer';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport makeWclUrl from 'common/makeWclUrl';\r\nimport { EventType } from 'parser/core/Events';\r\nimport { WCLDamageTaken, WCLDamageTakenTableResponse } from 'common/WCL_TYPES';\r\n\r\nconst SPIRIT_LINK_TOTEM_DAMAGE_REDUCTION = .1;\r\n\r\n/**\r\n * Spirit Link Totem\r\n * Summons a totem at the target location for 6 sec, which reduces damage taken by all party and raid members within 10 yards by 10%.\r\n */\r\nclass SpiritLinkDamageReduction extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n  };\r\n\r\n  damageReduced = 0;\r\n  get drps() {\r\n    return (this.damageReduced / this.owner.fightDuration) * 1000;\r\n  }\r\n\r\n  get filter() {\r\n    const playerName = this.owner.player.name;\r\n\r\n    return `\r\n      IN RANGE\r\n        FROM type='${EventType.ApplyBuff}'\r\n          AND ability.id=${SPELLS.SPIRIT_LINK_TOTEM_BUFF.id}\r\n          AND source.owner.name='${playerName}'\r\n        TO type='${EventType.RemoveBuff}'\r\n          AND ability.id=${SPELLS.SPIRIT_LINK_TOTEM_BUFF.id}\r\n          AND source.owner.name='${playerName}'\r\n        GROUP BY target\r\n      END\r\n    `;\r\n  }\r\n\r\n  load() {\r\n    return fetchWcl(`report/tables/damage-taken/${this.owner.report.code}`, {\r\n      start: this.owner.fight.start_time,\r\n      end: this.owner.fight.end_time,\r\n      filter: this.filter,\r\n    }).then(json => {\r\n      json = json as WCLDamageTakenTableResponse;\r\n\r\n      const totalDamageTaken = (json.entries as WCLDamageTaken[]).reduce((damageTaken: number, entry) => damageTaken + entry.total, 0);\r\n      this.damageReduced = (totalDamageTaken / (1 - SPIRIT_LINK_TOTEM_DAMAGE_REDUCTION)) * SPIRIT_LINK_TOTEM_DAMAGE_REDUCTION;\r\n    });\r\n  }\r\n\r\n  statistic() {\r\n    const tooltip = (\r\n      <Trans id=\"shaman.restoration.slt.statistic.tooltip\">\r\n        The total estimated damage reduced during Spirit Link was {formatThousands(this.damageReduced)} ({formatNumber(this.drps)} DRPS).\r\n        This has a 99% accuracy.\r\n        <br />\r\n        <br />\r\n        This value is calculated using the <i>Optional DRs</i> method.\r\n        This results in the lowest possible damage reduction value being shown.\r\n        This should be the correct value in most circumstances.\r\n        Health redistribution is not part of this calculated value.\r\n      </Trans>\r\n    );\r\n\r\n    return (\r\n      <LazyLoadStatisticBox\r\n        position={STATISTIC_ORDER.OPTIONAL(60)}\r\n        loader={this.load.bind(this)}\r\n        icon={<SpellIcon id={SPELLS.SPIRIT_LINK_TOTEM.id} />}\r\n        value={<Trans id=\"shaman.restoration.slt.statistic.value\">≈{formatNumber(this.drps)} DRPS</Trans>}\r\n        label={<Trans id=\"shaman.restoration.slt.statistic.label\">Damage reduction</Trans>}\r\n        tooltip={tooltip}\r\n        drilldown={makeWclUrl(this.owner.report.code, {\r\n          fight: this.owner.fightId,\r\n          type: 'damage-taken',\r\n          pins: `2$Off$#244F4B$expression$${this.filter}`,\r\n          view: 'events',\r\n        })}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default SpiritLinkDamageReduction;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemHealingDone from 'interface/ItemHealingDone';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\nimport { EMBRACE_OF_EARTH_RANKS } from 'parser/shaman/restoration/constants';\r\nimport { EARTHSHIELD_HEALING_INCREASE } from 'parser/shaman/shared/talents/EarthShield';\r\n\r\n/**\r\n * Earth Shield increases your healing done to the target by an additional x%\r\n */\r\nclass EmbraceOfEarth extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n  };\r\n  protected combatants!: Combatants;\r\n\r\n  conduitRank = 0;\r\n  boost = 0;\r\n  healing = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.EMBRACE_OF_EARTH.id);\r\n    if (!this.conduitRank) {\r\n      this.active = false;\r\n      return;\r\n    }\r\n    this.boost = EMBRACE_OF_EARTH_RANKS[this.conduitRank] / 100;\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER), this.normalizeBoost);\r\n  }\r\n\r\n  normalizeBoost(event: HealEvent) {\r\n    const target = this.combatants.getEntity(event);\r\n    if (!target) {\r\n      return;\r\n    }\r\n\r\n    if (target.hasBuff(SPELLS.EARTH_SHIELD.id, event.timestamp, 0, 0)) {\r\n      // idea\r\n      // heal = boostedHeal / (1.2 + x)\r\n      // bonusHeal = heal * x\r\n      const boostedHeal = (event.amount || 0) + (event.absorbed || 0) + (event.overheal || 0);\r\n      const heal = boostedHeal / (1 + EARTHSHIELD_HEALING_INCREASE + this.boost);\r\n      const bonusHeal = heal * this.boost;\r\n      const effectiveHealing = Math.max(0, (bonusHeal - (event.overheal || 0)));\r\n      this.healing += effectiveHealing;\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.EMBRACE_OF_EARTH} rank={this.conduitRank}>\r\n          <ItemHealingDone amount={this.healing} /><br />\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default EmbraceOfEarth;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\n\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemHealingDone from 'interface/ItemHealingDone';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\nimport { HEAVY_RAINFALL_RANKS } from 'parser/shaman/restoration/constants';\r\n\r\n/**\r\n * Whenever you cast healing tide totem you gain a buff that increases your healing rain healing by x% for 20 seconds\r\n * https://www.warcraftlogs.com/reports/8HtnKrqLJ7y9VFQ6#fight=21&type=summary&source=88\r\n */\r\nclass HeavyRainfall extends Analyzer {\r\n  conduitRank = 0;\r\n  healingBoost = 0;\r\n  healing = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.HEAVY_RAINFALL.id);\r\n    if (!this.conduitRank) {\r\n      this.active = false;\r\n      return;\r\n    }\r\n    this.healingBoost = HEAVY_RAINFALL_RANKS[this.conduitRank] / 100;\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.HEALING_RAIN_HEAL), this.normalizeBoost);\r\n  }\r\n\r\n  normalizeBoost(event: HealEvent) {\r\n    if (this.selectedCombatant.hasBuff(SPELLS.HEAVY_RAINFALL_BUFF.id)) {\r\n      this.healing += calculateEffectiveHealing(event, this.healingBoost);\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.HEAVY_RAINFALL} rank={this.conduitRank}>\r\n          <ItemHealingDone amount={this.healing} /><br />\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default HeavyRainfall;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { ApplyBuffEvent, CastEvent, HasTarget, HealEvent, RefreshBuffEvent, RemoveBuffEvent } from 'parser/core/Events';\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\n\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemHealingDone from 'interface/ItemHealingDone';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\nimport { SWIRLING_CURRENTS_RANKS } from 'parser/shaman/restoration/constants';\r\n\r\n/**\r\n * Using Healing stream totem/Cloudburst totem increases the healing of your next 3 healing surges, healing waves or riptides by x%\r\n * https://www.warcraftlogs.com/reports/8HtnKrqLJ7y9VFQ6#fight=21&type=summary&source=88\r\n */\r\nclass SwirlingCurrents extends Analyzer {\r\n  conduitRank = 0;\r\n  healingBoost = 0;\r\n  healing = 0;\r\n  targetsWithBoostedRiptides: boolean[] = [];\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.SWIRLING_CURRENTS.id);\r\n    if (!this.conduitRank) {\r\n      this.active = false;\r\n      return;\r\n    }\r\n\r\n    this.healingBoost = SWIRLING_CURRENTS_RANKS[this.conduitRank] / 100;\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this.riptideHeal);\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell([SPELLS.HEALING_SURGE, SPELLS.HEALING_WAVE]), this.notRiptideHeal);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this.trackRiptide);\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this.trackRiptide);\r\n    this.addEventListener(Events.removebuff.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this.removeRiptide);\r\n    this.addEventListener(Events.refreshbuff.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this.pandemicRiptide);\r\n  }\r\n\r\n  riptideHeal(event: HealEvent) {\r\n    if (this.targetsWithBoostedRiptides[event.targetID]) {\r\n      this.healing += calculateEffectiveHealing(event, this.healingBoost);\r\n    }\r\n  }\r\n\r\n  notRiptideHeal(event: HealEvent) {\r\n    if (this.selectedCombatant.hasBuff(SPELLS.SWIRLING_CURRENTS_BUFF.id)) {\r\n      this.healing += calculateEffectiveHealing(event, this.healingBoost);\r\n    }\r\n  }\r\n\r\n  trackRiptide(event: ApplyBuffEvent | CastEvent) {\r\n    if (!HasTarget(event)) {\r\n      return;\r\n    }\r\n    // todo: check logic and timings, we don't want the castevent to add to the list, and the applybuffevent to remove again\r\n    // probably only use applybuffevent with proper buffers to catch non-casted riptides (legendary, pwave)\r\n    if (this.selectedCombatant.hasBuff(SPELLS.SWIRLING_CURRENTS_BUFF.id)) {\r\n      this.targetsWithBoostedRiptides[event.targetID] = true;\r\n    } else {\r\n      delete this.targetsWithBoostedRiptides[event.targetID];\r\n    }\r\n  }\r\n\r\n  removeRiptide(event: RemoveBuffEvent) {\r\n    delete this.targetsWithBoostedRiptides[event.targetID];\r\n  }\r\n\r\n  pandemicRiptide(event: RefreshBuffEvent) {\r\n    if (!this.selectedCombatant.hasBuff(SPELLS.SWIRLING_CURRENTS_BUFF.id)) {\r\n      delete this.targetsWithBoostedRiptides[event.targetID];\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.SWIRLING_CURRENTS} rank={this.conduitRank}>\r\n          <ItemHealingDone amount={this.healing} /><br />\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default SwirlingCurrents;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { CastEvent, HealEvent } from 'parser/core/Events';\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_ORDER from 'interface/others/STATISTIC_ORDER';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemHealingDone from 'interface/ItemHealingDone';\r\nimport ConduitSpellText from 'interface/statistics/components/ConduitSpellText';\r\nimport { NATURES_FOCUS_RANKS } from 'parser/shaman/restoration/constants';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\n\r\nconst HEAL_WINDOW_MS = 100;\r\n\r\n/**\r\n * CH heals more AYAYA\r\n * https://www.warcraftlogs.com/reports/8HtnKrqLJ7y9VFQ6#fight=21&type=summary&source=88\r\n */\r\nclass NaturesFocus extends Analyzer {\r\n  conduitRank = 0;\r\n  healingBoost = 0;\r\n  healing = 0;\r\n  chainHealEvent: CastEvent | HealEvent | null = null;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.NATURES_FOCUS.id);\r\n    if (!this.conduitRank) {\r\n      this.active = false;\r\n      return;\r\n    }\r\n    this.healingBoost = NATURES_FOCUS_RANKS[this.conduitRank] / 100;\r\n\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell(SPELLS.CHAIN_HEAL), this._onChainHealCast);\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.CHAIN_HEAL), this._onChainHealHeal);\r\n  }\r\n\r\n  _onChainHealCast(event: CastEvent) {\r\n    // filtering out healing events if they're not from the current cast\r\n    if (this.chainHealEvent && event.timestamp - this.chainHealEvent.timestamp >= HEAL_WINDOW_MS) {\r\n      this.chainHealEvent = null;\r\n    }\r\n\r\n    // sometimes you have heal events before the cast happens, so check here as well\r\n    // comparing the target ID guarantees no false positives as each cast can only heal the same target once\r\n    if (this.chainHealEvent && this.chainHealEvent.targetID === event.targetID) {\r\n      this.healing += calculateEffectiveHealing(this.chainHealEvent, this.healingBoost);\r\n      this.chainHealEvent = null;\r\n    } else {\r\n      this.chainHealEvent = event;\r\n    }\r\n  }\r\n\r\n  _onChainHealHeal(event: HealEvent) {\r\n    // we only want the initial heal - as that is the heal on the person you target on the cast,\r\n    // you only have to compare the heal and target ID.\r\n    if (this.chainHealEvent && this.chainHealEvent.targetID === event.targetID) {\r\n      this.healing += calculateEffectiveHealing(event, this.healingBoost);\r\n      this.chainHealEvent = null;\r\n    } else if (!this.chainHealEvent) {\r\n      this.chainHealEvent = event;\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        position={STATISTIC_ORDER.OPTIONAL(13)}\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.COVENANTS}\r\n      >\r\n        <ConduitSpellText spell={SPELLS.NATURES_FOCUS} rank={this.conduitRank}>\r\n          <ItemHealingDone amount={this.healing} /><br />\r\n        </ConduitSpellText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default NaturesFocus;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { ApplyBuffEvent, CastEvent, HasTarget, HealEvent, RefreshBuffEvent, RemoveBuffEvent } from 'parser/core/Events';\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemHealingDone from 'interface/ItemHealingDone';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\nimport { Trans } from '@lingui/macro';\r\nimport { formatPercentage } from 'common/format';\r\n\r\n// I have observed massive delays of the copied application\r\n// the linked log has\r\n// Cast Success:  0:21:634\r\n// Buff Apply:    0:21:965\r\n// which is a delay of 331ms.\r\n// Manual testing shows delays of up to (at least) 700ms,\r\n// which is caused by primordial having travel time.\r\n// So this is just not gonna check for a time buffer.\r\n// Possible issues: traveling slower than the current GCD\r\n// which could fuck up the tracking if the next cast is a Riptide.\r\n\r\n/**\r\n * Every 4 casts of Riptide also applies Riptide to another friendly target near your Riptide target.\r\n * https://www.warcraftlogs.com/reports/94XrMGFh3vaN8dDZ/#fight=12&source=205\r\n */\r\nclass PrimalTideCore extends Analyzer {\r\n  healing = 0;\r\n  overhealing = 0;\r\n  targetsWithBoostedRiptides: boolean[] = [];\r\n\r\n  castEvent: CastEvent | null = null;\r\n  gainedRiptideCasts = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasLegendaryByBonusID(SPELLS.PRIMAL_TIDE_CORE.bonusID);\r\n\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER).spell([SPELLS.RIPTIDE, SPELLS.PRIMORDIAL_WAVE_CAST]), this.castedRiptide);\r\n    this.addEventListener(Events.applybuff.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this.trackRiptide);\r\n    // we figured out it can never refresh a riptide\r\n    // this.addEventListener(Events.refreshbuff.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this.trackRiptide);\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this.riptideHeal);\r\n    this.addEventListener(Events.removebuff.by(SELECTED_PLAYER).spell(SPELLS.RIPTIDE), this.removeRiptide);\r\n  }\r\n\r\n  castedRiptide(event: CastEvent) {\r\n    this.castEvent = event;\r\n  }\r\n\r\n  // this relies on castevent coming 1st which does not actually happen every time\r\n  // should reorder that as well\r\n  trackRiptide(event: ApplyBuffEvent | RefreshBuffEvent) {\r\n    if (!HasTarget(event)) {\r\n      return;\r\n    }\r\n    // We want the application that we **didn't** target,\r\n    // as that means its our copied Riptide.\r\n    if (this.castEvent && this.castEvent.targetID !== event.targetID) {\r\n      this.gainedRiptideCasts -= -1;\r\n      this.targetsWithBoostedRiptides[event.targetID] = true;\r\n      this.castEvent = null;\r\n    } else {\r\n      delete this.targetsWithBoostedRiptides[event.targetID];\r\n    }\r\n  }\r\n\r\n  riptideHeal(event: HealEvent) {\r\n    if (this.targetsWithBoostedRiptides[event.targetID]) {\r\n      this.healing += event.amount + (event.absorbed || 0);\r\n      this.overhealing += (event.overheal || 0);\r\n    }\r\n  }\r\n\r\n  removeRiptide(event: RemoveBuffEvent) {\r\n    delete this.targetsWithBoostedRiptides[event.targetID];\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.ITEMS}\r\n        tooltip={<>\r\n          <Trans id=\"shaman.restoration.legendaries.primalTideCore.statistic.tooltip\">{this.gainedRiptideCasts} Riptide applications</Trans><br />\r\n          <Trans id=\"shaman.restoration.legendaries.primalTideCore.statistic.tooltip2\">{formatPercentage(this.overhealing / (this.healing + this.overhealing))}% Overhealing</Trans>\r\n        </>}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.PRIMAL_TIDE_CORE}>\r\n          <ItemHealingDone amount={this.healing} />\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default PrimalTideCore;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemHealingDone from 'interface/ItemHealingDone';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\n\r\nconst HEAL_INCREASE_PER_STACK = 0.1\r\n\r\n/**\r\n * Healing Wave and Healing Surge increase the healing done by your next Chain Heal by 10%, stacking up to 5 times.\r\n * https://www.warcraftlogs.com/reports/CHaBLQd6FPZ9xGX1#fight=24&type=auras&source=7\r\n */\r\nclass JonatsNaturalFocus extends Analyzer {\r\n  healing = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasLegendaryByBonusID(SPELLS.JONATS_NATURAL_FOCUS.bonusID);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.CHAIN_HEAL), this.chainHeal);\r\n  }\r\n\r\n  chainHeal(event: HealEvent) {\r\n    const buff = this.selectedCombatant.getBuff(SPELLS.JONATS_NATURAL_FOCUS_BUFF.id, event.timestamp, 200);\r\n    if (buff) {\r\n      this.healing += calculateEffectiveHealing(event, HEAL_INCREASE_PER_STACK * buff.stacks);\r\n    }\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.ITEMS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.JONATS_NATURAL_FOCUS}>\r\n          <ItemHealingDone amount={this.healing} />\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default JonatsNaturalFocus;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\nimport Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\n\r\nimport Statistic from 'interface/statistics/Statistic';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemHealingDone from 'interface/ItemHealingDone';\r\nimport BoringSpellValueText from 'interface/statistics/components/BoringSpellValueText';\r\n\r\nconst HEAL_INCREASE = 1.5;\r\nconst TRIGGER_HEALTH_PERCENTAGE = .75;\r\n\r\n/**\r\n * Earth Shield healing is increased by 150% if your Earth Shield target is below 75% health, and Healing Wave adds a stack of Earth Shield to your target, up to 9 maximum stacks.\r\n * https://www.warcraftlogs.com/reports/HPZqaj8f6cQA3CmJ#fight=18&translate=true&type=healing&source=28&ability=379&target=35&view=events\r\n */\r\nclass EarthenHarmony extends Analyzer {\r\n  healing = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasLegendaryByBonusID(SPELLS.EARTHEN_HARMONY.bonusID);\r\n\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.EARTH_SHIELD_HEAL), this.earthShield);\r\n  }\r\n\r\n  earthShield(event: HealEvent) {\r\n    const healthBeforeHeal = event.hitPoints - event.amount;\r\n    const healthPercentage = Math.min(1, healthBeforeHeal / event.maxHitPoints);\r\n    if (healthPercentage > TRIGGER_HEALTH_PERCENTAGE) {\r\n      return;\r\n    }\r\n\r\n    this.healing += calculateEffectiveHealing(event, HEAL_INCREASE);\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <Statistic\r\n        size=\"flexible\"\r\n        category={STATISTIC_CATEGORY.ITEMS}\r\n      >\r\n        <BoringSpellValueText spell={SPELLS.EARTHEN_HARMONY}>\r\n          <ItemHealingDone amount={this.healing} />\r\n        </BoringSpellValueText>\r\n      </Statistic>\r\n    );\r\n  }\r\n}\r\n\r\nexport default EarthenHarmony;\r\n","import EventsNormalizer from 'parser/core/EventsNormalizer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { EventType } from 'parser/core/Events';\r\n\r\nconst MAX_DELAY = 17500;\r\nconst CBT_DELAY = 15000;\r\nconst debug = false;\r\n\r\n/*\r\n* Cloudburst Totem had some weird behaviour (even if it rarely happens),\r\n* because of that you can have a cast event without heal events.\r\n* This happens if everyone in range is at 100% HP, it will just not heal at all.\r\n*\r\n* That throws off the CooldownThroughputTracker, gathering all events\r\n* until the CBT after that explodes and giving results that are completely wrong.\r\n*\r\n* This Normalizer creates a 100% overhealed healing event where the heal would have been,\r\n* if no healing events happened within 20 seconds after casting the totem.\r\n */\r\n\r\nclass CloudburstNormalizer extends EventsNormalizer {\r\n\r\n  fabricatedEvent = null;\r\n\r\n  normalize(events) {\r\n    const fixedEvents = [];\r\n    events.forEach((event, eventIndex) => {\r\n\r\n      if (this.fabricatedEvent) {\r\n        if (event.timestamp >= this.fabricatedEvent.timestamp) {\r\n          fixedEvents.push(this.fabricatedEvent);\r\n          this.fabricatedEvent = null;\r\n        }\r\n      }\r\n\r\n      fixedEvents.push(event);\r\n\r\n\r\n      if (event.type === EventType.Cast && event.ability.guid === SPELLS.CLOUDBURST_TOTEM_TALENT.id) {\r\n        const castTimestamp = event.timestamp;\r\n        let recallTimestamp = null;\r\n\r\n        // Look ahead through the events to see if there is an CLOUDBURST_TOTEM_HEAL within a 20 second period\r\n        for (let nextEventIndex = eventIndex + 1; nextEventIndex < events.length - 1; nextEventIndex += 1) {\r\n          const nextEvent = events[nextEventIndex];\r\n\r\n          if ((nextEvent.timestamp - castTimestamp) > MAX_DELAY) {\r\n            // No CLOUDBURST_TOTEM_HEAL found within the period, meaning this cast wasn't able to find targets and did not have any healing events -> create a 100% overheal event\r\n            const newTimestamp = (recallTimestamp && (recallTimestamp - event.timestamp > CBT_DELAY ? event.timestamp + CBT_DELAY : recallTimestamp)) || (event.timestamp + CBT_DELAY);\r\n\r\n            debug && this.log(`No Cloudburst heal found for cast at ${this.owner.formatTimestamp(event.timestamp)}`);\r\n            this.fabricatedEvent = {\r\n              timestamp: newTimestamp,\r\n              type: EventType.Heal,\r\n              sourceID: event.sourceID,\r\n              targetID: event.sourceID,\r\n              sourceIsFriendly: true,\r\n              targetIsFriendly: true,\r\n              ability: {\r\n                abilityIcon: SPELLS.CLOUDBURST_TOTEM_HEAL.icon,\r\n                guid: SPELLS.CLOUDBURST_TOTEM_HEAL.id,\r\n                name: SPELLS.CLOUDBURST_TOTEM_HEAL.name,\r\n                type: 8,\r\n              },\r\n              amount: 0,\r\n              overheal: 1,\r\n              hitType: 1,\r\n              hitPoints: event.maxHitPoints,\r\n              maxHitPoints: event.maxHitPoints,\r\n              __fabricated: true,\r\n            };\r\n            break;\r\n          } else if (nextEvent.type === EventType.Cast && (nextEvent.ability.guid === SPELLS.CLOUDBURST_TOTEM_RECALL.id || nextEvent.ability.guid === SPELLS.CLOUDBURST_TOTEM_TALENT.id)) {\r\n            recallTimestamp = nextEvent.timestamp;\r\n            continue;\r\n          } else if (nextEvent.type === EventType.Heal && nextEvent.ability.guid === SPELLS.CLOUDBURST_TOTEM_HEAL.id) {\r\n            // CLOUDBURST_TOTEM_HEAL found, this was fine\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    return fixedEvents;\r\n  }\r\n\r\n}\r\nexport default CloudburstNormalizer;\r\n","import EventsNormalizer from 'parser/core/EventsNormalizer';\r\nimport SPELLS from 'common/SPELLS';\r\nimport { AnyEvent, EventType, HealEvent } from 'parser/core/Events';\r\n\r\n/**\r\n * reordering riptide applybuff after the initial heal because i really need it this way around\r\n * for the primaltidecore legendary analysis\r\n * todo: fix cast event as well?\r\n */\r\n\r\nclass RiptideNormalizer extends EventsNormalizer {\r\n  normalize(events: AnyEvent[]) {\r\n    const fixedEvents: AnyEvent[] = [];\r\n    let healEvent: HealEvent | null = null;\r\n\r\n    events.forEach((event: AnyEvent, eventIndex) => {\r\n      if (event.type === EventType.Heal && event.ability.guid === SPELLS.RIPTIDE.id && !event.tick) {\r\n        healEvent = event;\r\n        return;\r\n      }\r\n\r\n      if (healEvent !== null) {\r\n        if (event.type === EventType.ApplyBuff && event.ability.guid === SPELLS.RIPTIDE.id && event.targetID === healEvent.targetID) {\r\n          healEvent.__modified = true;\r\n          healEvent.timestamp = event.timestamp;\r\n          fixedEvents.push(event);\r\n          fixedEvents.push(healEvent);\r\n          healEvent = null;\r\n          return;\r\n        } else {\r\n          fixedEvents.push(healEvent);\r\n          fixedEvents.push(event);\r\n          healEvent = null;\r\n          return;\r\n        }\r\n      }\r\n\r\n      fixedEvents.push(event);\r\n    });\r\n\r\n    return fixedEvents;\r\n  }\r\n\r\n}\r\nexport default RiptideNormalizer;\r\n","import React from 'react';\r\n\r\nimport Panel from 'interface/others/Panel';\r\nimport Feeding from 'interface/others/Feeding';\r\n\r\nimport CoreCombatLogParser from 'parser/core/CombatLogParser';\r\nimport ManaTracker from 'parser/core/healingEfficiency/ManaTracker';\r\nimport LowHealthHealing from 'parser/shared/modules/features/LowHealthHealing';\r\nimport ManaLevelChart from 'parser/shared/modules/resources/mana/ManaLevelChart';\r\nimport ManaUsageChart from 'parser/shared/modules/resources/mana/ManaUsageChart';\r\n\r\nimport HealingEfficiencyDetails from './modules/core/HealingEfficiencyDetails';\r\nimport HealingEfficiencyTracker from './modules/core/HealingEfficiencyTracker';\r\nimport Abilities from './modules/Abilities';\r\n\r\nimport HealingDone from './modules/core/HealingDone';\r\nimport HealingRainLocation from './modules/core/HealingRainLocation';\r\nimport RestorationAbilityTracker from './modules/core/RestorationAbilityTracker';\r\n\r\nimport MasteryEffectiveness from './modules/features/MasteryEffectiveness';\r\nimport AlwaysBeCasting from './modules/features/AlwaysBeCasting';\r\nimport CooldownThroughputTracker from './modules/features/CooldownThroughputTracker';\r\nimport Checklist from './modules/features/checklist/Module';\r\nimport SpellUsable from './modules/features/SpellUsable';\r\nimport StatValues from './modules/features/StatValues';\r\n\r\nimport TidalWaves from './modules/features/TidalWaves';\r\nimport CastBehavior from './modules/features/CastBehavior';\r\n// Talents\r\nimport TalentStatisticBox from './modules/talents/TalentStatisticBox';\r\nimport Torrent from './modules/talents/Torrent';\r\nimport UnleashLife from './modules/talents/UnleashLife';\r\nimport Deluge from './modules/talents/Deluge';\r\nimport SurgeOfEarth from './modules/talents/SurgeOfEarth';\r\nimport Undulation from './modules/talents/Undulation';\r\nimport FlashFlood from './modules/talents/FlashFlood';\r\nimport AncestralVigor from './modules/talents/AncestralVigor';\r\nimport EarthenWallTotem from './modules/talents/EarthenWallTotem';\r\nimport Downpour from './modules/talents/Downpour';\r\nimport CloudburstTotem from './modules/talents/CloudburstTotem';\r\nimport Ascendance from './modules/talents/Ascendance';\r\nimport Wellspring from './modules/talents/Wellspring';\r\nimport HighTide from './modules/talents/HighTide';\r\nimport NaturesGuardian from './modules/talents/NaturesGuardian';\r\nimport AncestralProtectionTotem from './modules/talents/AncestralProtectionTotem';\r\n// Spells\r\nimport ChainHeal from './modules/spells/ChainHeal';\r\nimport HealingSurge from './modules/spells/HealingSurge';\r\nimport HealingRain from './modules/spells/HealingRain';\r\nimport HealingWave from './modules/spells/HealingWave';\r\nimport LavaSurge from './modules/spells/LavaSurge';\r\nimport Resurgence from './modules/spells/Resurgence';\r\nimport ManaTideTotem from './modules/spells/ManaTideTotem';\r\nimport WaterShield from './modules/spells/WaterShield';\r\nimport SpiritLinkDamageReduction from './modules/spells/SpiritLinkDamageReduction';\r\n// Potency Conduits\r\nimport EmbraceOfEarth from './modules/shadowlands/conduits/EmbraceOfEarth';\r\nimport HeavyRainfall from './modules/shadowlands/conduits/HeavyRainfall';\r\nimport SwirlingCurrents from './modules/shadowlands/conduits/SwirlingCurrents';\r\nimport NaturesFocus from './modules/shadowlands/conduits/NaturesFocus';\r\n// Legendaries\r\nimport PrimalTideCore from './modules/shadowlands/legendaries/PrimalTideCore'\r\nimport JonatsNaturalFocus from './modules/shadowlands/legendaries/JonatsNaturalFocus'\r\nimport EarthenHarmony from './modules/shadowlands/legendaries/EarthenHarmony'\r\n// Shared\r\nimport SpiritWolf from '../shared/talents/SpiritWolf';\r\nimport StaticCharge from '../shared/talents/StaticCharge';\r\nimport EarthShield from './modules/spells/EarthShield'; // technically shared\r\nimport AstralShift from '../shared/spells/AstralShift';\r\n\r\nimport CloudburstNormalizer from './normalizers/CloudburstNormalizer';\r\nimport RiptideNormalizer from './normalizers/RiptideNormalizer';\r\n\r\nimport { ABILITIES_AFFECTED_BY_HEALING_INCREASES } from './constants';\r\n\r\nclass CombatLogParser extends CoreCombatLogParser {\r\n  static abilitiesAffectedByHealingIncreases = ABILITIES_AFFECTED_BY_HEALING_INCREASES;\r\n\r\n  static specModules = {\r\n    lowHealthHealing: LowHealthHealing,\r\n    healingDone: HealingDone,\r\n    abilities: Abilities,\r\n    healingRainLocation: HealingRainLocation,\r\n    restorationAbilityTracker: RestorationAbilityTracker,\r\n    manaTracker: ManaTracker,\r\n    hpmDetails: HealingEfficiencyDetails,\r\n    hpmTracker: HealingEfficiencyTracker,\r\n\r\n    // Generic healer things\r\n    manaLevelChart: ManaLevelChart,\r\n    manaUsageChart: ManaUsageChart,\r\n\r\n    // Features\r\n    alwaysBeCasting: AlwaysBeCasting,\r\n    masteryEffectiveness: MasteryEffectiveness,\r\n    cooldownThroughputTracker: CooldownThroughputTracker,\r\n    tidalWaves: TidalWaves,\r\n    castBehavior: CastBehavior,\r\n    checklist: Checklist,\r\n    spellUsable: SpellUsable,\r\n    statValues: StatValues,\r\n\r\n    // Talents\r\n    torrent: Torrent,\r\n    unleashLife: UnleashLife,\r\n    undulation: Undulation,\r\n    deluge: Deluge,\r\n    surgeOfEarth: SurgeOfEarth,\r\n    flashFlood: FlashFlood,\r\n    ancestralVigor: AncestralVigor,\r\n    earthenWallTotem: EarthenWallTotem,\r\n    downpour: Downpour,\r\n    cloudburstTotem: CloudburstTotem,\r\n    ascendance: Ascendance,\r\n    wellspring: Wellspring,\r\n    highTide: HighTide,\r\n    naturesGuardian: NaturesGuardian,\r\n    ancestralProtectionTotem: AncestralProtectionTotem,\r\n    talentStatisticBox: TalentStatisticBox,\r\n\r\n    // Spells\r\n    chainHeal: ChainHeal,\r\n    healingSurge: HealingSurge,\r\n    healingRain: HealingRain,\r\n    healingWave: HealingWave,\r\n    lavaSurge: LavaSurge,\r\n    resurgence: Resurgence,\r\n    manaTideTotem: ManaTideTotem,\r\n    waterShield: WaterShield,\r\n    spiritLinkDamageReduction: SpiritLinkDamageReduction,\r\n\r\n    // Shared\r\n    spiritWolf: SpiritWolf,\r\n    staticCharge: StaticCharge,\r\n    astralShift: AstralShift,\r\n    earthShield: EarthShield,\r\n\r\n    // Normalizers\r\n    cloudburstNormalizer: CloudburstNormalizer,\r\n    riptideNormalizer: RiptideNormalizer,\r\n\r\n    // Conduits\r\n    embraceOfEarth: EmbraceOfEarth,\r\n    heavyRainfall: HeavyRainfall,\r\n    swirlingCurrents: SwirlingCurrents,\r\n    naturesFocus: NaturesFocus,\r\n\r\n    // Legendaries\r\n    primalTideCore: PrimalTideCore,\r\n    jonatsNaturalFocus: JonatsNaturalFocus,\r\n    earthenHarmony: EarthenHarmony,\r\n  };\r\n\r\n  generateResults(options: any) {\r\n    const results = super.generateResults(options);\r\n\r\n    results.tabs = [\r\n      ...results.tabs,\r\n      {\r\n        title: 'Feeding',\r\n        url: 'feeding',\r\n        render: () => (\r\n          <Panel style={{ padding: 0 }}>\r\n            <Feeding\r\n              cooldownThroughputTracker={this.getModule(CooldownThroughputTracker)}\r\n            />\r\n          </Panel>\r\n        ),\r\n      },\r\n    ];\r\n\r\n    return results;\r\n  }\r\n}\r\n\r\nexport default CombatLogParser;\r\n","/**\r\n * A simple component that shows the spell value in the most plain way possible.\r\n * Use this only as the very last resort.\r\n */\r\nimport React from 'react';\r\n\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Spell from 'common/SPELLS/Spell';\r\n\r\ntype Props = {\r\n  spell: Spell;\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}\r\n\r\nconst BoringSpellValueText = ({ spell, children, className }: Props) => (\r\n  <div className={`pad boring-text ${className || ''}`}>\r\n    <label>\r\n      <SpellIcon id={spell.id} /> <SpellLink id={spell.id} icon={false} />\r\n    </label>\r\n    <div className=\"value\">\r\n      {children}\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport default BoringSpellValueText;\r\n","import React from 'react';\r\n\r\n// https://thenounproject.com/term/duration/370713/\r\n// duration by Bohdan Burmich from the Noun Project\r\nconst Icon = ({ ...other }) => (\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"10 10 80 80\" className=\"icon\" {...other}>\r\n    <path d=\"M50,86.4865c17.4361,0,31.6216-14.1855,31.6216-31.6216c0-16.6168-12.8865-30.2714-29.1892-31.5189v-4.9677h7.2973v-4.8649  H40.2703v4.8649h7.2973v4.9677c-16.3027,1.2475-29.1892,14.902-29.1892,31.5189C18.3784,72.3009,32.5639,86.4865,50,86.4865z M52.4324,28.2236c3.1101,0.2817,6.0664,1.0982,8.7798,2.356l-8.7798,15.2073V28.2236z M47.5676,28.2236v26.6412 c0,1.1008,0.7393,2.0647,1.8029,2.3497c0.209,0.0561,0.4205,0.0827,0.6295,0.0827c0.8533,0,1.6642-0.4504,2.1065-1.2162 l13.3146-23.0616c6.8507,4.8503,11.3357,12.8315,11.3357,21.8454c0,14.7537-12.0031,26.7567-26.7568,26.7567 s-26.7568-12.003-26.7568-26.7567C23.2432,40.9315,33.9501,29.4573,47.5676,28.2236z\" />\r\n  </svg>\r\n);\r\n\r\nexport default Icon;\r\n","/**\r\n * A simple component that shows a value in the most plain way possible.\r\n * Use this only as the very last resort.\r\n */\r\nimport React from 'react';\r\n\r\ntype Props = {\r\n  label: React.ReactNode;\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}\r\n\r\nconst BoringValue = ({ label, children, className }: Props) => (\r\n  <div className={`pad boring-text ${className || ''}`}>\r\n    <label>\r\n      {label}\r\n    </label>\r\n    <div className=\"value\">\r\n      {children}\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport default BoringValue;\r\n","/**\r\n * Velen's is a static 15% healing increase to the raw healing going out. If that increase turns out to be overhealing it is worthless, so my approach of reducing the healing gain by the overhealing really only gives you the gain in healing that actually did something. An implementation that ignores overhealing and acts like Velen's contributed 15% of the effective healing will be inaccurate if there was any overhealing.\r\n *\r\n * I'll try to explain this PoV with an example:\r\n * Normal spell heals for 1,000 raw\r\n * With Velen's this is 1,150 raw. So Velen's increased the heal by 150 raw healing, that healing is on top of the original 1,000 raw healing the spell normally does.\r\n * Then comes overhealing;\r\n * If the spell overheals for 50, then the spell will have healed for 1,100. At this point Velen's effectively contributes 100 healing.\r\n * If the spell overheals for 100, then the spell will have healed for 1,050. So velen's effectiveness is 50;\r\n * If the spell overheals for 150, then the spell will have healed for the original 1,000 and Velen's increase was completely wasted.\r\n * If the spell overheals for 200, then 50 healing of the original spell was already overhealing, and the increased healing from Velen's did nothing (0).\r\n *\r\n * If you ignore raw healing and look at the actual healing done you may see the last 950 healing and think 15% of that was contributed by Velen's, while in fact it was 0.\r\n */\r\n\r\nexport default function calculateEffectiveHealing(event, relativeHealIncrease) {\r\n  const amount = event.amount;\r\n  const absorbed = event.absorbed || 0;\r\n  const overheal = event.overheal || 0;\r\n  const raw = amount + absorbed + overheal;\r\n  const relativeHealingIncreaseFactor = 1 + relativeHealIncrease;\r\n  const healingIncrease = raw - raw / relativeHealingIncreaseFactor;\r\n  const effectiveHealing = healingIncrease - overheal;\r\n\r\n  return Math.max(0, effectiveHealing);\r\n}\r\n","import Analyzer, { SELECTED_PLAYER, Options } from 'parser/core/Analyzer';\r\nimport EventEmitter from 'parser/core/modules/EventEmitter';\r\nimport Events, { EventType, ClassResources, EnergizeEvent, CastEvent, HealEvent, SpendResourceEvent } from 'parser/core/Events';\r\nimport { Resource } from 'game/RESOURCE_TYPES';\r\n\r\nexport type BuilderObj = {\r\n  generated: number,\r\n  wasted: number,\r\n  casts: number,\r\n}\r\n\r\nexport type SpenderObj = {\r\n  spent: number,\r\n  spentByCast: number[],\r\n  casts: number,\r\n}\r\n\r\ntype ResourceUpdate = {\r\n  timestamp: number | undefined,\r\n  current: number,\r\n  waste: number,\r\n  generated: number,\r\n  used: number,\r\n}\r\n\r\n/**\r\n * This is an 'abstract' implementation of a framework for tracking resource generating/spending.\r\n * Extend it by following the instructions in the TODO comments below\r\n */\r\nclass ResourceTracker extends Analyzer {\r\n  static dependencies = {\r\n    eventEmitter: EventEmitter,\r\n    // Optional dependency for the `resourceCost` prop of events\r\n    // spellResourceCost: SpellResourceCost,\r\n  };\r\n\r\n  protected eventEmitter!: EventEmitter;\r\n\r\n  current = 0;\r\n  resourceUpdates: ResourceUpdate[] = [];\r\n\r\n  // stores resource gained/spent/wasted by ability ID\r\n  buildersObj: {[index: number]: BuilderObj} = {};\r\n  spendersObj: {[index: number]: SpenderObj} = {};\r\n\r\n  // TODO set this to the resource you wish to track constructor.. see the appropriate objects in game/RESOURCE_TYPES\r\n  resource!: Resource;\r\n\r\n  // TODO a classes 'main' resource passes the max along with events, but for other resources this may need to be defined\r\n  maxResource!: number;\r\n\r\n  constructor(options: Options){\r\n    super(options);\r\n    this.addEventListener(Events.energize.to(SELECTED_PLAYER), this.onEnergize);\r\n    this.addEventListener(Events.cast.by(SELECTED_PLAYER), this.onCast);\r\n  }\r\n\r\n  // FIXME implement natural regen\r\n  // TODO if the tracked resource naturally regenerates (like Energy), set this to true and set the parameters of the regeneration in the below fields\r\n  // naturallyRegenerates = false;\r\n  // baseRegenRate; // TODO resource's base regeneration rate in points per second\r\n  // isRegenHasted; // TODO iff true, regeneration rate will be scaled with haste\r\n\r\n  // TODO if you wish an ability to show in results even if it wasn't used, add it using these functions constructor\r\n  initBuilderAbility(spellId: number) {\r\n    this.buildersObj[spellId] = { generated: 0, wasted: 0, casts: 0 };\r\n  }\r\n  initSpenderAbility(spellId: number) {\r\n    this.spendersObj[spellId] = { spent: 0, spentByCast: [], casts: 0 };\r\n  }\r\n\r\n  // BUILDERS - Handled on energize, using the 'resourceChange' field\r\n  onEnergize(event: EnergizeEvent) {\r\n    const spellId = event.ability.guid;\r\n\r\n    if(event.resourceChangeType !== this.resource.id) {\r\n        return;\r\n    }\r\n\r\n    const waste = event.waste;\r\n    const gain = event.resourceChange - waste;\r\n    this._applyBuilder(spellId, gain, waste, this.getResource(event), event.timestamp);\r\n  }\r\n\r\n  // FIXME Track resource drains too, so that the 'current' value can be more accurate\r\n\r\n  // TODO if a resource gain isn't showing as an energize in events, handle it manually by calling this\r\n  /**\r\n   * FIXME solve with a normalizer instead?\r\n   * Applies an energize of the tracked resource type.\r\n   * @param {number} spellId - The spellId to attribute the resource gain to\r\n   * @param {number} amount - The raw amount of resources to gain\r\n   */\r\n  processInvisibleEnergize(spellId: number, amount: number) {\r\n    const maxGain = this.maxResource !== undefined ? this.maxResource - this.current : amount;\r\n    const gain = Math.min(amount, maxGain);\r\n    const waste = Math.max(amount - maxGain, 0);\r\n    this._applyBuilder(spellId, gain, waste);\r\n  }\r\n\r\n  _applyBuilder(spellId: number, gain: number, waste: number,  resource?: ClassResources, timestamp?: number) {\r\n    if (!this.buildersObj[spellId]) {\r\n        this.initBuilderAbility(spellId);\r\n    }\r\n\r\n    this.buildersObj[spellId].wasted += waste;\r\n    this.buildersObj[spellId].generated += gain;\r\n    this.buildersObj[spellId].casts += 1;\r\n\r\n    // resource.amount for an energize is the amount AFTER the energize\r\n    if (resource !== null && resource !== undefined && resource.amount !== undefined) {\r\n      this.current = resource.amount;\r\n      if (resource.max !== undefined) {\r\n        this.maxResource = resource.max; // track changes in max resource, which can happen due to procs / casts\r\n      }\r\n    } else {\r\n      this.current += gain;\r\n    }\r\n\r\n    this.resourceUpdates.push({\r\n      timestamp: timestamp,\r\n      current: this.current,\r\n      waste: waste,\r\n      generated: gain,\r\n      used: 0,\r\n    });\r\n  }\r\n\r\n  // SPENDERS - Handled on cast, using the 'classResources' field\r\n  onCast(event: CastEvent) {\r\n    const spellId = event.ability.guid;\r\n\r\n    if(!this.shouldProcessCastEvent(event)) {\r\n        return;\r\n    }\r\n    const eventResource = this.getResource(event);\r\n\r\n    if(!eventResource){\r\n      return;\r\n    }\r\n\r\n    if (eventResource.max) {\r\n      this.maxResource = eventResource.max; // track changes in max resource, which can happen due to procs / casts\r\n    }\r\n    const cost = this.getReducedCost(event);\r\n\r\n    if (!this.spendersObj[spellId]) {\r\n      this.initSpenderAbility(spellId);\r\n    }\r\n\r\n    if (!cost || cost === 0) {\r\n      return;\r\n    }\r\n\r\n    this.spendersObj[spellId].casts += 1;\r\n    this.spendersObj[spellId].spentByCast.push(cost);\r\n    if(cost > 0) {\r\n      this.spendersObj[spellId].spent += cost;\r\n    }\r\n\r\n    //Re-sync current amount, to update not-tracked gains.\r\n    this.current = eventResource.amount - cost;\r\n\r\n    this.resourceUpdates.push({\r\n      timestamp: event.timestamp,\r\n      current: this.current,\r\n      waste: 0,\r\n      generated: 0,\r\n      used: eventResource.amount,\r\n    });\r\n\r\n    this.triggerSpendEvent(cost, event);\r\n  }\r\n\r\n  // TODO if your spec has an ability cost reduction that doesn't show in events, handle it manually by overriding here. Or extend SpellResourceCost and apply the discount there.\r\n  getReducedCost(event: CastEvent) {\r\n    if (event.resourceCost && event.resourceCost[this.resource.id] !== undefined) {\r\n      return event.resourceCost[this.resource.id];\r\n    }\r\n    return this.getResource(event)?.cost;\r\n  }\r\n\r\n  getResource(event: CastEvent | HealEvent | EnergizeEvent ) {\r\n    if(!event.classResources) {\r\n      return undefined;\r\n    } else {\r\n      return event.classResources.find(r => r.type === this.resource.id);\r\n    }\r\n  }  \r\n\r\n  triggerSpendEvent(spent: number, event: CastEvent) {\r\n\r\n    const fabricatedEvent: SpendResourceEvent = {\r\n      type: EventType.SpendResource,\r\n      timestamp: event.timestamp,\r\n      sourceID: event.sourceID,\r\n      targetID: event.targetID,\r\n      resourceChange: spent,\r\n      resourceChangeType: this.resource.id,\r\n      ability: event.ability,\r\n      __fabricated: true,\r\n    };\r\n\r\n    this.eventEmitter.fabricateEvent(fabricatedEvent, event);\r\n  }\r\n\r\n  shouldProcessCastEvent(event: CastEvent) {\r\n    return Boolean(this.getResource(event));\r\n  }\r\n\r\n  getGeneratedBySpell(spellId: number) {\r\n    return (this.buildersObj[spellId] && this.buildersObj[spellId].generated) || 0;\r\n  }\r\n\r\n  getWastedBySpell(spellId: number) {\r\n    return (this.buildersObj[spellId] && this.buildersObj[spellId].wasted) || 0;\r\n  }\r\n\r\n  getBuilderCastsBySpell(spellId: number) {\r\n    return (this.buildersObj[spellId] && this.buildersObj[spellId].casts) || 0;\r\n  }\r\n\r\n  get generated() {\r\n    return Object.values(this.buildersObj).reduce((acc, spell) => acc + spell.generated, 0);\r\n  }\r\n\r\n  get wasted() {\r\n    return Object.values(this.buildersObj).reduce((acc, spell) => acc + spell.wasted, 0);\r\n  }\r\n\r\n  get spent() {\r\n    return Object.values(this.spendersObj).reduce((acc, spell) => acc + spell.spent, 0);\r\n  }\r\n\r\n  get spendersCasts() {\r\n    return Object.values(this.spendersObj).reduce((acc, spell) => acc + spell.casts, 0);\r\n  }\r\n}\r\n\r\nexport default ResourceTracker;\r\n","import React from 'react';\r\n\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport SpellLink from 'common/SpellLink';\r\nimport Spell from 'common/SPELLS/Spell';\r\n\r\ntype Props = {\r\n  spell: Spell;\r\n  rank: number;\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}\r\n\r\nconst ConduitSpellText = ({ spell, rank, children, className }: Props) => (\r\n  <div className={`pad boring-text ${className || ''}`}>\r\n    <label>\r\n      <SpellIcon id={spell.id} /> <SpellLink id={spell.id} icon={false} /> - Rank {rank}\r\n    </label>\r\n    <div className=\"value\">\r\n      {children}\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport default ConduitSpellText;\r\n","import React from 'react';\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\n\r\nimport ResourceLink from './ResourceLink';\r\nimport Icon from './Icon';\r\n\r\ninterface Props extends Omit<React.ComponentProps<typeof Icon>, 'id' | 'icon'> {\r\n  id: number;\r\n  noLink?: boolean;\r\n}\r\n\r\nconst ResourceIcon = ({ id, noLink, ...others }: Props) => {\r\n  if (process.env.NODE_ENV === 'development' && !RESOURCE_TYPES[id]) {\r\n    throw new Error(`Unknown spell: ${id}`);\r\n  }\r\n\r\n  const spell = RESOURCE_TYPES[id] || {\r\n    name: 'Spell not recognized',\r\n    icon: 'inv_misc_questionmark',\r\n  };\r\n\r\n  const icon = (\r\n    <Icon\r\n      icon={spell.icon}\r\n      alt={spell.name}\r\n      {...others}\r\n    />\r\n  );\r\n\r\n  if (noLink) {\r\n    return icon;\r\n  }\r\n\r\n  return (\r\n    <ResourceLink id={id} icon={false}>\r\n      {icon}\r\n    </ResourceLink>\r\n  );\r\n};\r\n\r\nexport default ResourceIcon;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { TooltipElement } from 'common/Tooltip';\r\n\r\n/**\r\n * @deprecated Use `interface/statistic/Statistic` instead.\r\n */\r\nconst StatisticListBoxItem = ({ title, value, titleTooltip, valueTooltip}) => (\r\n    <div className=\"flex\">\r\n      <div className=\"flex-main\">\r\n        {titleTooltip ? <TooltipElement content={titleTooltip}>{title}</TooltipElement> : title}\r\n      </div>\r\n      <div className=\"flex-sub text-right\">\r\n        {valueTooltip ? <TooltipElement content={valueTooltip}>{value}</TooltipElement> : value}\r\n      </div>\r\n    </div>\r\n  );\r\nStatisticListBoxItem.propTypes = {\r\n  title: PropTypes.node.isRequired,\r\n  value: PropTypes.node.isRequired,\r\n  titleTooltip: PropTypes.node,\r\n  valueTooltip: PropTypes.node,\r\n};\r\n\r\nexport default StatisticListBoxItem;\r\n","import React, {useEffect, useState} from 'react';\r\n\r\nimport TooltipProvider from 'interface/common/TooltipProvider';\r\n\r\nimport RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\n\r\nimport ResourceIcon from './ResourceIcon';\r\n\r\ninterface Props {\r\n  id: number;\r\n  children?: React.ReactNode;\r\n  category?: string;\r\n  icon?: boolean,\r\n}\r\n\r\nconst ResourceLink = ({icon = true, ...props}: Props) => {\r\n\r\n  const [elem, setElem] = useState<HTMLAnchorElement | null>(null);\r\n\r\n  useEffect(() => {TooltipProvider.refresh(elem);})\r\n\r\n  const { id, children, category = undefined, ...other } = props;\r\n\r\n  if (process.env.NODE_ENV === 'development' && !children && !RESOURCE_TYPES[id]) {\r\n    throw new Error(`Unknown spell: ${id}`);\r\n  }\r\n\r\n  return (\r\n    <a\r\n      href={TooltipProvider.resource(id)}\r\n      target=\"_blank\"\r\n      rel=\"noopener noreferrer\"\r\n      className={category}\r\n      ref={elem => {setElem(elem);}}\r\n      {...other}\r\n    >\r\n      {icon && <ResourceIcon id={id} noLink />}{' '}\r\n      {children || RESOURCE_TYPES[id].name}\r\n    </a>\r\n  );\r\n}\r\n\r\nexport default ResourceLink;\r\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar ANIMATION_STATE_CLASSES = {\n  animating: 'rah-animating',\n  animatingUp: 'rah-animating--up',\n  animatingDown: 'rah-animating--down',\n  animatingToHeightZero: 'rah-animating--to-height-zero',\n  animatingToHeightAuto: 'rah-animating--to-height-auto',\n  animatingToHeightSpecific: 'rah-animating--to-height-specific',\n  static: 'rah-static',\n  staticHeightZero: 'rah-static--height-zero',\n  staticHeightAuto: 'rah-static--height-auto',\n  staticHeightSpecific: 'rah-static--height-specific'\n};\n\nvar PROPS_TO_OMIT = ['animateOpacity', 'animationStateClasses', 'applyInlineTransitions', 'children', 'contentClassName', 'delay', 'duration', 'easing', 'height', 'onAnimationEnd', 'onAnimationStart'];\n\nfunction omit(obj) {\n  for (var _len = arguments.length, keys = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    keys[_key - 1] = arguments[_key];\n  }\n\n  if (!keys.length) {\n    return obj;\n  }\n\n  var res = {};\n  var objectKeys = Object.keys(obj);\n\n  for (var i = 0; i < objectKeys.length; i++) {\n    var key = objectKeys[i];\n\n    if (keys.indexOf(key) === -1) {\n      res[key] = obj[key];\n    }\n  }\n\n  return res;\n}\n\n// Start animation helper using nested requestAnimationFrames\nfunction startAnimationHelper(callback) {\n  var requestAnimationFrameIDs = [];\n\n  requestAnimationFrameIDs[0] = requestAnimationFrame(function () {\n    requestAnimationFrameIDs[1] = requestAnimationFrame(function () {\n      callback();\n    });\n  });\n\n  return requestAnimationFrameIDs;\n}\n\nfunction cancelAnimationFrames(requestAnimationFrameIDs) {\n  requestAnimationFrameIDs.forEach(function (id) {\n    return cancelAnimationFrame(id);\n  });\n}\n\nfunction isNumber(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n}\n\nfunction isPercentage(height) {\n  // Percentage height\n  return typeof height === 'string' && height.search('%') === height.length - 1 && isNumber(height.substr(0, height.length - 1));\n}\n\nfunction runCallback(callback, params) {\n  if (callback && typeof callback === 'function') {\n    callback(params);\n  }\n}\n\nvar AnimateHeight = function (_React$Component) {\n  _inherits(AnimateHeight, _React$Component);\n\n  function AnimateHeight(props) {\n    _classCallCheck(this, AnimateHeight);\n\n    var _this = _possibleConstructorReturn(this, (AnimateHeight.__proto__ || Object.getPrototypeOf(AnimateHeight)).call(this, props));\n\n    _this.animationFrameIDs = [];\n\n    var height = 'auto';\n    var overflow = 'visible';\n\n    if (isNumber(props.height)) {\n      // If value is string \"0\" make sure we convert it to number 0\n      height = props.height < 0 || props.height === '0' ? 0 : props.height;\n      overflow = 'hidden';\n    } else if (isPercentage(props.height)) {\n      // If value is string \"0%\" make sure we convert it to number 0\n      height = props.height === '0%' ? 0 : props.height;\n      overflow = 'hidden';\n    }\n\n    _this.animationStateClasses = _extends({}, ANIMATION_STATE_CLASSES, props.animationStateClasses);\n\n    var animationStateClasses = _this.getStaticStateClasses(height);\n\n    _this.state = {\n      animationStateClasses: animationStateClasses,\n      height: height,\n      overflow: overflow,\n      shouldUseTransitions: false\n    };\n    return _this;\n  }\n\n  _createClass(AnimateHeight, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var height = this.state.height;\n\n      // Hide content if height is 0 (to prevent tabbing into it)\n      // Check for contentElement is added cause this would fail in tests (react-test-renderer)\n      // Read more here: https://github.com/Stanko/react-animate-height/issues/17\n\n      if (this.contentElement && this.contentElement.style) {\n        this.hideContent(height);\n      }\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      var _props = this.props,\n          delay = _props.delay,\n          duration = _props.duration,\n          height = _props.height,\n          onAnimationEnd = _props.onAnimationEnd,\n          onAnimationStart = _props.onAnimationStart;\n\n      // Check if 'height' prop has changed\n\n      if (this.contentElement && height !== prevProps.height) {\n        var _cx;\n\n        // Remove display: none from the content div\n        // if it was hidden to prevent tabbing into it\n        this.showContent(prevState.height);\n\n        // Cache content height\n        this.contentElement.style.overflow = 'hidden';\n        var contentHeight = this.contentElement.offsetHeight;\n        this.contentElement.style.overflow = '';\n\n        // set total animation time\n        var totalDuration = duration + delay;\n\n        var newHeight = null;\n        var timeoutState = {\n          height: null, // it will be always set to either 'auto' or specific number\n          overflow: 'hidden'\n        };\n        var isCurrentHeightAuto = prevState.height === 'auto';\n\n        if (isNumber(height)) {\n          // If value is string \"0\" make sure we convert it to number 0\n          newHeight = height < 0 || height === '0' ? 0 : height;\n          timeoutState.height = newHeight;\n        } else if (isPercentage(height)) {\n          // If value is string \"0%\" make sure we convert it to number 0\n          newHeight = height === '0%' ? 0 : height;\n          timeoutState.height = newHeight;\n        } else {\n          // If not, animate to content height\n          // and then reset to auto\n          newHeight = contentHeight; // TODO solve contentHeight = 0\n          timeoutState.height = 'auto';\n          timeoutState.overflow = null;\n        }\n\n        if (isCurrentHeightAuto) {\n          // This is the height to be animated to\n          timeoutState.height = newHeight;\n\n          // If previous height was 'auto'\n          // set starting height explicitly to be able to use transition\n          newHeight = contentHeight;\n        }\n\n        // Animation classes\n        var animationStateClasses = (0, _classnames2.default)((_cx = {}, _defineProperty(_cx, this.animationStateClasses.animating, true), _defineProperty(_cx, this.animationStateClasses.animatingUp, prevProps.height === 'auto' || height < prevProps.height), _defineProperty(_cx, this.animationStateClasses.animatingDown, height === 'auto' || height > prevProps.height), _defineProperty(_cx, this.animationStateClasses.animatingToHeightZero, timeoutState.height === 0), _defineProperty(_cx, this.animationStateClasses.animatingToHeightAuto, timeoutState.height === 'auto'), _defineProperty(_cx, this.animationStateClasses.animatingToHeightSpecific, timeoutState.height > 0), _cx));\n\n        // Animation classes to be put after animation is complete\n        var timeoutAnimationStateClasses = this.getStaticStateClasses(timeoutState.height);\n\n        // Set starting height and animating classes\n        // We are safe to call set state as it will not trigger infinite loop\n        // because of the \"height !== prevProps.height\" check\n        this.setState({ // eslint-disable-line react/no-did-update-set-state\n          animationStateClasses: animationStateClasses,\n          height: newHeight,\n          overflow: 'hidden',\n          // When animating from 'auto' we first need to set fixed height\n          // that change should be animated\n          shouldUseTransitions: !isCurrentHeightAuto\n        });\n\n        // Clear timeouts\n        clearTimeout(this.timeoutID);\n        clearTimeout(this.animationClassesTimeoutID);\n\n        if (isCurrentHeightAuto) {\n          // When animating from 'auto' we use a short timeout to start animation\n          // after setting fixed height above\n          timeoutState.shouldUseTransitions = true;\n\n          cancelAnimationFrames(this.animationFrameIDs);\n          this.animationFrameIDs = startAnimationHelper(function () {\n            _this2.setState(timeoutState);\n\n            // ANIMATION STARTS, run a callback if it exists\n            runCallback(onAnimationStart, { newHeight: timeoutState.height });\n          });\n\n          // Set static classes and remove transitions when animation ends\n          this.animationClassesTimeoutID = setTimeout(function () {\n            _this2.setState({\n              animationStateClasses: timeoutAnimationStateClasses,\n              shouldUseTransitions: false\n            });\n\n            // ANIMATION ENDS\n            // Hide content if height is 0 (to prevent tabbing into it)\n            _this2.hideContent(timeoutState.height);\n            // Run a callback if it exists\n            runCallback(onAnimationEnd, { newHeight: timeoutState.height });\n          }, totalDuration);\n        } else {\n          // ANIMATION STARTS, run a callback if it exists\n          runCallback(onAnimationStart, { newHeight: newHeight });\n\n          // Set end height, classes and remove transitions when animation is complete\n          this.timeoutID = setTimeout(function () {\n            timeoutState.animationStateClasses = timeoutAnimationStateClasses;\n            timeoutState.shouldUseTransitions = false;\n\n            _this2.setState(timeoutState);\n\n            // ANIMATION ENDS\n            // If height is auto, don't hide the content\n            // (case when element is empty, therefore height is 0)\n            if (height !== 'auto') {\n              // Hide content if height is 0 (to prevent tabbing into it)\n              _this2.hideContent(newHeight); // TODO solve newHeight = 0\n            }\n            // Run a callback if it exists\n            runCallback(onAnimationEnd, { newHeight: newHeight });\n          }, totalDuration);\n        }\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      cancelAnimationFrames(this.animationFrameIDs);\n\n      clearTimeout(this.timeoutID);\n      clearTimeout(this.animationClassesTimeoutID);\n\n      this.timeoutID = null;\n      this.animationClassesTimeoutID = null;\n      this.animationStateClasses = null;\n    }\n  }, {\n    key: 'showContent',\n    value: function showContent(height) {\n      if (height === 0) {\n        this.contentElement.style.display = '';\n      }\n    }\n  }, {\n    key: 'hideContent',\n    value: function hideContent(newHeight) {\n      if (newHeight === 0) {\n        this.contentElement.style.display = 'none';\n      }\n    }\n  }, {\n    key: 'getStaticStateClasses',\n    value: function getStaticStateClasses(height) {\n      var _cx2;\n\n      return (0, _classnames2.default)((_cx2 = {}, _defineProperty(_cx2, this.animationStateClasses.static, true), _defineProperty(_cx2, this.animationStateClasses.staticHeightZero, height === 0), _defineProperty(_cx2, this.animationStateClasses.staticHeightSpecific, height > 0), _defineProperty(_cx2, this.animationStateClasses.staticHeightAuto, height === 'auto'), _cx2));\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _cx3,\n          _this3 = this;\n\n      var _props2 = this.props,\n          animateOpacity = _props2.animateOpacity,\n          applyInlineTransitions = _props2.applyInlineTransitions,\n          children = _props2.children,\n          className = _props2.className,\n          contentClassName = _props2.contentClassName,\n          delay = _props2.delay,\n          duration = _props2.duration,\n          easing = _props2.easing,\n          id = _props2.id,\n          style = _props2.style;\n      var _state = this.state,\n          height = _state.height,\n          overflow = _state.overflow,\n          animationStateClasses = _state.animationStateClasses,\n          shouldUseTransitions = _state.shouldUseTransitions;\n\n\n      var componentStyle = _extends({}, style, {\n        height: height,\n        overflow: overflow || style.overflow\n      });\n\n      if (shouldUseTransitions && applyInlineTransitions) {\n        componentStyle.transition = 'height ' + duration + 'ms ' + easing + ' ' + delay + 'ms';\n\n        // Include transition passed through styles\n        if (style.transition) {\n          componentStyle.transition = style.transition + ', ' + componentStyle.transition;\n        }\n\n        // Add webkit vendor prefix still used by opera, blackberry...\n        componentStyle.WebkitTransition = componentStyle.transition;\n      }\n\n      var contentStyle = {};\n\n      if (animateOpacity) {\n        contentStyle.transition = 'opacity ' + duration + 'ms ' + easing + ' ' + delay + 'ms';\n        // Add webkit vendor prefix still used by opera, blackberry...\n        contentStyle.WebkitTransition = contentStyle.transition;\n\n        if (height === 0) {\n          contentStyle.opacity = 0;\n        }\n      }\n\n      var componentClasses = (0, _classnames2.default)((_cx3 = {}, _defineProperty(_cx3, animationStateClasses, true), _defineProperty(_cx3, className, className), _cx3));\n\n      // Check if user passed aria-hidden prop\n      var hasAriaHiddenProp = typeof this.props['aria-hidden'] !== 'undefined';\n      var ariaHidden = hasAriaHiddenProp ? this.props['aria-hidden'] : height === 0;\n\n      return _react2.default.createElement(\n        'div',\n        _extends({}, omit.apply(undefined, [this.props].concat(PROPS_TO_OMIT)), {\n          'aria-hidden': ariaHidden,\n          className: componentClasses,\n          id: id,\n          style: componentStyle\n        }),\n        _react2.default.createElement(\n          'div',\n          {\n            className: contentClassName,\n            style: contentStyle,\n            ref: function ref(el) {\n              return _this3.contentElement = el;\n            }\n          },\n          children\n        )\n      );\n    }\n  }]);\n\n  return AnimateHeight;\n}(_react2.default.Component);\n\nvar heightPropType = function heightPropType(props, propName, componentName) {\n  var value = props[propName];\n\n  if (typeof value === 'number' && value >= 0 || isPercentage(value) || value === 'auto') {\n    return null;\n  }\n\n  return new TypeError('value \"' + value + '\" of type \"' + (typeof value === 'undefined' ? 'undefined' : _typeof(value)) + '\" is invalid type for ' + propName + ' in ' + componentName + '. ' + 'It needs to be a positive number, string \"auto\" or percentage string (e.g. \"15%\").');\n};\n\nAnimateHeight.propTypes = {\n  'aria-hidden': _propTypes2.default.bool,\n  animateOpacity: _propTypes2.default.bool,\n  animationStateClasses: _propTypes2.default.object,\n  applyInlineTransitions: _propTypes2.default.bool,\n  children: _propTypes2.default.any.isRequired,\n  className: _propTypes2.default.string,\n  contentClassName: _propTypes2.default.string,\n  delay: _propTypes2.default.number,\n  duration: _propTypes2.default.number,\n  easing: _propTypes2.default.string,\n  height: heightPropType,\n  id: _propTypes2.default.string,\n  onAnimationEnd: _propTypes2.default.func,\n  onAnimationStart: _propTypes2.default.func,\n  style: _propTypes2.default.object\n};\n\nAnimateHeight.defaultProps = {\n  animateOpacity: false,\n  animationStateClasses: ANIMATION_STATE_CLASSES,\n  applyInlineTransitions: true,\n  duration: 250,\n  delay: 0,\n  easing: 'ease',\n  style: {}\n};\n\nexports.default = AnimateHeight;","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport BaseChart from 'interface/others/BaseChart';\r\n\r\nimport { formatPercentage } from 'common/format';\r\nimport SpellLink from 'common/SpellLink';\r\nimport { TooltipElement } from 'common/Tooltip';\r\n\r\nimport './style.scss';\r\n\r\nclass DonutChart extends React.PureComponent {\r\n  static propTypes = {\r\n    items: PropTypes.arrayOf(PropTypes.shape({\r\n      value: PropTypes.number.isRequired,\r\n      label: PropTypes.node.isRequired,\r\n      color: PropTypes.string.isRequired,\r\n      tooltip: PropTypes.node,\r\n      spellId: PropTypes.number,\r\n      valueTooltip: PropTypes.node,\r\n    })).isRequired,\r\n    // While you could change the chart size, I strongly recommend you do not for consistency and to avoid breaking whenever this component is modified. Do you really need to adjust the size?\r\n    chartSize: PropTypes.number,\r\n    innerRadiusFactor: PropTypes.number,\r\n  };\r\n  static defaultProps = {\r\n    chartSize: 90,\r\n    innerRadiusFactor: 0.28,\r\n  };\r\n\r\n  renderLegend(items) {\r\n    const total = items.reduce((sum, item) => sum + item.value, 0);\r\n\r\n    return (\r\n      <div className=\"legend\">\r\n        {items.map(({ color, label, tooltip, value, spellId, valueTooltip }, index) => {\r\n          label = tooltip ? (\r\n            <TooltipElement content={tooltip}>{label}</TooltipElement>\r\n          ) : label;\r\n          label = spellId ? (\r\n            <SpellLink id={spellId}>{label}</SpellLink>\r\n          ) : label;\r\n          return (\r\n            <div key={index} className=\"flex\">\r\n              <div className=\"flex-sub\">\r\n                <div className=\"circle\" style={{ background: color }} />\r\n              </div>\r\n              <div className=\"flex-main\">\r\n                {label}\r\n              </div>\r\n              <div className=\"flex-sub\">\r\n                <TooltipElement content={valueTooltip ? valueTooltip : value}>\r\n                  {formatPercentage(value / total, 0)}%\r\n                </TooltipElement>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n  renderChart(items, chartSize, innerRadiusFactor) {\r\n    const innerRadius = chartSize * innerRadiusFactor;\r\n\r\n    const data = {\r\n      items,\r\n    };\r\n    const spec = {\r\n      data: {\r\n        name: 'items',\r\n      },\r\n      mark: {\r\n        type: 'arc',\r\n        innerRadius,\r\n      },\r\n      encoding: {\r\n        theta: {\r\n          field: 'value',\r\n          type: 'quantitative',\r\n        },\r\n        color: {\r\n          field: 'label',\r\n          type: 'nominal',\r\n          legend: null,\r\n          scale: {\r\n            domain: items.map(({label}) => label),\r\n            range: items.map(({color}) => color),\r\n          },\r\n        },\r\n      },\r\n      view: {\r\n        stroke: null,\r\n      },\r\n    };\r\n    return (\r\n      <div className=\"chart\">\r\n        <BaseChart\r\n          width={chartSize}\r\n          height={chartSize}\r\n          spec={spec}\r\n          data={data}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n  render() {\r\n    const { items, chartSize, innerRadiusFactor } = this.props;\r\n\r\n    return (\r\n      <div className=\"donut-chart\">\r\n        {this.renderLegend(items)}\r\n        {this.renderChart(items, chartSize, innerRadiusFactor)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DonutChart;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { TooltipElement } from 'common/Tooltip';\r\n\r\nimport './StatisticBox.css';\r\nimport STATISTIC_CATEGORY from './STATISTIC_CATEGORY';\r\n\r\nexport { default as STATISTIC_ORDER } from './STATISTIC_ORDER';\r\n\r\n/**\r\n * @deprecated Use `interface/statistic/Statistic` instead.\r\n */\r\nconst StatisticsListBox = ({ title, tooltip, children, bodyStyle, ...others }) => {\r\n  delete others.category;\r\n  delete others.position;\r\n  return (\r\n    <div className=\"col-lg-3 col-md-4 col-sm-6 col-xs-12\">\r\n      <div className=\"panel statistic statistic-box statistic-box-list\" {...others}>\r\n        {title && (\r\n          <div className=\"panel-heading\">\r\n            <h2>{tooltip ? <TooltipElement content={tooltip}>{title}</TooltipElement> : title}</h2>\r\n          </div>\r\n        )}\r\n        <div className=\"panel-body items\" style={bodyStyle}>\r\n          {children}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\nStatisticsListBox.propTypes = {\r\n  title: PropTypes.node,\r\n  children: PropTypes.node.isRequired,\r\n  tooltip: PropTypes.node,\r\n  bodyStyle: PropTypes.object,\r\n  category: PropTypes.string,\r\n  position: PropTypes.number,\r\n};\r\nStatisticsListBox.defaultProps = {\r\n  category: STATISTIC_CATEGORY.GENERAL,\r\n};\r\n\r\nexport default StatisticsListBox;\r\n","import RESOURCE_TYPES from 'game/RESOURCE_TYPES';\r\nimport ResourceTracker from 'parser/shared/modules/resources/resourcetracker/ResourceTracker';\r\nimport { Options } from 'parser/core/Analyzer';\r\n\r\nclass ManaTracker extends ResourceTracker {\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.resource = RESOURCE_TYPES.MANA;\r\n    this.maxResource = 50000;\r\n  }\r\n\r\n  maxResource: number;\r\n}\r\n\r\nexport default ManaTracker;\r\n","import SPELLS from 'common/SPELLS';\r\n\r\nconst SHAMAN_BASE_ABILITIES = [\r\n  SPELLS.HEALING_WAVE,\r\n  SPELLS.CHAIN_HEAL,\r\n  SPELLS.HEALING_SURGE,\r\n  SPELLS.HEALING_STREAM_TOTEM_HEAL,\r\n  SPELLS.HEALING_TIDE_TOTEM_HEAL,\r\n  SPELLS.RIPTIDE,\r\n  SPELLS.HEALING_RAIN_HEAL,\r\n  SPELLS.WELLSPRING_HEAL,\r\n  SPELLS.UNLEASH_LIFE_TALENT,\r\n  SPELLS.EARTH_SHIELD_HEAL,\r\n  SPELLS.DOWNPOUR_TALENT,\r\n  SPELLS.ASCENDANCE_INITIAL_HEAL,\r\n];\r\n\r\nexport const RESTORATION_COLORS = {\r\n  CHAIN_HEAL: '#203755',\r\n  HEALING_WAVE: '#146585',\r\n  HEALING_SURGE: '#40b3bf',\r\n  RIPTIDE: '#a3dbce',\r\n  UNUSED:'#CC3D20',\r\n};\r\n\r\n// Spell Coefficients\r\nexport const CHAIN_HEAL_COEFFICIENT = 1.4;\r\nexport const HEALING_WAVE_COEFFICIENT = 1.7;\r\nexport const HEALING_SURGE_COEFFICIENT = 1.57;\r\nexport const HIGH_TIDE_COEFFICIENT = 1.68;\r\nexport const HEALING_WAVE_CAST_TIME = 2.5;\r\n\r\n// Conduit Ranks\r\nexport const SWIRLING_CURRENTS_RANKS = [20, 21, 23, 24, 26, 28, 29, 30, 31, 33, 34, 36, 37, 39, 40];\r\nexport const HEAVY_RAINFALL_RANKS = [75, 80, 85, 90, 95, 100, 105, 110, 115, 120, 125, 130, 135, 140, 145];\r\nexport const EMBRACE_OF_EARTH_RANKS = [5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12];\r\nexport const NATURES_FOCUS_RANKS = [10, 10.66, 11.33, 12, 12.66, 13.33, 14, 15, 16, 16.66, 17.33, 18, 18.66, 19.33, 20];\r\n\r\nexport const ABILITIES_AFFECTED_BY_HEALING_INCREASES = [\r\n  ...SHAMAN_BASE_ABILITIES,\r\n\r\n  // While the following spells don't double dip in healing increases, they gain the same percentual bonus from the transfer\r\n  SPELLS.CLOUDBURST_TOTEM_HEAL,\r\n  SPELLS.ASCENDANCE_HEAL,\r\n  SPELLS.LEECH,\r\n];\r\n\r\nexport const BASE_ABILITIES_AFFECTED_BY_MASTERY = [\r\n  ...SHAMAN_BASE_ABILITIES,\r\n];\r\n\r\nexport const ABILITIES_AFFECTED_BY_MASTERY = [\r\n  ...BASE_ABILITIES_AFFECTED_BY_MASTERY,\r\n  // While the following spells don't double dip in healing increases, they gain the same percentual bonus from the transfer\r\n  SPELLS.CLOUDBURST_TOTEM_HEAL,\r\n  SPELLS.ASCENDANCE_HEAL,\r\n  SPELLS.LEECH,\r\n];\r\n\r\nexport const ABILITIES_FEEDING_INTO_CBT = [\r\n  ...SHAMAN_BASE_ABILITIES,\r\n  SPELLS.ASCENDANCE_HEAL,\r\n  SPELLS.NATURES_GUARDIAN_HEAL,\r\n];\r\n\r\nexport const ABILITIES_NOT_FEEDING_INTO_ASCENDANCE = [\r\n  SPELLS.HEALING_TIDE_TOTEM_HEAL,\r\n  SPELLS.HEALING_STREAM_TOTEM_HEAL,\r\n  SPELLS.SPIRIT_LINK_TOTEM_REDISTRIBUTE,\r\n  SPELLS.LEECH,\r\n  SPELLS.ASCENDANCE_HEAL,\r\n  SPELLS.CLOUDBURST_TOTEM_HEAL,\r\n  SPELLS.ASCENDANCE_INITIAL_HEAL,\r\n];\r\n","import AbilityTracker from 'parser/shared/modules/AbilityTracker';\r\nimport HealingDone from 'parser/shared/modules/throughput/HealingDone';\r\nimport DamageDone from 'parser/shared/modules/throughput/DamageDone';\r\nimport CastEfficiency from 'parser/shared/modules/CastEfficiency';\r\nimport CoreAbilities from 'parser/core/modules/Abilities';\r\nimport Analyzer from 'parser/core/Analyzer';\r\nimport SPELLS from 'common/SPELLS/index';\r\nimport Spell from 'common/SPELLS/Spell';\r\n\r\nimport ManaTracker from './ManaTracker';\r\nimport { SpellbookAbility } from '../modules/Ability';\r\n\r\nexport interface SpellInfoDetails {\r\n  spell: Spell;\r\n  casts: number;\r\n  healingHits: number;\r\n  healingDone: number;\r\n  overhealingDone: number;\r\n  damageHits: number;\r\n  damageDone: number;\r\n  damageAbsorbed: number;\r\n  manaSpent: number;\r\n  manaGained: ManaTracker;\r\n  percentOverhealingDone: number;\r\n  percentHealingDone: number;\r\n  percentDamageDone: number;\r\n  manaPercentSpent: number;\r\n  hpm: number;\r\n  dpm: number;\r\n  timeSpentCasting: number;\r\n  percentTimeSpentCasting: number;\r\n  hpet: number;\r\n  dpet: number;\r\n}\r\n\r\nclass HealingEfficiencyTracker extends Analyzer {\r\n  static dependencies = {\r\n    manaTracker: ManaTracker,\r\n    abilityTracker: AbilityTracker,\r\n    healingDone: HealingDone,\r\n    damageDone: DamageDone,\r\n    castEfficiency: CastEfficiency,\r\n    abilities: CoreAbilities,\r\n  };\r\n\r\n  protected manaTracker!: ManaTracker;\r\n  protected abilityTracker!: AbilityTracker;\r\n  protected healingDone!: HealingDone;\r\n  protected damageDone!: DamageDone;\r\n  protected castEfficiency!: CastEfficiency;\r\n  protected abilities!: CoreAbilities;\r\n\r\n  getSpellStats(spellId: number, healingSpellIds: number[] | null = null) {\r\n    let spellInfo: SpellInfoDetails = {\r\n      spell: SPELLS[spellId],\r\n      casts: 0,\r\n      healingHits: 0,\r\n      healingDone: 0,\r\n      overhealingDone: 0,\r\n      damageHits: 0,\r\n      damageDone: 0,\r\n      damageAbsorbed: 0,\r\n      manaSpent: 0,\r\n      manaGained: this.manaTracker,\r\n      percentOverhealingDone: 0,\r\n      percentHealingDone: 0,\r\n      percentDamageDone: 0,\r\n      manaPercentSpent: 0,\r\n      hpm: 0,\r\n      dpm: 0,\r\n      timeSpentCasting: 0,\r\n      percentTimeSpentCasting: 0,\r\n      hpet: 0,\r\n      dpet: 0,\r\n    };\r\n\r\n    const ability = this.abilityTracker.getAbility(spellId);\r\n\r\n    spellInfo.casts = ability.casts || 0;\r\n    spellInfo.healingHits = ability.healingHits || 0;\r\n    spellInfo.healingDone = (ability.healingEffective || 0) + (ability.healingAbsorbed || 0);\r\n    spellInfo.overhealingDone = ability.healingOverheal || 0;\r\n\r\n    if (healingSpellIds) {\r\n      for (const healingSpellId in healingSpellIds) {\r\n        const healingAbility = this.abilityTracker.getAbility(healingSpellIds[healingSpellId]);\r\n\r\n        spellInfo.healingHits += healingAbility.healingHits || 0;\r\n        spellInfo.healingDone += (healingAbility.healingEffective || 0) + (healingAbility.healingAbsorbed || 0);\r\n        spellInfo.overhealingDone += healingAbility.healingOverheal || 0;\r\n      }\r\n    }\r\n\r\n    spellInfo.damageHits = ability.damageHits || 0;\r\n    spellInfo.damageDone = ability.damageEffective || 0;\r\n    spellInfo.damageAbsorbed = ability.damageAbsorbed || 0;\r\n\r\n    const spenders = this.manaTracker.spendersObj as {\r\n      [spellId: number]: {\r\n        spent: number;\r\n        spentByCast: number[];\r\n        casts: number\r\n      }\r\n    };\r\n    spellInfo.manaSpent = spenders[spellId] ? spenders[spellId].spent : 0;\r\n\r\n    // All of the following information can be derived from the data in SpellInfo.\r\n    // Now we can add custom logic for spells.\r\n    spellInfo = this.getCustomSpellStats(spellInfo, spellId, healingSpellIds);\r\n\r\n    spellInfo.percentOverhealingDone = spellInfo.overhealingDone / ((spellInfo.healingDone || 0) + spellInfo.overhealingDone) || 0;\r\n    spellInfo.percentHealingDone = spellInfo.healingDone / this.healingDone.total.regular || 0;\r\n    spellInfo.percentDamageDone = spellInfo.damageDone / this.damageDone.total.regular || 0;\r\n    spellInfo.manaPercentSpent = spellInfo.manaSpent / this.manaTracker.spent;\r\n\r\n    spellInfo.hpm = (spellInfo.healingDone / spellInfo.manaSpent) | 0;\r\n    spellInfo.dpm = (spellInfo.damageDone / spellInfo.manaSpent) | 0;\r\n\r\n    spellInfo.timeSpentCasting = this.castEfficiency.getTimeSpentCasting(spellId).timeSpentCasting + this.castEfficiency.getTimeSpentCasting(spellId).gcdSpent;\r\n    spellInfo.percentTimeSpentCasting = spellInfo.timeSpentCasting / this.owner.fightDuration;\r\n\r\n    spellInfo.hpet = (spellInfo.healingDone / spellInfo.timeSpentCasting) | 0;\r\n    spellInfo.dpet = (spellInfo.damageDone / spellInfo.timeSpentCasting) | 0;\r\n\r\n    return spellInfo;\r\n  }\r\n\r\n  getCustomSpellStats(spellInfo: SpellInfoDetails, spellId: number, healingSpellIds: number[] | null) {\r\n    // Overwrite this function to add specific logic for spells.\r\n    return spellInfo;\r\n  }\r\n\r\n  getAllSpellStats(includeCooldowns = false) {\r\n    const spells: { [spellId: number]: SpellInfoDetails } = {};\r\n    let topHpm = 0;\r\n    let topDpm = 0;\r\n    let topHpet = 0;\r\n    let topDpet = 0;\r\n\r\n    for (const index in this.abilities.abilities) {\r\n      const ability = this.abilities.abilities[index] as unknown as SpellbookAbility;\r\n\r\n      if (ability.spell instanceof Array) {\r\n        continue;\r\n      }\r\n      if (ability.spell && ability.spell.manaCost && ability.spell.manaCost > 0) {\r\n        if (includeCooldowns || ability.category !== 'Cooldown') {\r\n          spells[ability.spell.id] = this.getSpellStats(ability.spell.id, ability.healSpellIds);\r\n\r\n          topHpm = Math.max(topHpm, spells[ability.spell.id].hpm);\r\n          topDpm = Math.max(topDpm, spells[ability.spell.id].dpm);\r\n          topHpet = Math.max(topHpet, spells[ability.spell.id].hpet);\r\n          topDpet = Math.max(topDpet, spells[ability.spell.id].dpet);\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      spells,\r\n      topHpm,\r\n      topDpm,\r\n      topHpet,\r\n      topDpet,\r\n    };\r\n  }\r\n}\r\n\r\nexport default HealingEfficiencyTracker;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport StatisticBox from './StatisticBox';\r\n\r\nexport { STATISTIC_ORDER } from './StatisticBox';\r\n\r\n/**\r\n * @deprecated Use `interface/statistic/Statistic` instead.\r\n */\r\nclass LazyLoadStatisticBox extends React.PureComponent {\r\n  static propTypes = {\r\n    loader: PropTypes.func.isRequired,\r\n    value: PropTypes.node.isRequired,\r\n    children: PropTypes.node,\r\n  };\r\n  static contextTypes = {\r\n    updateResults: PropTypes.func.isRequired,\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      loaded: false,\r\n      loading: false,\r\n    };\r\n    this.handleClick = this.handleClick.bind(this);\r\n  }\r\n\r\n  handleClick() {\r\n    if (this.state.loaded) {\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      loading: true,\r\n    });\r\n    this.props.loader().then((result) => {\r\n      this.setState({\r\n        loading: false,\r\n        loaded: true,\r\n      });\r\n      this.context.updateResults();\r\n      return result;\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { value, children, ...others } = this.props;\r\n    delete others.loader;\r\n    delete others.children;\r\n\r\n    return (\r\n      <StatisticBox\r\n        onClick={this.handleClick}\r\n        value={this.state.loaded ? value : (this.state.loading ? 'Loading...' : 'Click to load')}\r\n        style={{ cursor: this.state.loaded ? undefined : 'pointer' }}\r\n        {...others}\r\n      >\r\n        {this.state.loaded ? children : null}\r\n      </StatisticBox>\r\n    );\r\n  }\r\n}\r\n\r\nexport default LazyLoadStatisticBox;\r\n","import React from 'react';\r\n\r\nimport colorForPerformance from 'common/colorForPerformance';\r\n\r\ninterface Props {\r\n  percent: number;\r\n}\r\n\r\nconst PerformanceBar = ({ percent }: Props) => (\r\n  <div className=\"performance-bar-container\">\r\n    <div\r\n      className=\"performance-bar\"\r\n      style={{\r\n        width: `${percent * 100}%`,\r\n        transition: 'background-color 800ms',\r\n        backgroundColor: colorForPerformance(percent),\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nexport default PerformanceBar;\r\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAAAuCAYAAACCq/96AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjEuNv1OCegAAAPKSURBVGhD7ZtLSBRxHMcttegQPYhKKCii94PeWVD0Lo+uVFoQRJck9BAF+WAJDS8FXUItzdVMzQ5ejO5B++jhW7e3eggCL+2641p0+Pf9zf5n3V3/7u6sO40j84EPiLM7/vbD/GcWdzaFMXYMZkV4Bm6EC1NMwgmJlDU+VNfs/179UvZbZbvUb20ZfXelxuvIqdRSPko0ymEVrIaP4GNYA2vhE24dtMF62ACfwkb4DDbBZtgCn3Nb4QsVBlBi+YdsjWPuuyxUaeAO83XfYF7XJYYXppkeh6WdjyPCCpnODsEAcqzhBltkLEU5Ws8tzaN57TltfKRQiqDoBfxvJ4KNDzdViUKFStGk3tuIlid+scnSbqFlolAARcPrYWiw+gZRpEiD0ZwXxC82CWJpOvhYRAkUDa+HE8H8n+89nBToY4VES0RTHZb+BIL9grR09TDAqNNS4uu+GR7s0/2vfLNmIE5RAsE6oL5QMBqWlpsZLA6UYF7neSb1lZrBYhEMRuKELkczg01NWDDSmcskd8UXvlkzZk8wGtyZ18U3a8bsCmbP0XwwwwbTCzOYSowcTJfBphGsUCeDGCmYXv6GQcxgsTWDqdQMplLDBvsLR3QyiJGCaT5XPJjBVGIGU4kug3k7rpWZwVQgucsfeF0XzWDx4h+sqR3tyA/7FMoMFgX/UL2N/rs7+v4qYp0zg8WCPm2XBsqY1FvMvG8vm8FiodyeQNGUWxGMHiwjijIjr7MzEnVssLZVDuYuZ1K/lfk6C5jHmeviuyYSmUtLg4gGi6WMcrKOJp2jKErwM0+BgaVZxPBW4wNjLI3vPpG5tHLiVgGgaTCSoolChSrfJdRX3INgi+Ec7H7GBlsOe6DogVMpI4ozlfFEG//RVoRYm+E87D6RubQyLBihdjgZUZho+jqvC0ORf36+siIU3dx3BK6Bc/EnZkq0ScEINcPJiKLE0tdVGC0WeRbugysgLc2ZEE0YTDWeN5b8yCAee46bb54ShNgBlUCRnoZ0lNHSXAQp2uwg0WAEQuyCkbHo6KJgR+EeuBou4E8xPtMJRiCGEo1CkcrPJ+EhuAkugan8KcZmusEIxNgPKdApqESj7wkoR9kqmM4fbmySFCwV7oSH4XFIsSgaLU363Va4FBr/XJaMYARipMMtMBPSkUWxKBoddQfgWmj8b6UkKxiBIGlwHdwN6SpJ0U7Ag5BiroTGvgB4XdmZHrulNFK+WTUIQsszA26HdLRRrL2QgtEVk95mzI7zWbJAkLlwGdwAt0E6h62HdPKnK+Z8qNP5LCXlH/EZJ5PjYeR7AAAAAElFTkSuQmCC\"","import React from 'react';\r\nimport { formatNumber, formatPercentage, formatDuration } from 'common/format';\r\nimport Toggle from 'react-toggle';\r\nimport PerformanceBar from 'interface/PerformanceBar';\r\nimport SpellLink from 'common/SpellLink';\r\nimport { TooltipElement } from 'common/Tooltip';\r\nimport HolyPriestHealingEfficiencyTracker from 'parser/priest/holy/modules/features/HolyPriestHealingEfficiencyTracker';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport HealingEfficiencyTracker, { SpellInfoDetails } from './HealingEfficiencyTracker';\r\n\r\nexport interface Props {\r\n  tracker: HealingEfficiencyTracker | HolyPriestHealingEfficiencyTracker;\r\n}\r\nexport interface State {\r\n  showHealing: boolean;\r\n  detailedView: boolean;\r\n  showCooldowns: boolean;\r\n  showEchoOfLight?: boolean;\r\n}\r\n\r\nclass HealingEfficiencyBreakdown extends React.Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      showHealing: true,\r\n      detailedView: false,\r\n      showCooldowns: false,\r\n    };\r\n  }\r\n\r\n  HealingEfficiencyTable = (props: Props) => {\r\n    const { tracker } = props;\r\n    const { spells, topHpm, topDpm, topHpet, topDpet } = tracker.getAllSpellStats(this.state.showCooldowns);\r\n\r\n    const spellArray = Object.values(spells);\r\n\r\n    spellArray.sort((a, b) => {\r\n      if (this.state.showHealing) {\r\n        if (a.hpm < b.hpm) {\r\n          return 1;\r\n        } else if (a.hpm > b.hpm) {\r\n          return -1;\r\n        }\r\n      } else {\r\n        if (a.dpm < b.dpm) {\r\n          return 1;\r\n        } else if (a.dpm > b.dpm) {\r\n          return -1;\r\n        }\r\n      }\r\n\r\n      return 0;\r\n    });\r\n\r\n    const spellRows = spellArray.map((spellDetail => {\r\n      if (spellDetail.casts > 0) {\r\n        return this.HealingEfficiencySpellRow(spellDetail, topHpm, topDpm, topHpet, topDpet);\r\n      }\r\n      return null;\r\n    }));\r\n\r\n    return <>{spellRows}</>;\r\n  };\r\n\r\n  HealingEfficiencySpellRow = (spellDetail: SpellInfoDetails, topHpm: number, topDpm: number, topHpet: number, topDpet: number) => (\r\n    <tr key={spellDetail.spell.id}>\r\n      <td>\r\n        <SpellLink id={spellDetail.spell.id} />\r\n      </td>\r\n      {this.state.detailedView ? this.DetailView(spellDetail) : this.BarView(spellDetail, topHpm, topDpm, topHpet, topDpet)}\r\n    </tr>\r\n  );\r\n\r\n  BarHeader = () => (\r\n    <>\r\n      <Trans render=\"th\" id=\"shared.healingEfficiency.tableHeader.manaSpent\">Mana Spent</Trans>\r\n      {this.state.showHealing && (\r\n        <>\r\n          <th colSpan={2} className=\"text-center\"><Trans id=\"common.stat.healingPerMana\">Healing per mana spent</Trans></th>\r\n          <th colSpan={2} className=\"text-center\">\r\n            <TooltipElement content={<Trans id=\"common.stat.healingPerExecutionTime.long\">Healing per second spent casting the spell, including GCD wait time.</Trans>}>\r\n              <Trans id=\"common.stat.healingPerExecutionTime\">Healing per second spent casting</Trans>\r\n            </TooltipElement>\r\n          </th>\r\n        </>\r\n      )}\r\n      {!this.state.showHealing && (\r\n        <>\r\n          <th colSpan={2} className=\"text-center\"><Trans id=\"common.stat.damagePerMana\">Damage per mana spent</Trans></th>\r\n          <th colSpan={2} className=\"text-center\"><Trans id=\"common.stat.damagePerExecutionTime.long\">Damage per second spent casting the spell</Trans></th>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n\r\n\r\n  BarView = (spellDetail: SpellInfoDetails, topHpm: number, topDpm: number, topHpet: number, topDpet: number) => {\r\n    const hasHealing = spellDetail.healingDone;\r\n    const hasDamage = spellDetail.damageDone > 0;\r\n    const barWidth = 20;\r\n\r\n    return (\r\n      <>\r\n        <td>\r\n          {formatNumber(spellDetail.manaSpent)}\r\n          {' (' + formatPercentage(spellDetail.manaPercentSpent) + '%)'}\r\n        </td>\r\n        {this.state.showHealing && (\r\n          <>\r\n            <td className=\"text-right\">{hasHealing ? formatNumber(spellDetail.hpm) : '-'}</td>\r\n            <td width={barWidth + '%'}><PerformanceBar percent={spellDetail.hpm / topHpm} /></td>\r\n\r\n            <td className=\"text-right\">{hasHealing ? formatNumber(spellDetail.hpet * 1000) : '-'}</td>\r\n            <td width={barWidth + '%'}><PerformanceBar percent={(spellDetail.hpet / topHpet)} /></td>\r\n          </>\r\n        )}\r\n        {!this.state.showHealing && (\r\n          <>\r\n            <td className=\"text-right\">{hasDamage ? formatNumber(spellDetail.dpm) : '-'}</td>\r\n            <td width={barWidth + '%'}><PerformanceBar percent={spellDetail.dpm / topDpm} /></td>\r\n\r\n            <td className=\"text-right\">{hasDamage ? formatNumber(spellDetail.dpet * 1000) : '-'}</td>\r\n            <td width={barWidth + '%'}><PerformanceBar percent={(spellDetail.dpet / topDpet)} /></td>\r\n          </>\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  DetailHeader = () => (\r\n    <>\r\n      <th>\r\n        <TooltipElement content={<Trans id=\"shared.healingEfficiency.tableHeader.casts.tooltip\">Total Casts (Number of targets hit)</Trans>}><Trans id=\"shared.healingEfficiency.tableHeader.casts\">Casts</Trans></TooltipElement>\r\n      </th>\r\n      <Trans render=\"th\" id=\"shared.healingEfficiency.tableHeader.manaSpent\">Mana Spent</Trans>\r\n      <Trans render=\"th\" id=\"shared.healingEfficiency.tableHeader.timeSpent\">Time Spent</Trans>\r\n      {this.state.showHealing && (\r\n        <>\r\n          <Trans render=\"th\" id=\"shared.healingEfficiency.tableHeader.healingDone\">Healing Done</Trans>\r\n          <Trans render=\"th\" id=\"shared.healingEfficiency.tableHeader.overhealingDone\">Overhealing</Trans>\r\n          <th>\r\n            <TooltipElement content={<Trans id=\"common.stat.healingPerMana.long\">Healing per mana spent casting the spell</Trans>}>\r\n              <Trans id=\"common.stat.healingPerMana.short\">HPM</Trans>\r\n            </TooltipElement>\r\n          </th>\r\n          <th>\r\n            <TooltipElement content={<Trans id=\"common.stat.healingPerExecutionTime.long\">Healing per second spent casting the spell, including GCD wait time.</Trans>}>\r\n              <Trans id=\"common.stat.healingPerExecutionTime.short\">HPET</Trans>\r\n            </TooltipElement>\r\n          </th>\r\n        </>\r\n      )}\r\n      {!this.state.showHealing && (\r\n        <>\r\n          <Trans render=\"th\" id=\"shared.healingEfficiency.tableHeader.damageDone\">Damage Done</Trans>\r\n          <th>\r\n            <TooltipElement content={<Trans id=\"common.stat.damagePerMana.long\">Damage per mana spent casting the spell</Trans>}>\r\n              <Trans id=\"common.stat.damagePerMana.short\">DPM</Trans>\r\n            </TooltipElement>\r\n          </th>\r\n          <th>\r\n            <TooltipElement content={<Trans id=\"common.stat.damagePerExecutionTime.long\">Damage per second spent casting the spell</Trans>}>\r\n              <Trans id=\"common.stat.damagePerExecutionTime.short\">DPET</Trans>\r\n            </TooltipElement>\r\n          </th>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n\r\n  DetailView = (spellDetail: SpellInfoDetails) => {\r\n    const hasHealing = spellDetail.healingDone;\r\n    const hasOverhealing = spellDetail.healingDone > 0 || spellDetail.overhealingDone > 0;\r\n    const hasDamage = spellDetail.damageDone > 0;\r\n\r\n    return (\r\n      <>\r\n        <td>{spellDetail.casts} ({this.state.showHealing ? Math.floor(spellDetail.healingHits) : Math.floor(spellDetail.damageHits)})</td>\r\n        <td>\r\n          {formatNumber(spellDetail.manaSpent)}\r\n          {' (' + formatPercentage(spellDetail.manaPercentSpent) + '%)'}\r\n        </td>\r\n        <td>{spellDetail.timeSpentCasting !== 0 ? (formatDuration(spellDetail.timeSpentCasting / 1000) + ' (' + formatPercentage(spellDetail.percentTimeSpentCasting) + '%)') : '-'}</td>\r\n        {this.state.showHealing && (\r\n          <>\r\n            <td>\r\n              {hasHealing ? formatNumber(spellDetail.healingDone) : '-'}\r\n              {hasHealing ? ' (' + formatPercentage(spellDetail.percentHealingDone) + '%)' : ''}\r\n            </td>\r\n            <td>\r\n              {hasOverhealing ? formatNumber(spellDetail.overhealingDone) : '-'}\r\n              {hasOverhealing ? ' (' + formatPercentage(spellDetail.percentOverhealingDone) + '%)' : ''}\r\n            </td>\r\n            <td>{hasHealing ? formatNumber(spellDetail.hpm) : '-'}</td>\r\n            <td>{hasHealing ? formatNumber(spellDetail.hpet * 1000) : '-'}</td>\r\n          </>\r\n        )}\r\n        {!this.state.showHealing && (\r\n          <>\r\n            <td>\r\n              {hasDamage ? formatNumber(spellDetail.damageDone) : '-'}\r\n              {hasDamage ? ' (' + formatPercentage(spellDetail.percentDamageDone) + '%)' : ''}\r\n            </td>\r\n            <td>{hasDamage ? formatNumber(spellDetail.dpm) : '-'}</td>\r\n            <td>{hasDamage ? formatNumber(spellDetail.dpet * 1000) : '-'}</td>\r\n          </>\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { tracker } = this.props;\r\n\r\n    return (\r\n      <>\r\n        <div className=\"pad\">\r\n          <div className=\"pull-left\">\r\n            <div className=\"toggle-control pull-right\" style={{ marginRight: '.5em' }}>\r\n              <Toggle\r\n                defaultChecked={false}\r\n                icons={false}\r\n                onChange={event => this.setState({ detailedView: event.target.checked })}\r\n                id=\"detailed-toggle\"\r\n              />\r\n              <label htmlFor=\"detailed-toggle\" style={{ marginLeft: '0.5em' }}>\r\n                <Trans id=\"shared.healingEfficiency.toggle.detailed\">Detailed View</Trans>\r\n              </label>\r\n            </div>\r\n          </div>\r\n          <div className=\"pull-right\">\r\n            <div className=\"toggle-control pull-left\" style={{ marginLeft: '.5em', marginRight: '.5em' }}>\r\n              <Toggle\r\n                defaultChecked={false}\r\n                icons={false}\r\n                onChange={event => this.setState({ showCooldowns: event.target.checked })}\r\n                id=\"cooldown-toggle\"\r\n              />\r\n              <label htmlFor=\"cooldown-toggle\" style={{ marginLeft: '0.5em' }}>\r\n                <Trans id=\"shared.healingEfficiency.toggle.cooldowns\">Show Cooldowns</Trans>\r\n              </label>\r\n            </div>\r\n            <div className=\"toggle-control pull-left\" style={{ marginLeft: '.5em' }}>\r\n              <label htmlFor=\"healing-toggle\" style={{ marginLeft: '0.5em', marginRight: '1em' }}>\r\n                <Trans id=\"shared.healingEfficiency.toggle.damage\">Show Damage</Trans>\r\n              </label>\r\n              <Toggle\r\n                defaultChecked\r\n                icons={false}\r\n                onChange={event => this.setState({ showHealing: event.target.checked })}\r\n                id=\"healing-toggle\"\r\n              />\r\n              <label htmlFor=\"healing-toggle\" style={{ marginLeft: '0.5em' }}>\r\n                <Trans id=\"shared.healingEfficiency.toggle.healing\">Show Healing</Trans>\r\n              </label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <table className=\"data-table\">\r\n          <thead>\r\n            <tr>\r\n              <Trans render=\"th\" id=\"common.ability\">Ability</Trans>\r\n              {this.state.detailedView ? <this.DetailHeader /> : <this.BarHeader />}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <this.HealingEfficiencyTable tracker={tracker} />\r\n          </tbody>\r\n        </table>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default HealingEfficiencyBreakdown;\r\n","/**\r\n * @deprecated Use `interface/statistic/StatisticGroup` instead.\r\n */\r\nconst StatisticWrapper = props => props.children;\r\n\r\nexport default StatisticWrapper;\r\n","import SPELLS from 'common/SPELLS/index';\r\n\r\n/*\r\n * Fields:\r\n * int: spell scales with Intellect\r\n * crit: spell scales with (is able to or procced from) Critical Strike\r\n * hasteHpm: spell does more healing due to Haste, e.g. HoTs that gain more ticks\r\n * hasteHpct: spell can be cast more frequently due to Haste, basically any spell except for non haste scaling CDs\r\n * mastery: spell is boosted by Mastery\r\n * masteryStack: spell's HoT counts as a Mastery Stack\r\n * vers: spell scales with Versatility\r\n * multiplier: spell scales with whatever procs it, should be ignored for purpose of weights and for 'total healing' number\r\n * ignored: spell should be ignored for purpose of stat weights\r\n */\r\n\r\n// This only works with actual healing events; casts are not recognized.\r\nexport default {\r\n  [SPELLS.LEECH.id]: { // procs a percent of all your healing, so we ignore for weights and total healing\r\n    multiplier: true,\r\n  },\r\n  [SPELLS.HEALTHSTONE.id]: {\r\n    int: false,\r\n    crit: false,\r\n    hasteHpct: false,\r\n    mastery: false,\r\n    vers: true, // confirmed\r\n  },\r\n  [SPELLS.MARK_OF_THE_ANCIENT_PRIESTESS.id]: {\r\n    int: false,\r\n    crit: true,\r\n    hasteHpct: false,\r\n    mastery: false,\r\n    vers: true,\r\n  },\r\n};\r\n","import React from 'react';\r\n\r\nimport InformationIcon from 'interface/icons/Information';\r\n\r\nimport SPELLS from 'common/SPELLS/index';\r\nimport Tooltip, { TooltipElement } from 'common/Tooltip';\r\nimport { formatNumber } from 'common/format';\r\nimport { calculatePrimaryStat, calculateSecondaryStatDefault } from 'common/stats';\r\nimport Analyzer, { SELECTED_PLAYER, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport Events, { EventType } from 'parser/core/Events';\r\nimport HIT_TYPES from 'game/HIT_TYPES';\r\nimport HealingValue from 'parser/shared/modules/HealingValue';\r\nimport DamageValue from 'parser/shared/modules/DamageValue';\r\nimport CritEffectBonus from 'parser/shared/modules/helpers/CritEffectBonus';\r\nimport StatTracker from 'parser/shared/modules/StatTracker';\r\nimport { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport StatisticWrapper from 'interface/others/StatisticWrapper';\r\nimport InfoIcon from 'interface/icons/Info';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport CORE_SPELL_INFO from './SpellInfo';\r\nimport STAT, { getClassNameColor, getIcon, getName, getNameTranslated } from './STAT';\r\nimport QELiveLogo from './images/QE-Logo-New-Small.png';\r\n\r\nconst DEBUG = false;\r\n\r\n/**\r\n * This is currently completely focussed on Healer stat weights but it should be relatively easy to modify it to work for a DPS, it just requires some work. The only reason no effort was put towards this is that we currently have no DPS interested in implementing this so it would be wasted time. If you do want to implement stat weights for a DPS this should provide you with a very good basis.\r\n * @property {CritEffectBonus} critEffectBonus\r\n * @property {StatTracker} statTracker\r\n */\r\nclass BaseHealerStatValues extends Analyzer {\r\n  static dependencies = {\r\n    critEffectBonus: CritEffectBonus,\r\n    statTracker: StatTracker,\r\n  };\r\n\r\n  /**\r\n   * QE Live Link Setter\r\n   * As of right now this is only enabled for MW, Resto Druid, and Holy Pally\r\n   * Unless you talk to Voulk, the creator of QElive, Do not flip the switch for other healers\r\n   */\r\n  qeLive = false;\r\n\r\n  // region Spell info\r\n\r\n  // We assume unlisted spells scale with vers only (this will mostly be trinkets)\r\n  fallbackSpellInfo = {\r\n    int: false,\r\n    crit: true,\r\n    hasteHpm: false,\r\n    hasteHpct: false,\r\n    mastery: false,\r\n    vers: true,\r\n  };\r\n  // This will contain shared settings for things like trinkets and Leech\r\n  sharedSpellInfo = CORE_SPELL_INFO;\r\n  // This is for spec specific implementations to override. It gets priority over defaultSpellInfo.\r\n  spellInfo = {};\r\n\r\n  mentioned = [];\r\n  _getSpellInfo(event) {\r\n    const spellId = event.ability.guid;\r\n\r\n    const specSpecific = this.spellInfo[spellId];\r\n    if (specSpecific) {\r\n      return specSpecific;\r\n    }\r\n    const shared = this.sharedSpellInfo[spellId];\r\n    if (shared) {\r\n      return shared;\r\n    }\r\n\r\n    if (process.env.NODE_ENV === 'development') {\r\n      if (!this.mentioned.includes(spellId)) {\r\n        console.warn(`Missing spell definition: ${spellId}: ${event.ability.name}, using fallback:`, this.fallbackSpellInfo);\r\n        this.mentioned.push(spellId);\r\n      }\r\n    }\r\n\r\n    return this.fallbackSpellInfo;\r\n  }\r\n\r\n  // endregion\r\n\r\n  totalAdjustedHealing = 0; // total healing after excluding 'multiplier' spells like Leech / Velens\r\n\r\n  // These are the total healing that would be gained if their respective stats ratings were increased by one.\r\n  totalOneInt = 0;\r\n  totalOneCrit = 0;\r\n  totalOneHasteHpct = 0;\r\n  totalOneHasteHpm = 0;\r\n  totalOneMastery = 0;\r\n  totalOneVers = 0; // from healing increase only\r\n  totalOneVersDr = 0; // from damage reduced only\r\n  totalOneLeech = 0;\r\n\r\n  playerHealthMissing = 0;\r\n\r\n  scaleWeightsWithHealth = false;\r\n\r\n  constructor(options){\r\n    super(options);\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER), this.onHeal);\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER_PET), this.onHeal);\r\n    this.addEventListener(Events.absorbed.by(SELECTED_PLAYER), this.onAbsorb);\r\n    this.addEventListener(Events.absorbed.by(SELECTED_PLAYER_PET), this.onAbsorb);\r\n    this.addEventListener(Events.removebuff.by(SELECTED_PLAYER), this.onRemoveBuff);\r\n    this.addEventListener(Events.removebuff.by(SELECTED_PLAYER_PET), this.onRemoveBuff);\r\n    this.addEventListener(Events.heal.to(SELECTED_PLAYER), this.onHealTaken);\r\n    this.addEventListener(Events.damage.to(SELECTED_PLAYER), this.onDamageTaken);\r\n    this.addEventListener(Events.fightend, this.onFightend);\r\n  }\r\n\r\n  onHeal(event) {\r\n    const healVal = new HealingValue(event.amount, event.absorbed, event.overheal);\r\n    this._handleHealEvent(event, healVal);\r\n  }\r\n  onAbsorb(event) {\r\n    const healVal = new HealingValue(event.amount, 0, 0);\r\n    this._handleHealEvent(event, healVal);\r\n  }\r\n  onRemoveBuff(event) {\r\n    if (event.absorb) {\r\n      const healVal = new HealingValue(0, 0, event.absorb);\r\n      this._handleHealEvent(event, healVal);\r\n    }\r\n  }\r\n  _handleHealEvent(event, healVal) {\r\n    const spellInfo = this._getSpellInfo(event);\r\n    const targetHealthPercentage = (event.hitPoints - healVal.effective) / event.maxHitPoints; // hitPoints contains HP *after* the heal\r\n    this._handleHeal(spellInfo, event, healVal, targetHealthPercentage);\r\n  }\r\n  /**\r\n   * This actually does that stat weights calculations.\r\n   * @param spellInfo An object containing information about how to treat the spell, like on what stats it scales.\r\n   * @param eventForWeights The event that uses the stats to scale its healing. If we're tracking a multiplier (like Beacons), this should be the source of the multiplier.\r\n   * @param {HealingValue} healVal The actual healing done, all child weight calculators should use this instead of the event data as that might be for another event.\r\n   * @param targetHealthPercentage The percentage of health the target has remaining BEFORE the heal.\r\n   * @private\r\n   */\r\n  _handleHeal(spellInfo, eventForWeights, healVal, targetHealthPercentage) {\r\n    // Most spells are counted in healing total, but some spells scale not on their own but 'second hand' from other spells\r\n    // I adjust them out of total healing to preserve some accuracy in the \"Rating per 1%\" stat.\r\n    // Good examples of multiplier spells are Leech and Velens.\r\n    if (!spellInfo.multiplier) {\r\n      this.totalAdjustedHealing += this._adjustGain(healVal.effective, targetHealthPercentage);\r\n    }\r\n\r\n    if (spellInfo.ignored) {\r\n      return;\r\n    }\r\n\r\n    this.totalOneLeech += this._adjustGain(this._leech(eventForWeights, healVal, spellInfo), targetHealthPercentage);\r\n\r\n    if (spellInfo.multiplier) {\r\n      // Multiplier spells aren't counted for weights because they don't **directly** benefit from stat weights\r\n      return;\r\n    }\r\n\r\n    if (spellInfo.int) {\r\n      this.totalOneInt += this._adjustGain(this._intellect(eventForWeights, healVal), targetHealthPercentage);\r\n    }\r\n    if (spellInfo.crit) {\r\n      this.totalOneCrit += this._adjustGain(this._criticalStrike(eventForWeights, healVal), targetHealthPercentage);\r\n    }\r\n    if (spellInfo.hasteHpct) {\r\n      this.totalOneHasteHpct += this._adjustGain(this._hasteHpct(eventForWeights, healVal), targetHealthPercentage);\r\n    }\r\n    if (spellInfo.hasteHpm) {\r\n      this.totalOneHasteHpm += this._adjustGain(this._hasteHpm(eventForWeights, healVal), targetHealthPercentage);\r\n    }\r\n    if (spellInfo.mastery) {\r\n      this.totalOneMastery += this._adjustGain(this._mastery(eventForWeights, healVal), targetHealthPercentage);\r\n    }\r\n    if (spellInfo.vers) {\r\n      this.totalOneVers += this._adjustGain(this._versatility(eventForWeights, healVal), targetHealthPercentage);\r\n    }\r\n  }\r\n  _adjustGain(gain, targetHealthPercentage) {\r\n    if (gain === 0) {\r\n      return 0;\r\n    }\r\n    // We want 0-20% health to get value gain, and then linearly decay to 100% health\r\n    const maxValueHealthPercentage = 0.3;\r\n    const mult = 1 - Math.max(0, (targetHealthPercentage - maxValueHealthPercentage) / (1 - maxValueHealthPercentage));\r\n    return this.scaleWeightsWithHealth ? gain * mult : gain;\r\n  }\r\n  _leech(event, healVal, spellInfo) {\r\n    if (event.type !== EventType.Heal) {\r\n      return 0; // leech doesn't proc from absorbs\r\n    }\r\n\r\n    // We have to calculate leech weight differently depending on if we already have any leech rating.\r\n    // Leech is marked as a 'multplier' heal, so we have to check it before we do the early return below\r\n    const hasLeech = this.statTracker.currentLeechPercentage > 0;\r\n    if (hasLeech) {\r\n      return this._leechHasLeech(event, healVal, spellInfo);\r\n    } else {\r\n      return this._leechPrediction(event, healVal, spellInfo);\r\n    }\r\n  }\r\n  _leechHasLeech(event, healVal/*, spellInfo*/) {\r\n    // When the user has Leech we can use the actual Leech healing to accuractely calculate its HPS value without having to do any kind of predicting\r\n    const spellId = event.ability.guid;\r\n    if (spellId !== SPELLS.LEECH.id) {\r\n      return 0;\r\n    }\r\n    if (!healVal.overheal) {\r\n      return healVal.effective / this.statTracker.currentLeechRating; // TODO: Make a generic method to account for base percentage\r\n    }\r\n    return 0;\r\n  }\r\n  _leechPrediction(event, healVal, spellInfo) {\r\n    // Without Leech we will have to make an estimation so we can still provide the user with a decent value\r\n    if (this.owner.toPlayer(event)) {\r\n      return 0; // Leech doesn't proc from self-healing\r\n    }\r\n    if (spellInfo.multiplier) {\r\n      return 0; // Leech doesn't proc from multipliers such as Velen's Future Sight\r\n    }\r\n    if (this.playerHealthMissing > 0) { // if the player is full HP this would have overhealed.\r\n      const healIncreaseFromOneLeech = this.statTracker.statMultiplier.leech / this.statTracker.ratingNeededForNextPercentage(this.statTracker.currentLeechRating, this.statTracker.statBaselineRatingPerPercent[STAT.LEECH], 1, false);\r\n      return healVal.raw * healIncreaseFromOneLeech;\r\n    }\r\n    return 0;\r\n  }\r\n  _intellect(event, healVal) {\r\n    if (healVal.overheal) {\r\n      // If a spell overheals, it could not have healed for more. Seeing as Int only adds HP on top of the existing heal we can skip it as increasing the power of this heal would only be more overhealing.\r\n      return 0;\r\n    }\r\n    const healIncreaseFromOneInt = this.statTracker.statMultiplier.intellect / this.statTracker.currentIntellectRating;\r\n    return healVal.effective * healIncreaseFromOneInt;\r\n  }\r\n  _getCritChance(event) {\r\n    const rating = this.statTracker.currentCritRating;\r\n    const baseCritChance = this.statTracker.baseCritPercentage;\r\n    const ratingCritChance = rating / this.statTracker.ratingNeededForNextPercentage(this.statTracker.currentCritRating, this.statTracker.statBaselineRatingPerPercent[STAT.CRITICAL_STRIKE]);\r\n\r\n    return { baseCritChance, ratingCritChance };\r\n  }\r\n  _isCrit(event) {\r\n    return event.hitType === HIT_TYPES.CRIT;\r\n  }\r\n  _criticalStrike(event, healVal) {\r\n    if (this._isCrit(event)) {\r\n      // This collects the total effective healing contributed by the last 1 point of critical strike rating.\r\n      // We don't make any predictions on normal hits based on crit chance since this would be guess work and we are a log analysis system so we prefer to only work with facts. Actual crit heals are undeniable facts, unlike speculating the chance a normal hit might have crit (and accounting for the potential overhealing of that).\r\n\r\n      const { baseCritChance, ratingCritChance } = this._getCritChance(event);\r\n\r\n      const totalCritChance = baseCritChance + ratingCritChance;\r\n      if (totalCritChance > (1 + 1 / this.statTracker.ratingNeededForNextPercentage(this.statTracker.currentCritRating, this.statTracker.statBaselineRatingPerPercent[STAT.CRITICAL_STRIKE]))) {\r\n        // If the crit chance was more than 100%+1 rating, then the last rating was over the cap and worth 0.\r\n        return 0;\r\n      }\r\n      const ratingCritChanceContribution = 1 - baseCritChance / totalCritChance;\r\n\r\n      const critMult = this.critEffectBonus.getBonus(event);\r\n      const rawBaseHealing = healVal.raw / critMult;\r\n      const effectiveCritHealing = Math.max(0, healVal.effective - rawBaseHealing);\r\n      const rating = this.statTracker.currentCritRating;\r\n      const healIncreaseFromOneCrit = this.statTracker.statMultiplier.crit * ratingCritChanceContribution / rating;\r\n\r\n      return effectiveCritHealing * healIncreaseFromOneCrit;\r\n    }\r\n    return 0;\r\n  }\r\n  _hasteHpct(event, healVal) {\r\n    const currHastePerc = this.statTracker.currentHastePercentage;\r\n    const healIncreaseFromOneHaste = this.statTracker.statMultiplier.haste / this.statTracker.ratingNeededForNextPercentage(this.statTracker.currentHasteRating, this.statTracker.statBaselineRatingPerPercent[STAT.HASTE]);\r\n    const baseHeal = healVal.effective / (1 + currHastePerc);\r\n    return baseHeal * healIncreaseFromOneHaste;\r\n  }\r\n  _hasteHpm(event, healVal) {\r\n    const healIncreaseFromOneHaste = this.statTracker.statMultiplier.haste / this.statTracker.ratingNeededForNextPercentage(this.statTracker.currentHasteRating, this.statTracker.statBaselineRatingPerPercent[STAT.HASTE]);\r\n    const noHasteHealing = healVal.effective / (1 + this.statTracker.currentHastePercentage);\r\n    return noHasteHealing * healIncreaseFromOneHaste;\r\n  }\r\n  _mastery(event, healVal) {\r\n    throw new Error('Missing custom Mastery implementation. This is different per spec.');\r\n  }\r\n  _versatility(event, healVal) {\r\n    if (healVal.overheal) {\r\n      // If a spell overheals, it could not have healed for more. Seeing as Versatility only adds HP on top of the existing heal we can skip it as increasing the power of this heal would only be more overhealing.\r\n      return 0;\r\n    }\r\n    const currVersPerc = this.statTracker.currentVersatilityPercentage;\r\n    const healIncreaseFromOneVers = this.statTracker.statMultiplier.versatility / this.statTracker.ratingNeededForNextPercentage(this.statTracker.currentVersatilityRating, this.statTracker.statBaselineRatingPerPercent[STAT.VERSATILITY], 1, false);\r\n    const baseHeal = healVal.effective / (1 + currVersPerc);\r\n    return baseHeal * healIncreaseFromOneVers;\r\n  }\r\n\r\n  onDamageTaken(event) {\r\n    this._updateMissingHealth(event);\r\n\r\n    const damageVal = new DamageValue(event.amount, event.absorbed, event.blocked, event.overkill);\r\n    // const targetHealthPercentage = event.hitPoints / event.maxHitPoints; // hitPoints contains HP *after* the damage taken, which in this case is desirable\r\n    // this.totalOneVersDr += this._adjustGain(this._versatilityDamageReduction(event, damageVal), targetHealthPercentage);\r\n    // TODO: Figure out how to make this account for target health since damage event don't appear to have hitPoints info\r\n    this.totalOneVersDr += this._versatilityDamageReduction(event, damageVal);\r\n  }\r\n  _versatilityDamageReduction(event, damageVal) {\r\n    const amount = damageVal.effective;\r\n    const currentVersDamageReductionPercentage = this.statTracker.currentVersatilityPercentage / 2;\r\n    const damageReductionIncreaseFromOneVers = this.statTracker.statMultiplier.versatility / this.statTracker.ratingNeededForNextPercentage(this.statTracker.currentVersatilityRating, this.statTracker.statBaselineRatingPerPercent[STAT.VERSATILITY], 1, false) / 2; // the DR part is only 50% of the Versa percentage\r\n\r\n    const noVersDamage = amount / (1 - currentVersDamageReductionPercentage);\r\n    return noVersDamage * damageReductionIncreaseFromOneVers;\r\n  }\r\n\r\n  onHealTaken(event) {\r\n    this._updateMissingHealth(event);\r\n  }\r\n  _updateMissingHealth(event) {\r\n    if (event.hitPoints && event.maxHitPoints) { // fields not always populated, don't know why\r\n      // `maxHitPoints` is always the value *after* the effect applied\r\n      this.playerHealthMissing = event.maxHitPoints - event.hitPoints;\r\n    }\r\n  }\r\n\r\n  onFightend() {\r\n    if (DEBUG) {\r\n      console.log('total', formatNumber(this.totalAdjustedHealing));\r\n      console.log(`Int - ${formatNumber(this.totalOneInt)}`);\r\n      console.log(`Crit - ${formatNumber(this.totalOneCrit)}`);\r\n      console.log(`Haste HPCT - ${formatNumber(this.totalOneHasteHpct)}`);\r\n      console.log(`Haste HPM - ${formatNumber(this.totalOneHasteHpm)}`);\r\n      console.log(`Mastery - ${formatNumber(this.totalOneMastery)}`);\r\n      console.log(`Vers - ${formatNumber(this.totalOneVers)}`);\r\n      console.log(`Leech - ${formatNumber(this.totalOneLeech)}`);\r\n    }\r\n  }\r\n\r\n  get hpsPerIntellect() {\r\n    return this._getGain(STAT.INTELLECT) / this.owner.fightDuration * 1000;\r\n  }\r\n  get hpsPerCriticalStrike() {\r\n    return this._getGain(STAT.CRITICAL_STRIKE) / this.owner.fightDuration * 1000;\r\n  }\r\n  get hpsPerHasteHPCT() {\r\n    return this._getGain(STAT.HASTE_HPCT) / this.owner.fightDuration * 1000;\r\n  }\r\n  get hpsPerHasteHPM() {\r\n    return this._getGain(STAT.HASTE_HPM) / this.owner.fightDuration * 1000;\r\n  }\r\n  get hpsPerHaste() {\r\n    return this.hpsPerHasteHPCT + this.hpsPerHasteHPM;\r\n  }\r\n  get hpsPerMastery() {\r\n    return this._getGain(STAT.MASTERY) / this.owner.fightDuration * 1000;\r\n  }\r\n  get hpsPerVersatility() {\r\n    return this._getGain(STAT.VERSATILITY) / this.owner.fightDuration * 1000;\r\n  }\r\n  get hpsPerVersatilityDR() {\r\n    return this._getGain(STAT.VERSATILITY_DR) / this.owner.fightDuration * 1000;\r\n  }\r\n  get hpsPerLeech() {\r\n    return this._getGain(STAT.LEECH) / this.owner.fightDuration * 1000;\r\n  }\r\n\r\n  // region Item values\r\n  calculateItemStatsHps(baseStats, itemLevel) {\r\n    let hps = 0;\r\n    if (baseStats.primary) {\r\n      hps += calculatePrimaryStat(baseStats.itemLevel, baseStats.primary, itemLevel) * this.hpsPerIntellect;\r\n    }\r\n    if (baseStats.criticalStrike) {\r\n      hps += calculateSecondaryStatDefault(baseStats.itemLevel, baseStats.criticalStrike, itemLevel) * this.hpsPerCriticalStrike;\r\n    }\r\n    if (baseStats.haste) {\r\n      hps += calculateSecondaryStatDefault(baseStats.itemLevel, baseStats.haste, itemLevel) * this.hpsPerHaste;\r\n    }\r\n    if (baseStats.mastery) {\r\n      hps += calculateSecondaryStatDefault(baseStats.itemLevel, baseStats.mastery, itemLevel) * this.hpsPerMastery;\r\n    }\r\n    if (baseStats.versatility) {\r\n      hps += calculateSecondaryStatDefault(baseStats.itemLevel, baseStats.versatility, itemLevel) * this.hpsPerVersatility;\r\n    }\r\n    if (baseStats.leech) {\r\n      hps += calculateSecondaryStatDefault(baseStats.itemLevel, baseStats.leech, itemLevel) * this.hpsPerLeech;\r\n    }\r\n    return hps;\r\n  }\r\n  // endregion\r\n\r\n  // region statistic\r\n  _ratingPerOnePercent(oneRatingHealing) {\r\n    const onePercentHealing = this.totalAdjustedHealing / 100;\r\n    return onePercentHealing / oneRatingHealing;\r\n  }\r\n  _getGain(stat) {\r\n    switch (stat) {\r\n      case STAT.INTELLECT:\r\n        return this.totalOneInt;\r\n      case STAT.CRITICAL_STRIKE:\r\n        return this.totalOneCrit;\r\n      case STAT.HASTE_HPCT:\r\n        return this.totalOneHasteHpct;\r\n      case STAT.HASTE_HPM:\r\n        return this.totalOneHasteHpm;\r\n      case STAT.MASTERY:\r\n        return this.totalOneMastery;\r\n      case STAT.VERSATILITY:\r\n        return this.totalOneVers;\r\n      case STAT.VERSATILITY_DR:\r\n        return this.totalOneVers + this.totalOneVersDr;\r\n      case STAT.LEECH:\r\n        return this.totalOneLeech;\r\n      default:\r\n        return 0;\r\n    }\r\n  }\r\n  _getTooltip(stat) {\r\n    switch (stat) {\r\n      case STAT.HASTE_HPCT:\r\n        return <Trans id=\"shared.healerStatValues.stats.hpct\">HPCT stands for \"Healing per Cast Time\". This is the value that Haste would be worth if you would cast everything you are already casting (and that scales with Haste) faster. Mana is not accounted for in any way and you should consider the Haste stat weight 0 if you run out of mana while doing everything else right.</Trans>;\r\n      case STAT.HASTE_HPM:\r\n        return <Trans id=\"shared.healerStatValues.stats.hpm\">HPM stands for \"Healing per Mana\". In valuing Haste, it considers only the faster HoT ticking and not the reduced cast times. Effectively it models haste's bonus to mana efficiency. This is typically the better calculation to use for raid encounters where mana is an issue.</Trans>;\r\n      case STAT.VERSATILITY_DR:\r\n        return <Trans id=\"shared.healerStatValues.stats.versDR\">Weight includes both healing boost and damage reduction, counting the damage reduced as additional throughput.</Trans>;\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n  moreInformationLink = null;\r\n  static position = STATISTIC_ORDER.CORE(9);\r\n  statistic() {\r\n    const results = this._prepareResults();\r\n    const qeLink = results.reduce((urlParts, stat) => {\r\n      if (stat === 'intellect' || stat === 'versatilitydr') {\r\n        return urlParts;\r\n      }\r\n\r\n      const statValue = typeof stat === 'object' ? stat.stat : stat;\r\n      const gain = this._getGain(statValue);\r\n      const weight = gain / (this.totalOneInt || 1);\r\n      const statName = getName(statValue).replace(/[()\\s+]/g, '');\r\n\r\n      urlParts.push(statName + '=' + weight.toFixed(2));\r\n      return urlParts;\r\n    }, []).join('&');\r\n    return (\r\n      <StatisticWrapper position={this.constructor.position}>\r\n        <div className=\"col-lg-6 col-md-6 col-sm-6 col-xs-12\">\r\n          <div className=\"panel items statistic\">\r\n            {this.moreInformationLink && (\r\n              <a\r\n                href={this.moreInformationLink}\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n              >\r\n                <Tooltip content=\"Click for more information.\">\r\n                  <div\r\n                    className=\"detail-corner\"\r\n                    data-place=\"top\"\r\n                  >\r\n                    <InfoIcon />\r\n                  </div>\r\n                </Tooltip>\r\n              </a>\r\n            )}\r\n            <div className=\"panel-body\" style={{ padding: '10px 0 16px' }}>\r\n              <table className=\"data-table compact\" style={{ margin: 0 }}>\r\n                <thead>\r\n                  <tr className=\"text-muted\">\r\n                    <th style={{ minWidth: 30, fontWeight: 400 }}>\r\n                      <TooltipElement\r\n                        content={(\r\n                          <Trans id=\"shared.healerStatValues.statistic.title.tooltip\">\r\n                            These stat values are calculated using the actual circumstances of this encounter. These values reveal the value of the last 1 rating of each stat, they may not necessarily be the best way to gear. The stat values are likely to differ based on fight, raid size, items used, talents chosen, etc.<br /><br />\r\n                            DPS gains are not included in any of the stat values.\r\n                          </Trans>\r\n                        )}\r\n                      >\r\n                        <Trans id=\"shared.healerStatValues.statistic.title\">Stat Values</Trans>\r\n                      </TooltipElement>\r\n                      {false && this.qeLive && this.selectedCombatant.characterProfile && ( // globally disable the QELive button until QE is updated to accept Shadowlands data\r\n                        <Tooltip content=\"Opens in a new tab. Leverage the QE Live Tool to directly compare gear, azerite traits, and trinkets based on your stat values.\">\r\n                          <a\r\n                            href={`https://www.questionablyepic.com/live?import=WoWA&spec=${this.selectedCombatant.specId}&pname=${this.selectedCombatant.name}&realm=${this.selectedCombatant.characterProfile.realm}&region=${this.selectedCombatant.characterProfile.region}&${qeLink}`}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                          >\r\n                            <Trans id=\"shared.healerStatValues.statistic.qeLink\"><img src={QELiveLogo} alt=\"Questionably Epic Live\" style={{ height: '1.2em', marginLeft: 15 }} /> Open Questionably Epic Live</Trans>\r\n                          </a>\r\n                        </Tooltip>\r\n                      )}\r\n                    </th>\r\n                    <th className=\"text-right\" style={{ minWidth: 30, fontWeight: 400 }} colSpan={2}>\r\n                      <TooltipElement content={<Trans id=\"shared.healerStatValues.statistic.title.value.tooltip\">Normalized so Intellect is always 1.00.</Trans>}>\r\n                        <Trans id=\"shared.healerStatValues.statistic.title.value\">Value</Trans>\r\n                      </TooltipElement>\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {results.map(row => {\r\n                    const stat = typeof row === 'object' ? row.stat : row;\r\n                    const tooltip = typeof row === 'object' ? row.tooltip : this._getTooltip(stat);\r\n                    const gain = this._getGain(stat);\r\n                    const weight = gain / (this.totalOneInt || 1);\r\n                    const ratingForOne = this._ratingPerOnePercent(gain);\r\n\r\n                    const Icon = getIcon(stat);\r\n\r\n                    const gainPerSecond = (gain / this.owner.fightDuration * 1000).toFixed(2);\r\n                    const rating = gain !== null ? (ratingForOne === Infinity ? '∞' : formatNumber(ratingForOne)) : 'NYI';\r\n                    const informationIconTooltip = <Trans id=\"shared.healerStatValues.statistic.stats.tooltip\">{gainPerSecond} HPS per 1 rating / {rating} rating per 1% throughput</Trans>;\r\n\r\n                    return (\r\n                      <tr key={stat}>\r\n                        <td className={getClassNameColor(stat)}>\r\n                          <Icon\r\n                            style={{\r\n                              height: '1.6em',\r\n                              width: '1.6em',\r\n                              marginRight: 10,\r\n                            }}\r\n                          />{' '}\r\n                          {tooltip ? <TooltipElement content={tooltip}>{getNameTranslated(stat)}</TooltipElement> : getNameTranslated(stat)}\r\n                        </td>\r\n                        <td className=\"text-right\">\r\n                          {stat === STAT.HASTE_HPCT && '0.00 - '}{gain !== null ? weight.toFixed(2) : 'NYI'}\r\n                        </td>\r\n                        <td style={{ padding: 6 }}>\r\n                          <Tooltip content={informationIconTooltip}>\r\n                            <div>\r\n                              <InformationIcon />\r\n                            </div>\r\n                          </Tooltip>\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </StatisticWrapper>\r\n    );\r\n  }\r\n  // endregion\r\n}\r\n\r\nexport default BaseHealerStatValues;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport { formatPercentage } from 'common/format';\r\nimport SpellLink from 'common/SpellLink';\r\n\r\nimport StatisticBox, { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\nimport ItemHealingDone from 'interface/ItemHealingDone';\r\nimport UptimeIcon from 'interface/icons/Uptime';\r\nimport SPECS from 'game/SPECS';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { HealEvent } from 'parser/core/Events';\r\nimport { ThresholdStyle } from 'parser/core/ParseResults';\r\nimport calculateEffectiveHealing from 'parser/core/calculateEffectiveHealing';\r\nimport Combatants from 'parser/shared/modules/Combatants';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport { HEALING_ABILITIES_AMPED_BY_EARTH_SHIELD } from 'parser/shaman/shared/constants';\r\nimport { EMBRACE_OF_EARTH_RANKS } from 'parser/shaman/restoration/constants';\r\n\r\nexport const EARTHSHIELD_HEALING_INCREASE = 0.20;\r\n\r\nclass EarthShield extends Analyzer {\r\n  static dependencies = {\r\n    combatants: Combatants,\r\n  };\r\n\r\n  protected combatants!: Combatants;\r\n\r\n  healing = 0;\r\n  buffHealing = 0;\r\n  earthShieldHealingIncrease = EARTHSHIELD_HEALING_INCREASE;\r\n  category = STATISTIC_CATEGORY.TALENTS;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    const isRsham = this.selectedCombatant.specId === SPECS.RESTORATION_SHAMAN.id;\r\n    this.active = isRsham || this.selectedCombatant.hasTalent(SPELLS.EARTH_SHIELD.id);\r\n\r\n    if (isRsham) {\r\n      this.category = STATISTIC_CATEGORY.GENERAL;\r\n    }\r\n\r\n    const conduitRank = this.selectedCombatant.conduitRankBySpellID(SPELLS.EMBRACE_OF_EARTH.id);\r\n    if (conduitRank) {\r\n      this.earthShieldHealingIncrease += EMBRACE_OF_EARTH_RANKS[conduitRank] / 100;\r\n    }\r\n\r\n    // event listener for direct heals when taking damage with earth shield\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(SPELLS.EARTH_SHIELD_HEAL), this.onEarthShieldHeal);\r\n\r\n    const HEALING_ABILITIES_AMPED_BY_EARTH_SHIELD_FILTERED = HEALING_ABILITIES_AMPED_BY_EARTH_SHIELD.filter(p => p !== SPELLS.EARTH_SHIELD_HEAL);\r\n    // event listener for healing being buffed by having earth shield on the target\r\n    this.addEventListener(Events.heal.by(SELECTED_PLAYER).spell(HEALING_ABILITIES_AMPED_BY_EARTH_SHIELD_FILTERED), this.onEarthShieldAmpSpellHeal);\r\n  }\r\n\r\n  get uptime() {\r\n    return Object.values((this.combatants.players)).reduce((uptime, player) => uptime + player.getBuffUptime(SPELLS.EARTH_SHIELD.id, this.owner.playerId), 0);\r\n  }\r\n\r\n  get uptimePercent() {\r\n    return this.uptime / this.owner.fightDuration;\r\n  }\r\n\r\n  get suggestionThresholds() {\r\n    return {\r\n      actual: this.uptimePercent,\r\n      isLessThan: {\r\n        minor: 0.95,\r\n        average: 0.90,\r\n        major: 0.80,\r\n      },\r\n      style: ThresholdStyle.PERCENTAGE,\r\n    };\r\n  }\r\n\r\n  onEarthShieldHeal(event: HealEvent) {\r\n    this.healing += (event.amount + (event.absorbed || 0));\r\n  }\r\n\r\n  onEarthShieldAmpSpellHeal(event: HealEvent) {\r\n    const combatant = this.combatants.getEntity(event);\r\n    if (combatant && combatant.hasBuff(SPELLS.EARTH_SHIELD.id, event.timestamp)) {\r\n      this.buffHealing += calculateEffectiveHealing(event, this.earthShieldHealingIncrease);\r\n    }\r\n  }\r\n\r\n  // gets overriden by the rshaman module\r\n  getFeeding() {\r\n    return 0;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <StatisticBox\r\n        label={<SpellLink id={SPELLS.EARTH_SHIELD.id} />}\r\n        category={this.category}\r\n        position={STATISTIC_ORDER.OPTIONAL(45)}\r\n        tooltip={<Trans id=\"shaman.shared.earthShield.statistic.tooltip\">{formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.healing))}% from the HoT and {formatPercentage(this.owner.getPercentageOfTotalHealingDone(this.buffHealing))}% from the healing increase.</Trans>}\r\n        value={\r\n          (\r\n            <div>\r\n              <UptimeIcon /> {formatPercentage(this.uptimePercent)}% <small>uptime</small><br />\r\n              <ItemHealingDone amount={this.healing + this.buffHealing + this.getFeeding()} />\r\n            </div>\r\n          )\r\n        }\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default EarthShield;\r\n","import React from 'react';\r\n\r\nimport Panel from 'interface/statistics/Panel';\r\nimport Analyzer from 'parser/core/Analyzer';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport HealingEfficiencyTracker from './HealingEfficiencyTracker';\r\nimport HealingEfficiencyBreakdown from './HealingEfficiencyBreakdown';\r\n\r\nclass HealingEfficiencyDetails extends Analyzer {\r\n  static dependencies = {\r\n    healingEfficiencyTracker: HealingEfficiencyTracker,\r\n  };\r\n\r\n  protected healingEfficiencyTracker!: HealingEfficiencyTracker;\r\n\r\n  statistic() {\r\n    return (\r\n      <Panel\r\n        title={<Trans id=\"shared.healingEfficiency.title\">Mana Efficiency</Trans>}\r\n        position={120}\r\n      >\r\n        <HealingEfficiencyBreakdown tracker={this.healingEfficiencyTracker} />\r\n      </Panel>\r\n    );\r\n  }\r\n}\r\n\r\nexport default HealingEfficiencyDetails;\r\n","import SPELLS from 'common/SPELLS';\r\n\r\nimport { ABILITIES_AFFECTED_BY_HEALING_INCREASES } from '../restoration/constants';\r\n\r\nexport const HEALING_ABILITIES_AMPED_BY_EARTH_SHIELD = [\r\n  ...ABILITIES_AFFECTED_BY_HEALING_INCREASES,\r\n];\r\n\r\nexport const ELEMENTAL_BLAST_BUFFS = [\r\n  SPELLS.ELEMENTAL_BLAST_CRIT,\r\n  SPELLS.ELEMENTAL_BLAST_MASTERY,\r\n  SPELLS.ELEMENTAL_BLAST_HASTE,\r\n];\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport { formatThousands, formatNumber } from 'common/format';\r\n\r\nimport StatisticBox, { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\nimport STATISTIC_CATEGORY from 'interface/others/STATISTIC_CATEGORY';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport { Trans } from '@lingui/macro';\r\nimport SpellLink from 'common/SpellLink';\r\n\r\nconst SPIRIT_WOLF_DAMAGE_REDUCTION_PER_STACK = 0.05;\r\n\r\nclass SpiritWolf extends Analyzer {\r\n  damageReduced = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.SPIRIT_WOLF_TALENT.id);\r\n\r\n    this.addEventListener(Events.damage.to(SELECTED_PLAYER), this.damageTaken);\r\n  }\r\n\r\n  damageTaken(event: DamageEvent) {\r\n    if (!this.selectedCombatant.hasBuff(SPELLS.SPIRIT_WOLF_BUFF.id)) {\r\n      return;\r\n    }\r\n    const stacks = this.selectedCombatant.getBuff(SPELLS.SPIRIT_WOLF_BUFF.id)?.stacks;\r\n    if (!stacks) {\r\n      return;\r\n    }\r\n    const damageTaken = event.amount + (event.absorbed || 0);\r\n    this.damageReduced += damageTaken / (1 - (SPIRIT_WOLF_DAMAGE_REDUCTION_PER_STACK * stacks)) * (SPIRIT_WOLF_DAMAGE_REDUCTION_PER_STACK * stacks);\r\n  }\r\n\r\n  get totalDrps() {\r\n    return this.damageReduced / this.owner.fightDuration * 1000;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <StatisticBox\r\n        position={STATISTIC_ORDER.OPTIONAL(45)}\r\n        category={STATISTIC_CATEGORY.TALENTS}\r\n        icon={<SpellIcon id={SPELLS.SPIRIT_WOLF_TALENT.id} />}\r\n        value={`≈${formatNumber(this.totalDrps)} DRPS`}\r\n        label={<Trans id=\"shaman.shared.damageReduced.label\">Estimated damage reduced</Trans>}\r\n        tooltip={(\r\n          <Trans id=\"shaman.shared.damageReduced.tooltip\">\r\n            The total estimated damage reduced was {formatThousands(this.damageReduced)}.<br /><br />\r\n            \r\n            This is the lowest possible value. This value is pretty accurate for this log if you are looking at the actual gain over not having <SpellLink id={SPELLS.SPIRIT_WOLF_TALENT.id} /> bonus at all, but the gain may end up higher when taking interactions with other damage reductions into account.\r\n          </Trans>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default SpiritWolf;\r\n","import SPELLS from 'common/SPELLS';\r\nimport Analyzer, { Options, SELECTED_PLAYER_PET } from 'parser/core/Analyzer';\r\nimport Events from 'parser/core/Events';\r\nimport SpellUsable from 'parser/shared/modules/SpellUsable';\r\n\r\n// Static Charge can only reduce the cooldown down to 40 seconds\r\nconst minimumCooldown = 40000;\r\nconst stunReduction = 5000;\r\n\r\nclass StaticCharge extends Analyzer {\r\n  static dependencies = {\r\n    spellUsable: SpellUsable,\r\n  };\r\n\r\n  protected spellUsable!: SpellUsable;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n    this.active = this.selectedCombatant.hasTalent(SPELLS.STATIC_CHARGE_TALENT.id);\r\n\r\n    this.addEventListener(Events.applydebuff.by(SELECTED_PLAYER_PET).spell(SPELLS.STATIC_CHARGE_DEBUFF), this.stunApplication);\r\n  }\r\n\r\n  stunApplication() {\r\n    const cooldownRemaining = this.spellUsable.cooldownRemaining(SPELLS.CAPACITOR_TOTEM.id);\r\n    if (cooldownRemaining <= minimumCooldown) {\r\n      return;\r\n    }\r\n\r\n    this.spellUsable.reduceCooldown(SPELLS.CAPACITOR_TOTEM.id, stunReduction);\r\n  }\r\n}\r\n\r\nexport default StaticCharge;\r\n","import React from 'react';\r\n\r\nimport SPELLS from 'common/SPELLS';\r\nimport SpellIcon from 'common/SpellIcon';\r\nimport { formatThousands, formatNumber } from 'common/format';\r\n\r\nimport StatisticBox, { STATISTIC_ORDER } from 'interface/others/StatisticBox';\r\n\r\nimport Analyzer, { Options, SELECTED_PLAYER } from 'parser/core/Analyzer';\r\nimport Events, { DamageEvent } from 'parser/core/Events';\r\nimport { Trans } from '@lingui/macro';\r\nimport SpellLink from 'common/SpellLink';\r\n\r\nconst ASTRAL_SHIFT_DR = 0.4;\r\n\r\nclass AstralShift extends Analyzer {\r\n  damageReduced = 0;\r\n\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    this.addEventListener(Events.damage.to(SELECTED_PLAYER), this.damageTaken);\r\n  }\r\n\r\n  damageTaken(event: DamageEvent) {\r\n    if (!this.selectedCombatant.hasBuff(SPELLS.ASTRAL_SHIFT.id)) {\r\n      return;\r\n    }\r\n    const damageTaken = event.amount + (event.absorbed || 0);\r\n    this.damageReduced += damageTaken / (1 - (ASTRAL_SHIFT_DR)) * (ASTRAL_SHIFT_DR);\r\n  }\r\n\r\n  get totalDrps() {\r\n    return this.damageReduced / this.owner.fightDuration * 1000;\r\n  }\r\n\r\n  statistic() {\r\n    return (\r\n      <StatisticBox\r\n        position={STATISTIC_ORDER.OPTIONAL()}\r\n        icon={<SpellIcon id={SPELLS.ASTRAL_SHIFT.id} />}\r\n        value={`≈${formatNumber(this.totalDrps)} DRPS`}\r\n        label={<Trans id=\"shaman.shared.damageReduced.label\">Estimated damage reduced</Trans>}\r\n        tooltip={(\r\n          <Trans id=\"shaman.shared.damageReduced.tooltip\">\r\n            The total estimated damage reduced was {formatThousands(this.damageReduced)}.<br /><br />\r\n            \r\n            This is the lowest possible value. This value is pretty accurate for this log if you are looking at the actual gain over not having <SpellLink id={SPELLS.ASTRAL_SHIFT.id} /> bonus at all, but the gain may end up higher when taking interactions with other damage reductions into account.\r\n          </Trans>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default AstralShift;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Trans } from '@lingui/macro';\r\n\r\nimport SPECS from 'game/SPECS';\r\nimport SpecIcon from 'common/SpecIcon';\r\nimport { formatNumber } from 'common/format';\r\nimport { TooltipElement } from 'common/Tooltip';\r\nimport indexByProperty from 'common/indexByProperty';\r\nimport Toggle from 'react-toggle';\r\nimport SpellLink from 'common/SpellLink';\r\nimport PerformanceBar from 'interface/PerformanceBar';\r\n\r\nclass PlayerBreakdown extends React.Component {\r\n  static propTypes = {\r\n    report: PropTypes.object.isRequired,\r\n    spellreport: PropTypes.object,\r\n    players: PropTypes.array.isRequired,\r\n  };\r\n  state = {\r\n    showPlayers: true,\r\n  };\r\n\r\n  calculatePlayerBreakdown(statsByTargetId, players) {\r\n    const friendlyStats = [];\r\n    const playersById = indexByProperty(players, 'id');\r\n    Object.keys(statsByTargetId)\r\n      .forEach(targetId => {\r\n        const playerStats = statsByTargetId[targetId];\r\n        const playerInfo = playersById[targetId];\r\n\r\n        if (playerInfo) {\r\n          friendlyStats.push({\r\n            ...playerInfo,\r\n            ...playerStats,\r\n            masteryEffectiveness: playerStats.healingFromMastery / (playerStats.maxPotentialHealingFromMastery || 1),\r\n          });\r\n        }\r\n      });\r\n\r\n    return friendlyStats;\r\n  }\r\n\r\n  calculateSpellBreakdown(statsBySpellId) {\r\n    const spellStats = [];\r\n    Object.keys(statsBySpellId)\r\n      .forEach(spellId => {\r\n        const spell = statsBySpellId[spellId];\r\n\r\n        spellStats.push({\r\n          ...spell,\r\n          masteryEffectiveness: spell.healingFromMastery / (spell.maxPotentialHealingFromMastery || 1),\r\n        });\r\n      });\r\n\r\n    return spellStats;\r\n  }\r\n\r\n  render() {\r\n    const { report, spellreport, players } = this.props;\r\n\r\n    const friendlyStats = this.calculatePlayerBreakdown(report, players);\r\n    const totalEffectiveHealing = Object.values(report).reduce((sum, player) => sum + player.effectiveHealing, 0);\r\n    const highestEffectiveHealing = friendlyStats.reduce((highest, player) => Math.max(highest, player.effectiveHealing), 1);\r\n    const highestMasteryEffectiveness = friendlyStats.reduce((highest, player) => Math.max(highest, player.masteryEffectiveness), 0);\r\n\r\n    let spellStats = [];\r\n    let totalSpellEffectiveHealing = 0;\r\n    let highestSpellEffectiveHealing = 0;\r\n    let highestSpellMasteryEffectiveness = 0;\r\n    if (spellreport) {\r\n      spellStats = this.calculateSpellBreakdown(spellreport);\r\n      totalSpellEffectiveHealing = Object.values(spellreport).reduce((sum, spell) => sum + spell.effectiveHealing, 0);\r\n      highestSpellEffectiveHealing = spellStats.reduce((highest, spell) => Math.max(highest, spell.effectiveHealing), 1);\r\n      highestSpellMasteryEffectiveness = spellStats.reduce((highest, spell) => Math.max(highest, spell.masteryEffectiveness), 0);\r\n    }\r\n\r\n    return (\r\n      <>\r\n        {spellreport &&\r\n          <div className=\"pad\">\r\n            <div className=\"pull-right\">\r\n              <div className=\"toggle-control pull-left\" style={{ marginLeft: '.5em' }}>\r\n                <label htmlFor=\"playerbreakdown-toggle\" style={{ marginLeft: '0.5em', marginRight: '1em' }}>\r\n                  <Trans id=\"interface.playerBreakdown.toggle.spells\">Spells</Trans>\r\n                </label>\r\n                <Toggle\r\n                  defaultChecked\r\n                  icons={false}\r\n                  onChange={event => this.setState({ showPlayers: event.target.checked })}\r\n                  id=\"playerbreakdown-toggle\"\r\n                />\r\n                <label htmlFor=\"playerbreakdown-toggle\" style={{ marginLeft: '0.5em' }}>\r\n                  <Trans id=\"interface.playerBreakdown.toggle.players\">Players</Trans>\r\n                </label>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        }\r\n        <table className=\"data-table\">\r\n          <thead>\r\n            <tr style={{ textTransform: 'uppercase' }}>\r\n              <th><Trans id=\"interface.playerBreakdown.name\">Name</Trans></th>\r\n              <th colSpan=\"2\"><Trans id=\"interface.playerBreakdown.masteryEffectiveness\">Mastery effectiveness</Trans></th>\r\n              <th colSpan=\"3\"><TooltipElement content={<Trans id=\"interface.playerBreakdown.masteryEffectivenessTooltip\">This is the amount of healing done by spells affected by mastery. Things like Holy Paladin beacons or Restoration Shaman feeding are NOT included.</Trans>}><Trans id=\"interface.playerBreakdown.healingDone\">Healing done</Trans></TooltipElement></th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {!this.state.showPlayers && spellStats && spellStats\r\n              .sort((a, b) => b.masteryEffectiveness - a.masteryEffectiveness)\r\n              .map((spell) => {\r\n                // We want the performance bar to show a full bar for whatever healing done percentage is highest to make\r\n                // it easier to see relative amounts.\r\n                const performanceBarMasteryEffectiveness = spell.masteryEffectiveness / highestSpellMasteryEffectiveness;\r\n                const performanceBarHealingDonePercentage = spell.effectiveHealing / highestSpellEffectiveHealing;\r\n                const actualHealingDonePercentage = spell.effectiveHealing / totalSpellEffectiveHealing;\r\n\r\n                return (\r\n                  <tr key={spell.spellId}>\r\n                    <td style={{ width: '20%' }}>\r\n                      <SpellLink id={spell.spellId} />\r\n                    </td>\r\n                    <td style={{ width: 50, textAlign: 'right' }}>\r\n                      {(Math.round(spell.masteryEffectiveness * 10000) / 100).toFixed(2)}%\r\n                  </td>\r\n                    <td style={{ width: '40%' }}>\r\n                      <PerformanceBar percent={performanceBarMasteryEffectiveness} />\r\n                    </td>\r\n                    <td style={{ width: 50, textAlign: 'right' }}>\r\n                      {(Math.round(actualHealingDonePercentage * 10000) / 100).toFixed(2)}%\r\n                  </td>\r\n                    <td style={{ width: '40%' }}>\r\n                      <PerformanceBar percent={performanceBarHealingDonePercentage} />\r\n                    </td>\r\n                    <td style={{ width: 50, textAlign: 'right' }}>\r\n                      {(formatNumber(spell.effectiveHealing))}\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n            {this.state.showPlayers && friendlyStats && friendlyStats\r\n              .sort((a, b) => b.masteryEffectiveness - a.masteryEffectiveness)\r\n              .map((player) => {\r\n                const combatant = player.combatant;\r\n                if (!combatant) {\r\n                  console.error('Missing combatant:', player);\r\n                  return null; // pet or something\r\n                }\r\n                const spec = SPECS[combatant.specId];\r\n                const specClassName = spec.className.replace(' ', '');\r\n                // We want the performance bar to show a full bar for whatever healing done percentage is highest to make\r\n                // it easier to see relative amounts.\r\n                const performanceBarMasteryEffectiveness = player.masteryEffectiveness / highestMasteryEffectiveness;\r\n                const performanceBarHealingReceivedPercentage = player.effectiveHealing / highestEffectiveHealing;\r\n                const actualHealingReceivedPercentage = player.effectiveHealing / totalEffectiveHealing;\r\n\r\n                return (\r\n                  <tr key={combatant.id}>\r\n                    <td style={{ width: '20%' }}>\r\n                      <SpecIcon id={spec.id} />{' '}\r\n                      {combatant.name}\r\n                    </td>\r\n                    <td style={{ width: 50, textAlign: 'right' }}>\r\n                      {(Math.round(player.masteryEffectiveness * 10000) / 100).toFixed(2)}%\r\n                    </td>\r\n                    <td style={{ width: '40%' }}>\r\n                      <div className=\"flex performance-bar-container\">\r\n                        <div\r\n                          className={`flex-sub performance-bar ${specClassName}-bg`}\r\n                          style={{ width: `${performanceBarMasteryEffectiveness * 100}%` }}\r\n                        />\r\n                      </div>\r\n                    </td>\r\n                    <td style={{ width: 50, textAlign: 'right' }}>\r\n                      {(Math.round(actualHealingReceivedPercentage * 10000) / 100).toFixed(2)}%\r\n                    </td>\r\n                    <td style={{ width: '40%' }}>\r\n                      <div className=\"flex performance-bar-container\">\r\n                        <div\r\n                          className={`flex-sub performance-bar ${specClassName}-bg`}\r\n                          style={{ width: `${performanceBarHealingReceivedPercentage * 100}%` }}\r\n                        />\r\n                      </div>\r\n                    </td>\r\n                    <td style={{ width: 50, textAlign: 'right' }}>\r\n                      {(formatNumber(player.effectiveHealing))}\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n          </tbody>\r\n        </table>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default PlayerBreakdown;\r\n","// A helper function that's more performant than a reduce without being more readable by consumers\r\nexport default function indexByProperty(arr, key) {\r\n  const objByKey = {};\r\n  const length = arr.length;\r\n  for (let i = 0; i < length; i += 1) {\r\n    const item = arr[i];\r\n    objByKey[item[key]] = item;\r\n  }\r\n  return objByKey;\r\n}\r\n"],"sourceRoot":""}